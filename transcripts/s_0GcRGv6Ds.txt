 how does it go on YouTube this is nips that can be doing nibbles from hack the box which was a relatively easy machine so I haven't really done any prep work so you can kind of see the workflow we go through when we go solve this machine because well it's been probably four to five months since I've looked at this machine so with that being said let's just jump in the first thing we do is create the end map directory to hold the results and then we can run the scan with end map - SC for default scripts SV and reversions Oh a output all formats put in the end map directory call in the file initial now I'm going to add - vvv so it shows us what port is open as soon as it finds out and the IP address of nibbles which is 10 10 10 75 we see it has discovered port 80 so let's go to that page first check boat intercept to set off then we can go to nibbles and we see just hello world so I'm going to copy this send this over into repeater so paste refresh go to book then do control shift or to send repeater and go to that tab maybe that just goes a tab controller to send a repeater and then hold shift and we'll switch to the tab there's probably a hotkey to do both but I guess I missed it click go and we can see it is running Apache 2 4 1 8 on Ubuntu we also see a comment down here that says go to the directory slash nibble blog but first I'm gonna see exactly what this Apache version is I think this is Ubuntu xenial so I'm going to Google two four one eight Apache Ubuntu turning intercept off go to packages and we do see yes it is xenial Apache - doesn't really do us any good right now but that information is always useful to have because knowing that you distro can tell you what type of exploits to throw once you get a shell and if you see its end of life well you may want to throw shell shops and things like that so we're just gonna proceed and go to slash nibble blog and see what that is and we just see a page we see it's powered by nibble blog so the very first thing I'm going to do before doing go bust or anything and see if this is like an open-source application so just googling nibble blog we do get a website we also see it is on github but I just want to download the latest version because I want to see exactly if I can find out how to enumerate what version a software is installed to see if this is a fully up-to-date or not so we're downloading the code right now and the reason I don't do this off github is because those are not releases there's a commits so they may not update the version every time if that makes sense you get better results by looking at the actual release so I'm gonna move that file into a working directory unzip it and we go into nibble vlog I'm going to do a grep a recursive grab so that's grep with a - capital or I believe 4:05 that is the version that we are running and then we do dot for the current working directory and we see that string is in quite a few files so I'm gonna fight this - orc we do - capital F a field separator and I want to separate at : and then single quote print dollar side one so I'm gonna grab the very first match and we can see what files we can also pipe that to unique so we see tiny MCE has 4:05 but that may just be in like these font sizes I'm gonna look at this admin rules 98 constant stop bit and we see the nibble blog version is 4 0 5 right here so let's check that out paste that in there there we get a blank page but if we do control you to view the source code we do see PHP is failing to execute because this is the dot bi T extension I'm guessing the code uses include to include this file but because it's not dot PHP we can see the source code because the server is not going to execute it and we see it as running version 4.0.3 I guess the codename is coffee and the last release is in 2014 so we can do a search point to look for potential vulnerabilities and we do have two different ones we have a file upload and a multi-core injection so I'm going to run search poit - m2 mirror and then paste in the exploit to copy it to my current working directory and actually I'm going to move those into a different directory so I have the first one in this expose directory and now let's copy that second one and we can just look at them so looking at 3 5 8 6 5 text we see new blog 3.0 is infected so we're just gonna get rid of that file because we don't care about it we're running for 0 3 not 3l looking at the other one this is a Metasploit script the disclosure date is September 1st 2015 so we're gonna guess this version is vulnerable they specifically call out the target is 4 0 30 which is our version this is running Metasploit though and I don't really want to use Metasploit so let's just look at the blog post that is referenced in this script and see if we can figure out how the exploit works so when updating about uploading files via my image plug-in by default it keeps the extension of the uploaded file so all we have to do is find a way to upload images and then upload the file very simple so proof of concept obtain admin credentials so this is a credentialed attack we can't do it as an uncle natural user they're saying use cross-site scripting or cross-site request forgery we can't really do that because that's not common and vulnerable scenario since you need to exploit a user then you activate my image plug-in upload your shell and then visit this directory so let's find a way to log in and to do that I'm gonna go back into nibble blog and look for potentially useful fired files so if we go to admin dot PHP see what that is admin dot PHP get rid of this view source that is the login so we've got copyright text not too interesting feed PHP index dot PHP we didn't really look at that that much so if we just go home there a new post click around I don't see anything too interesting I'm trying to find like in the URL some way to view users so controller is equal to users maybe and then watch ID is equal to one not found so if we go back here can I do this quickly let's see nibble blog find dot grab controller and we have controllers let's see controller blog there's a controller blog there is not so I was thinking we followed kind of like a directory structure if I saw controller then slash blog then I know this would be a directory so I don't know exactly how that works yet so I'm gonna be lazy and just poke around that other files instead of trying to figure out exactly how this application works and we can see install dot PHP we can see if that was left open does this experience Talde maybe we want to update we go here and we get two different files this content private directory so let's see if we can go into this and it also exposes the version right there so this is a open directory and then we got users XML username admin ID is gonna be 0 I guess and maybe this is an epoch date for creation time looks like some type of blacklist not sure exactly what that black list is for but we do see the username admin so maybe this is counting the number of failed login attempts let's see if that number increases if we do admin dot PHP username as admin put a bad password refresh this we don't see that incrementing so I don't know exactly what that's doing so let's just try to brute force the username with Hydra so make a directory or just call this brute force and copy a few files let me go user share SEC list no word list SEC list and this file is off github you can just get clone or download it if you just Google SEC list github you don't go in the passwords and then we'll do rock you - 50 text I'm just best finding this because this is around 10,000 different passwords and for you just WC - all that we see 9400 and if you looked at the regular rock you is it just here this is 14 million so 14 millions gonna be a lot of web requests I'm gonna take forever so we're just gonna see if it's in the top 10,000 first so to run Hydra I think we do Hydra and then let's see - H they're a help to do this it's like HTTP - post see I guess we'll just wing it will do Hydra - L the user admin - capital P this is the password file lowercase L is just specify the username if it was capital L we see it is a file and then the server which is HTTP 10 10 10 75 and we won't do it h-e-b - post - correct quest and we specify the login path which is slash nibble blog admin dot php' colon now I got to put the HTTP request so let's go back here paste admin put a password of please subscribe go into burp intercept that request login back to boot we see there's only two different user fields so copy those out paste that in and change the username to be carrot user carrot all uppercase and this is how you tell Hydra it's a variable and then the password we do carrot Pass carrot okay and then we close this off with the tell Hydra what a incorrect login looks like so let's send this to repeater and we see the phrase incorrect username on that so let's just use that and we're gonna hope that uh it detects this and we have our error in the request so let's see maybe it's a to be post cuz it's an HTTP form still air let's get rid of HTTP and still unknown service what if there is a flag that we're missing Hydra username I don't have any uppercase is it a comma between variables it is not let's put that back to end and see what else could we be missing oh I'm an idiot I don't have the actual file RockYou 50 dots there after the - capital P there we go and it completed awfully fast so something got screwed up there because we have five different successes if we run this again are they all going to be the same no they're not so not sure what's going on here Hydra nibble blog admin dot PHP if we refresh this do we still see it nibble security error blacklist protection so I guess we hit the blacklist and got banned if we go back guys Boop intercept on turn that off refresh fail to account five for my IP address and I guess that's not good how do we make this no longer the case we get rid of the cookie I'm guessing that's not gonna help us no it is not because it's IP based may actually have to just revert the box at this point or wait a few minutes huh so the lesson learned is don't run Hydra against applications if you're not positive there's a lock yet or not because you may lock yourself out which sucks oh let's see is there something else I can do let go still blacklist protection so we're gonna have to proxy requests through a web server to get past this I believe so let's uh do that I should have the SSH key from the last video I did falafels so SSH - I dot dot slash dot dot slash falafel root key yes I still have it and we're going to do a - capital L and we're gonna listen on port 80 for 2 - 10 10 10 75 port 80 so what this is going to do actually would do 9,000 since this is a local port forward it's gonna listen on my local box on point 9000 whenever I hit port 9000 it's going to send it through this SSH tunnel which is then going to come out on falafel and then for that request over to 10 10 10 75 and I think falafel was 10 10 10 70 no is a 80 I think OOP 73 sweet so we have that port for it up if I go back to my local box hit local host on port what is it 9,000 we get hello world so we have setup the port forward and set tab okay and if I go to let's see slash nibble blog update dot PHP we have to do port 8000 still 9,000 is why I put it on my bad check out this file go to users and we can see we don't have anything yet so let's try one time to log in and see if it updates with our IP address so going to 1010 1075 nibble blog orb and of course we can't hit it directly we have to do localhost 9000 so we go forwarded through that server admin dot PHP along with that username admin password as I guess I did lol refresh this and we do see falafels IP now shows up with a failed login account attempt of one so we're just gonna try a few things so we don't lock ourselves out we're gonna try admin admin doesn't work let's try admin nibbles and see and go in and that's one I had just randomly attempted we're going to go to the nibble blog website and see if that's actually the default for this so googled nibble blog see if they have install instructions documentation Docs installation guide see down the latest unzip upload doesn't have the default password here so I'm guessing maybe it's nibbles if not then it was a lucky guess let's see yeah we could look in the install script I suppose install dot PHP oh crap - I password and sort out PHP I think it asks you for it yep not exactly sure we're gonna ignore that fact and just say hey it's nibbles you may want to try the password of nibbles for admin and then you get to this page and we can finally follow exactly what is on this CVE so we got the admin credentials activate the my plugins page so let's go to plugins click on my image so they enable that yeah I guess install brought me to this page which is an upload so we're gonna upload totally not malicious as the title position 5 sure caption and we have to give it a file so I'm going to copy a file out of my directory up shell PHP and we'll do CMD dot PHP and then we can look at that file rather simple PHP echo system request if if we do a file against that it's just Unicode text think something got screwed up and that guy's erased I always put gif a semicolon on the top because that's the magic byte for a gif so I run C file against that again we get it returning as a gif image just in case something checked for that we can go back to Firefox and just upload this it doesn't say we have to bypass anything so we're just going to go to documents HTTP boxes nibbles or is it nibbles CMD PHP I'm going to save this request just in case we need to make modifications save changes for that repeater turn intercept off to afford it we get a bunch of error messages but I think this page says ignore error messages yeah upload PHP shell ignore warnings and then visit this directory so give a walled content private my image copy that paste we get image dot PHP we see gift 8 and if we do question mark it be equals Who am I it should execute a command yes it does so let's send this one to repeater and get actual shell send a repeater right click change request method to a post because doing this in the URL we have a lot more characters we have to worry about filtering and let's just go to pen test monkey or virtual cheat sheet and pick some reverse shelves to try always try the very first one and then the last one first one because when it works it simple the last one because it almost always works as long as NC has installed the box so if we do which and see we do have it so I'm assuming that last one will work if this doesn't or IP address is 10 10 14 30 port 8080 let's change that to 9001 because it's over 9000 and burp listens on port 8080 so I don't want to use that I like this control you just to do safe encoding or URL encoding or whatever that encoding is and see LVN P 9001 click go get response back immediately so I don't think that worked so let's scroll all the way at the bottom and do this one because this almost always works paste that in replace the IP and port code that click go we don't get a response back immediately because that request went down here so we do which pythons you have pythons installed it isn't which Python 3 that is so we can do Python 3 - C input PT y PT why not spawn then - listen give us somewhat of a TTY but we don't have tab autocomplete so we do ctrl Z - background it type stty raw - echo then FG enter to bring back the process and now we have tab autocomplete on everything so just doing looking at the home directory we have used it our text if we do WCC user dot txt we see it as 33 bytes that is 32 characters for the md5 sum and then one for the line break and then the very first thing I always do on a box is sudo - L and we see this is taking quite a while for it to come so we'll just be patient and let this command run and that's odd I guess there we go uh neighbor resolved hostname nibbles so I guess sudo for some reason tries to resolve itself freak at Etsy hosts we see this was shockers VM but it just got updated to be nibbles I guess and that's why we have this error message because it tries to look up itself and can't so who knew that sudo needed or did reverse lookups but we see the user nibbler may run the following command on nibbles as root without a password home nibbler personal stuff monitor Sh so let us just make that directory we can do mkdir - P - P just means we don't have to make all the previous directories because personal doesn't exist and we'll just try it without - P so I can show you so if we make directory personal slash stuff cannot create it because the previous directory doesn't exist if we add that - PFLAG it just creates every directory in the chain and then it wants monitored Sh so let's echo bash - monitored SH and we should be able to sudo and then what can we do we probably should have something like that in the top so this way when the file is executed the Linux system knows to execute it with bash or shell so chmod plus x monitor dot SH and then we can do sudo dot slash monitor SH and it's probably gonna do that reverse lookup which is taking a while wonder if sudo has a flag for don't do DNS man sudo well like sudo - n look at nothing for DNS but the command did finish we have it right here unable resolve the hostname nibbles and then it executed monitored SH and we are root and the reason why that worked let's just edit the house change this oh man letÂ´s do echo 127 0 1 2 and we'll call this nibbles do Etsy hosts cat Etsy house okay it should be able to resolve itself so if we exit we can do sudo - L even though it specifies this whole parent directory thing we don't just put that all in a command it's smart enough that monitor that Sh is in home nibble or personal stuff that it will execute if we had created that mom got SH not in the stuff so a copy mom SH up one directory and then do sudo monitor SH it doesn't work if we go in stuff sudo monitor SH we get root so there's one way to do the box let's do another way so this goes back to the last box we did last week falafel which silently got patched I didn't know it when I did for waffle the kernel exploit worked pick our patch between when I did it and it got retired and the kernel exploit no longer worked and I look silly in that video so let's do rational love so if we copy out let's just go do it again let's Google Linux exploit suggester go to the github page click on the fork to get the latest version because that last commit was May 13th we want to grab one that was a little bit more recent well grab see Morris because he has a lot of commits and then clone this out make the dub-dub-dub directory and then we're gonna copy a script out of Linux exploit suggester what a copy when X - exploit - suggester and we're just going to rename it to a new message because I don't feel like typing that now let's - la there we go Python - am simple HTTP server on port 80 go back to nibbler we can curl - Oh we'll call this a numbness H and then 10 10 14 30 and numbness H and just run it and we see it's beating out a lot of different ones I just choose the latest one I'm guessing something broke in the script not exactly sure what if we just execute it with chmod plus x rays get this way yeah maybe it doesn't like how we're doing server shell but we got a CVE for 2018 and it's detecting it based upon G Lib C 2.2 3-0 Ubuntu 9 if we do a l DD - version is it - - version we can see our G Lib C version so 2.2 3-0 Ubuntu 9 that looks good and if we do a cat at C LSB - release we can see 1604 3 so just like the last box it's saying everything is vulnerable and this still came up the last time and we ran 0 Ubuntu 10 which is the patch version of G Lib C I believe but we should be able to do rational love now so let's Google for rational love well it's probably in Cali so search boy rational love no results because it's called something else like G Lib C something but I'm just doing rational of POC grab the exploit off exploit DB g Lib C get CWD it's a weird name for it view role copy great the file set V to set paste paste it in and we can start the simple HTTP server and then let's grab that file 1010 1430 I give it caps no I do let's look at the file on our County box so the main thing I'm saying is the compiled instructions we see it just says GCC - Oh which is out for file name and then that so we don't have to give it any special parameters so let's do this GCC - oh please follow on Twitter I guess and then rational love dot C just gave us warnings if we do LS - la it created the file and it's executable so we execute it and now we have a root shell with rational love using the exploit we get a slash root we can do a WCC on root txt and see indeed 33 characters so that's probably an md5 hash with a line break I hope you guys enjoyed the video uh sorry it was fast it was a rather simple machine hopefully you guys enjoyed me kind of doing it live and not worrying about doing prep work so take care of guys see you all next week which should be a tough machine I think it's nightmare that's retiring don't quote me on that but if it is we're gonna have a hard video to do so later