 what's going on YouTube the zipsak will be doing a video on antivirus evasion specifically targeting antivirus products that use definition files to create signatures for binaries and do static analysis on them this isn't going to help you when you go against any type of EDR solution but it will help you if you're just trying to evade Windows Defender which recently changed you used to be able to just rename mini cats too many dogs changed some of the metadata around remove the mini cat spanner compile it and you'd be good now defender has updated it adding a lot more strings that you have to change in addition to one of those strings being a exported function so in order to get around that we're going to change the function loading from a named load to loading straight from the ordinal value so the function name doesn't appear in the binary itself and yeah so let's jump in before we begin we should make sure our development environments are the same and I'm gonna install the fire I commando add-on to Windows 10 right now I just have a fresh install of Windows 10 that I have installed Google Chrome because currently commando doesn't install this and not having Google Chrome causes errors and I have made sure my copy is up-to-date so we will open up Chrome and go download fireEye commando VM go to the github page we want to just download a zip open it and go to PowerShell and run that as a administrator I'm gonna press control shift enter and that pops up the UAC prompt and we can unzip this by dragging it to the desktop and then we just want to first let's edit the properties and make this font bigger 28 probably is fine so we will CD to home go into desktop and then go into come master and dude dot slash installed ps1 before we do that we have to do set execution policy to bypass do you yes and then install dot ps1 it is going to ask us for our password do I need to take a snapshot before continuing no and then enter the password for the user it does this because it creates a registry setting to set auto log-in because during this install your computer's going to reboot several times and it needs to auto log-in and then execute a startup script to resume the install this will take probably about two to three hours I think so just let this go overnight or something and I'm going to just skip ahead because it's pointless to speed up the video when this install process is just so long so commander VM is now installed we have more programs and our star per we also have this folder called tools which has a lot of things nice and organized but the very first thing we're going to do is set the desktop background because no install is complete without changing that so I'm gonna go into my users folder than pictures we're gonna extract backgrounds dot 7-zip which is something that commando VM had placed and we're going to set our background I'm going to do light male red and let's just right-click that set as desktop background and now we have a commander VM installed so let's now grab mini cats so let's go to google chrome search github mini cats and then we should be able to go to gentle Kiwis repo because I clicked the wrong link but now we're here so copy this open up a command prompt commando installs CMD or which is just a nice command prompt I'm gonna go in the settings and disable transparency because I'm just not a fan of transparency and let's also increase the font size so everyone can read this and let's go to documents and then we can do get clone and paste the link I used shift insert to paste that link I'm not sure if control V works I'm just in a habit of using shift insert and I want to open up visual studio code 2017 not just Visual Studio code these are two different applications open up visual studio 2017 it'll ask you to sign in I'm just gonna select not now maybe later we'll select the dark color scheme and then start Visual Studio this will take a few seconds to configure and then once this is open we can select open projects last solution navigate to documents mini cats um actually I want documents code so let's just make code move mini cats to code MV mini cats to code Cmdr is configured to do bash things so we have like strings and all that other thing so it's not like a normal Windows command prompt which it just has all the binaries you'd expect on Alec's machine which is nice so let's go to code mini cats and then select me me cats dot SLN and it's going to have us install some dependencies so we can compile this there's going to be the visual c++ MFC so let's just install this and this could take a few minutes to install click continue and it said 6 gigs so I underestimated a few minutes we'll just let this sit until it installs this component and then once this is installed I think we have one more dependency to install so I will fast forward a cut the video to minimize just watching grass grow the installation is now complete but I believe we'll have to do one more thing we'll try to compile by going to build rebuild solution and first before we do that let's change it off of arm and go to 64-bit and we see it needs the XP build tools so I'm going to go to tools get tools and features I believe and I think it should be on the right once this opens up this looks correct I'm going to go over to individual components and we should see Microsoft XP somewhere if we go down here we go it is under compilers build tools and runtimes and for me it is the very last one Windows XP support for C++ and this is going to install another 250 Meg's of things so we will pause the video again and let this install we have to close Visual Studio before it will even begin the install is finished so we can just click launch to open up Visual Studio community again and we can close out of the Installer and we will select mini cats under recent projects and I also want to just exclusive mood there so if I go to install missing features maybe I installed the wrong thing Windows XP will click install again to install missing features I must have missed something so it looks like there's another 650 Meg's so let's click continue and let this go install that installation is complete and now we have everything loaded that we need we do not need Mimmi driver so we want to worry about that not being loaded let's just minimize all these folders okay and try rebuilding mini cats so we're gonna go to build rebuild solution and mini cats takes a good like 45 60 seconds to build while it does that let us open up a remote desktop session to my other Windows machine that will have Windows Defender on it and I'm doing this because commando disables defender so I'm gonna do show options local resources and we want to share a drive so we'll do see : I guess men epic will put the password and I'll tell you that I guess when mimikatz runs if it's able to extract it and maybe that VM is offline right now there we go so put the password in and then the VM will connect and we can just leave this oh I want to show defender actually catching this so we can go into this PC see on my shared drive users eps AK documents code mini cats x64 and we can try well we have it right there virus found already so that did not work so we have to find a way to obfuscate mini cats so the very first thing that everyone does is just a search in replace for mini cats so we'll do edit find and replace replace in files will find mini cats and replace it with please subscribe I'm gonna click on find options and do match case do replace all yes and then we're going to do mini cats and all capitals and E's subscribe and all capitals and I also want to go back to defender I want to say we couldn't exception real quick for that remote Drive because that is going to get annoying so if I are some threat protection manage settings exclusions and exclusion folder and we'll go to and this whole thing so let's see if it will now auto remove me me cats so users EPS ACK documents code Hemi cats x64 and we can probably launch it here and if we copy it to the desktop defender should flag okay that is exactly what we expected and that sounds gonna get annoying so let's new computer so we can minimize the remote desktop and this is the thing that we've already replaced mini cats so there should be no more references to mini cats and I think when I did it I do entire solution so that is a very important thing so it's our solution no reference to mini cats do it in caps even though I don't think this one is case-sensitive and we have gotten rid of all mini cat strings so we can do project rebuild solution and wait for mini cats to finish and we see we have some error messages cannot open source file please subscribe H so what we have to do is go and rename all the files that have mini cats to be please subscribe so do that there the icon file and this so that's mini love I don't see me me cats here and while we're at it I'm going to go in here users hip sack documents code mini cats and let's go to mini cats and open this dot RC file with sublime and let's just remove this information so we don't want gentle Kiwi we probably should also just remove that so company name will be not so gentle Kiwi get rid of the four windows and we'll do copyright 2019 to 2041 to I guess not a Kiwi and we'll remove his name just in case a V signatures that private build POC special build POC so we can save this file exit I just did ctrl C to save it and we probably should change the icon file while we're at it so it's not just that Kiwi so let's do coffee icon and we will make the icon what do we want this this looks fine download ICO and it's showing folder rename this to please subscribe and then copy this on over it may be cached in windows to be the Kiwi but don't be fooled that is really a coffee cup so let us try rebuilding it and see if it builds didn't build we do have an error message of saying this key name POC is undefined so let's go there and we see it is indeed I forgot a quote there so I some reason I have bad luck whenever adding RC files in Visual Studio that maybe just may we can make a copy of it and try it again real quick let's see I know I did something once upon a time and I've always straight against it so let's just try this other quote save it and then build again and one thing to note when you do go and add this RC file it may put you in team Explorer or not team Explorer there should be another icon here to edit this or see if I double click it here there we go may put you in resource view so you want to always could be in solution Explorer to see all these that took me a while the first time using Visual Studio to realize what it did so we have mini cats now built without any strings called mini cats so let's verify that by going into CMD our mini cats x64 and then we can do strings mini cats and then grab - I for mini cats and see there is no strings we can make sure that command has output so that is good if we go to the remote desktop refresh this and copy it we see defender does go off and flags this so if we call this please subscribe I'm guessing it's not going to have that Kiwi icon showing that this is the new version and again even if it's not called many cats AV will pick it up so since its flagging all soon as it touches disk I'm assuming it's a signature based which uses strings so let's find out exactly what string in the binary it's flagging on the easiest way to do this is just to copy the binary and various sizes and find out the very first occurrence of it hitting so let's take this straw size divide this by 2 and see if it's in the first half or second half of the file that it's hitting so we'll do head - see and that's 610,000 3 or 4 I think on please subscribe and we'll call this AV test dot exe so that will copy we can go here refresh copy it to a desktop and defender does not flag if we copy please subscribe we should get a defend to pop-up almost immediately so let's go back and let's do 750,000 so going back here we go from 596 KB to 733 Kb and we still don't have a flag so let's go back and we'll change this to 900,000 actually let's do one hundred thousand and one just for the memes but anyways go in copy to a desktop and defend it Flags it so let's go back and go down one so 800,000 copy it no flag so we'll do five there and we're just trying to figure out the first time this flags so nothing we can do 75 and it looks like it's gonna be a little by that 900,000 so let's try 80 there copy this where you get a flag so let's go back to 7 change the next to B we already tried 75 so let's try 75 five go here copy the desktop we get a flag so let's go back 75 for we get a flag so let's try 75 1 nothing so let's do 250 get a virus and we can try 200 and it's clean so we know AV is picking up within a very small size so we can just send this verified flags so let's just open this up and a hex editor so if we go to tools utilities and then hxd I'm going to ctrl o to open I'm going to select AV test let's do tools options view no format font 228 we can change this to I guess 32 and scroll all the way right so we can see the strings let's do 48 there we go and just scroll all the way down and see what it could be flagging on we have kiwi and CMD kiwi and registry tools so I'm just going to do a Zhan kiwi and we will file save as we'll do a V test to save and not sure what happened to my remote desktop session let's just open that again okay probably some UAC prompt was up I guess I have to go back this okay we got both of these files copy av-test to which we took out that kiwi and registry and then av-test and let's mute this an AV test immediately got flagged so we know we have successfully changed the string of that one thing so the next thing to do is go in search for it in Visual Studio and if we look at the code nothing there I'm just looking to see if there's any references to Mimmi and foul names so let's just do something bold and let's do find and replace replace and files find what Mimmi and we were place it with comment replace all and let's hope it compiles so rebuild solution we probably should have like made a commit and made sure we could revert before making a big change like this because when you do search in replaces how things can happen and here we go something weird happened cannot open file let's see can I control Z all the changes I don't know if I can we can probably do it edit find the replace place in files oh I hope I didn't do that was comment now I got quotes there so let's do comment Mimmi and pray this will fix it build rebuild so as a betting man I'd say we just toes this and have to redo everything nope it's successfully built so let's go back in this we want Kiwi and registry tools so we can just ctrl F Kiwi and while we're here let's remove all of this we will just do that and there we go cuz I'm sure it Flags on that little thing but anyways Kiwi and registry maybe it was here we go so let's see how many hits do we have on this string Oh many so let's control C and I think it is case-sensitive so we can just do a find and replace real quick paste and replace it with random caps this has the least amount of chance of screwing anything else so replace all two occurrences replaced build rebuild solution and hopefully it compiles and we can move on to finding the next string so while this builds let's do something in the background and that is find a way to identify strings that defender flags on so I'm going to Google um expand defender sig and we're gonna go to Maddie fest Asians kiss or just and copy this so go to raw open up a PowerShell window paste that in so it's now a forget what you call it we've now loaded that function so we can go to CD program data I think it's Microsoft Windows Defender definition updates and then the UUID and we see these are definition updates from the last few days and we have em pas base and MPA V base so it's copy both of those so MPA s and B AV and I think one's the anti-spyware ones antivirus will copy this to do I have temp directory I don't will do users desktop epic will just your documents code maybe cats x64 maybe I can only copy one item at a time there we go do MPA V and then let's go in that directory and we can do LS em pas pipe it whoops control C OS m PA V expand defender signature and it is what's the function output file name I'll put foul name MPA V base dot dump so with that one wrong and it takes 30 60 for that to finish we have mini Katz syntax error in one spot will we remove the banner save that build rebuild go back to PowerShell it is still expanding that signature database but this will just let us do a strings and see things that it may flag on it's not a guaranteed thing just because it signatures work and weird ways I think it uses something called fuzzy logic or something but won't be exact but it will give us good ideas of what's flagging maybe cats has been rebuilt so let's go and test this so if we refresh we have mini cats copy this to desktop and we have defender flagging it yet again so if we minimize this we can go to Cmdr and we'll try copying this again and see verify that our signature has changed so we'll copy it to av-test we can reopen this file good at the bottom 16 I think we're on 48 I don't see that tracing so oh there we go here it is it's in random cases not in the same spot because it compiled and order changed a little bit but let's see if av-test doe flags I had double clicked it paste it and defender is not going off so that was a successful way to evade it by just changing caps on that one string so the next thing to do is we'll go back here real quick do em pas base and well that one decompresses we will go and play with this again so let's do 88 my machine is going slow and I think I have an extra zero there maybe not maybe tests do not so we can copy this maybe we can copy it drag drop there we go and it did not flag so let's try 89 scoring KB at a time essentially does not flag so we can try 90 does not flag so let's be a bit bolder and do 95 copy it down we get a hit so now the next step is to go half of that so we'll do 25 I know this probably isn't the most entertaining thing but once you figure out exactly what gets flagged it lasts quite a while but this one may not last a while because while we're doing a video on it so they're probably extra strings you have to look out for and you can script this and do all the cool things I'm gonna look at running d√©fendre on Linux and that will make this process infinitely faster so maybe defender wasn't just getting before because we're getting really close back to that 900,000 ok a vide on that so let's go 75 so drag-drop no flag you can't tell my machine is going slow for some reason still no flag so let's go that and if this doesn't flag we'll change this to 91 see is that expand database thing going yeah maybe that's eating all my CPU I may just let this one finish because this is getting way too slow so I'm gonna let this command finish and then we'll resume the video okay that bow show command finished so hopefully my Windows is faster now so let's copy this and yep that is going much better there's remote desktop whilst I get hung again not sure why it's doing that it is a rather annoying looking machine need to sound again and we'll try this av-test oh we have to click through this again users hip sack documents code mammy cats x64 av-test no flag so let's try one and we don't have a flag again so let's try - did I miss something earlier ok so it's at one I believe so we'll do one v paste flag maybe 1 to 5 virus try 91 again just to sanity check ok so we're getting close so think we may be able to find it and one or two more of these missed it in try to five there okay so we're getting really close at finding the bad string so we'll try three hundred paste nothing 400 paste virus so let's go back into hxd I open at av-test and go all the way to the bottom and see what it could be flagging on so W I just Kerberos is base64 interception output maybe this so let's try changing this to capital a and we'll do capital e on interception save it with ctrl s go here still got a virus so that's not it let's see I don't know if this is something we can change try W digests see was that old pop up or the current one so that doesn't flag so change W digests back what are you doing defender this w digest is back drop so it's not that now not sure what we changed we can try changing this pack but I was pretty sure it captured on this save that okay we got a look and it auto removed it so maybe we just miss categorize this so capital a capital N and capital e save this copy a desktop definitely is flagging that my don't flag it before okay so if we remove this string what's going to happen don't see a flag so let's see if that w digest is in a print statement or if it's actually on a DLL load its own alone it's gonna be pretty ugly if it's just in a print statement it's not gonna be too bad so let's see these are variable names how much does this occur what does it say that say yeah I think it was all lowercase W digests DLL right here so what is this doing W digests package this the only call I think I just changed something version libs so maybe since it's a file name it won't be case sensitive so let's find a replace W digest with weird cases and replace all two occurrences placed build rebuild and this will take probably 45 60 seconds I guess well there's bills we could have confirmed that it was W digest by using the dumps we did so if we do strings M pass bass dot don't we can grip for W digest DLL and see if this comes back with anything if it doesn't come back then we can always do it on the MP AV base dump and we can see in this MP a base dump we do have the string W digests Mini cats has finished compiling so we can go back to a Windows machine and try copying mini cats and we see defender has flagged it so let's delete this minimize and let's do that head command again I should be will control C this and we can do the same exact one and the goal here is to just verify that W digesting is changed and we have an AV awit right away so let's open this up and hxd and we see W just is changed but we also changed this is base64 interception so let's not do that let's change this again go back drop it and looks like that is a string so let's go and visual studio is phase 64 intercept output and we can probably safely change this so find and replace place that with it's going to be capitalizing the a the E and the you replace all don't replace any so I probably screwed up that copy/paste tie a solution match case 7 occurrence is replaced okay and I'm going to the input as well okay place all seven occurrences again build rebuild and once this builds we will copy it on over I wanted to show this more but I think because I did a disk link instead of a clone for my Windows VM without command oh my disk i/o is horrible right now so I think I can't really quickly show going through these dumps the rebuild has finished so let's go up here copy it here the date changed please don't flag and we don't flag so we can also try copying mini cats and a job is not done so a few weeks ago we were done soon as we change that header that had all those like pound signs and mini cats but now it's becoming a little bit more difficult so let's try 95 see if this Flags I accidentally double-click that we do have a flag so let's do I think this is gonna be the last one if I remember correctly I did this like two or three days ago a dry run and this next one is where it gets tricky because we can't easily just remove the string by changing casing okay so 9 10 is fine the last one we did was 9 to 5 so we'll do 9 - that's a virus doing 9 1 5 that's clean 9 1 by 5 that's clean c91 seven because 91.9 2 was bad okay if we do nine one seven zero pleasure to recorded all the bad spots in the file so we didn't have to go through this I could have made quicker guesses but you can always use the time to time stamps in the comments to jump we're getting close that's with 50 KB I think let me just go back one make sure yep so we are close I wanted five copy come on defender flag this oh come on okay there we go we just go back to the one prior because defender did lag a little bit that last time okay so I relatively confident the string is here so we open it back up and hxd scroll down let's see experimental multi RDP see this is set thread token let's see is it multi OTP I think this is a bad string save paste it is so there's not the one I was thinking of this should be an easy fix let's look at what Multi RDP is in the code and it's probably just that string so I'm going to guess it to this and we can put this as secret RDP oh we'll just change it everywhere and do a search on places we've been doing that so edit find replace multi RDP and one do M ult I D P I hate eyes and ELLs especially when doing this like weird casing so see if it still compiles like this rebuild has finished so actually before I do that I'm just going to test this should we copy this and then paste AV is not flagging it of course memory Katz is still gonna get flagged so her job is not done so let's try ninety five thousand five hundred fifty thousand paste threat found I'm just gonna double check that so wasn't sure if that was a older work nope that's not an order Lert so we can go down to three this looks good go up to 4 and we will take all those numbers out so it's at 3:00 all right three someone for if we go to five virus so if we do for five this is looking good I'm just clearing that number and the notification thing so four five five okay will do seven five four five eight so we're getting close unless I made a mistake and once you do this for four or five strings you do start making mistakes so let's try four six does this flag nope four seven I think this one flagged something's going on four eight when did flag last time okay that's going on and that's interesting I've never just double clicked it but it may be the thing to do if defenders going slow so let's try four eight okay so we get this app can't be ran on the PC but you saw before when defender would flag it it would just crash so let's try four nine that's a virus so it's going to be four eight five that's fine I do like that method better than just waiting for a pop-up okay flagged so one or two more check this one flag still so it's gotta be right around here not that okay so we got and 50 bytes and this one should flag yep so let's see what this one is so back up open up a V test and scroll down [Music] see maybe it's logon passwords now live SSP let's try this there are so many strings you have to change now so let's copy okay so it is logon passwords so boy was I wrong with one more change like three changes ago so fine to replace replacing files and it's also possible that some of these strings got added since I did this a few days ago because defender updates happen daily and uploading to like virustotal to see how well it is is generally a bad idea and gets things flagged and that's what I did so that may be a mistake doing so hopefully we actually make this possible and if you ever wonder what definition something gets added if you go back to the defender files C colon program data Microsoft Windows Defender definition updates this DLT a file is the Delta changed for the last update I believe so you can always find what has changed since the last update and I think you can download a backlog on Microsoft's website it is built let's copy this over to make sure everything's kosher and RDP hung again so let's do it and don't ask me again Oh what so I think that happens when I leave a virus on the desktop and navigate away oh well at least I got pretty good at what now that I'm saying it knowing where to click I guess that one perfectly so 4:3 based on the desktop and the Smerch screen comes up so that does not have a virus at least accordion defender so let's change this back I'm going to do 9:8 go back to remote desktop copy it and that says defender won't let us execute it so we can go back and change this to 9 6 and again the annoying guessing game and you could script it but I don't think Cmdr has scripting capabilities at least not that I know of yeah I always unexpected so that's why I'm doing this all manually cuz I didn't think it would take this long so try 9 4 we get smart screen so it's going to be 4 5 next smudge screen again so we'll change it to 75 and it is smart screen 85 smart screen 95 virus so we're getting really close and I hope this is going to be the last one ok so let's see we in from Matt so we'll do 250 it's fine do 450 that's not fine so we should be able just open this up and hxd and get an idea of what we have to change so open it up go to a V test scroll down let's see Sakura maybe I should have just guessed to change that one oops so II you because this is the module that there's all the fancy plaintext retrieving so EU SEC you LS a these are different casings which I changing this one first and I can't control Z to go back that sucks thankfully it looks like nope not that one did not let me open so all lowercase so maybe it's the all lowercase one hopefully it's not booth so I'm only changing one of the coud not seku or let's say at all clad man there we go good man so go back to the code at it find a replace cred man CR e d ma + o always one more string to do so let's build this project and oh I'm in a different module okay I was like we remove this but this looks like it may be mini love or made me driver because we see kernel-mode okay maquettes has been rebuilt so let's copy the server and if it Flags maybe at SEC your LSA so copy come on smart screen there we go so that flag was changed let's see what the next turtle is going to be so we can put this back to zeros and ones i-96 copy that's fine 99 that's fine so we're getting close to the end of the binary hundred thousand virus so it's somewhere in the ninety nine range so do 99 five okay let's say the virus ninety nine to five nope ninety-nine one nope I'm gonna try 99 again because I swear we tried this and it was fine yep so 99 is good so 9905 not good do Oh two five that's good try three five and that is fine next one's gonna be four or five and if this doesn't flag I think we're done after this one because we know the next increment up which is 9905 flags at least that's what I remember yep so I can open this back up and hxd and see what we have I want if it's Auto reloading maybe I don't have to keep opening this doesn't look like I do okay so now if you notice like before we had things and 16 byte chunks because that was crap one of my thinking utf-16 now we don't we're a different part of this binary and I believe it's going to be this string so if we try to change this to all capitals and then go back here we won't flag however this was password skip if we look at the code this is flagging probably not it's not on this thing because if it was here this is going to be in utf-16 it's flagging here on loading of modules and this is case-sensitive so we can't really just do the same obfuscation we have been so we have to change how we're loading this and the easiest way to do that and mimmie caps is go to the actual library this I Nets trust server passwords get if we google this it's a net API 32 thing and automated malware analysis report four million cats from Joe sandbox is good as well I believe but we got the library right here this net API 32 min Lib so if I go back here if I do dump bin it's not in my path of course it isn't so let's go C colon backslash and I'm just gonna search for it dump bin to find where this binary is located it's part of Visual Studio so it's in some weird directory okay we have found it in program 86 so I'm going to right-click it and where is open file location' okay it's right here and the other thing i want is web dot exe so we're in the correct folder I'm just gonna do something that makes my life easy and put this in my path so let's go to this PC properties what is it advanced system settings environment variables path edit new paste okay I'm a copy this string and will relaunch CMD you did not see my transparency settings or my size that is annoying fonts size 28 I guess there's a Save button somewhere I didn't actually use this program until I checked out a command L so we're here and we have the dump bin file in our path so it works so let's go up a directory and then we want to go into Lib x64 and we want to do dump bin against net API 32 min Lib and I've got we want the exports table so slash exports and these are the files we or functions we want and how this works is it does a name looked up so it essentially just puts the name in the binary and tells it hey and net API 30 to go grab this function and load it so that's how instead of load it maybe import it is the better terminology so what we want to do is look at the exports for C colon windows system32 net API 32 DOL and instead of saying we want to load the name we're going to specify the word value which is this so the code well let me just copy this real quick we want to copy all these eye nets so copy all this so essentially okay the code is doing something like we'll say windows net api 32 dot i met passwords get and then you get your functions there are arguments I should say so that's essentially how it's working and it knows when you type this eye net passwords get it's going to go to net API 32 and load the correct function and ordinal load is we just specify the function number I think I net passwords get is 62 but and that goes through this table and grabs the 60-second function and let's see 62 I was correct it is that function so it's going to go here and grab it so that's what we have to do so I'm going to we'll go back and file explorer' C colon users if set documents code Mimmi cats dub x64 and when we do this ordinal load it's going to make it less like compatible with various patches because if the API changes and the order changes then we're going to call the wrong function so we'll call this net API 32 dot def and then we will open this with sublime and we got to create the definition file which is easy it's just library net API 32 DLL exports and then we want to put the three functions let's stay organized and we have to specify where these exist so authenticate to is going to be 59 so all we do is put a 59 their request challenge I think this is like sixty seven sixty five and then trust pass would get we already went over that is 62 so we save this go back in to Cmdr do a dir we are at where the definition file is so we use the lib command and this works because we added the path earlier and we want to do slash def for definition net api 32 death slash out or do please subscribe Lib and the only reason I'm calling it this is because I did not back up that API 32 min Lib that API 32 men Lib back and let's move the please subscribe Lib over top this okay so now if we do a dump bin slash exports on that API 32 men Lib it has the ordinal values hard-coded so if we go back to visual studio rebuild a solution new code change is required we should be able to get rid of that string the build was successful so let's go back here and go into x64 strings mimikatz grep - I I net passwords get it's not there if we look at the please subscribe DX e oh it's not there either grep I net pass huh it should be there maybe it's a encoding thing copy this to desktop and we'll say get detected a virus which I didn't think it would do nope we have many cats now loaded so we can do or as administrator privilege debug sec URL SI wall gone passwords and let's see if we can get to my password so let's change size so everyone can see it easily change it to 28 and we can see the cred man this is what it was flagging on and we changed the size let's just go to the very top and see if we see it password oh there we go password is leave a comment so many cats successfully working with a fully up-to-date Windows Defender these subscriptions definition files were created on program data Microsoft Defender definitions the third of March April it is a months but yeah there's one last thing I wanted to show and that is exactly what happens to the binary when we do this ordinal word versus the name load so to do that we're gonna show off GUID draw so we'll do github kid raw because I don't believe that is here we got debuggers I don't see a dissembler if we do developer tools no it's funny that Visual Studio is not their only code exploitation no utilities and I don't see any disassemblers so I'm gonna go install this is a I think I said get right it's Diedre I believe anyways I bought your names for almost everything so that won't be now so we're gonna download this do already have it okay so let's copy this to the desktop man this vm8 sound but anyways open it up digital Ron Agee draw JDK 11 is needed so let's download that JDK 11 windows Oracle's site accept it and download okay open the JDK to install it and I'm just gonna mute my sound because the sound sucks anyways next next job is installed so now we should be able to open this I guess I have to activate this copy of Windows that just recently popped up I guess let's see the joys of running Windows in a VM accept the agreement see accepted that close that new project name will be Emmie cats ordinal load and then we just probably drag and drop it I've never really used this tool so users hip sack documents code many cats x64 ok it looks like it's loaded we can allow Java to talk to the Internet and then we want to go to curb browser file open and we cats it's not been analyzed yes let's analyze it and we can see down this bottom right it is doing its magic it looks like it finished analyzing it and we got this warning we'll just click through it because the only thing we want to look at is the project imports there any exports no yeah so the imports we want and it was net API 32 and we can see the ones we specified to have ordinal 59 62 and 65 and this is Deidre just putting a undefined there I believe it's just guessing that's what this function is and we can look at one that is not ordinal loaded so if we just go to like net API buffer no it still says that let's see what is the difference between these two I've been actually looked at it so quest challenge let's see okay so it's a pointer so if we do get server info it does a pointer so all we're doing is taking one step out of the equation so in the export or import table it puts a pointer to the function and then the program goes and takes that string and searches the dol and pulls it warden all value which is the number so you can think of this exactly like DNS where this net API buffer free has a DNS name resolved so if Google changes its IP address this name can just be updated and everything will work when we're doing ordinal loads we're kind of putting static IPs and saying hey go to a function number 62 in this do l if that ever changes then it's just going to break and that's it so hope you guys enjoyed the video and learn something from this take care and I will probably see you tomorrow in the activox video later actually I lied there's one last thing I want to do and it's gonna make you all cringe so I'm excited for this one let's go back into documents code mini cats x64 room delete please subscribe rename this to please subscribe and then let's go to we can move it which maybe this gets rid of copy I mean get rid of the original name tag I'm not sure if it does but do this and we're gonna do what you should never do when you're trying to make something undetectable and that is upload it to virustotal and we'll see how long it takes virustotal or defender to change the signatures or update them once this videos released so uploaded let's see how long it takes or how many AVS will pick this up in signatures so quite a few actually did flag this and it probably wouldn't be too hard to just go download clamavi and do the same exact process that we just did against claim AV to remove the detection here and as long as it's not just running in a sandbox we should be able to get this number extremely low but that's it hope you guys enjoyed it later