 hey guys what's going on this is epic and we're gonna do the devel machine as a heads up this machine will be a hundred percent Metasploit not doing anything outside of it I did want to do something with Empire but I don't know enough about ASP to code the Empire loader and quite honestly just did not have time to look into it long story short the hack the box code was supposed to retire optimum but a glitch has happened and this box got retired right after I recorded the optimum video which is all through PowerShell one lighters no Metasploit etc but since this box got retired and we didn't want to tell the computer it was wrong because that's how Skynet happens we're just gonna run through this quickly with Metasploit which is how I did it initially so let's jump in so like every other box win and map with SC safe scripts SV enumerate versions Oh a I'll put all formats and we'll call the file and map the IP address which is 10 10 10 5 I have already ran this so let's look at the results and we see something interesting FTP is open as well as HTTP HTTP not a surprise but that FTP definitely is we do see it running iis which is a Microsoft web server and of course FTP being open is interesting as I said so let's go over to the IP address which is 10 10 10 5 10 10 10 5 and we see the default welcome page if we view this image we see welcome dot PNG going to our FTP server we see welcome dot PHP if we go to iis dot HTM that's probably gonna be what we assume is index.html the default page of a website so there we have it the FTP server likely is in the same route as the HTTP server so if we upload a script there we may be able to view it through the HTTP server so let's FTP to 10 10 10 5 users anonymous because that's what map said we anonymous access and then the password it doesn't matter I assume you know I can't type that fast so it's a random password that just still lets me in doing a dir shows the same files we know exists so let's create a file and do echo upset and we'll call the file test and then we're gonna upload the file via put and test so do a dir now the file test exists on that web server if we go try to view it oops we don't get a 404 not found so that is a bit odd if a file doesn't have an extension it's giving us a 4 or 4 if we rename test to test on HTML is that still going to happen so let's delete test and then put test dot HTML there and we have successful execution of this the next thing is it is a iis server and iis does execute code generally ASP or ASP let's for this real quick so I can make sure I'm 100% right before I say anything if we go here we have is 7.5 which I believe is 2008 but we can easily Google this if we do well let's turn intercept off and then just put iOS versions is good we're going to tell us this immediately yes 7-5 is 2008 or two so it's either gonna be ASP which is just vbscript based or aspx which is dotnet based if it was 2003 I leaned towards ASP but since 2000 a is relatively recent within the last decade I think that's going to be done that base and gonna be aspx so that's we're gonna take this we go into msfn I'm somewhere exit this create a new shell and do MSF venom - H and I'm just gonna grab four windows to show us all the payloads actually before I do that I must have venom - H I wanna see how this binary actually works so we have - P for payload and we will also need - F for format and - o4l those are the three flags we'll need for MSF venom if you don't know what MSF venom is it's just gonna build us a meterpreter session essentially so we can do MSF venom - L to list all available payloads so MSM Adam - L I'm just gonna grab this for Windows to show us only windows payloads because we don't care about Solaris Linux OSX etc and this does take a few seconds to run and we get a bunch of results so we're gonna do Windows meterpreter reverse TCP is what I want because I know that's always gonna work if we just did like the 64 bit it may not work if it's a 32-bit machine actually it will not work if it's a 32-bit machine if we do the 32-bit version a 64-bit machine it's still going to work so this is the safest one to use first so MSM venom - P for payload - F is the format and we're going to say it's an aspx file and we're going to specify the filename is EPS aspx and this is going to create us a aspx file that loads meterpreter so if we view the file we do see magic and if we go back up to ms of venom help we could probably list all the different formats so if we do - - help - formats it'll list all the different files we can do so MSF venom - h-help formats while that loads we can upload EPS aspx put epic aspx not connected so - super close connection to us plug back in and then put exact dot aspx and that did not well I have - H there we go so the next step is to load Metasploit with MSF console and what we have to do is load a listener that is going to listen for the webserver trying to learn meterpreter so we're gonna use exploit multi handler show the options doesn't have much so we want to set the payload to the same thing we just used which was Windows meterpreter reverse TCP and now we show options we can see what we can do so we can do set l host to our IP address which is tun 0 and when we run this we see it started a reverse TCP Handler on the IP port 4 4 4 4 and that is something I forgot to do and my MSF venom so here's all the different types of extensions you can give it but before we go into that we have to go back here and say L host equals 10 10 14 17 which is my IP o port equals 4 4 4 4 but it can do ASP aspx aspx exe access do l elf it does a bunch of different formats we're destroying aspx because we assume this is what the web server will be able to execute so delete tips aspx and then put the new version and then we can go to 10 10 10 5 epic aspx and for hit enter let's go over to a ruby window and we should see instantly we get meterpreter session 1 has opened so do sessions - I won and this info is the first thing I do on meterpreter we see the architecture of the machine is 32-bit or meterpreter is 32-bit so that is good it is a Windows 7 box and then I normally do a shell and do System Info and this normally tells us the hotfix is installed in this case it says na so chances are this machine has never been updated we also see the boot time the install date version and service pack so not much information there so we can exit out of this background the session and search for suggests because we want to use this local exploit suggester so if we use this show options set the session to 1 because that's what our meterpreter session is and then run this it's going to check for a bunch of exploits that are potentially available for this machine so right now it's collecting them and it takes a little bit but once it does it will say I'm guessing it's going to check a brown 40 different exploits we should see in just a second if this machine wasn't so slow a second since it's slow maybe 10 seconds so here we go it is checking and we have one from 2010 this kit trap we have essentially every exploit since 2010 so chances are what we saw is the machine had it been updated since it was installed and windows sevens release date wonder one that was Windows 7 release date 2009 so chances are this is just off the standard regular install CD so we're just gonna use the first exploit show options set session is equal to one so options again and when I do run its gonna set my l host to something that's wrong and I just want to show this real quick yeah so it's doing the exploit but doing it on 192 168 we want to set and now since we ran it once Metasploit tells us it's using this payload and this is the l host so we want to set this to be 10 10 14 17 and run the exploit again we can change the port and we may just re exploit this box because it's not immediately going to something so when I control seed out something weird happened so let's go sessions one exit out of that multi handler make sure that's running refresh my exploit and we should get a callback we actually crashed the box that that is unique so when it couldn't get to the host something happened which caused this box to go down very hard if I try to ping this let's just verify ping 10 10 10 5 that's 4 it's online there we go it came back up and session 2 has been opened ok so yeah probably blue screen of death so what is it it's net server statistics I think net statistics server there we go time since 1014 743 if we do date know how I specify what time see well I meant 15 44 and this is probably in Greece and that looks like it was a minute ago I don't know the flag for date my bad so yeah this box literally just got rebooted because we messed up that exploit so background let's redo this because that wasn't back rounding for whatever reason session 3 is opened okay so we can do em s10 set session is equal to 3 that L host is the correct value we run this exploit finished sending stage meterpreter 4 has opened and we can do a shell Who am I and what anti-authority system so that is developing I hope you guys enjoyed the video and next week will be a better one I promise you and between then I'll probably do a video on reversing malware so stay tuned