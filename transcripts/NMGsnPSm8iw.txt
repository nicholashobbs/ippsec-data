 hey everyone this is if sec i'm going to be showing you how i did popcorn on hack the box see you before we begin I just want to highlight that this box is now retired so walkthroughs are allowed please don't do walkthroughs on active machines and let me get rid of this bar there we go the very first thing is we have to connect to Z half the Box VPN I'm not going to be showing this every time but since this first video I wanted to show you and I'm going to start that off by going T MUX new - SH DB you don't have to use T MUX this is what I do to stay organized so what that allows us to do is handle multiple windows with a keyboard instead of spawning up a new physical window for everything for example I can create a new window we see down here it did create this I can split this in half I can split this horizontally I can jump back to my VPN anytime and create multiple one so you'll see how beneficial this is as we go along hopefully and join the team ox way screen is another thing but I just find team ox gives you a bit more control than screen very first thing to do is find a way to stay organized I just created a folder called boxes and labeled the hostname of each box this one is popcorn and once we have this folder we can run an nmap scan of dude and map - SV per version SC to run safe scripts against it it may be redundant to do both of these but I always do a matter habit I'll put in all formats because I don't know when I want to use the grep perform at the regular format or the XML so might as well just gives me a mall 10 10 10 6 is the IP I've already ran this so control see how this and we can look at the output and we can see it is listening on port 80 and 22 so the first thing is let's go to 10 10 10 6 and see what happens we just get the standard Apache page so my very first step is i turn on my proxy and we're going to refresh this send this over and I'm going to change this host to be the domain name of the server and I do this just because of something called virtual host routing the server is going to look at this header that I sent and if it's set up as virtual host routing it will read this and potentially service to a different location not the case here so the next step is I'm going to run derby against it you could use WWF s doorbuster there's a lot of programs you can run I just run to not sure why just want to familiar with so 10 10 10 6 and - Earth is going to make it so it doesn't go in recursive mode I believe and - Oh saves it as output so I'm going to do temp dub you can see what it looks like but I've already ran this as popcorn htb and we can see the different pages so we have a CGI bin may be useful we may want to do this to see if there's any CGI scripts we have index index HTML server status test is interesting so let's open up the test and we probably to turn intercept off and we get the PHP info page this tells us a bunch of information about the server most importantly it shows us where like PHP scripts are cached so if we have a local file inclusion we may be able to chain some of the knowledge granted from this taking this code execution so we'll keep that in a pocket just in case it's useful we do also see a slash torrent link so when I click this and see what this is we do have an application toward moster so my first step is I generally always and I say generally because I didn't do it here but I run search Boyd against the app search Boyd's just going to search xdb exploit DB but it's all local so it goes really fast you'll have any CAPTCHAs so torrent poster and we do see one remote load exploit maybe that's mislabeled says remount upload but besides the point so we can do search boy x1 1 7 4 6 dot txt I just grabbed that from here and we can see this so it says use tamper data doing something on upload this is creating a form not sure oddly enough it has some cross-site scripting thing it does say it doesn't have the date in here but if we actually go to the EDB page we can see the date of this is 2010 and the date on the copyright of this is 2007 so whatever this exploit is it probably works but I'm not going to be using this so first thing let's check upload uploads are generally a vulnerable function of Web Apps so clicking this we do get to a login page so just try admin admin and I'm going to put an intercept go on capture this request and we're going to copy this and sequel map just because sequel Maps takes a while and if - what haven't running in the background in case we don't find anything else so let's go back to a boxes pop 1 folder create a login request file I copied this wrong so I got a bunch of spaces to clean and now we can do sequel Maps data Logan requests let's change level 5 risk 3 and this will take a few seconds give us a few prompts once we answer all these prompts then it won't ask us anymore and we'll be on a way so let's rename this to be sequel map and we can see down here mighty MUX I have sequel map so this can stay running and I can forget about it let's sign up because upload brought us to this Logan prompt so might as well try signing up and this is taken well is intercept still on it is so use a name step set password that's word its second we're calm let's see 3 EAD so we have registered a user now when we go to upload it will probably ask us to login again nope it log this in so browse um save this as an image because generally the first thing I always do on image uploads is save a file uploads is save an image just because these are generally accepted files so if we go to a downloads directory type uploading this logo dot PNG not a valid torn file so it wants a torrent file so let's download the callee torrents and upload Kali and see what happens save this go back to upload Kali torrent a blue torrent this takes a little bit so while this is going I'm going to add this to my scope and boot and what that's going to allow me to do is show only in scope items which get rid of all these fluffy things that we don't actually care about and both that and the HTTP history tab and I've already sorted this by method because I'm most interested in post requests see if this uploaded yet has not uploaded so while we're waiting let's go to a sequel map sequel map has not found anything as is finished uploading no it has not that is a small file but it's probably doing other checks there we go file uploaded and we're at the page for this we see the kali linux if we try to click this to download we don't see an exact link of where the file is in order to exploit it file uploads we have to know where the file gets placed so let's try to guess a few locations of where this file could be placed let's try uploads I must type that 404 okay let's just try regular upload ok we have files put no torrent files only images so that's the no screenshot yeah so let's upload our logo image that we had before submit image has been uploaded we go back refresh we do see our image here is it this one okay this is our image that was on it was purple saying saying I clicked on it before so assume that wasn't it but it was because of it being saved in my Firefox I guess so with that let's try to edit this and upload a PHP script so I have script saved to opt shell PHP and I'm choosing PHP because we do see the web application is coded in PHP CMD dot PHP is just something I wrote it's nothing special I'll show you in one second we get an invalid file so let's go to burp we can see the requests this should be my PHP file we can see all it's doing is echo system Qwest and taking the parameter tip so go to an image request and we can see what's different the file name ends in dot PNG like mine type is image slash PNG and also it's a valid image file so what I'm going to do is copy let's just take these bytes and we're going to go here send this to repeat I'm going to do ctrl R and I'm going to paste where I copied I wanted to copy some of the image because if we convert this to base 64 I can show you go back into terminal what do you find something Oh normally when it's green that's saying it sounds something but okay so we can let go what I had copied then base64 - D this is that PNG stuff so if we send this to a file and run file against it it should tell us it's a PNG data did not copy enough from it so then I'll copy enough or was that bad may 64 I'm not sure but let's go back to a proxy tab and we'll just copy more of that how that works is magic bytes or beginning bytes in a file and they just tell Lennox quickly identifies what the file actually is it doesn't do it based on extension like windows it does it by what they call as magic bytes so I'm going to convert this to base64 and put go with the slash that's odd let's see Phoebe huh if we echo this base64 - d2 file I'm getting a head copied something extra or something but now we're on file against the file we created make it a PNG so for good measure we will copy this chunk go back to this and replace what we had previous with this so now it's got the start of an image file we got the content type of an image file and let's just add dot PNG and the intention name so the script looks hey does the file name contain P&G if so then it's image if the mime type that gets passed to the script if it says the image it's an image or if it actually uploads the image and then runs file against it it's still going to register as the PNG image so let's upload this and we do see upload complete so go back over into first interceptors off go back to this upload directory and we do see or script so clicking this see it air is out but if we do something like tip equals Who am I we do see we got code execution so from this we could just do a standard reverse shell what I'm going to do instead is use Python to generate a full pto shell that gives us up/down control-c and all that stuff so in order to do that let's go back to my terminal I'm going to create a new session we're going to label this session HTTP and what's up shell Python TTY shells and if you just google this it'll bring you to a github page which is where I had got all these from ok so first things first is we want to use the TCP bat connect this is a reverse shell and we see it's going to the IP address 1010 of 194 which is me on port elite 3 1 3 c 7 that looks good so we're going to do Python - M simple HTTP server and it's listening on port 8000 this will allow us to download so go back to Firefox and just to make this easy intercept send this over to repeater if we change the request method to a post it just makes it easier to run commands so again click go we do see the output of who am i down here so going to double you get 10 10 12 194 put 8,000 and flower name is TCP bat connect dot P Y so do that - capital o is going to say where to save the file - when do dev sh m dot it dot well we call it revved-up I then easy SH M is just RAM disk so it's not saving to the hard drive just generally where I work out of on reverse shells and whatnot we want to save this and if we now try to cap this file we should see the contents of the reverse shell script yes so we can change this to place on and before we do this we actually have to set up a listener so let's go back to a bash and we're going to rename this to popcorn because that's what the machines that's going to be reversing me is called and go into a shell place on PTY and we're going to tcp PTY shell handler - be for bind 10 10 12 194 and elite so now we execute this reverse spy it's going to send the shell to me and unlike most shells I have the ability up I can do control I can do VI and everything so it becomes a lot more handy to work with when you start typing you make a mistake you can do left and it doesn't set a bunch of gibberish so now we have a shell generally the first thing I do is let's get the user flag so I don't know the username generally I could just go into slash home l-last get the user but let's do this because it will help us down the line and just good habit so I'm going to go find slash home print F I want the file name slash tab for a tab delimited we want the path I want the user who owns the file and I want the group and I want to see file permissions so that would be % m and if I pipe this to column think dash T this will give me really pretty output but first one to send a message to Devin all so let's see what happens column to long paper just a column not sure all right oh wait we have to do newline Devin all column dash T there we go so now we have the contents of home and I forgot to do - type F but yeah so let's go back find home - tight because I only care about files so we can see first user dot txt and it's readable by us so if we do at /home George user text we get the first flag one odd thing is we see a message of the day and generally on these boxes we haven't seen that so something to take note of the next thing I generally do you name - a and we can do another find for set UID binaries but it's not relevant for this box we do see the kernel is from 2009 which is dirty cow exploitable so we have both message of day that we should look into in duty cow we could just win right now dirty cow it but that is a dangerous exploit could crash the Box could host things up so that's a last resort so let's look into this motd thing so open up a new window back on a local shell so I'm going to rename this window to be local and I'm going to do search void for MOTD and we do see we have valid exploits against linux pam 1.0 1.1 point O so let's check what version of pam is on pop 1 so d package - L scrap - I for Pam we do see 1.10 so go back to a local window and let's see what this exploit is so search boy I'm going to do - X 1 4 3 3 9 s H and we see a script of them running it the calling this script ubuntu pms tuesday local root SH and it looks like it's going to add a new user core with some type of password so if we look the password is use password tour to get route so let's try this exploit so I'm going to cap this file and use X clip to throw it into my clipboard go to popcorn V dot prove SSH just paste it's been written we do LS dash a we can see Prive ask if you don't want to use V you could always go back to our HTTP let's see we are in shelves a place on p2 why we don't want to do that so let's split this horizontally and go to boxes popcorn and put a code there so if we go to local we can just effect HTTP CP copy that here and then do a Python - M simple HTTP server 8001 and we could just copy this script so go back to pop one double you get 1 7 10 10 12 194 8,000 won and we download the bash script there so either way works for doing it now actually just run that so if we run this we got an error that was odd another one so I guess in the copy something screwed up one hi didn't when I copy and paste it it worked when I didn't when I download it it did not work it normally doesn't work like that it's normally the opposite but hey we got this it says use password port to get root so we do and now we are root so we can go root cat fruit text and get the flag so that is popcorn if we wanted to we could also have gaudí cow tits so let's show that first let's delete these and let's go grab dirty Cal so dirty cow ninja I think that's URL is but intercepting it is okay few exploits let's see let's just do dirty dot see seems like good one go back let's check if we have GCC installed we do so V DC paste this okay go back let's see if there's compile instructions there is make this file executable execute this I did minus X not plus I stripped executable Commission okay please enter a new password so we're just going to add a scrap password and it's going to try to add fire foot to a local root user as we see UID and GID a zero takes a little bit so let's check a sequel map injections not exploitable via that sure we'll kill this because we've already got root and we don't care about that go back to popcorn and we'll try to do su fire foot because that's the user it created and it was password and if we do this we see UID 0 GID 0 and we can go into slash root and cap the file so two ways to get root on popcorn hope you guys enjoyed this video take care and I'll see you around