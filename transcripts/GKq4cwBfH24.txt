 what's going on YouTube the zipsak can be doing right up from hack to box which is only easier and machines at least when it comes to getting the user shell the only thing you really have to do is identify the website was built with CMS made simple which is just a open source content management system for PHP you run search played against that find the read write exploit and you'll get a salted md5 hash that same exploit that you ran can crack that md5 hash however we will be using hash cat because it's a bit faster and definitely more Universal because if you're just using this Python script you can only crack things that use CMS made simple which I've honestly never seen before if you learn how to do it with hash cat then you can crack any salt in md5 combination which is awesome we'll also be identifying a little few unused features in hash cat like specifying user names in your hashes file but after you get that password you can login with SSH the previs is a little bit more hidden you remember the staff group and can write to user local bin and do kind of a pass in Jackson attack but we'll get to that when we do so let's just jump in as always a begin with and maps are - SC for default scripts SV enumerate versions Oh a output all formats put in the end map direct and call it right up and then the IP address which is ten ten ten 1:38 can take some time to run so I've already ran it looking at the results we have just two ports open the first one being SSH on port 22 and it's banner is telling us it's a debian box and I don't know exactly how the Debian versioning works it says 10 + W + 9 update 6 I'm guessing this is Debbie + 10 which is a testing build and the package comes out of the Debbie and not in repository if I had a guess if you go to Firefox and just Google like Debian versions you'll see they're all named off of Toy Story characters and then the odd ones are stable and then the even ones are testing I believe so we have Debian 9 or a 10 that is testing but nope that's how Debian versioning works so I'm guessing this is Debian 10 but the package is coming from the stretch repository which is 9 so the next thing we see is a CH EP on port 80 and it's Apache HTTP D version to 4 to 5 and also telling us that's a debian box there's also a nmap script the HTTP - robots.txt and it tells us there is one entry in it which is slash right up so let's just go take a look at the web server so going back over to Firefox 10-10-10 138 and we just see a page that says there is some type of denial of service protection so don't make a bunch of 400x errors so I'm not gonna do any dirt busting or fuzzing or anything because chances are it's gonna generate a lot of 4o x errors and then I'd get banned and no one wants to get banned we also see a note saying that page is handcrafted with VI and looking at the source code it definitely looks like it is not automatically generated by like WordPress Joomla or something like that so let's go take a look at slash robots.txt and then we do see there is a disallowed entry slash write-up so let's go take a look at what the box is telling search engines not to crawl we see the homepage and then if we click on each of these links we see it is a PHP script and the page is why puffy so I'm going to assume this is working by like some type of include and there may be like a write up dot PHP file and if this was a very old version of PHP you could just do no bytes and that would truncate the input so what I mean by that is if the server was appending anything you put a null byte and then anything with several pens just gets discarded because the null byte is a string terminator so but you generally won't see that anymore because it's been fixed for decades so if we just go back to the home just looking around we do see a note that says pages are handcrafted with them not so telling us they're not handcrafted if we look at the source code as we normally do what to see if things would generate with like wood residue or anything we do see a meta name generator' and the content is CMS made simple we see the copyright is from 2019 so it kind of gives us an idea if it's up to date we can do a search point on CMS made simple and we get a ton of versions so instead of going through each of these individually you could always start with the latest one first but I always like saying if there's a way to enumerate what version is installed on the server so we can just google CMS made symbol and see if we can download it looking over there it did say it was an open-source product and then we have a download page if you just do this install dot script installed our zip file it's gonna install like an archive and once you install the whole thing generally the best way to search the source code I find is always going to the like repo either get or subversion generally we find the SVN link and then here we go we have a bunch of files that probably exist on the server we can start test them out by going to like slash admin so if we do write up slash admin we get a authentication required we can do admin admin and we don't get in so I'm gonna stop there because I don't want to create too many error requests I'm also just gonna get out of this view source because I don't need any more oh crap let's there we go go to the next directory doc and if we look inside a doc it has a HT access authors changelog readme HT access to file stick out one is readme and the other is change log so if we look at readme doesn't have anything indicating the versions but if we look at change log we can see the latest version right at the top so the latest version of this software is two point two point one two and if we go to write up and go to slash doc slash change log dot txt we can see this is two two nine one so let's go back in the search boy direct output and we see two to ten so most likely it's going to be vulnerable to this one because two to nine is just before 10:00 and 2:00 to 9:00 is also greater than two one three so the only exploit it could potentially be is this one or maybe one of these down here which not that one not that one that looks like it's a module so we'd have to have the Showtime two module installed on that so I'm gonna go with this exploit so if we copy this we can do search boid dash X and then start looking at it looking at this we don't really see a blog post going by this exploit there is a CVE number if you want to search you maybe get more details out of it can also look at the source code we just go to the very bottom we can look at what it's saying for a payload and just based upon this I know it's sequel because this looks like a sequel injection thing and then because they're doing some type of sleep this is probably gonna be blind injection and we'll take a look at this in a second but let's just start running it so we can do search bleach - M - mirror it and then I always like renaming it so we're just you just do like CMS made simple SQL PI the one thing I didn't do was look at this Python 2 or 3 I'm just gonna search for a print statement and we do see a space so this is going to be Python 2 and if you haven't ran a lot of Python you may have to install one of the modules that's not default and that is term color so if you get error message 1 and running this do pip install term color I already have it on my machine so it says requirement satisfied if you don't it'll install it so let's do Python CMS made simple and then we need to specify a URL so HTTP or not HTTP HTTP 10 10 10 131 and I believe that is it so now we see it looks like it is trying 138 is the IP not 131 but it's going through the alphabet and thinks it has K Oh serve a close connection did we just get banned unable to connect I don't know why we'd get banned that's mean we can ping it just can't connect to it I'm gonna restart my VPN I think we got banned so I'm gonna give it like 10 to 15 minutes and then we'll go and try running this again it's now been some period of time and I should be unblocked from the server and what happened was I didn't put slash right up slash so everything the script did generate a 404 error and like the server says it blocked me because I generated too many requests so always make sure you put that slash right up slash or you will get banned so here we go it looks like it is trying it now and all looks good we could edit this grip to go through a proxy but because it's just HTTP let's just do something different and Wireshark it so let's open up Wireshark and then we will capture on ton zero get a few HTTP requests stop it and let's see exactly how this works so if you go to epic rocks and search like SQL injection you'll probably find a lot of videos that go over this so if we also search for like time oh maybe we don't have time boolean this will probably be a good video to go to but always check that side out if you need help on specific topics we're just going to look at this one let's take a request and follow it and see exactly what it is doing so it's doing a git slash right up module interface PHP and then a scary-looking sequel statement so if we copy this entire thing let's go over to Firefox let's move this down turn on rips wheat and then paste it in my bib Suites not running I could be problematic click it come on look at this it will stick it found the valid name so it's trying to do email it looks like so clips this launch it once plude's do this and that's just a script I have that there's all the sizing the whole terminal windows so run this we can send this to repeater and start playing with it so we want to look at the oh that is ugly that's not we want this is what we want we can clean that up so copy this let's go to a different one paste proxy drop this request this one looks better we can close out of this and let us highlight the whole thing I'm going to do ctrl shift you to underling code this and we see the injection is within this parameter and I'm guessing this is the expected thing or maybe just one is and that we do in a select sleep one from CMS site prefs where site prep value is like this and site prep name is like this and what it's probably doing is a new Marine characters one at a time well and this it's probably doing two at a time because it is hex so we can find out what value it was so this was probably up here so if we do man ASCII table man asking if maybe there we go we can look at what five is because the very first character is 5 so ABCD scroll down where is 5 okay 35 so going back to burp 35 here so up there it was brute-forcing the site pref the next one is 61 if you look here for 61 that is going to be a lowercase a up here so all it's doing is essentially saying hey if the value is like 3 stir or anything 3 probably percent but if it begins with actually 3 5 because we won 5 its value begins with 5 then do this sleep 1 so what I'm going to do is simplify this by just removing all this and we can say this and I'm going to highlight press control you to yodel encode it and it's gonna sleep for one second and now we know that was true so if we do sleep 5 it will sleep for 5 seconds and how it was corroded was just saying hey if this next statement is true then sleep for 5 seconds and any time the server takes 5 seconds to respond you know that was a correct value so that's how that worked let's just move on and take what it found so it found a password so we can whoops clip that we can do echo dash n paste the password WC - C 32 characters safe to assume this is probably just going to be a md5 sum we also have a salt for the password so we can't just go to like hashes org and crack this password probably because there is a salt we should disable it and essentially you can think of a salt as just prepending something - the password so if your password is password and your salt is hips AK then it puts up SEC password in the hash there probably better if I just type it out so whoops we need to go hash search paste new 0-7 vd5 and it did not find it so if this was just a straight md5 sum it would do md5 sum password like that but with the salt it does md5 some sort password and if this salt is random it's gonna be pretty tough to crack the password with just standard word list especially if this is like non ASCII characters so let's go back to that script and see if they had a method to crack so - H - C so crack passwords with word list we probably should have specified that at the very beginning so we'll let this script to run again and I guess we'll come back when this is done so I'll speed up the video actually while this runs let's just look at exactly how it's doing this salt so let's do them CMS made simple search for crack crack passwords so it's opening word list and literally just doing what I said salt plus line line is gonna be a line and probably rock you and so we can probably do this in hash cat instead so let's just open up a new window go to the crack in which is just a box I have my network I never recommend doing any type of cracking in a VM always do it on your host or just on a separate box because VMs are slow so let's go into the hash cat directory and then we will have to grab the salt and we'll also have to grab the password hash so pw hash and that is going to be C can I get it right here and yep so it failed probably because it wants you to specify a directory so let's save this a no file name we'll call this right up info and then echo - n WC - see that's 33 characters I wonder if it doesn't have that X definitely doesn't have that X if it's a md5 sum because that's not hex there we go hex can only have a through F so let's go back into the write up info and we'll just move this to be password info we can cat that so it'll always stay at the bottom while we look into how to do this with hash cat the best place to always start is by running hash cat and then doing - - example hashes and then pipe in that - less and this gives you a bunch of examples and then we can search for md5 and go through the list and this is type is md5 and it's saying past dot salt so we don't want that one this next result is md5 and it's salt not pass so this the one we want because if we looked at the code it was doing the salt and then the line which was the password so it's not putting a literal period in this is just how they concatenate these two variables so we're going to use mood 20 and then the format is the hash and then the salt I know this is the hash because this is more likely to be 32 characters then this is I can probably eyeball this being a bigger thing and well I can eyeball this definitely not being 32 characters that's what I wanted to say so let's go into a wordless directory or hashes directory and we'll call this CMS made simple and then put the password and then colon the hash so base that colon hash paste the hash colon the salt and that's what I want to say hash cat - mode 20 the hash file so this will be hashes CMS made simple and then the word list I'm just gonna use rock you so we'll start this off and see if we get a crack and we did so we see it up here and then the other good thing with hash cat is you can do - - shell and this becomes incredibly useful because if we go into this let's just move - cat pot file - ash cat pot file dot not showing you because I don't know what passwords are in there so I don't want to do that let's go back to that hashes so if we go hashes and then what was it CMS made simple we can put a user name so if we knew this was please subscribe if that was the user name and then do that same hash cat send tax and say - - user name it's always going to take that very first separate field separated by a colon and have that as the username which is going to come in extremely handy when doing that - - shell so if you give it a bunch of like Active Directory hashes then when you do so and you can't do that with a dictionary list you just want the hashes file or not let's do dot slash hash cat help grab - I user - - username I thought that would do it let's put - - whose name ahead all hashes in part file oh it once username yeah so it doesn't actually put the username in the pot file it's just taking a username out of this and doing the set for you so you have the username the hash you gave it and then the password so this becomes extremely handy when cracking a ton of things to do that username flag but we have a password Rae kj9 and if we went all the way back here to the box we see a potential username JKR and then the password was Rae kj9 so let's make sure that's not a clipboard we can try going to slash admin and saying if we can log in so JK or paste the password we can't get in we can do JK or at right up htb and see if we get in and we do not so we can also try SSH so SSH JKR at 10 10 10 138 put in the password and we get in I just had copied it wrong because I had shift insert and control shift insert two different copies or at Pace so being on the box we should probably run like linen or something so I'm going to make a directory dub dub dub and then we're going to CP opt linen oom when Danube got SH to this directory and the only change I probably made to this is I put 0 equals 1 at the top so it's always thorough checks so I don't know why I just close that window so we can do Python M simple HTTP server to step a web server and then just go to dev sh m and probably curl 10 10 10 for 10 10 14 3 make sure this is our IP if config ton 0 it is port 8000 Lin a new message curl not found we can probably W get it yes we can then we just execute it with bash linen oom and let this run well it goes I guess we can just go to the top whoops oh it's already done so let's go to the top and see what we have so I'm just going to search for bracket - bracket and we can just hit n as we go so we see this is Debian we knew that already specific release information name Devon I don't know host name is right up user and group info one of the odd groups is staff this is a special group see if this will highlight it I'm not sure if it does who else has logged in a contents of Etsy passwd missions on home directory wax doesn't look like it fouls owned by this user I'll in a Noom world readable files so doesn't look too interesting I'm just getting down to probably the set UID bit files our history doesn't really show any hosts so we know there's no like docking containers on this box listening ports it's got MySQL so we probably should look at the MySQL config and get a password out of that and see a nit systemd dub-dub-dub set UID files and we see everything looks default set GID files everything looks default and improbably it so there were two things we saw number one we're in a staff group which is unique and number two we have my sequel I personally probably would just start with the staff group because I know what that group does but on most boxes you probably want to start with like enumerate that my sequel thing so let's go to verb dub-dub HTML and then go into that write-up directory and we can't so maybe a numerator my sequel is not what we're supposed to do here we can try like MySQL and we can't access my sequel so maybe I was hoping maybe like our user could access the database but we can't if we do LS la we see only dub-dub-dub data can get into this write up folder so let's go look at what the staff group does so staff group we can search for Debian we get system groups and if we search for staff it allows the user to make local modifications to the some use a local without needing root privileges and I bet if we had paid attention to Linda new output more slash user local crontab that's I would tell us that we could modify this maybe not but we can modify files and use a local and that becomes a huge thing because if we echo path user local bin is right at the beginning so if we can place a file in this directory then anytime a file is referenced that's not in this it will get executed so take like let's look at what's in bin so bin bash is there so if you had a file in use a local bin called bash when you type bash out a command prompt that file will get executed if you typed bin bash it wouldn't get executed because you're doing an absolute path so that path injection only works with relative paths but we should be good to go a good thing to do to find vulnerable things you have to find someone executing a program without using a relative path so I'm gonna download PS spy or piece by process PI and this was created by a hack to box user we can go to the releases and then just download it there you could also just do go build so we can do both will download it and compile it so if you have goaling installed that is apt install go Hwang and we should be doing this from a box then you can run these commands so let's go into opt get clone paste this in CD piece by we do go build we can't get the package so we do go get and then get this package and that's going to go install that and it installs it in your home directory / go / source and that's how we do package management let's go but anyways now that we have that package we just do go build and then it builds us a binary so we do file PS PI and we see that is a 64 bit elf executable so we can just copy piece by 2 root HT B boxes what is it right up dub dub dub and then go into that ice hm w get ten ten fourteen three port 8000 PS by and then chmod plus x on this dot slash PS by PSP Y we get permission denied if I look at mount let's grep for s hm we see the new exec flag is on dev AC hm so he can't just put binaries and execute it and worked with linen oom because linen oom I don't have less that's annoying linen oom we'll call bin bash to execute it so we're not executing linen oom directly out of device at gem it gets executed out of bin because that's what we're calling bash to execute it hopefully that makes sense so let's just move this to like slash tab we should be able to execute it here so piece by and then just look for processes and the process we're looking for will probably run we cat Etsy crontab one of the things that runs is hope that's a full path if you wait long enough you'll probably see a process that doesn't have a full path like user s been our syslog D that's a full path or absolute path so we can't hijack that one however upon logging in it will do something that a call that doesn't do a full path so let's do another SSH connection ssh JK r at ten ten ten one thirty eight paste the password and we can see it's executing run - parts but not specifying the full path if we do a witch run - parts we see that is in /bin and you can also see the commands I had ran there but since it's in slash bin and we can write to use a local bin and use a local bin as before bin we should be able to hijack this so if we do CD use a local bin name a file what was it run - parts and let's just do VI and then call it then - we can touch temp please subscribe so that's going to create a file that tells us that the script ran and then we can also let's make the home directory slash SSH and then we will echo let's generate a SSH key so let's go back to HB boxes right up and we can do SSH - key gen - F and we can call this right up and this is just going to generate us an SSH key for a public SSH key login thing so we can write up this is a private key if we can't write up Pub that is the public key that goes on to the box you want SSH into so I'm just gonna copy it to my clipboard with X clip that selection primary and then now if I just paste it's on my clipboard handy little program so echo paste and then we will drag that to dot ssh authorized keys and then I'm just going to chmod 600 keys chmod plus x run - parts and we can go to slash temp watch - and one LS SLA so every one second it's going to list the output of that directory so let's grab this password again SSH JK are at 10 10 10 101 38 paste the password and we see it created a file called please subscribe 0 bytes long it is owned by root so now root should probably have our SSH key so if we do a chmod 600 we now can do shi right up then 10 10 10 138 we could specify root but we probably don't have to because we already the root user and it always defaults to the same username as what you logged into if you don't specify but specifying this we get logged right in and we can do WCC root text 33 characters which is 32 and a line-break 32 is of course then b 5 some so that is the flag hope you guys enjoy the box take care and I will see you all next week