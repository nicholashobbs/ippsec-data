 what's going on YouTube the Zips I can be doing Vaughn hubs DC - nine machine and I had done this machine just yesterday as part of the livestream on March 28th 2020 but the live stream was pretty chaotic because it's just hard to work and read the chat at the same time so I wanted to do this machine justice create a separate video for it and hopefully out one day I'll have a separate video for all the machines on TJ Knowles osep like machines to practice on and learn from so with all that being said let's just jump in we have the VM set up and both the VM and our host is on a host-only adapter on the network so both things are going to be on a 192 168 48 subnet so just going over to show you a machine that is running Kali does have the second network adapted as host only if I do if config eath one that is the IP address of my Kali machine and if I do an ARP - scan - - interface eath one and then 192 168 48.0 slash 24 we're gonna scan the subnet for other boxes and we see the Vaughn hub machine is at 192 168 48.1 30 so I'm going to make the directory and map and do an map - SC - SV that's going to be for default scripts and enumerate versions Oh a output all formats put in the end map directory call it dc9 and then the IP address which is 192 168 1 48.1 30 and let that run I'm going to then put a sleep for 5 minutes because I hate running multiple add Maps at the same time and looks like I don't have to do that but we can do a - P - to do all ports and then - Oh a dc9 192 168 48.1 30 and when we look at this we see two things the first thing is what 22 is filtered so there's probably some type of unique config on there because they didn't say any other port is filtered except 20 - if you wanted to dig into this we could open up Wireshark and see exactly what happens there we also have Apache it's just open and the box is running Debian and we have the HTTP - title saying example.com so let's go over to Wireshark CAPTCHA on 8th one and we want to do foot 22 so I'm just going to search for 22 tcp port is equal to 22 and i'm going to do netcat 192 168 48 130 on port 22 to initiate a connection and what it's open it is open so looks like your end map actually opened up port 22 that that is weird so we're gonna ignore this for a little bit actually I'm going to pause and restart the machine to reset what happened essentially there's a port knockin service on this that will find out in a little bit and if you enter the ports and a specific order it opens it up I'm guessing when we did our nmap scan it hit all the sports within I think the 25 seconds needed and it opened up that port but that's going to ruin what we're trying to do so I'm just going to reboot the box so the box is averted now if I do an NC on this we get connection refused and that is what we actually wanted as odd as it sounds and that's how it should be so I guess if you just nmap this box twice port 22 will open and we'll test that and oh it's only data n P - P - is one it opened so let's filter on port 22 into a net gap and we can see we reach out to it sending it a syn packet and then it sends us a port unreachable so if we try for it 20 something that's not listening and do a filter to show that we get a rest reset at rest so we send it a sin it sends us a reset acknowledgement saying the port is closed and that happens on any port that is here so except 22 so that means that iptables is probably on this box and configured to reject packets and when it rejects it it sends it this ICMP so if you wanted to be sneaky always make sure that your reject rules in your firewall are the same exact thing as what happens when it doesn't hit a reject rule so let's move on and actually test out a theory of that - P - causing this so if we do this nothing happens so let's do n map - P - wait about 30 seconds or already 192 168 48.1 30 I'm not sure why it said the host was up/down 192 168 48 130 if config eath 1 I lost my IP address to each client eath 1 ok there we go let's do this and map and we don't need to do an output file look at this connection refused what biz run and when this finishes it'll probably up so still refused it's about 16 percent done I guess oh and Matt maybe not - P - let's just do n map I really have no idea why that opened up earlier I guess we just got lucky and and map scanned it and an order that was compatible with opening it up so can replicate that not sure what happened that's why I had reverted the box so let's move on it only had point 22 as filtered and 80 as open so let's look at port 80 so 192 168 48.1 30 and we get this website that looks to be not well created let's see we got a few links so I'm going to open up each link and we'll go through them so display dot PHP has all this search looks like we can search with either first step or last name so if we go here grab a name such as tom search it pulls the result and then we got a login page so you can try walking in with admin admin and we get a password invalid so what I'm going to do here is stir to go Buster so go Buster - you HTTP 192 168 48 130 - w-4 word list user share word list dirt Buster directory lists 2 3 medium and then we're going to do - X to do extensions so it's gonna take everything in this file and put the extension PHP after it and I'm doing that because looking at the site we know it does PHP so - oh good bustard - root got out and I had to specify the mode for goo Buster you got dir DNS and V host yeah I think there's no modes so do this and while this goes we can take a look at the pages so there's no input in this display so we can ignore this for now this def did have something so let's send this over to burp suite and play with the request and I don't have burp up I'm just going to run it and while we wait for it to start let's just manly poke at it so I'm gonna do a single quote and see what happens we do submit well we have to tell it not to go through burp and then ctrl shift to refresh we get zero results so I was hoping to get some type of like SQL ear and same thing goes for that if we go next start burp do a comment after this and click Submit we get the data so we have a classic SQL injection if we go up and cherry tree we can explain what is happening so where's cherry tree we can just call this DC 9 and the syntax is probably going to be something like this select let's see we'll do name well select star because a valid return returns everything but it's probably ID name position phone email but we'll do this for now from the table name so this is probably going to be let's call this users and would do where first name is equal to user input so it's probably like this and what we did was we put a single quote here and now this syntax is failed and then what we did was we put a comma a comment so the single quote the server has is no longer valid so anything after that is gone so this is now a valid sequel query again and that's why we got the result returned so now we can do something called a Union injection and I wonder if we can explain this quickly let's do SQL query structure let's see okay I figure out why my VM keeps doing this or just set myself on a static IP but I keep losing my IP address let's see select statement example that doesn't have it check these two real quick so this gets some it doesn't do a good job on getting them all cuz we don't have things like out file Union etc so let's see let's just help it out by saying Union order by out file just things we want and we got a document for Union that's not what we want reference material for select there go this is kind of what I wanted so since we're injecting in the we're conditioned most likely we can do everything after this like group by ascending descending having order by limit procedure into out file into dump file for update and it's not really going into a union let's see select can include Union statements and sub queries but when you have an injection and you're here you know you can do everything below that's I guess what I was trying to do so let's go over and do a Union injection and what a Union injection it's a sub query that will allow us to inject what we want to select and in order for a union to work you have to know everything that is right here and my VM is going incredibly slow I'm gonna pause a video because if you can hear I'm clicking and nothing is happening okay so things appear to calm down so what was i we're talking about Union but Union to work you have to know every parameter here so looking at what it returns we got ID name position phone number and email so ID name position phone and email so we know we have this much data and the reason why we need to know this is again because we know how many primers are in the Union so there's two ways to go about doing this the first is we can just do Union a bunch of unions and eventually it'll work so let's go burp suite on that's this play and that's the wrong one let's go results control shifter ready send drop so here's our SQL query so we can do Union select one and we get zero matches one comma two zero three zero well I'm looking right here actually at the bytes one two four eight bytes so when that number changes I know I made a big difference and at six we get one four two three bytes so it's no longer 1200 I'm looking at this code let's see come on run to the page we can see ID 1 name position phone number and email so the reason why it was 6 and not 5 his name is broken up into two things we got probably first name and last name the other way to really go about identifying how many things on that left side is using the order by statement so if we do order by 1 we're going to get 1347 bytes because it's a valid sequel query when we were doing Union nothing was returning it was saying zero results so one or two by two still 1300 bytes 3 4 5 6 and then on the seventh request we go from 1300 bytes to 1200 bytes because it can't order by that seventh parameter so what we're doing is saying order by one and sequel is smart enough to know one means ID and we can say first and last name now that we know that you could also specify the column name in the water by statement well order by 2 would be first name so it's smart to know that and when you to seven it goes here and like hey man there is no seventh result so that's why the query fails so two ways to know how many things to do a union with so we can go back and do Union one two three four five six Union select and what we want we could do something like DB I think now um if we go SQL injection cheat sheet there's a few parameters we could just choose I lost my IP again I really should have fixed this between last night and now but SQL injection cheat sheet I like the pen test monkey once you got a bunch of things you can do a database not DB so if we do database we can see let's see well in the staff database if we want to list all the databases information out of the sequel database we can do that with a I guess just SQL statement so let's go and look at information schema and this is going to be like the central database for MySQL it's how everything is grouped so everything here is tables the key tables are going to be columns was tables schemata schemata is going to be all the database names and tables there's other three key ones so let's go and grab all these and we want schema name this is going to be the database so we can do select schema underscore name and then on this right side after all the numbers we can do from information schema schemata and click send and ID we get staff we could change the limit statement so limit 1 comma 0 this is gonna I think start at 0 display 1 result and we get 'invalid query maybe it's the other way I always screw up the limit statements let's see ID name Tomcat so they I think get anything let's try 1 comma 1 we got information schema so it doesn't start at 0 so 2 we get staff and 3 what do we get nothing so the other thing we could do instead of doing a limit statement we can do a group underscore concat and this will put things on the same line because the reason why we can't select multiple things is because PHP is only pulling one item out of that result it's probably going to pull the last one so group concat is going to put them all on the same line so now when we do this we have information schema staff and users so it is definitely 3 so doing here let's go and get a new nude SQL structure so we know there's a information schema and this is going to be simple it's just going to be let's do schemata columns and tables there's the ones we care about for information schema so let's go down to staff and users so let's see what columns are in staff so we can do is change this to be whatever the columns thing is so this is the tables or table we want tables columns yet so table name and then table schema this is going to be the database name so let's go back here do table name and this table is going to be dot tables click send and we get a lot of results this is for everything so what we could do is put where and we can put schema name is equal to staff could go and that is wrong table underscore schema so let's change that to be table underscore schema is equal to staff and now we have two tables staff details and users so we can go back here and put these two tables and staff details we can get rid of this information schema thing we don't need that anymore but we want to know what columns are in each of these tables so to do that I'm going to rename this one to be table NFL press control are to go to a new tab and we'll put column and fell and the reason why I save that is because we're going to redo this for the users table and this will just be easier so going back to the information schema page columns I guess we should have table schema table name and column name so we can change this to be column name from information schema tables where table schema is equal to staff we want this to be columns click send and we have ID first name last name position phone email reg user ID username password we probably want to know which column each of these goes to we could do an and statement so we could do and column name is equal to users and see what this returns [Music] maybe it's lowercase let's see where table name not column name I keep getting column and table confused for some reason right now table name is equal to users and we get user ID username password we could also go up here in this group cat statement and do table name comma colon comma and now when we display this we get staff details ID staff details first name so we get everything we want since how I'm organizing this and my cherry tree I'm going to do it this way and we want to get rid of this there we go just want user ID username password so user ID actually let's just do them all this is table name comma like this this would be the quicker way to document and we don't need this copy they're based and we'll go where there's a comma let's just go in a batch real quick at Kadesh n said search for commas replace with line breaks and we'll paste there we go so now we have a list of all the fields and we can do the same exact thing for users so we'll just change staff to be users click send is it lowercase group and guide table name column name or maybe not plural lowercase so do the same thing at Kadesh n said s comma and like that and we have everything so you only add this information ID first name last name username password and reg date which is PI registration date the first thing that is immediately apparent to me is this users passwords so let's extract this so we can just do username and password so replace table name with username and then this one with password and now we're going to only want information schema dot columns we want that to be staff and we don't need a wear statement click send we get nothing staff dot users let's see we get one and MIT in this hash so I'm going to create a new thing called creds and what paste that and I want was Oh users has username and password so we can grab this as well so if we do coop can cat username password from user details dot username no user details we want users dot user details this was lowercase ok so now we have a bunch of credentials so echo dash n said s comma and like that we go to creds paste this in we have a md5 hash so what I'm going to do is copy this and we're going to search the internet to try to crack it so let's go to hashes org again th client eat 0 there we go that's gonna get annoying real fast we can do search paste the md5 hash here and I know it's md5 because this is 32 characters Hector - n WC - see oh I didn't copy the whole thing let's go back to boob sweet and what was it a skill structure user's password out of staff so from staff dot users username password we can just do password or this return copy this whole thing I've got to see at the end I'm glad I went to explain that so add to see that's now 32 characters and we have this almost impossible read CAPTCHA q t k HC k k did not find it and then you can also go to other sites hash killer is a good one maybe coat UK is what I'm looking for hash cracker md5 paste it here do the much more reasonable CAPTCHA and we get the password as transorbital one so trans orbital one so we have a bunch of username and passwords and now we have to try them all so we go to manage we got username and password so we can try going to proxy clear ik you use name test password test submit we got to put it on intercept mode because I want to see what the login looks like I'm William for like a cross-site request forgery token or something and we don't have any so we can probably do is do w fuzz on this so let's go back to cherry tree copy these two a file V creds paste this all and they'll do awk - F : print one creds this will be users print - we'll call this passwords so W fuzz - H chains let's display help on chains chain know let's just try W fuzz - W uses - W passwords - you HTTP 1 9 - 1 6 8 41:30 / manage 1 9 2 1 6 8 48 130 manage PHP and then we want - D for post data and the post data is going to be username and password so username is equal to fuzz and password is equal to fuzz so let's see what this does when we to specify W twice fuzz and number of payloads don't match so I think if we do maybe - m's if well this work does not let's see WUF us multiple parameters and Vance usage so - z-list abc123 fuzz fuzz so I wonder if we have to use - Z when we do multiple parameters so zip we'll do a 1 c3b - because it's going by the first thing if we don't specify any chain it does all combinations if we do - M Jane it's only to do one parameter so hopefully that makes sense so we want the - M's it but we also want to specify file so let's see W fuzz - Z probably the basic usage - W word list file and then the file name so let's try this does the file users does the file passwords let's see where's my syntax I'm just going to put the URL at the very end and not do that - you and I don't know why I'm eating so much clipping on my VM right now we're still getting an issue put this end single quotes let's just test something out question mark fuzz and fuzz oh I have ax so that looks better so let's go back to what was - D change that - X - a - Z buzz words and payloads don't match it should let's see I'm just going to try their example when I do 168 48 130 okay so file passwords file users that worked fu Z to Z is what I missed oh man that is obnoxious syntax fuz to Z mainly because the two blends in with the Z there we go so doing that we see the password is admin and transorbital one well I can't believe I had missed that or I can't believe someone thought that was awesome syntax to use so I would submit let's go to manage try it again whoops it's not in my clipboard correctly copy paste logged in as admin and we get this weird thing that says file does not exist there is also add record so we can insert something it looks like so if we insert please subscribe position as CEO phone number as five five five and the email will do thanks at for subscribing got awesome click Submit and now we do all records we have something I don't know what that really buys us but we can insert things into the database it could be potential rabbit hole for people to try like a b c d we may want digits and position like for people to try PHP code so we can do this and see if this works but normally when PHP grabs data out of the database it does not work so if we view the source go to the end do we have PHP info we do so it printed the PHP tag so maybe that's why that's there but if we go back to manage we see this file does not exist so that's probably hinting at something so I'm going to search the source for file and we don't see anything so chances are we probably have to fudge manage PHP for some type of parameter so I'm going to go back to W fuzz and before we do that let's go find slash user share SEC less grep - I and let's search for burp and we have a few things so the one I want is parameter names so let's go back to it w fuzz and remove this in tax and what we want is just dash W and paste that and then question mark what do fuzz is to what could be a potential file here probably index dot PHP let's make sure that exists index dot PHP it does so search for that and now we want to hide probably everything that is 87 words so we can do - - hide words 87 and see if anything comes back and parameter names is just a bunch of things that may be parameter names nothing came back for index.php we can try the good ol standard l fi which is a bunch of dots lashes and then at c passwd and see if anything comes here nothing so let's see we may have to specify a cookie actually we probably do so going back to this if we do a - P for proxy and do one 27001 port 8080 and then HTTP and all caps we're going to send what we're doing through burp suite and if we just go to this page we probably won't get anything because we don't have a PHP session ID so let's right-click oh actually we can sent to repeater go and render page and see what this page looks like do you even have that air we don't have that air at the bottom so that would probably explain what's going on so let's control C out of that we can grab a PHP session ID so let's send this Boop go to manage see what it's trying to do and this is the cookie we need so W fuzz - H - B is for cookie so we can do I'll actually leave the proxy out so W fuzz - P so you can see what's happening and then - B for cookie paste it clear the cue of intercept for you fresh and now we're getting this PHP session cookie so if we click repeater go and go to render render page we now see file does not exist so let's clear this and do W fuzz we can just get rid of the proxy when you pipe W fuzz a go bust or something through burp it slows it down and also burp is a Java program we'll have a lot of memory assigned to it afterwards because it keeps all that information storage and just slows down your machine so don't send things through burp that you don't have to especially with like W fuzz go Buster etc so let's try this and now we should filter for a hundred words and it looks like we're not getting anything so let's try a good ol trusty dot dot slashes let see passwd and right away the file parameter is three thousand six hundred and ninety four so if we go back to a repeater and say file is equal two bunches of slashes click send let's go to the raw we get the output of passwd so I'm not sure why index didn't work and X dot PHP because this should include itself let's try manage PHP maybe it has some check that prevents it nope power does not exist so let's do after video go over lfi and manage dot PHP okay so let's see with this Elif I we can include various things the first step is try to go to log so very log Apache to access log to see if we can read this file if we can then we can do like log file poisoning and put our PHP code inside a user agent or something and get it executed but I'm not seeing anything and we don't have a PHP session so let's send this intercept on repeat and copy I close that repeater tab when I didn't want to okay so power does not exist and I'm gonna put this here and my search term so if I ever see one match I know didn't work so the other thing is the try to get code out a bit so if we try to include PHP files well it didn't work so let's try the bunches of slashes var dub dub dub HTML index dot PHP and that's looking better actually because we're including index dot PHP it's probably looping over this and never get a finish because maybe manage dot PHP calls index dot PHP and then that's where the file parameter is but it's probably going to say hey go display this page oh this test page displays it's probably like this manage PHP calls index dot PHP which has the file parameter of grab index yeah grab index dot PHP and we're going through an infinite loop here because it's just going to grab index dot PHP which then has the foul parameter this to go grab index dot PHP again and just goes on and on and on until the process runs at a memory so that's looking good as weird as that sounds it not coming back is a good thing so let's see what is something that may not grab we can do display dot PHP see what ends when we include this still just hangs okay um let's see we can do PHP filter convert dot actually PHP filter is probably not going to work and I say that because for a PHP filter to work generally you should be in the directory th client eath one that lose connection why is nothing coming back well I'm still there let's get rid of this paying 192 168 48 130 I can ping it curl 192 168 48 130 that's coming back that's going where I think it is that's coming if I put this cookie everything I do with this session now doesn't work when the session is here the page just doesn't pretend let's logout and well again maybe the database hung or something let's try logging out by deleting a cookies manage username admin transorbital one for the password we're now logged in we go to manage that's looking better I don't know what we did to that PHP session let's see do I have it saved I do so put this PHP session in how does not exist okay file is equal to index dot PHP and we get it doesn't exist so chances are we're in some type of directory so it's probably doing a include and then some directory slash user input here so think about it this way but did this we can't put the PHP filter here because it's got directory before it if it didn't then it starts with this which then causes this to go down that path so that's why I don't think that will work so if we do dot slash index dot PHP it doesn't hang so we're in one up one weird directory but we can try PHP filter convert base64 encode resource is equal to index.php click send and we get follow does not exist so that doesn't work the proc table so CD / proc has a bunch of useful information all this are the process IDs running on your box and then inside that is secret information about the process so if I do psdf bash let's go into 8687 and here's all the information about the bash process so this is how tools like PS get all information so if we do like CMD line it's just going to be bash because that is this piece right here if we do let's see L s CWD is going to be the working directory of that process so that was route 1 d c---nine so a bunch of cool information out of this there's also the F D for file descriptors and that may just contain random stuff about the process and when you do LF is you don't know exactly what PID you are but there is a magical directory called self which is always going to be yourself so if I do a LF I on proc self n CMD line clicks and we get ball does not exist what managed file Etsy passwd let's make sure this works ok so Fowler does not exist and then it displays it that is annoying so far does not exist but we get the CMD line of user s been Apache 2 - K start so we can try FD 0 and we get nothing ft 1 nothing so let's go and copy this end W fuzz it so we'll do W fuzz - z range zero to a hundred let's try 100 file descriptors - you put the URL which is going to be HTTP 192 168 48.1 30 and then the number is what we want to fuzz and we can do - - 8 w 87 and probably need to put a cookie - B and let's grab PHP session ID Emmett ID 100 and we get nothing so that clearly did not work so another thing in the proc table CD / proc is this schedule underscore debug if I cut that on my calaman Sheen we do less you can see lots of things that may be processed names and just good details about the box so this is another good thing to look at so let's go proc sched debug grab this and let's just throw this into a file because there is a lot to go through oh we can go into a tree okay so I'm going to do let me go through all of these and there's probably going to be a lot of duplicates so let's just V output paste and we can cat this pipe it to awk print - and then sort - you four unique because we don't really want to go through duplicate things all that I EQ stuff not important let's see going through on it stuff block just looking through and one stick naught D naught D is a port knocking service and if you remember going back all the way to the beginning there was point 22 as filtered so we can go through the rest of these things and don't really see anything there's the SSH daemon but let's go back to burp suite and try at C not D Kampf is this a file it is and if you didn't know where not D is you could just Google not the configuration location and we see two OpenSSH we send these ports to close SSH we send the ports and reverse so I'm guessing with an map and all depending on what order it sends the first port in so if n Matt sends seven four six nine before nine eight four two it'll probably open up SSH if it sends nine eight four two before it probably closes it again so that's probably what happened there when we were doing this box is by chance and map sent in this port first goes MF scans ports in a random order by default we could and map no random port that is super annoying th client EEP zero I'm really confused what adding a second interface did to muck with my eat zero scan order port exclude fast - our is don't randomize so if we do an NC 192 168 1 38 130 on point 22 is it 48 it's closed so nmap - B - - are 192 168 48 130 looking at this not D config the ports do go in consecutive order so as long as it does ports 1 through whatever it should be open at this so let's see so it says 22 is filtered and now 22 is open because it hit all the sports and the correct order so I guess just randomly if your end map does the random and this port order it's going to work and I don't mean it has to do these 3 consecutively I just mean when it scans 7 4 6 9 then it's got a scan 8 4 7 5 before 9 8 4 2 so that is interesting let's go ahead and close it so there's the ports so we can do NC 192 168 48 139 8 4 2 8 4 7 5 & 7 4 6 9 and now if we go on port 22 connection effused if we reverse that order so seven four six nine eight four seven five nine eight four two it's now open again so let's try doing Hydra against this so Hydra - H at once - l4 user file so - L users - P for password file that's going to be passwords and then we want SSH 192 168 48 130 and then reverse mode so we'll do - V and hydras not connecting not exactly sure why my Hydra screwed up it was this way when I did the video box live as well so we'd afford it back to an crack so n crack and C so an ssh example so - pssh and - capital u and - capital p u users p passwords and it's doing HTTP here so I'm just going to specify SSH 192 168 48 130 is there a thread option let's see wait time per login over all the threads C tasks in parallel so let's do - t32 and - capital t 128 I guess we're just doubling it and was there a verbose there was we can do does V for verbose see what this outputs so it's going to be two minutes left I'm just gonna pause the video and we'll resume when this is done so it's been a long time probably like 15 20 minutes and this n crack still isn't finished so I'm gonna kill it and I'm guessing it's probably because of these threads SSH normally doesn't like being threaded and I'm also going to now try a different option I saw when I was looking over the man pages called pairwise choose username and password and pairs so what is gonna do hopefully it is it gonna try these name and passwords in pairs so maybe admin and only transorbital one and I'll try because a password list is in order actually if we do had users and had passwords from SQL database this should be good so Miriam is probably 3kf and Chandler is you're a god so if we head cred marry 3kf Chandler you're a god so hopefully it works that way but it didn't do anything so we're gonna give up with and crack and switch over to Medusa so - h4 target or IP address so 192 168 48.1 30 - capital u for username file users - OH - D for combo entries that may be what we want Medusa - C H 192 168 48 130 - C let's just give it credit - m4 module SSH invalid combo file format man Medusa combo let's see the file containing combo entries combo files are colon separated user password okay so cat creds so all we need to do is add the host to this so let's do for I and creds do echo 192 168 48 dot 48.1 30 : I done this will be combo so go back to Medusa and we can do combo and I'm guessing we don't need the IP address since the target is in this word list and let's try this admin transorbital 1 Mary yep it is doing it as we expect if we wanted to speed it up we could probably do threads so let's do - T we're do 6 and see if this is anything it should display errors as it finds it but there we go we're now finally getting success so maybe from now on I'm always going to use Medusa for checking SSH because this syntax was pretty easy to use and it's relatively awesome so we got Chandler your god Joey and password and janitor so let's go here and say SSH and we'll copy these lines so let's do Candler and your god Chandler be so SSH shandler be at 192 168 48.1 30 face the password and we get into the box so I can do find dot to see if there's any files there is some weird GnuPG things but I'm going to disregard that for now we could run lineage Lin peace which is my preferred privilege escalation script so if we to make dub dub LS up it's going to be this privilege escalation awesome script sweet and almost everything in this out directory can be found on github so if you just google these things you can find it so let's go nww and CP up this and then Lynn peas Lynn pssh and we can start a web server HT b dot server on eighty Python three go back to our shell do we have curl we don't we do fw get so we can just W get 192 168 1 30 the 48.1 30 slash Blimpie's sh not found li NP EAS I probably type out that 1001 129 the box itself is 130 so we can execute when peas and let this run and I'm just going to SSH again while that runs maybe if I can get this before Sh Chandler be at one I to 168 48 129 130 you're a god so we got two sessions so let's just go to the very top and go through this red in yellow are things we definitely should look at if you see this chances are you can prevent so let's see it's telling us basic information ping is available so we can do net with discovery but that cat is not there so we can't do port scanning operating system is going to be debian there's a path system environment useful software we have w get so cat so we don't have that cat but so cat can probably do tunneling stuff python old PHP headin pseudo we also have GCC so if we wanted to go with a kernel exploit we could compile it on this box which is super handy otherwise we should stand up a debian 10 box to compile there to make it as similar to a target as possible however since this is Vaughn hub and an old machine I'm gonna ignore doing all kernel exploits unless I run into a huge wall I guess I should say so looking at this it highlights not D we already know that nothing else really interesting running on a root process we do have my sequel which we should enumerate and we can probably get more credentials out of the PHP scripts so going through this users with console highlighting Chandler because that's who we are then root users on the box last logins password policy not really saying too much it's printing out the port knockin sequence for us the set UID binaries all these are standard I don't see anything really sticking out to me set user group binaries or GID same exact thing nothing really sticking out and let's see her Lib PHP sessions we could look at all the session information this is going into very dub we got some backup files it's highlighting probably username here we got my password so we should find out what my password is and that is it so let's go over dub dub dub HTML and figure out where the password is going to be typically in PHP scripts you see things like DB PHP or config dot PHP there's the ones you generally want so MySQL servers on localhost the user names DB user the password is password and the database name is going to be staff there's probably a database name called users as well so let's go MySQL - you DB user and - P type in password and we get authenticated so we could also do show databases and we're here we could use staff show tables and we can select star from staff details and look through this so we can see the one we created we can see when the box was probably created 2000 1905 one because everything's here except we have the janitor account and janitor to account being on different days so based upon this being different and the January here I'm going to switch to that user so su - janitor we can also start up a whole new SSH session if we wanted to copy the password paste it in and if we do find dot to see anything in this home directory we can see secrets for Putin we can go in there cat passwords found on post-it notes and we have a few more passwords so what we can do is go back into where Medusa is so let's go and V we'll just call this one P W and then Medusa - H 192 168 48 130 - you users - P P W and then - t we'll do 6 threads again we gotta do - m4 module name SSH and let's see Oh probably wants capitals I'm used to crack map exact which automatically checks for you if it's a file on all arguments so try and log in now the reason why I didn't just add these to our existing password list is because well we already tried the valid credentials there and also that's like 18 lines so you'll have a lot more things instead of doing six attempts per user we'd be doing twenty four attempts per user and we have a few ones we have Fred F Joey t so we can try Fred F so we can copy this line go here paste that and then we can do Joey T face that and I think that is it so we got two more users so let's check Fred F so this is Chandler that is janitor and we'll do another one for Fred F so SSH Fred F at 192 168 48 130 and find dot and we don't really have anything here so let's copy Lynn pees do a place we can all read and like Chandler can't go into any directories so we can look at what groups everyone's a member of you don't have anything and there was another user Joey tea with the password of password so SH Joey T at one I to 168 48 130 paste this so actually I'm not gonna run limpy's on them all we're just going to do find / - read a bowl - you Joey tea period let's see - find readable by user get my internet for a few minutes he'll find files based upon permissions find files not I guess I can just do find that dot - readable yeah that'll work so - dev null and we can fight this - dev s hm Joey T and we can do the same exact thing on this user except read F same thing here janitor and same thing here but for Chandler so if we go into dive s hm oh shoot I did not copy them to a directory I forgot to care it here we go so now we have all the files so let's try something cat star sweet so we can probably do unique - C for count on star cat star pipe it - unique - C sort - n for number now we can pipe - uniques so what I'm doing here is I want to see how many unique things there are and why is it one I was hoping that would work doesn't look like it would oh shoot we can just cat uniques grap - for Chandler let's see cats do - Paul cat all unique - see - uniques I'm not exactly sure why unique - she's not working let's grab MACD on uniques on all yeah this appears multiple times unique - see works there okay we're gonna ignore that and we're just going to I don't want to ignore it Jana Chandler Fred Joey so mm all uniques cat star oh crap mech on all unique that see okay cat stir unique - see oh I'm an idiot so unique is only going to work if the fire numbers are right next to each other and not numbers the files so in mech uniques working here because they're all here however if V explained there's something in between this and now we do a unique - see it says one breaks it up three so we have to sort all - sorted and once we do this now we can do the unique so cat sorted unique - see - uniques and we can probably disregard everything that is for so cat uniques grip - v4 and we probably don't want slash run or let's see I think we can do or that way /proc and we can see all unique files on this box so dev we don't really care about because where we put our stuff but we got Chandler's bash history Fred F janitor Joey so the reason why I was doing this is because if we ran Lyn pees on each user we'd have a ton of information to go through tons however doing this just shows us what files are unique based upon the user and we don't have anything so we could do the same as that process except instead of readable do writable and see if any user can write files but I'm not too concerned with that since I don't see anything here so the next step is to do sudo checks so sudo - L and we need the password for Chandler so if we cat cred scratch and you're a god exclamation point Chandler may not be able to run sudo Joey sudo - L his password was over here Joey can't run sudo sudo - L the janitor the password can't run sudo on Fred P and run sudo right away doesn't even need a password so he and run op dev stuff dist test test so if we les this file it is just an elf which is a Linux executable so let's go in this directory and see what this is go up to directories and this test dot PI so if we just execute this it says usage Python test op I read append so if we look at testify examine what it's doing we have usage Python tests but I read append and this is art v1 v2 so it's going to open ciserek v1 for read and assign the contents of that file and output and now it's going to open sis argh v2 and append and then write that output and then close so that we could go probably two ways to get on this box or if there's a lot of ways we probably can because we can just write a file you can do a lot of badness got Etsy su doors we can't read that but we could just put a line in su doors to allow us to sudo to anything so let's do that real quick so let's just create a new pane cat Etsy su doors do we have this file let's see members of sudo right here use a privilege escalation let's just add this so if we go back to this and let's do VI slash temp sudo had pasted this and what user do we want let's do Joey tea so remember Joey tea can't run sudo and it's asking for a password and now let's run sudo - L so sudo this slash temp slash sudo add slash Etsy sudo verse oh no we're gonna wrong word it the file we want and then the file we want to append to camstudio add okay we could also I guess read files so Joey don't ask still asking for a password weird was that it so that doesn't look like it worked but we could copy that sudo is file so if we do Tim let's touch tap test and then run the same sudo command and copy wait did I have upwards CD op dev stuff desktop I read studio and so yeah I had it right the very first time I ran it so if we look at pseudo ad now we copied the pseudo file in here so this pseudo command is data you want to copy and then add it to this file so if we did Etsy shadow on temp slash test and look at temp test we now have the entire shadow file that we could try to crack with hash cat if it wasn't sha-512 encrypted because this is super slow to crack I probably throw this in the hash cat but not gonna be too worthwhile so let's reverse that sudo thing and do temp pseudo add on Etsy see doors so now we added that line if we do sudo - shell Joey may run the following commands on dc-9 all all so sudo - and we are now route the other easy way to do this is through open SSL and adding an entry into the passwd so open SSL passwd let's th client eat 0 sorry about this I'll figure this out but before I can do my next video open SSL passwd and we want - salt so let's see there we go examples so we can go back to the box and what this is doing is just generating the password so what's for the salt do please and for the password we'll do subscribe let's do so it's shrunk a this to 8 characters one two three four five six seven eight so password is subscrib so let's add this line to the passwd going into temp let's tail - one passwd - new swd and we're going to edit this to be the user if SEC and this is reserved for password hashes if it's an X it's gonna go into the shadow file to get a password so we're just going to put a passwd password here we could do the shadow file but that would just make it much more annoying so hips ik and I say much more annoying because we'd have to do this twice and add a line to pass to be create the user then add a line in the shadow file for the user's password this is just a shortcut so I'm gonna make his home directory slash root so this is the path to PDF format username password hash user ID zeros root group ID zeroes root again comment or name of the user this doesn't matter it can be literally anything and then the home directory is next I'm just playing as home directory as root and then the login shelved in bash so let's go back to the sudo and we'll do tap new passwd let's see passwd and now we can do a su - if SEC and type the password what was it su be CRI be subscrib and we are now rude on this box so that is how you do d c---nine if you enjoyed this video let me know in the comments and that would be it so take care see you all later actually I lied I'm not done yet there are two things I wanted to show you number one was a unintended thing that we discovered and the live stream doing this box and the other thing is this lfi and managed PHP so let's go for a dub dub dub HTML look at manage PHP and see where this lfi is I'm going to search the file for file and let's see file is equal to this so if file exists file include so let's see file currently is contact info dot PHP so if that exists include it else file does not exist file is equal to get file include directory slash file so this is why the PHP filter did not work so if we edit manage PHP and say just include file so let's go before we edit it go back to burp suite and we wanted to grab index dot PHP so we did a PHP filter convert base64 encode index dot PHP this is free source is equal to this and send we don't get anything because we're to command right now is directory slash that since it the include statements not beginning with this wrapper it's not going to work so let's cheat a little bit and get rid of the directory these save that click send and oh we're not logged in so let's copy this PHP session ID I guess we need to log in real quick let's go Firefox example manage admin trans for abital 1 and we will send this to bit sweet repeater send and we have a bunch of base64 so if we go back to this file and do directory slash like it was send doesn't work so this is that piece and if we decode this echo - an base64 - D we get the source code to the script so if we just tried index dot PHP we won't be able to see the full source code - I leave it on directory C no I did not I don't know why that not working but you can't really use include statements to do that because if we look at the source the PHP is going to see this PHP tag and execute it when you do it in base64 it doesn't see the PHP tag because it's an base64 encoding so that's why you can extract source with that PHP filter the second thing is a bug in this website so when we're doing this box live and we did go Buster go Buster root dot out we found a few scripts like welcome PHP so let us go and delete this cookie refresh delete and we click on all these things and we can't do anything ok so if we go to welcome dot PHP and notice the foe not found things not there we get a welcome PHP you are already logged in and we go back to manage we get the file does not exist so looking at the code on manage PHP we see right off the bat it's includes config dot PHP and then goes on to do things so let's look at what config dot PHP is that is just the file we saw earlier with config stuff let's see is there any dyes in this there is not so going back to file we have let's see right now I'm just trying to figure out why it's showing okay so we have this is admin and the session is logged in user name here so when we hit the welcome page this logged in user name things being set so if we go back into storage cookies and we look at this session so I think the PHP session is in ver Lib PHP sessions and we cat cess and the session we see logged in user name so this create this exists so that's why we can go down that one code path is admin does equal something if we create a new session and don't hit welcome dot PHP so let's delete this it manage look at this session and we cat whoops the file it's empty but soon as we hit welcome PHP it populates so we got to see what Welcome dot PHP does so less welcome PHP it's going to include session PHP and what we want to do is look for a logged in user name here so this isn't setting anything because this is just saying if the session variable is admin then display more stuff and then we have logged in as this so we don't see it setting this variable name but the very first thing it does is include session dot PHP so if we look at session dot PHP and search for logged in we see it's setting that variable to admin so starts the session and then sets it to admin and that's why this script works so any file that includes session dot PHP will actually unlike log you in which is hilarious so let's grep session dot PHP do a recursive so like logout includes session dot PHP so if you try to log on to this application you can't so let's test that further the leader session go here we don't have anything if we hit logout dot PHP we are now logged in and on manage so if you didn't do that peace with SQL injection and grabbing the credentials to eventually discover admin transorbital one this was a bypass of that whole SQL injection piece because if you hit the logout dot PHP welcome dot PHP or any of those that had session it would log you on the application and you could proceed straight to doing that lfi so with that being said that will be the video take care and I'll see you all later