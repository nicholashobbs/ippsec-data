 what's going on YouTube the zipsak when we doing la casa de papel from hack the box which I believe is the Netflix show money heist that this box is loosely based upon but anyways to get a user shell in the box you have to chain to vulnerable services the first is V SFTP d that has the backdoor from 2011 running on it it's slightly modified so instead of a bash shell you get a PHP shell that has some functions disabled so you can only read and write files but one of those files you can read is the certificate authorities private keys so you can generate user certificates which comes in handy because the web service on the box requires client authentication and if you watch my securing vendor Web Apps video I did months ago we set all this up so hopefully that part is relatively easy the routing of this box is just um there's a file in a home directory that gets executed you don't have write access to that file but you do own the directory so you can move that file or delete the file and create a new one and then get cleared execution on a cron job so I'm sure while this will make more sense once you see it done so let's jump in as always we start with it and map so - SC for default scripts SV I remember eight versions Oh a I'll put all formats put in the end map folder and call it la casa de papel and then the IP address which is ten ten ten one thirty one can take some time to run so I've already ran it looking at the results we have a few ports open the first thing I notice is FTP on port 21 and this is running vs FTP D version 2.3.4 so if we do a search play it against that to see if there's any known exploits we do see that there is a backdoor command execution via Metasploit so we should try that one out but let's finish doing the Recon we have SSH on port 22 and we got OpenSSH version 7.9 it's not leaking any OS type information we also have HTTP on port 80 running a node.js application and probably the Express framework the HTTP title for that is lacasa de papel on 443 we have HTTP also running nodejs but this time we're getting a 401 unauthorized error and then do we have anything else doesn't look like any other ports but we do have it leaking a host named La Casa de papel htb and the organization name is what Casa de papel so we can put this host name in our hosts file so we can reference it later so go to Viet see host and then we can just do ten ten ten one thirty one and then paste the host name so let's go and try vs FTP D someone do MSF DB run which will start the database then run MSF console it's just a little handy shortcut with Metasploit luden we can just do search vs FTP D and we get the exploit so let's copy this whoops not open link let's copy do use put the module show the options and we can get rid of this window and we just set our host to ten ten ten one thirty one and that may be it if we click run or a type run we'll see what happens and we get exploit completed but no session created we do show Advanced Options maybe there's like some type of reverse so let's see that reverse is set to false so we can set that true so set for verse true run it again and see if it tells us anything different the service on port 6,200 does not appear to be a shell so exploit didn't work but at least I told us something and when we did it and maps again port 6200 was not up so let's try doing n map again I'm just going to - vvv 10 10 10 131 and that's just gonna show verbose output to show open ports because maybe we did not scan port 6200 and we can also just do NC 10 10 10 131 6200 and we indeed do have something listening so this is kind of semi unintended because we're gonna dig and do exactly how this exploit worked but before I do that I am going to revert the box as soon as that a map finishes because I'm not sure port 6200 is in the default top 1000 I'm just curious and now that nmap is finished we have confirmed that port 6200 is not on the default top 1,000 percent IMAP scans if it was we would have seen at map showing it as open so based upon what I know about this backdoor already I'm guessing the Metasploit module did trigger but it just didn't know how to handle it because the backdoor normally gives you a bash shell on port 6200 and this is giving us this weird size shell that may be a PHP shell so I'm gonna revert the Box check this port out again to see if the box starts with this board open and we would have seen if we just did - B - and then we'll also do a little bit of a deep dive on this backdoor to see exactly what Metasploit did and at the end of the video we'll dig into the binary and see why it's giving us a PHP shell instead of the bash shell so let me revert the Box the box has now been reverted so I'm going to try to netcat again on port 6200 and we immediately get a connection refused so that Metasploit module did do something so let's Google exactly what that V SFTP backdoor does so I'm going to do v SF TBD backdoor and I know I want a page on a domain that has XOR L so I'm just going to put that here because this does a relatively decent job at showing the change so the backdoored version places let's see where's the code this code so this P string is going to be the username so if username equals hex 3a and if we go to like ASCII table we can see what 3a is so going here let's see let me make this bigger for you all we have the colon as 3a and then we have 2 9 next so if we go over here and go to 2 it is this so it was a parenthesis which is a smiley face so if the username contains a smiley face then the backdoor triggers so let's try doing this so the first thing I'm going to do is we're going to do net cat ten ten ten one thirty one not one that we're gonna do space twenty one to do on that port and then we'll type user hip sack and then we'll do password but not password pass apes ACK and this is just the plain text of how FTP works and we can do and see on that port and it doesn't exist if we do the user as if sec smiley and the password of if sec we can get a shell on that port so we will dig into the assembly or binary at the end of the video but for now we'll just be happy that we have a PHP shell so we could also have just looked at this Metasploit module so if we do locate V SFTP D 2 3 4 backdoor we can see what the Metasploit script does and we'll see it does pretty much the same thing I'm gonna do them real quick so we have syntax highlighting we got URLs to go look at and then let's see port print status banner so right here it's checking if it's vulnerable and now would putting user space and then random text alphanumeric probably six characters plus 1 and then a smiley face to trigger the backdoor whoops I don't know why it was highlighting and that was a this shows something that is interesting if the server is configured for anonymous only the backdoor code cannot be reached because you can't put a username I guess so and the password just random text alphanumeric then it connects and let's see now it just connects to port 6200 so that is the module but since we have this PHP shell meterpreter just or not matter but if Metasploit just doesn't know what to do so if we do help we can see what we have it's a weird shell but if we just type PHP code we can work so we can do like echo please support me on patreon and whoops I'm gonna do something real quick so you saw when I hit up it did all those weird characters the control characters anything too cold I'm just gonna execute a program called RL wrap which is read line wrap which will let me hit the up arrow and memorize my keystrokes so we can do echo please support me on patreon and we can see the echo works so we could also do like system paying ten ten fourteen three and then over here we can do TCP dump - I tun zero which is the interface for my Open VPN adapter and then ICMP and we run this we get a PHP error saying coda on an undefined function system we could try like I think shell exec is another one and we also get that so I'm gonna try PHP info and this is just going to print out that PHP info page since we're not calling it since we're calling it from bash instead of web server it doesn't give us all that HTML output but we can just search this for disabled and we should see something soon is it here I thought I would have seen it let's see maybe disabled there we go it's not disabled it disabled its disabled but we can see PHP has disabled functions exact pastor shell exact Procope and a bunch of things that could lead to code execution if you google like PHP bypass disabled functions I think the first one is like a call to IMAP open yeah if we read this whole thing there is a proof of concept that uses IMAP to execute bash so this is a good thing to run but we can see it won't work soon as we get the call I think it's IMAP underscore open yeah so if we look for this function it is undefined I want to find that here where's the code PHP okay so here it is so what it's doing do it to specify the app nope so IMAP open has this proxy command option which allows for executing things so this is just something that can be loaded in PHP and it's loaded in most at mail application not mail applications most PHP applications because they deal with sending emails so when you load the email thing you'll probably have this function defined and then this function defined lets you execute code and it's not on the default disabled functions list so it works but in our case it doesn't work so we don't have any clear way to execute code but there are PHP commands to do things like LS which is skander so we're gonna do skander and then period for current working directory and we can see we're in slash and since we have these dear store objects we can probably guess that the uses a math computer because that Mac put slurs and all those directories so we can look at like slash home and then we can do go into each home directory see what we have so home Berlin we got downloads node modules so PJs and user that text so if we do downloads we got a page server dot J s and instead of skander I'm gonna do file and get contents and let's see permission denied I think its contents is it content yeah so we can't read survey J s there is a dot SSH directory so if we do skander ondata ssh we can't go in it so let's go out of berlin and check out the next user which is dolly so there is a dot config directory i've forgot to put the period and then we got psy sh and this is actually the PHP shell that we're in so if we do file get contents color mode function forest do help let's see where am I I don't know this show well but that's I shell that's where we are and we can get into dot SSH and we do have a unintended path here where we can overwrite authorized keys we'll do that after we do the end intended path but because our size shell is running as the dollar user that most likely means we are at dolly and that means we can at this SSH directory I wonder if we can do like proc self and see what's here can we get and vine by old get contents yeah we can so proc is where all the processors stored so if we did skander on just proc you'll see a bunch of numbers and these are all processes that are running on the server self is an alias to go to itself and environm environmentally so this will tell us exactly who we are and we can see let's see user pin node home dolly server user I'm kind of confused by the pseudo server Jas but based upon all these it's safe to say we are probably the dolly user I was hoping to get something like a PID I wonder what else is in this proc self thing stat maybe we're to stat have stepped PHP we got the process ID the group I think I forget how to press stat I did in one video but you can look up rock to get which user you're running as spoiler we're running as dolly so we could take over that SSH directory but let's move on and then go to the next thing so the next user Nairobi and there is a file see a key so let's do a get contents on that so home Nairobi see a key we should copy this and then let's go to a new window make sure I'm just gonna call this SSL see a key paste and do I have the top yep deal so I'm just gonna get rid of the backslash ends whoops Sen s there we go now I'm going to get rid of all the spaces and I accidentally got rid of spaces I did one too so let's put a space after again private key and and private key so that should be fine so now we got the CA key let's see if there's anything else in here so let's go back to home by row B whoops when you do skander download Jade node modules so Vijay s we can see what server dot J s is permission denied so we can check other users so there's Oslo he's got a mail der dot sent man going through mails pain her temp doesn't look like he has mail which I a few more folders so we can probably ignore this mail folder we can go to the next you can do professor and we have a dot SSH we can't go in it so the only user we go into the dot ssh was who is it Nairobi come on dolly so that also gives you a hint that you are probably running as the dollar user we can also try to get like the dot a sh history so file get contents home professor sh history forgot to close that hopefully I had to kill my whole shell let's try this again I'm not closing a quote I'm just gonna kill the shell redo it because I'm not sure what state it's in there we go and we get permission denied so we've got the CA key let's see we can also get like users on the box so we could do file get contents let's see passwd and get all the users on the box can poke around more but we haven't actually checked the web server so let's go and go to ten ten ten one thirty one and well you should come to a page there we go we get some QR code reader and once this enter a password and email then get free trial if we put something and once an email address so at a.com can see what this says didn't really get anything let's check out that HTTP and well this web server is going extremely slow so while that goes I guess we could do like skander on bird octave dub HTML the main reason I didn't do this was because we saw the node applications in each user's home directory so yeah we have port 443 giving us a certificate error and it says sorry you need to provide a client certificate to continue so if you remember back a while ago I did a video on like securing vendor applications where we set up mutual so cell authentication to protect a web server that's kind of what is doing here or exactly what's doing here and we have the CAS private key so the only thing else we need is the certificate chain from the web server which we can get and then we'll be able to sign our own certificates so going into view certificates we can do export and then we want to put it in where is it Casa de papel SSL and we'll save it here so if we go into SSL we have two things I'm just going to remove this to see a dot C ot so the first thing let's do is verify that the private key we have that we got off the PHP shell is the private key to this CA certificate to do that we just run open a cell P key for private key - in CA key and then Pub alt and we can get the public key from this private key and then on the CH certificate we do open s cell we exported in x.509 if you go back all the way to Firefox when you look it'll say X 5 or 9 format you're exporting it in but anyways - in4 in CA certificate - pub key - no alt and we could compare these two public keys we see it ends with ZW i QA b and then begins with mi i you could also just md5 sum them so we do that one and then let's see that was see a dot sir so we'll copy this output and also pipe it to md5 sum and we can see they are indeed the same exact thing so we have the private key to the certificate authority used to trust this web server so we can generate a client key so to do that first we have create the client key so do open SSL gen RSA - L client key we'll give it 4096 pits okay so now we got the file client key we have to create a certificate signing request so open SSL request new key Dukes quiet key out client see you sir and let's see we'll do us we'll say we're in New York local name NYC Marvel organizational name DC will really upset some people their common name we'll call this hip sec and email address please at subscribe dot now and we won't put a password so now we have a certificate sign all right certificate signing request we have to sign it so we can do open SSL x.509 - request in client dot csr - ca ca ca key zhe - set serial this certificate will be number 9001 because why not extensions client days will do 9,000 in two days out form Pam and out client dot sir unrecognized flag see a key I hate when things are case sensitive I think this has to be see a there we go so now we have a signed certificate but unfortunately Firefox can't import this it has to be in pkcs12 so we'll do that by doing open SSL pkcs12 export because we're saving it in key client key in client dot certificate and out will be client dot p12 okay we won't put a password on it and now we have a p12 certificate so that is just a combination of client key and client dot certificate and client dot certificate is just the signed version of the csr so we could do like open SSL pkcs12 info in client p12 no password and we can view here's the subject what we are and the issuer so you can view that information of this certificate but if you want to know more I'd highly recommend watching the securing vendor Web Apps video so let's go into a certificate store so let's go to preferences view certificates and let's import I am on the your certificates tab and they'll get import client p12 there is no password and we can see we have now imported it I'm going to go to authorities and let's go down to L I can right just type Allen right where's the casa similar server weird let's try importing then import see a CRT trust the CA to identify websites click ok and now in authorities we have it if you had it here and it doesn't work I would recommend doing edit trust and making sure that box is checked I think it has to be so now when we refresh the page I pressed ctrl shift are to refresh and now we can just click OK to send it or certificate and thought it would work let's see let's try reopening Firefox so bring Firefox again fix with a placement HTTP 10 10 10 131 send it my certificate and see connection is not secure you've added a security exception for this site let's remove the exception and try doing this adding again so we have it here I guess we have to maybe do it by hostname so let's copy the hostname ok ASSA t we click confirm ok let's try a hostname unless we did something wrong and our certificate doesn't actually work uses invalid I'm not exactly sure why this is failing we need to provide a client certificate we did okay so let's test if our client certificate goes to our server which it should to do that we just run open SSL verify - verbose - CA file specify the CA certificate not the CAS private key and then what we want to check and we're going to check client dot C or because this is what we put into the application pkcs store and we see okay which means it is checked out so what I'm going to do is we're going to clear everything so let's go new up Firefox options SSL or not proxy certificates and then let's go to authorities we will clear out this tweet or distrust and then servers I'm going to I delete everything here let's do that it doesn't let me delete everything let's see if we can do not stored delete all these that should be fine people my certificates we will even delete it back here click OK and now let's clear everything right history so clearing everything and let's import everything again so certificates mine let's import client b12 there's been imported let's go to authorities input CA cert click OK now ctrl shift are to refresh and wants us to send our certificate I'm gonna click okay connections not secured I don't know why it gets unknown issuer okay here we go connecting to server please wait so well finally in this server I'm not sure exactly what we did wrong before but who cares now we got it working so if we click on season one it's gonna do this again and then send us two files if we look down the list it's probably hard for you to see the bottom left in my web browser you can see this base64 is barely changing which means it's mostly the same but let's just send this to burp suite and intercept it so we can do this a bit easier so intercept is on refresh the page repeater click go and if we do render we need a provider certificate so if we go to user options SSL client certificate we can add destination I'm just gonna do start to add it to everything and then the certificate file let's select so htb boxes this is going to be lacasa ssl and we want clan type p12 password is required why why do you require a password so let's go back to where we generate this here we go we'll do client - encrypted p12 export password will be password ok go to burp select file client encrypted and we'll put a password to make Boop happy there we go certificate has been loaded if we click repeater now when you provide a client certificate but I did the way to do like CA socks proxy upstream display no weird I thought that was gonna work let's go back user options do this stir and also add the now we can't add the CA because it's gonna need a certificate let's see I'm not exactly sure how to do this in birth that's a first I think something's odd about how this has to sell isn't get created let's see let's go back to put go stepped off let's at dawn forward yeah we just won't use burp so our authentication can be annoying so let's try changing path instead of season one we can put dot dot and we have private area and we got files so if we go into dot SSH see if it lets us we're in there and we have an authorized key file Idra Idra epub and known host so we should have went back to season one and if we walk that base64 is barely changing so let's copy the link location go to a terminal at code n paste in the base64 and then just do base64 D and we can see the path season - 1 / 0 1 a VI if you look at - we can do echo - n and try this we get to a VI so that's why the base64 was barely changing because there's only one character difference in these two so if we do echo - n and then what we want dot dot slash dot SSH / ID underscore RSA base64 encode that and we can paste this in as file / like this and it wants to send us a file ID RSA click open and we get begin OpenSSH private key so let's go to terminal we can do v s/s HTM paste in the private key chmod 680 and we have to get user names so let's go what do we have it here we go skander we can just do slash home and we can do berlin dolly nairobi we can just split the pain like this so be a bit easier SH - I Berlin at 10 10 10 131 I forgot to put the key s hm put that all in one line we get it asking for passwords so the key did not work for Berlin let's try the next user dolly key did not work I'm gonna skip a few and just go to the bottom if I was doing this box I probably would try every user incrementally I just want a save time and we get hey as is hl2 as Professor to this box so at this point let's do the unintended way because we've reached that point so if we went back to this PHP shell we could have skipped the whole ssl certificate authority so we can do skander slash home and then slash dolly that was who we were running as if we go to SSH we have the authorized key file so we can generate a ssh public key so SSH - key Jen do not overwrite we'll just put it here so we'll do dal a dot said - oh well what is file - F don't put a private key so now that created dolly - la which is the authorized key file this is essentially that s HTM that we downloaded and then we got the public key file dolly - la dot pub so let's put this in that file so copy this go back to a PHP shell and we're going to do file put contents home Dolly s dot SSH / authorized keys then put in our public key file and then file underscore a pen and that should be it 389 so it wrote I think 3 9 bytes let's do file get contents and get the contents of this authorized key file we can see now we put our key there you got the creator's key right here a public key back at SEC Mac local so let's chmod $600 - LA and then Sh - I the authorized key file dolly at ten ten ten one thirty one it's thinking and we get in as this user and have a PHP shell oh so we could do dash D 1080 and this is just going to do a dynamic proxy so if we look neck cat - LV NP grew up 1080 that's stat we see we are listening so if we do V Etsy proxy chains socks5 is already configured to go through whoa close 1080 and now we can do proxy chains and map - s capital T to do TCP scans - capital P and to ignore host discovery - end to ignore DNS and then one 27001 and if we wanted to we could do - P - to do all ports I don't think we'll have to I am going to specify - V - show open ports as it does find them and we can see 22 4 4 3 21 80 and it should find a few more and there we have it discovering port 8000 on localhost if we did a and maps can on just port 8000 without proxy chains will see that it is closed so if we go to Firefox edit preferences or actually we can do foxy proxy sucks I think my socks configuration if we do options is just socks 1080 so now we go to one point seven zero zero one port 8000 which is going to send this through or a sock stone that we created via SSH and we have the page right here so this is the web application without doing SSL checking so maybe when we get root we can see exactly why this works long story short there's a service on 4 for 3 that's acting as a middleman check in the proxy and then directing to the API on port 8000 so that is the ultimate path but all paths lead to this show so let's see what we have here we have memcache ini and memcache Jas and node modules we cat memcache dot ini we get this weird sudo command so if we do LS dash that way and look at it we can't edit it so if we do V on it we can try we put this and write read-only write estimation point permission denied so can't write to this file we do a psdf and grep for memcache we can see let's see usually been node it's executing it so let us go run a PS by so if we do LS /opt PSP why this is just on github if you google github PSP why it should come up github PSP why let's turn off a proxy yep this is it so if you grab this there is a release so you don't have to compile if you don't want to but if we copy it to this box so we can do Python M simple HP server dev SH M W get ten ten fourteen three port 8000 PSP Y got a copy it in CP and let's make there dub dub dub I always hate putting too many files and exposing it via a web server so I always try to create a dub dub dub directory for boxes I do just so I don't over expose data so now we are downloading the file and we can let it run for about a minute to see what process is execute on the box so we can do dot slash PSP why chmod plus x mount we look at mount sh m is mounted with no exec so we can't execute there I'm going to grep for no exec see if other places are it looks like temp should be fine so move PS py to slash temp and not found you name - I say 6 64 64 bit elf we - PSP why I'm not exactly sure why that's not executing CP PSP why let's just copy to our home flash home professor PSP why ok let's download a different file so let's see in download S which may be stripped I don't know what s and not s is but we'll save them both and dry I'm more than grabbing the 64 bit because when we did you name - eh we see we are on 64-bit Linux so let's see P downloads can do simple HTTP server make the PSP why W get - R for recursive 10 10 14 3 port 8000 I thought that was recursive well download it manually PS py 64 and now we can do PS py 64's gum birth chmod plus x on everything PS py 64 and there we go it's running so it must be how I had it compiled in my /opt so skinning for processes every hundred milliseconds so there we go and we'll just let this run for about a minute and we can see some things starting this supervisor D service but I don't think anything's a super big giveaway yet so let's see supervised deep it file profile ah configuration at C supervisor D Kampf so let's see if we can read that config file so cat let's see supervisor D Kampf we can't do we have anything related to memcache doesn't look like we do is there anything in PS py that lets us do like follow system things let's see we'll do p SP y dash F for filesystem events as well and let this one run and see if this gives us anything better and holy crap we just got a lot so I'm going to check this out and scroll up so let's see so we see this supervisor command and run we have filesystem events everywhere so it's calling sudo Etsy passwd sudo is data so a bunch of environments see calling home professor memcache j/s see do we have any iodized we search for ini say I wonder if I can do hi and I dollar for new line let's do back slash dot hi and I maybe not maybe PSP I wasn't a big giveaway as I thought it would be or I may just be missing something but let's just move on if you've looked at memcache dot any you did see a command and that command is running memcache j/s which that's what I had saw earlier that I was thinking so called the supervisor D and then it ran a bunch of sudo which we see that memcache file do and then it executed memcache j/s so from that output we can assume it runs this file the only downside is we can't edit this file however our user owns our directory that win because we are professor and professor owns his own directory so you have mission overall the inodes or file names in this directory so even though we can't like edit the memcache ini we can change its name will delete the file so we can move this to definitely not memcached dot ini and then we can create our own memcached dot hi and I whoops let's instead of creating their own let's just cat definitely not to memcached let's see dot ini and because we are creating this file we will now have write access over top of it well yeah because we created the file we have readwrite so if we edit it we can just edit the command so I'm going to Google pan test monkey reverse she'll go to the cheat sheet and there are a lot of programs that automate this for you I personally just prefer doing this every time so I'm gonna do - - see for command because I don't know what it's doing and then going to put this here and we'll say put it on port and this SH sessions going slow but not envy what editor am I in them it wasn't like doing all the hotkeys I was expecting deist okay - Jesse paste will say on port 9000 1 and 10 10 14 3 there we go something weird is going on there and now if I do netcat LVN P 9001 when this thing hits it should execute a shell so while we wait let's go in PS py and execute that with - f2 show file system events and this way if we miss it we'll also know and right when we got all these file access events we got a show back so doing a Who am I shows we a route if we go into slash root we can do WCC root txt and 33 characters which is an md5 sum and then a new line so let's do net stat al MP grip for listening to see exactly what's going on and crap we got it just saying node so we got a process 3267 and then four four three is thirty to sixty eight so let's graph this and I haven't actually looked into this so I have no idea how this section is gonna go in the video we're just doing this live so I'm looking at thirty to sixty seven and thirty to sixty seven is the Berlin user and then thirty to sixty eight is the Nairobi so this is right here enforcing certificates I bet if we look into the code it's just making calls to port 8000 which is this guy so if we do CD home Nairobi we can probably do grep - capital R 1 2700 1 : 8000 put this in just period let's see - ah put this in single quotes what I recognized option OS of my own so Vijay s see cat server j s grep for 8000 so yeah in this survey j s we VI yet Tamara's all screwed up let's just send this over to my local box and see LV NP 9001 to survey yes cat survey j s pipe it to neck at 10 10 14 3 9001 sent bim server' Jas here we go so we have a memcache instance here's the see a key that it's loading so let's see request client authorized yeah every request it's just piping to port 8000 so if request client dot authorized passes send them to localhost 8080 certificate issue so is there like an authorized thing that says it's a certificate key sleep CA not sure how this works see a key maybe this stuff up here request sir that maybe the user certificate authentication and nodejs or Express but that is how that worked let's go take a look at V SFTP D that backdoor let's see if we can figure this out quickly so PSE F grep v SFTP there's the server so let's do and see LV MP 9001 send it off to V SFTP D and then we can also just cat user espen v SFTP d pipe it to netcat just like we did in the last time 9001 should be good and now it's md5 sum both files to make sure they're the same user S Pen V SFTP D md5 sum V SFTP D and we are at the same exact um hash so I'm just gonna run a strings against this we can see if we see anything here see there are definitely a lot see I see it right here I was gonna search like 6200 since that support it opens up buoy see iptables deleting a rule then adding a rule on 6200 and then - s % s this is probably the source IP so upon hitting port 6200 it opens an IP tables rule up for that IP address would be my guest just looking at that because IP tables sixty-two hundreds not normally an FTP binary so now the question is PS EF grep but not that that's that a ONP grep 6,200 we can see thirty to sixty five is listening so PS EF grab thirty to sixty five and this is user bin node dali so VJ s so if we go in home dali cat server j s we will see the shell so upon connecting spawn a child process this process is user bin psy sh and then just a way to interact with it so this is only listening and upon hitting port 6200 iptables goes and we can see here is the accept rule for me so let's go look at what the source code looks like to verify that's exactly what it does so if we do a CD I can just run up deidre gage will run load up Giga probably should update it I haven't ran since the last time I using that video let's see let's hopefully figure this out quickly open project no that's projects where is open file tools figure install import file that's why I want root htb boxes this be SFTP D load this in click OK pretty sure I click this and it loaded come on do it again there we go no program file may be import file here let's see - name already exists - here we go analyze the file let's just select all it's a small file so it shouldn't take too long to analyze and I'm just waiting for down here to finish so down there is no longer doing anything we get a functions I'll just go to strings so windows there are strings functions search program text search all fields and we'll search for IP tables because we saw that string and the program so we want to find it here see I have the bet I think came right to it that's not how I wanted to show this but we found it kind of the cheating way I guess yep here's the code so rename function back door window where's window view function graph see backdoor I think we have to go up one call so right-click references show references to this call backdoor here we go so this actually shouldn't be called backdoor this function is actually probably the backdoor so let's make this bigger no I have decompiled output there we go Oh now used to it moving everywhere but decompiled output we can see right here 3a - 9 we begin the file this is it searching for the smiley and you can see that right here how I normally would find that is I normally have a strings view is that here we're strings script display symbol tree control s now I need to use this more defined strings that's why I wanted and then normally I'd go here and search for IP tables find it and then right-click references show references to address and this goes to where that string is used and then you can just look at where this is used and kind of just trace it that way but you could also probably do windows function call graph and then back trace the function this way so if we go back here rename I think we just hit L we can rename this maintain that back door parent and then go to window function call graph that should been renamed oh well go to this one and see what this function does we see handle wall get in start right here we can also go back to the decompile tab if you prefer reading this output but then you can just trace it to see exactly what it's doing however the handle login Stewart calls this which I believe called or back door parent so I hope you guys enjoyed that take care and I will see you all next week