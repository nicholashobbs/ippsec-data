 what's going on YouTube this zip sack and we're gonna be doing a update to the last video and getting this Network pivoting actually working not 100% sure where all the issues came from I think a lot of it came from me being a madman and saying you know what when do slash network pivoting on a slash 24 network when you don't need to and I think some of the things I implemented cause Metasploit to kind of act funky but I've got it all figured out now and we'll do the update and why the last video had a lot of errors in it because well it's nice to see other people struggling even me and also I try to get the videos out as soon as a box is retired and that is four hours before the launch and I didn't have much time in the morning I wait to the last possible minute to do recordings so I can try to incorporate what all the feedback is and that may just be excuse of me procrastinating but enough talking let's jump into the video so before we begin I'm going to create a new pane and we'll resize this and this may make things a bit easier to explain if I have notes off to the side so 10 10 14 4 is going to be us that is our IP address granny which is going to be the Box we attack from is going to be 10 10 10 15 and grandpa the box we want to pivot to is 10 10 10 14 so the first thing first is let's look at our IP table rules we don't have anything so we're going to block grandpa so - aid to append to the output chain the destination IP is going to be 10 10 10 14 and the rule we're gonna jump to is going to be drop and let's just set up into that to make sure a rule goes in effect so as soon as we start this we get operation op mitad on ping so that's set now we actually have to do the exploitation I'm not going to be explaining a lot of the exploits in depth because well they're done in the previous video and I'm just gonna try to make this just about pivot so let's do the exploit which is I is web dev SC storage this is a 2017 sve so show options I'm going to set the our host to granny which is ten ten ten fifteen and set o host ton zero and I'm gonna run this once it's probably not gonna go on my ton zero IP address it's gonna go in like a 192 if I had to guess oh no it did right away that time sometimes you have to set L hose twice it's shown in my last video don't know why that happens but we got session one opened so what we want to do is we're going to have to create a pivot from this box back to us and when we do this it's going to sound a bit confusing at first but the main thing is - L is like a local port forward and what that means is it's going to listen to this box and forward it to us the - earth flag which is reverse is going to listen to our box go through and forward it through the pivot machine it's a bit backwards in my mind but just keep that in mind as we do this video and hopefully everything will make sense so the firewall is on this box so we have to escalate to admin so I'm just going to do MS oh I'm on meterpreter back in the session ms 15 show options session 1 and did not go so this the error message I was expecting the first video that we didn't see until the very end and this just means we have to migrate to a different session a different process so we're going to migrate to 1 2 9 6 this is the session that meterpreter is running and we just want to be on a different session not exactly sure why this matters but it does so just learn to live with it whenever you see an error message right away and it couldn't possibly exploit that fast chances are it's a weird issue and so am I going into a different process don't know what else to say so now we're running this and this should get us a session any second come on not sure why this is taking so long let's try am I going to a different process migrate to one seven one two let's try this one amateur processions acting funky we can't make it a show so migrating to this w3 WP process actually screwed us over so let's go back do the SD storage exploit again get a session and will migrate to one seven one two the dev data come on session okay so okay we can still do that so a session isn't completely booked ms 15 set session to run this and there we go now we have admin to the box so what we can do drop the shell net Sh firewall set pop mode disabled so we had just now disabled the firewall so if we try a port forward command see what happens ad - L we're gonna listen on ten ten ten fifteen because this is granny so we're listening on our own self then we'll going to four port 8000 - port 8000 on host 10 10 14 4 and this still doesn't work so what we're trying to do is say whenever someone requests a connection on 10 10 15 port 8000 for them to 10 10 14 4 on port 8000 that's what we're trying to do on this port forward command it's not working so what we're going to do move away from Metasploit and we're gonna use p link so you should have this on your kali user share windows binary spilling 30 exceed this is part of putty so if you don't have this if you google it you'll probably go to parties page and you can get it from there so we're going to upload this but first we need to probably be in a good directory so CD / I know we can write to I net pub and WW so that's we're going to put a file fleet upload that we can do /root documents grandparents feeling sexy we uploaded it the how P link works is it's going to because it's put a party going to establish a SSH tunnel back to us and we don't want to do that tunnel over root so what we're going to do is create a new user on a box so user add it and I'm gonna go into my Etsy passwd and I'm gonna say if shell is been false because it doesn't need to actually execute commands the other thing I'm going to do is change my password to be epic okay so we have a user on a box and we're going to restart SSH so we should have SSH listening yes we're listening on SSH so P link is going to come back to us and create a tunnel so let's go into shell and we do P link exe then - L which is user we're going to what am i sholde i so quick p link ax e - l yep - PW for password my password is if SEC I'm going to - L to do the local port we're going to listen on 10 10 10 15 which is our own IP address and we're going to Ford so listen on port 8000 on that and we're going to afford all requests to 10:10 14.4 on port 8000 wall so gonna specify - n which tells this not to execute any commands once you establish the connection so when we do this we get an error message oh I missed one thing we have to specify the IP we want to ssh to to establish the tunnel which will be 10 10 14 4 this is the standard as the sage key thing yes we want to trust it and that should be good background that channel and let's do NC l VN p on 8000 so on another box we're listening on any port on port 8000 we're going to NC - granny which is 10 10 10 15 on port 8000 and we gave a connection so we have verified a port forward there is working on everything so we can background session 3 we're going to add a route so route add 10 10 10 14 which is grandpa and we're going to say the subnet mask all 255 s so for any connection to this IP and this IP only that's what the full subnet mask means forward it through session 3 and now when we do show options we're going to set whole host to 10 10 10 15 which is granny set L port to 8 wait this is the previs my bad let's go to the se storage so he'll host call port show options and we have to set our host to grandpa's while we do this we can capture in wire sure to prove we don't send any packets to 10 10 10 14 it's all going through ten ten ten fifteen so ton zero now I run this let us hope everything works and there we go we get a shell on ten ten ten up wait but tip is a bit freaked out it doesn't exactly know what that IP address is because we're kind of tricking it doing this port forwarding magic outside of Metasploit but once we get this we can do shell IP config and see we're indeed on ten ten ten fourteen and we go to Wireshark we don't have anything from the source address of ten ten ten fourteen it's all going through ten ten ten fifteen so a port forwarding worked here now let us do the reverse port so we can access samba because the firewall is running on this box and we shouldn't be able access port for four or five through a tunnel so we're gonna do a port forward on top of a port forward to access what's listening on one twenty seven zero zero one four four five so let us do ms fifteen real quick to get a what well back on session miss fifteen show options set session two three run this set session to four I think that's our session sessions I 4ps migrate to dab data which is 1524 and I guess to authenticate we can um what huh let's read on this exploit SC storage exploit I was seeing someone reset granny on me and killed everything which would really suck what we're gonna do is we're gonna go admin do hash dump to grab the ntlm hash and pass the hash to open another shell to prove we have at code execution on port four four five so let us background the session oh no we want that session to migrate PS migrate 1524 okay we have migrated so we can do LS fifteen now run set session five okay run hash dump when we get the administrator hash and this time we're not going to bother cracking it even though we could we're just going to save it off so what we want to do is put forward - H so let's try what we did in the last video put forward add - L 4 4 5 - p 4 4 5 - our local host so what we did is a reverse Connect so everything listening on grandpa 4 4 5 is now what we're doing is saying try to think out the best way to do this so on point four four five on us we are directing it to meterpreter session six is this and here we're saying that meterpreter session six to one twenty seven zero zero one four four five it's the easiest way to think about it not a hundred percent factual but that'll be the easiest way so if we do and map - p four four five localhost it should come up as up yes so that's down this session we're going to search for SMB exec and we use the pass the hash version and we can set SMB pass to be the Oh do this in two copies that looks funky oh well set SMB user to be administrator this is a member of their main set or host to be localhost and we're going to see if this works it's still try and do a payload so set L host to be Graham granny's IP which is 10 10 10 15 set L port to be 8000 still run this did not work I may have bit off more than I can chew here doing this tunnel as well that should have worked did really not like localhost was that the issue so let's see if this actually logs in this hash dump and ministry - yeah that should be fine we can just copy this and try it again so let's see SMB pass the hash SMB client let's see - traitor yeah that works I don't know why Metasploit it's not working something's weird there but SMB client passed the hash did work and I can press my paste that's why I entered for the password that you didn't see but we do see we are on grandpa with SMB client so I'm not 100 sure why the Metasploit module did not work but obviously the port for it is setup if I went from localhost to grandpa so that'll be it for this past the hash video or not pass the hash network pivoting video I hope you guys enjoyed it take care and I'll see you next time