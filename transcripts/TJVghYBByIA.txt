 what's going on YouTube the zipsak and I'm gonna be doing the apocalypse machine from half the box this box got ate a lot of aid and I think it was just one small detail which created a lot of frustration and broke the immersion of hacking a machine and turned this box into a big CTF problem so the stirred off the box is just a wordpress blog that doesn't have vulnerable plugins you have to guess the administrator's credentials that is valid that is an awesome CTF problem happens all the time the issue is how you guess those administrative financials to start off you have to cool the page to create a targeted word list which again is perfectly valid in any CTF or pen test with that word list you do it against the directories on the server and not directly to the administrator because you're looking for a hidden directory and then again perfectly valid the issue is the hidden directory contains a image that is looks identical to a bunch of other images on the server it just so happens the image in this directory has steganography that has another word list they can use to brute force the administrative credentials and that's where the immersion breaks because you're not gonna find a hidden directory with steganography it's just not gonna happen if it was just like a old backup file that contained a password that would be a perfect problem and the immersion would stay there and I think a lot of people would have positive reviews but just that one small detail made a lot of people hate this box they're still planning or what learn so let's jump in like every other box we and map it first so SV enumerate versions SC and run save scripts Oh a I'll put all formats we'll call that n map and the IP address of apocalypse which is 1010 1046 already ran that so let's look at the output we see that SSH and Apache is running and we have WordPress as well so a map was able to identify WordPress and version 4.8 going over to the URL to verify what n map says we do see what looks like a blog but a bunch of the content isn't really there we see at the very bottom powered by WordPress but the theme looks like it's missing so let's look at the page source and WordPress is doing what WordPress does and always uses absolute URL this URL we can't get to because we don't have this hostname a lot of things and websites will use relative paths which means they don't put the hostname they just put the file path and your browser knows ok when I see this without a hostname it just goes to the host name that was accessing the page WordPress doesn't do that they put the full path so let's fix our host file so we can resolve that house so 1010 1046 apocalypse htb and now we refresh this page we can get to those URLs and refresh against there we go and we can get to everything and it looks more like a blog so since this is WordPress the very first thing I do is a WP scan so I'm going to create a new team MUX pain and we're going to call this enum cuz we can do a few enumeration things Doug peace can - - help and let's look at what we can do - - URL we want - - enumerate and we can see the default or is VT TT u and V P so you use your names VP it's doing vulnerable plugins tt Tim thumbs no idea what that is n VT vulnerable themes scrolling down we can see there is a - - log option and word list user names so this is also capable of doing some type of brute forcing but can't really brute force yet so let's just do the enumeration put so Joey piece can - - URL ACP FACA list dot h TB - 'if enumerate we want V TTT you and ap I like doing all plugins not vulnerable just because there's so many bad WordPress plugins there's a chance if you can enumerate it you may be able to find a vulnerability in it so always include the a p1 I do this we want the - - log and would do dopey scan dot txt well we can call it log and I think that is all we wanted so let that run and then we also want to do a go Buster because it is a webpage so flash op go Buster - you four URL HTTP pockle sh t be ruthless user share worthless doe buster directory list 2.3 - small so while both of those are running and we see do brush it right away it gives us a bunch of 300 ones on a lot of directories so let's go over to the page and just give it a bunch of gibberish and we see a 404 page so the reason I did that is because it looked like everything was returning 301 so I wanted to make sure invalid page doesn't equate to 301 so I'm going to kill this go Buster because that's not gonna be too useful to us and we're gonna look at the options before we do that we can navigate to one of these and see what it is so if we do slash link we just see a image we do slash eagle same thing this image so one thing note is it's always a pending this slash so if we go into Burt refresh this send that to repeater will get rid of this slash and click go and we see the 301 moved permanently and is directing us to eagle where slash if we add that we get the page so we want go Buster to see this because this is a bit more helpful than a 301 at least we get way content links and things like that so let's go back and look at go Buster options and we can split that vertically that all helpful so we have - F append a for its last - each directory request that looks like what we want to do there is also - L which has include the length of the body and the output which we're going to do as well so go back to a request - f - L and now we're getting a bunch of 200s with the size and at 1:57 we can assume there's a direct link to that same page the next thing we want to do is create a word list and to do that we'll use cool CEW LF we go into stands for something something word list so looks like the only option we want is the - W - right so cool apocalypse htb - W cool text and this will create a word list based upon all the words on the webpage so we can see like the apocalypse revolution preparation WordPress signs all these had appeared on the page and we could play with the depth flag to make cool go deep down the page but I find when I change that cool just never finishes it eats up all the memory it does something and craps out so cool is great as long as you don't make it do too much at least in my opinion so we can go back to enumeration and we can kill that because this is way too much content for us and we're not to be able to handle all that instead we're just going to point this to our new word list which is cool text I'm going to do something called T which is going to say take all the out but I'm saying and also direct it to a file and then is done so if week at the go Buster's our text file we t22 we have all the content what I'm going to do is a grep - V - say don't show me these lines and put it size : 157 because I don't want to see any page that has size 157 because chances are it's just this which isn't helpful I get to an intercept mood off yeah that's not too helpful and we see only one page comes back righteousness so let's try going there and we see it changed slightly all that was added was needle and it's still directing to that image so if we go in here we have this image and this is where a lot of people hated this machine because you had to notice that and then to think to save the image and then run stag hide against it so it's a car - - help we want to extract data so stag hide extract SF and then the file name and a passphrase we're just going to hit enter it's blank and we wrote extracted data to list dot txt looking at list dot txt we see another word list so let's go back over into an enumeration tab and look at what the would uh WordPress can did so we see one potential username but we can scroll up and see what else there is so we have critical finding WP this one's new I don't think this was here when the box got released I remember seeing this technical details looks interesting and glancing over this it looks like there was a vulnerability and one of the wordpress functions that plugins used and if plugins had used something improperly that wasn't obvious it was one reporter sequel injection so we have to find a plugin for this one to be vulnerable so chances are we're not gonna be finding an exploit here that's just something Hey WordPress is doing something silly a lot of plugins are vulnerable to this is my take on that but I only looked at that for 15 seconds host header injection and password reset so that is a interesting one that I always check now so quick way if we want to dig into this WP admin lost your password foul rocky was what DP scan showed us get new password and could not be set because the mail function is disabled so we can ignore this one because even though it's a vulnerable version well there's no password reset functionality cross-site scripting authenticated ignore that because we don't have authentication and cross-site scripting isn't too common because it requires a user another cross-site scripting pass traversal these two seem interesting I'd probably look more into them and we see let's see it should say what version so this remedy HTML exposes the version number I thought is it a page source I don't know exactly what it is off top my head but that file exists which exposes the WordPress version which is probably how an app saw so that is dumpy scan before we look into these vulnerabilities and I'm not gonna look into him here because I know the next thing is gonna yield great results we'd set up more enumeration to go in the background because you always want to have something going in the background while you poke around so don't be scan does allow for brute forcing so we're gonna do - - word list and that's gonna be list text - - username fowl rocky enter let this go list our text doesn't exist so this wants the absolute path I'm just gonna do PWD slash and putting this in the back text will allow me now put it that command is my current working directory it's print working directory is what PWD stands for so just run that and it will start the brute force for fala rocky and it should get us the password which is Tran I don't even know what that trance : nation or something but if we wanted to we didn't have to use WP scan because donkey scan is only gonna work for WordPress if we wanted to just do Hydra or something to brute force these HTTP logins let's look into that real quick so we're going to have to go back into a browser and go to the login page and we're just gonna put admin admin and intercept this request so looking at this we don't see any sea surf talkin that's CSRF and that is important because what the sea surf talkin does is it prevents cross-site request forgery but it also makes brute-forcing a pain in the butt every time you go to the login page it gives you a unique token that you can use to submit a pass a law game attempt and if that login attempt doesn't have the token that you got from the last page it fails you and once you use that token the token dies so every time you'd have to hit this page get the C surf token then you can submit the request bit more complicated to do luckily there is no C surf taken in this version of WordPress don't know if we're press does C surf on login off the main one so all we have to do is copy this line the data log is the wall again PWD is the password there's the two key things in Hydra so gonna run Hydra - lowercase L for a username if I did capital L I could specify a text file that has a bunch of users but since there's only one we can just do lowercase L - capital P for a dictionary and I did lowercase B I could specify just one password there's not many times you'd ever want to do that then the IP or hostname you want to attack so it will be a pocket list each T be then the I guess plug-in we want to use an Hydra is HTTP - post - forum and then we specify what we want so the very first thing we have to grab is the foul name were posting against which is slash WP - login dot PHP so /jp login dot PHP then you use a colon and we want the HTTP request so I'm going to paste what I had at the bottom in my clipboard and actually before I copy it we need to tell Hydra which field is username which is password you do that by just Karen upper case user carrot and pass is the same with pass so doing that tell us Hydra hey input all users here and put all passwords here then we can paste that and then the last thing we need is to tell Hydra what a failed login attempts like so we're just gonna send that and invalid username so we want fella rocky test so we just have to give something on the page that is saying it's invalid so we can do is incorrect because this can be on the page of the invalid request so is incorrect and my double quotes and then we should be able to go this should take a little bit and once it returns we should see the password is this so let that go in the background and check in on it and a minute but in the meantime let's log in so that does let us log in right away we can look at plugins and don't see any plugins look at users don't see any other users so we got all them the next thing we could do is we want code execution on this blog we could create a middle it's just plug-in install it and upload it or just edit a PHP file WordPress allows us to do this and the appearance editor and we can edit themes these themes are PHP files so if we edit like theme header and we can put something here so put it back here and we'll update the file and let us save it so this is writable by the HTTP user and if we go back to the page we can see what we put is there so we have to create a shell or input something that gives us a show and before we do that tune back in here and we do see Hydra came back successful with HTTP POST form a pocket last login and password so Hydra works as well we're going to do a quick PHP command injection thing I just have a few things I coded a top shell PHP CMD just going to copy this echo system request imp and I'm going to put that here so this is a PHP code that is going to run a system command and it's going to take the value of it so we're going to update this go back here we can do a question mark if equals LS and we just ran the command LS against the server and if we refresh the page it didn't screw anything up if you don't send yep that's always important that you don't screw up the page for everyone so to make this a bit easier I'm going to turn intercept on send this to purp dance and there we go send this to repeater and we want to do a shell cell easiest way is to Google and test monkey reverse cheat sheet and the first one I always use is this one because it works in most of the cases so go back to the repeater tab equals OS verify that worked directory list I like to change it to post request and start putting that in the header still works then we just have to edit the IP I think I'm 1010 1430 I think that's my IP ifconfig 1010 1430 okay we're gonna do is URL encode this I just press control you there good a new tab shell and c lv NP 1 2 3 4 and send this and we get the shell back so if we do hostname we are on a pocket list the first thing I always do is try to upgrade to a PTY so we do Python - C and port B - i bt y dot spawn been bash pythons not film so python - C Python 3 - C import PT y PT why not spawn then - and we get that working the next thing is to background recession with control Z then we do sty raw - echo and then FG - foreground and there we go if you do zsh or something use bash on your first shell I think zsh doesn't like that one trick so next step is basic enumeration so I'm just going to go to dev sh m as a temp directory and we're going to use a linux privilege escalation script so that's prevents another few if you just google any numbness h you will find the contents of this script in projector this is version 2 only there's a version 3 out there I haven't downloaded it yet so we'll do when enum Sh first so python - m simple HTTP server and we can do curl - Oh Lynne SH and we will get 10 10 14 30 slash when I mount Sh we have download the script so we can just run it with bash and this should only take a few seconds to run okay I'm going to go to the beginning of the output and we'll see what we have we have Linux information we're running Ubuntu 1604 the kernel is from January 2017 so could look for a kernel Prevost since that's about a year out of date going down we can see the username final Rocky is logged in so maybe we should try the password we had for WordPress for that actual SSH user scrolling down at C passwd we see his full name so maybe create a separate word list adding his last name home directories lakhs we can go into his directory it looks like we have the execute permission so we can list contents and read so that's something to look into available shells umask looking at cron jobs it looks like everything is the default cron job nothing new IP information route information running services here I'm just looking at root processes that are running scripts or other services that we may be able to exploit because if we exploit something that's running as root chances are we get root and I don't really see anything there binaries with relaxed permissions so I don't see any set UID bits down this list I don't see right down that init.d sudo versions one eight one six start modules getting into a lot of that HTTP cap so I'm gonna search for three pounds in a space to skip to the next section I don't want to look at verb dub-dub interesting files we have netcat w get and here's something interesting the passwd file is world writable that's very bad so er no permission is read write group missions read/write and everyone is read/write so if we look at that file that's the passwd and when a fixer terminal just a little bit because it's got the size a bit goofy and makes editing files weird so open a new thing s TTY size we see I have 48 rows and 198 columns so go back to a shell s TTY Rose 48 calls 198 and now what I ate that file it's good so what we want to do is just add or what change the root password or add a password for ourselves we can just create us so if SEC and we want to generate a password so open SSL passwd - help will do md5 beast we gasps private assaults or dips and the password will be at the box so copy this paste that in I'm gonna say zero zero so a user ID and group ID is gonna be zeros and root we can try that get write a backup who cares and now we can just su to hip sack pack the box and we are now root because we created the user hip sack and said that was the same exact thing as root go in the directory and read the contents there and home foul rocky didn't really have anything other than user dot text so hope you guys enjoyed that guide and yeah just look at shadow Father akhi is at 512 so that's not going to decrypt quickly I was just looking to see if we could reverse his password and see what it was but nope not going to do crap see you guys next time hip