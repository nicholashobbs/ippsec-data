 what's going on YouTube this is if ii be doing olympus from hack the box which was a really well laid out box the ED map you initially do you just have to use throughout the entire box because every time you pivot through a docker container it releases a piece of information that makes that end map make more and more sense it strips off with x debug being configured in just a god-awful way with that provides remote shell by hitting a page and I'd be lying if I said I hadn't used this at least once on a pen test have been successful then it goes into a little bit of Wi-Fi cracking and when this box was released the path was cracking the Wi-Fi packets getting the key and then using the key to guess the username and I hated that piece but it is kind of realistic because in pen test sometimes you just gotta guess and things work however after this box was released unrelated some really smart people found ways to brute-force user names out of SSH and this box is vulnerable to that so we'll dig into that and I think it makes the box that much better because you use a exploit to enumerate user names based upon the theme of the box and after you do that you can do a dns zone transfer because you finally get the full name of the box do a little bit of port knocking to unlock SSH get in and then you can use docker to prove ask and that privacy is very similar to LXE it's a lot of small hops so it's hard to explain so let's just jump in as always we start off with a MSO and map - SC for default scripts SV and versions Oh a output all formats put in the end map director and call it Olympus then the IP address which is 1010 1083 this does take some time to run so I've already run it looking at the results we have quite a bit of information on the screen the very first thing I notice is port 22 is filtered that is the SSH port and filtered just means we made a request out to 1010 1083 on port 22 and the server just ignored us all together and firewalls there's a difference between dropping a packet and blocking a packet with a dropped packet you just drop it and ignore it completely with a blocked packet you generally sound like a TCP reset back to the server letting him know that ports not open so a lot of times when you configure a firewall rule people choose drop and that is why we see it as filtered so I'm guessing there's an IP tables rule around SSH just keep that in mind and the only reason is because this board is not like all the others the next thing we see is DNS is open on 53 TCP so I'm going to guess maybe zone transfers or something like that because DNS is normally a UDP protocol one of the few things that require TCP is a zone transfer so that's why I'm thinking zerrin transfer right off the bat then the next thing is port 80 we have Apache listening it looks like the server head is just Apache so we're not leaking any OS information here and on point 2 - 2 - we also have SSH and it is has a unique band that just says city of Olympia so nothing else really for the end map other than yeah nothing so let's just move on and check out what is happening with DNS so the very first thing I'm gonna do is a nslookup and I'm gonna set the server to 10 10 10 83 and let's see if we can get the server to output what its host name is and order 4 is don't transfer to work we have to get the domain name so I'm gonna search like Olympus HDB as just a wild guess and we don't get anything back and this could take a little bit to time out so I'm just gonna ctrl C do it again server 10 10 10 83 the next thing when try is like 1 27001 doesn't have reverse lookup for that I'm going to try 10 10 10 83 doesn't have a reverse lookup for that so what I'm going to do is make a new directory called DNS and the spirit of always having recon running in the background we're gonna create a DNS recon script to enumerate all RFC 1918 addresses which was loop X so call this DNS anoon eh and then let's just do DNS recon - n for name server 10 10 10 83 then - are for range and then 10 10 10 10 10 10 10 0 0 0 / 8 then we won't do I think it's - DB DNS recon help - - DB then - - DB Olympus DB delete that line with DD then just use P to put the new line and we'll do the rest so I did 10 s to go into insert mode and delete 10 characters will do 170 to 1600 12 and we'll do the same thing here and this time we'll do 192 168 0 0 slash 16 so this is all the loopback addresses the easiest way to remember it is everyone knows the 1000 170 216 192 168 and this number just increments by for each time so that's the easy way I do to remember the 3 addresses and then we just run that script in the background and it's going to do a bunch of DNS requests so if there's a server configured for a reverse lookup at any RFC 1918 address we'll find it there and get the folders name so let's just rename this to DNS recon move to a new tab we'll call this I don't know HTTP I guess I don't know why I started renaming it but let's move on to enumerate Apache let's open up Firefox go to 10 10 10 83 and see what Apache gives us it's just a image control you we see just a CSS sheet there there nothing too special I'm going to I want to save this image not the HTML tag view background image copy this we'll do a double you get on it real quick and exist tool Zeus we're not having zip tool app install zip tool there we go while that installs let's just check like robots.txt nothing they're still installing the tool so let us go over the book generator set dawn go back to Firefox make sure foxy proxies configure to go to Burt send the request controller to send to the repeater tab control shifter to automatically switch and then click go and looking at the headers we have an Apache nothing really weak there the one other thing we see is XD bug and this is a developer thing and with this enabled you may be able to just connect to a debug instance and debug PHP live on the server we can debug applications you can change the code do all sorts of nasty things generally in most configurations the callback is forced to be on localhost so you have to do a SSH tunnel at point port 9000 back to a development machine and some misconfigurations it sends it to whatever host made the request so we will play with that I just want to see if the image downloaded there we go so let's do exist tool on Zeus and we see see it was created April 6th so this web page probably got created in early 2018 that's just something to put on the back burner we can't really enumerate what the OS is so we're trying to get a date time around when the server was built for what type of exploits to throw at it if we saw like 2015 maybe go down cgi-bin and do shellshock but this looks like it's relatively recent so we can remove that file because we don't need it anymore so let's go into the debug thing and I normally use Chrome to do this there is Metasploit modern L that hacked the box users created after this box I think it was a miniature Mumbai and one other guy had created the module but in order to explain it better on why it exists it's not just exploit with Metasploit and actually do something legitimate with it normally developers will use their IDE the integrated development environment to hook into it instead of setting all that up would do the easy path and just use chrome because chrome has a X debug application so if we're just Google Chrome X debug app my computer's going really slow Chrome Web Store let's kill this DNS recon maybe that's it it shouldn't find anything so normally I would have some type of enumeration always going in the background but for the sake of the video to speed things up let's disable that so adding X debug to the chrome apps we can open it and then let's resize this window too so if we click listen we're listening on port 9000 we open a new thing metstat AlN grep 9000 we see we are indeed listening so in order for X debug to work we have to send it a HTTP request so let's go back to burp and all we're going to say is X debug session start and then equals it SP in an argument cell like that and this can be anything this is just a session thing so we'll say please subscribe we click go we don't get any response back we go back to X debug we see the entire script and now we can set like a breakpoint here click run it's going to run stop at this breakpoint and we can actually change it so it's echoing HTML so what I'm going to do is say HTML app and if SEC was here okay so we have appended that click run to keep going and then go back into foot and we see we have successfully appended to the page so let's test code execution X debug is listening go back to Bert go and click here and let's just do system Bing 10 10 15 10 10 14 15 I think is my IP and we always need like - and I think - see is Cal you set a ping on a Linux box and don't put a count you have no way to stop the ping sometimes so that's what I'm just doing - C 1 and we do TCP dump - I for interface tun 0 ICMP and then run this command we see output came back and then terminal we got a request so now we know we have code execution on the box so let us turn intercept off what does turn intercept off by not going through but now we can go to pen test monkey reverse shell grab this copy the one that almost always works is this one go back into an X debug session step pinging let's send a shell put the IP so 10 10 14 15 port 9001 and we'll make sure we're listening so and see LVN p 9001 send this request go here and we have a shell so at this point I can close Chrome and we'll just play with this box where we are so if we do hostname a bunch of gibberish LS - la don't see that much go to slash and we can see we're in a docker environment if we do ifconfig we see 172 2002 and check out home Zeus air get in and we have air Gannon Sh so let's see what that is bunch of text quite a bit to read I don't feel like reading all that yet so let's just see what else there is there's a captured directory so let's go into captured and we see captured cap and papyrus text so let's see what's in papyrus txt captured while flying I'll banish him to olympia zues so we got a bunch of greek references right now just based upon the name being Olympus I think the end map had something now I got Zeus Olympia so something there we look at captured cat we see it's a TCP dump so we could basics t4 to copy and paste it to a machine we probably could SCP it I'm gonna do something different that we haven't done before and that set up a nginx listener so we can just send files over HTTP to us so I'm gonna go and edit enginex then we want to go to sites - available and let's look at default there's a lot there so let's grep - v we don't want to see anything with a comment and we want to grab only things that have entries on them send this to file upload let's edit this so let's listen on port 8000 one we don't need ipv6 the route we're not going to have a root of the web - we don't need any of that we'll give it the server name of if set dot Brock's I guess and then location we want to put the root here so root for dub dub dub upload so that's gonna be where this directory exists and I would make sure and your root dub dub dub your Apache or whatever you use as a web service configured to do HTML because if you can upload and PHP is configured people can just upload a PHP script and execute it and that's bad so always use care when doing this so make derp upload and we want to do dev underscore methods to set like a WebDAV server put and we have to have semicolons there and that looks good and I generally stay organized by like services on eight thousand one two three four five and shells are on nine thousand one two three four or five just how I generally stay organized you may want to pick different numbers than 8,000 9,000 because people watch these videos and probably everyone's gonna start using those so yeah the next thing we want to do is Ln - s Etsy nginx sites available and file upload and move this to let's see nginx sites in Abel and now when we restart nginx we can do a net stat a LNP grip on 8,000 won we see it's listening and if we did curl - - file upload well go in here HDB boxes olympus echo exec - please sub so if I now do curl file upload please sub and I point it to one 2700 one port 8000 one is it upload file not file upload upload file there we go we get an internal server error so let's look at that tail over log nginx era dot log and we get a permission denied so I'm going to do chmod 777 for dub dub dub HTML and then we'll do CH own dub dub dub data is nginx running as dub dub data grab nginx it is so CH and dub dub dub data adapter dub upload and I did HTML there out of habit crap that should not be like that I think 6 4 4 is a fine permission no special a HTML that's fine so we want 777 on upload most of memory took over there for a second so now if we do that curl command again we don't get an error message and if we look at ver dub dub dub upload we get to please subscribe if we cat that we get the file so this is just a good way to transfer files to our server so let's now curl upload file captured cat to ten ten ten ten ten fourteen fifteen / a nut / port 8000 one go over to a box go into upload we get captured cat so let's copy this to a directory htb boxes olympus we can close this window and we can open up caption cap and Wireshark and we can also stop nginx so people can't just upload files to our server I'm looking at the CAPTCHA dump we're on a beacon frame we see the SSID is too close to the Sun and digging through these let's look at tag parameters SSID rsn that is robust secure network CCM so this is just a WPA so I just know that by the group cipher suite and rsn so let's see if we can crack this WPA key so let's go to aircraft and what's the file name capture cat and we'll do the word list user share with list rocky text and we see the estimated time is around one hour and I don't have time for that for this video so we're going to send it to or crackin in order to crack be a hash cat we have to convert this to a hash cat capture file so let's go and grab hash cat utils so hash cat - utils github and then let's go to op get clone and then go into source and just type make and if you don't have if you get errors like P cap dot H is missing that's because you're missing the development packages so Google what you're missing and find out what packages P cap dot H is like lid pcap - dev sha things would probably gonna be SSL Lib - dev and yeah just Google - error messages you should be able to get it compiled so we have a bunch of binaries now we want to do the cap - HC cap X which is just hash cat captcha and we do a input file then an output file and then we could also filter by e SSID or be SSID but we're not gonna worry about that so just do HT be boxes olympus captured cap and we'll put this to H to be boxes olympus captured h cap X so it wrote two captures and we got them right here we can't really read that file it's just meant for hash cat so let's SCP them to my box that I use for cracking so SCP captured hCAP to crack in and then we'll ssh to it and we can move this to hash cat backslash hashes go in the hash cat and then we do dot slash hash cat - - help grab - I WPA and we're going to do 2500 so dot slash hash cat - M - 500 then we'll specify the hash file then the world list we want to use and once this starts it should crack relatively quickly we can see it's going to take a total of nine seconds to crack or go through the whole list so much faster than doing it on a CPU assigned to a VM so we get the SSID uh yeah as this idea of too close to the Sun and the password is flight of Icarus so the first thing I'm going to do is go into Wireshark edit preferences protocols I Triple E eight or 211 put a decryption key add this is going to be a WPA password and the key white of Icarus click OK make sure enable decryptions enabled and now we have these packets decrypted so we can do Oh another thing I said we just looked in the beacon the main reason I went straight to like aircrack and stuff is because we see a bunch of D authentications and this just means probably a deal that acting capture a hash or something so seeing this much is relatively bad so we can sort by TCP or UDP and see what else is here so we have Dropbox DHCP offer and we're looking for a host name so just digging through this DNS servers eight doesn't look like it gave a host name the thing joining is a 1 plus which is a phone we got stuff to Google whatsapp but nothing too interesting so we can close why Ashok because we're done with it we didn't really get anything but we do have a SSID and it's password so perhaps that is reused so let's go up here the s ID correct I guess and just put this in a file so let us go back to our shell of the doctor thing we did the very first thing on a cat Etsy passwd look for potential users we do see the user Zeus so maybe I'll try to SSH on port 2 2 2 2 the other thing I'm going to do is do a net stat al NP grep list and we don't see SSH listening at all I don't know what that port is that's odd maybe that's a docker thing I don't know yeah but the main thing I was looking for is SSH listening here because if it is maybe the quad to's goes to this box if not may go somewhere else so let us try to find valid host names and if you remember back when we did the exists all we saw like 2014 or not 2014 April I was thinking number 4 but we saw this box was back in April and I remember a SSH username brute force that came out relatively recently after this box retired so that's what we're going to use to find a valid username so if we just Google like SSH brute force username we may find information about it tools any time let's do the last year CVE there we go use name of enumeration flaw this is it I don't know if the proof of concept is in this script so I'm just going to google this CVE and we can go that's exactly what I went to Google CVE then github there we go slightly different CVE number than before I think 1/5 now when I was what we copy and we went to 1 5 4 7 3 so it looks like maybe it just wasn't fully patched and got two CVEs but this should be what we want so let's clone this get clone go here and we can look at what the example is so it wants a user list file and a host name so let's look at what example input has root and root invalid so just to host so let's do python ssh user name user list example input and then the host name 10 10 10 83 Oh list as a cap well that's annoying and see if this returns anything oh we forgot port 2 2 2 2 what is port - - port 2 - 2 - there we go and we see root is a valid user root invalid is not a valid user so we could just edit example input and put Zeus and run this again and we see Zeus is not a valid user I'm going to edit the script search not a valid user and we're gonna take this out because I don't want to report all the non valid users so now if we run this again it should just come back not a valid user looks like it's in two spots none okay let's try this now okay so it only comes back root is a valid user based upon the theme of this box I'm gonna guess it's some Greek mythological character so it's just Google that Greek mythological characters and create a custom word list so let's go here get a list of all the characters it's quite a bit of them and copy the Greek cares text paste percent a space get rid of all spaces that's fine now we have to go from capital characters to lowercase characters because chances are the username doesn't have the first character the name capital that's a quick thing so we'll do Greek myth LST remove the file we had to work with and now this Greek myth list is just a list of a bunch of Greek mythological characters so let's go back to our CVE and do the user list as Greek myth LSD take a little bit to run because we gave it a lot of characters once it finishes though we should have a list of valid user names on this box and one does come back Icarus is a valid user so let us look at the SSID cracked and we have probably the passwords flight of Icarus maybe so let's try SSH Icarus at 10 10 10 83 and we have to specify the port and the password doesn't work so let's try the other one too close to the Sun and that didn't work either did I misspell something yes I did I see a are us try this again flight of Icarus and then we'll try the SSID and we get in and when we did this box if you remember I'd said the CVE wasn't out when the box was released the intended way is for you to see flight of Icarus and figure out Icarus is the username so we just changed up a little bit doing a ssh enumeration to get valid user names and the SSID was the password so now that we're on the box let us do some more enumeration LS - la / and we see we are still in a docker environment so what else can we do with this let's check our home directory and we see a file help of the gods dot txt so reading that file we see Athena goddess will guide you through the dark waiter roads CTF Olympus HDB if you remember in the beginning of the video we're trying to do a DNS zone transfer because it was listening on TCP but we didn't know what domain it was so we started that DNS recon to try to brute-force a bunch of things to try to get a domain I'm going to do that we finally found it so let's go back and try that Zurn transfer again before we do that lets just stay organized and rename our team bucks pains so put them to the sessions we're on copy CTF Olympus HDB and let's try a zone transfer again so dig axfr that is the zone transfer at ten ten ten eighty-three this is the DNS server IP and then CTF Olympus HT B is the domain so we see NS one Prometheus open a temporal portal Hades three four five six eight two three four six two four three one and steel the fire going through other things that doesn't really look like there's that much information but this is interesting and even further back in the video at the very beginning we saw SSH was filtered and it wasn't configured like the other so let's try putting a port knock thing just like we did in pinky and seeing if that opens up the filtered port which was SSH so I'm going to copy this because that looks like a password to me and we'll do and Matt - PN so we don't do ICMP pings then we want to do max retries and set that to zero so it doesn't me try anything and then just do - P 3 4 5 6 8 2 3 4 6 2 4 3 1 then the IP address which is 10 10 10 83 and then do another end map and see port 22 at the end doing that and we still see 22 as filtered try that a few times to see if it opens up and we do and the reason why it did that is just because n map was doing it too fast for nacht D which is probably the port mapping service if we sent the - tasks can delay it is equal to 0.5 it'll be a little more reliable or not I think a statue a scandal I try it come on do we have to go like 0.5 let's go and map scan the way click this link scan delay there's gotta be a better way to do port knocking I'm sure there is and I'm just ignore it to it we'll just do it a few times so SSH Prometheus at that and see if we get a SSH connection missed at that time just try it a few times and one of these times it'll work let's set the scandal a21 and that still didn't open up open the portal 80s we'll try point 2 doesn't look like the portal wants to open so let's see may have to find a different way to do port knocking because that is not good so let's see let's open up why I show I can see actually what's going on is that map just sending these out of order or do we have to do something with the order so listen on time zero send this and of course soon as you open up that map it works oh that's annoying see did nmap do it in the correct order so three four five six eight two three four six two four three one yep so I guess the service is just picky so neither one prometheus let us check if we're a docker container still we don't see that dr. M so we are not doing an if config command not found let's do I PEP IP addr and we see this is indeed the host we see our IP address the bridges for the docker containers doctor itself etc so I'm going to check the groups because like Alexi docker is set UID and you can do the same type of attack which is binding the root of your OS into a container which you have root permission and then getting root over the disk so the very first thing to do with that is docker container help and we want to do LS to list all the docker containers we could upload and create a whole new docking container but why bother going through that when we don't have to and you can always enter a docker container with docker let's see what is it doc Oh run help and let's see what the command is I think it's just docker run then the name so like Olympia bash docker run docker container LS let's get the names docker run Olympia bash it's not it we want I think I have to specify - Ti there we go so now we're in the Olympia container and Olympia was the SSH server I believe so if we go to /home we can see Icarus and that's help with the gods to prove we are in that container so we could go pillage Roddy's which is the DNS server erodes I don't even know greek mythology that well or Oh dhes why don't let me in that oh I am in it um am I in a hostname yeah so this doesn't have a user there route nothing here so that is entering doc containers if we wanted to there is a - V - bind mount a volume so we're going to do is go back to Olympia it could be any dr. container do - V I'm going to bind mount / - slash Mel please subscribe and then enter Olympia if we go into slash mount there is a please subscribe directory and going here we are now inside of the host OS is slash we could read route text and defer to prove that we could probably go to like Etsy hosts and we're on Olympus so there is the box I hope you guys enjoyed take care and I will see you all next week