 what's going on YouTube this is IPSec and we're doing Crimestoppers from hacked the box which is a machine I created and I created it I decided to be lazy and do almost no prep work which I'm sure is gonna bite me in the ass and there's gonna be confusing as hell parts in the video but oh well we're gonna do it anyways so when I created this box I had one goal in mind and that was to have enough Easter eggs through the box that acted as a hint system so you could do a lot of learning without wasting your time and hopefully the Easter eggs I plays didn't send you down wrong rabbit holes so as we come across them I'll explain my thought process and we'll do the Box it's a pretty fun box it involves a PHP lfi with the filter base64 stuff to pull down the PHP scripts and view the source and it also allows us to upload a file and if that file is a zip file we can gain code execution because it's hard to explain you'll see in the video or you can click below to the lfi portion to see and once you get a shell in the box you plunder through some email read that probably White Rose is still on the system and there's a rootkit on the system you have to do a little bit of wrist engineering I'm going to use radar to do that reverse engineering so let's just jump in and I hope you enjoy the box like every other box will install for the end map so and map - SC for default scripts as V enumerate versions Oh a output all formats put in the end map directory and let's call this initial then the IP address of Crimestoppers which is 10 10 10 80 this does take some time so I've already ran it and looking at the results we see only one port is open it is port 80 it's running Apache it's Ubuntu server and running version - 4 - 5 we can find out exactly what flavor of Ubuntu this is by just going to packages Ubuntu Apache and this is going to take us to packages that Ubuntu calm slash Apache - and this shows us what flavors of Ubuntu are bundled with what Apache version so trustees gonna be two four seven Daniels two four one eight artful two to seven and we skip to four to five which is a little bit weird so let's just Google Apache to four to five Ubuntu and we can get the very first result goes it's good a launchpad slash Ubuntu so that's a good sign and we see it says zesty and zesty isn't on this page either and if you google Ubuntu zesty we can see it reaches end of life January 13 2018 so let's just google Ubuntu end of life and go to that page and see all the Ubuntu versions so you bunch of calm / info / release end of life and is this gonna show us the way cycle of zesty and graphs I actually don't want that see is this what I wanted maybe it's the wiki yeah so we can see all the Ubuntu end of life this was released April 13 2017 and and the life date was January 13th 2018 so it didn't have a long life because this was an alts version the long something support maybe long term support is what LTS stands for and this information is it gonna help you for Crimestoppers but on an actual assessment if you can identify a end of life system which means it doesn't receive updates just by the Apache header you're gonna look like a wizard gonna be like how how do you know is gonna be vulnerable to this probe ask before even add a shell well Apache is just broadcasting it can't be updated since January 13 2018 it doesn't seem like a logical thing to note just based upon the Apache version but you can't find out anyways let's go back to the machine and we can go to 10 10 10 80 and see a mr. robot page looks like and once you see these pictures you can confirm yes it is a mr. robot famed machine and that's just a pretty darn good TV show and normally I would run go Buster or something like that but I have it on good authority that the creator of the machine isn't a dick and waste your time by just making you wait while the tool runs so the first thing I do when I come across the page and as I look at the source code to see if I can identify if it's WordPress or not looking for things like WP - plugins or something Joomla related and I don't see any of that I do see bootstrap here so bootstrap is a theme so if the page looks familiar it's probably just the developer decided to grab a common bootstrap theme and have at it so clicking around we do see a upload page o P equals upload we can submit a tip sending this we see secret name I don't know exactly what that variable is yet and Oh P equals view and normally with file uploads the very first thing you do once you upload a file is try to find out exactly where it uploaded so if we go to slash uploads we see read the source Luke so let's read the source code and looking at this the view doesn't really have anything let's change this to upload and we see the initiative comment five nine or fifty-nine SQL injection and tip submission remove database requirement by changing submit tip to create a file so we know there's no database at least that's what this comment is telling us so running things like SQL map and things like that is pretty pointless and it does create a file so that's worth knowing let us sniff this request to see exactly what happens so it's good a burp turn intercept on send a tip and we see a few interesting things looking at the cookie we see admin equals zero so that is definitely odd we see named tip and we got test so let's just instead of doing that let's change this to PHP echo hip sac and we could try shells and things like that but if PHP safe mode or something like that is enabled it may silently error so I generally like throwing just the accurate command or something safe then we got this token command I don't know exactly what touken is but we can put that too repeater to save the request for future use and then click forward drop that we get directed to view secret name click forward and we see your tip and the PHP code so doesn't look like it executed it's converting everything to HTML entities so not just a trivial code execution there it does say read the source so the very first thing I'm gonna do is probably fuzz this opie variable because I don't know exactly what secret name is but opie this looks like it's controlling the content of the page obviously because that's the only thing that's changing and I think I've intercept on and this is just how small PHP programs work that don't use a framework that does like MVC Model View controller so generally you don't want to have to write this little navigation bar actually before we go and explain that let's put admin equals one in a cookie and see what that is so cookies manager edit admin change that cookie to one refresh the page and we see a bunch of file names looks like just hashes I don't if they're all 32 characters it doesn't look like there but clicking whiterose text we do see hello you guys should really learn to code one of the get parameters is still vulnerable most will think this just leads to a source code disclosure but there's a chain that provides RCE remote code execution contact Waitrose at dark army HTTP for more info and this email is actually a big hint once we get a initial shell so remember that going back we're thinking okay one of the gate parameters is vulnerable and we only really have two we got Opie and test test secret name so the very first one I tested was Opie because how PHP templates used to work is you don't want to recode this navigation bar on every single file because if you added something like list or a new link up here then you have to go back and edit every single file same goes with the footer so generally how that worked is you'd have let's make a new directory call it explain I guess actually that'll be please sub so you got index dot PHP that is going to do some header stuff and that's going to make all of this then below that it's going to include and it's going to include get and then the parameter which was Opie and I'm doing this in each PHP statements because you can do HTML in between all this but after that you got PHP further so generally that's how small PHP applications work that don't use frameworks so we're guessing this Opie parameter is going to be follow name so the very first thing to test is let's do let's see passwd and we get no such page let's add a null byte and this definitely won't work because the null byte is an exploit from I think 2010 I think it's Apache not bad yeah PHP 5-3 for PHP fix no bite changelog let's see if we can quickly find this nobody looks like sometimes it gets vulnerable again through various things well let's just Google five three four and cheat I'm not exactly sure and instead of burning a lot of time just take my word that the noir bite and include statements was fixed so that's what this hint is saying is are you really trying that did we time travel this isn't the 90s and it's printing the doll bite you just can't render it also knowing that this was patched in 2010 if you go back to the releases zesty zap zap us I keep watch this morning to say Zapdos but zesty was released in 2017 so chances are a 2010 thing working is not good the next thing I would do is test things like index dot PHP to see if that exists it should then we can do home dot PHP and we see we get a white page if we put a bunch of junk we get not found so we know that page exists view dot PHP exists with stop PHP exists so we know that the script is probably just taking this Opie parameter and then appending dot PHP so what we can do is a different way a more recent like local file inclusion trick which is using PHP s wrappers the filter one in particular to do convert dot base64 - encode slash resource equals home and what this is going to do is convert the PHP script into base64 and when it does that Apache never sees the PHP tag so it doesn't send it to be interpreted and executed so you can just get the raw PHP source code this way so I'm gonna highlight that press end to go to the end and we will make a new directory called I guess dub dub dub no source I normally use dub dub dub as like Python simple HTTP server directory so I'm not going to put stuff there I'm gonna put in SRC for source and we grabbed home someone do V home dot PHP dot be 64 paste basics for dash D and put that in home dot PHP let me get in Valentin Berk is out of space at the end and we see at the very beginning it does a include too common dot PHP so we got a nother PHP script name and this looks like just HTML so let's grab index and then we'll grab other things so source equals index this is the biggest script and then index dot PHP b64 looking at this we have let's see this is that um match so if we do two dots or a null byte it executes they is this the 90s the cookie it's got the function page top to print the top and we don't really see anything interesting and index other than was that opie include statement each bottom I really hate PHP I can't even read my own code this is index so there should be and include there we go so if it can't include OPI PHP then do no such page and that comes right after it doing the page top function so I really should've done a better job coding that and since it's pretty bad when I can't read my care that I wrote about a year ago anyways let's just dump all the pages copy this them list PHP dot be 64 bases for - D - D come to code it this one doesn't really have anything so let's go to the next one we have home index list there was upload in view so upload PHP okay looking at this we see it doing a cross-site request forgery token on the uploads and we see it's placing tips in the folder of the client's IP address so if the directory up Lutz slash client IP doesn't exist make it chmod to 755 and I forget what this false does and that's going to generate a filename that's probably in common dot PHP and then direct them to view secret name and if the CSRF token doesn't work out it's going to print hacker detected so let's actually show that cuz I don't think I showed that before so if we click upload we can do test test go to burp turn intercept on send this to repeater and we get three or two found and it's going to direct us to the file and we can click follow redirection and we can see your tip is test if we send this request again without even modifying it click go we don't get that 302 Oh then we click there we go we have to click back because we followed the 302 this is the same exact upload request click go we get 200 ok and the message hacker detected and then a bunch of junk so how that works if we go to the code if you hit the upload page it's going to generate a token and then when you submit it it's going to kill the token so it only works once and that was done to prevent the disk from filling up of space of people just using an automated tool and hammering it so let's go to view is there anything there we have to turn there set back off phew no whoops you have to take this all again there we go feel copy this I didn't grab the space so we probably won't see that err a message director of the space will see yep no basically for error message because I think grab the space nothing here let's look at common good this and looking at common dot PHP we see if the hacker cannot control the filename it's totally safe to let them write files dot dot or is it so that's another hint at there's something wrong with being able to upload these files and it's kind of a hint to say let them write files not let them write tips or notes let them write files so let's go back to the upload code and see if we see anything interesting so we can ignore that CSRF stuff if directory uploads exist just create the directory upload client IP so let's try that my IP address is let's see 10 10 14 30 so going here let's do it in a new window uploads 10 10 14 30 we get the index page so we get rid of this view source and we know now that the secret name is really just V hashes so clicking this one we see PHP echo if SEC and it's completely blank when this should be valid command so let us copy this and PHP - a to enter the interactive mode and yes that is PHP code so hTML is just hiding everything in between these brackets and the reason why PHP isn't executing this is because it doesn't have like dot PHP PHP 5 ph p7 doesn't have the extension of apache to tell apache to send it to PHP so there is a PHP wrapper that will allow us to do that because we could send it files not tips but files so if you look at PHP wrappers and pull up the document and the reason why you're looking into this is because of White Rose text if we click list the get the get parameter that is vulnerable leads to source code disclosure we found that that was the PHP filter but there is a chain that provides remote code execution so if you did a lot of googling or just knew a little bit about PHP wrappers you would notice there is a zip one that wasn't the correct page let's see PHP wrappers lfi code execution let's see if this actually pulls up anything you do expect there's quite a few of these but in particular I'm gonna do zip because I think that's the only one this is vulnerable to it maybe form but all the ones let's see does this have zip in it it does not file lfi so how the zip one works is you can do zip colon slash slash the zip name a pound sign and then the file so this is going to be really handy because we can write this archive dot zip can just be that random junk that the server creates and then we can go into that file and call CMD and then it's going to do the dot php' appending to us so let us make a directory let's call this or not make a directory a file CMD PHP and we're going to make this called let's see do PHP echo system request I don't think it has to be capital it's just habit and we'll do one step please stop let's just do if SEC and this should execute code so it's going to take whatever is in the parameter if SEC and send to system and print the results so the next thing to do is zip this up zip is it CMD zipped and CMV dot PHP there we go so now we got that zip file so a lot of people I think made a mistake here I think they tried to just cat the CMD zip and then copy this cuz it doesn't look like there's any bad characters I'm gonna be a sad if there actually aren't bad characters in this one we'll see so a lot of people that we're trying this we have to go back go to uploads paste this but test and we can send the tip looks like junk here's that file name so what we're going to do is do Opie zip then we can do upload / 10/10 1430 because this is the directory the upload is in paste that put the pound sign do CMD that ape SEC is equal to Who am I so what this is going to do is go to this blob which is a zip file go into it put CMD the server script is going to append PHP for us and then we can do another parameter upset to do that and we get error no such page which is a bit odd so let's send this into burp because everything we did should have worked so send this let's refresh look at this and we don't see anything and that's because the HTML RFC a specification forever however this works uses whatever after the pound or hash tag as more of an anchor so if the web page has an anchor to go to certain locations that's how the browser knows that not to load the page just go to that spot on the page if that makes sense I don't think it does but I want to move on so we're just gonna that wasn't my clipboard cut this when I paste that send this to repeater click go we still get no such page so we're going to do is URL incur this was control you after we highlight it click go and we still are getting no such page so the next thing to do is let's verify this exists so let's copy all that we can turn intercept off and this is the second mistake I think a lot of people made when they were trying to do this exploit and I hope I really typed it right and okay we can download this so let's download it so curl that - oh this should be CMD dip but I don't want to overwrite it so we'll call it test dog zip we can md5 sum test odds if + CMD dot zip and these should be the same exact thing but they have different md5 sums and the reason being is let's see if we can dip these if it works with binary files they just differ it didn't copy some of the what is it newline characters correctly so let's see we'll just do it quickly if we can't do it quickly you can play with it but let's do tests on zip decks and we'll do CMD dot zip decks and then dip it so right off the bat we can see one begins with 504 B the other begins with 2050 so these are definitely different files if you try to unzip test dot zip let's go into a temp directory we get an error message so we do file test dot zip and even registers as ASCII text if we do file CMD dot zip it registers is zip so we got a lot of issues with how we uploaded that and that's another mistake I think a lot of people are made the way I would recommend doing this is when you want to copy a bunch of junk that has weird characters that you can't see let's use verb so we can do that again click intercept on send tip and then the tip let's go back to this we can do base64 - w04 with 0 so if we don't do that we can do CMD dot 0 and puts on multiple lines no if that's the issue but I just do - w0 put that all on one line when I'm doing this copy it go to Bert put it in highlight it and then we can verts election base64 decode and there we go this looks much different than the last one we sent if we go back see I'm not sure where we sent it was an edited well you can go back in the video if you want to see it but it looks a lot different so let's go back to intercept for I did it to repeater I think did I I'm not gonna worry about it so click forward turn intercept off we go back here it's not even printing out her tip which is weird did I do that wrong not sure so we're going to do is go to slash uploads 1010 1430 and now it just didn't bring it because the PHP script Aaron since it was a binary file and not text but this looks much better so let us save this file and we can do curl again so curl - OH new dot zip and we're going to md5 sum all the dips and we see CMD dot zip and new dot zip have that same exact md5 sum and the md5 sum of tested zip was different so now we have the correct file the real file uploaded so let's go back to boot go under Peter replace the file name with the new one click go and we get no such page so if we this let's see we can get rid of this for now real quick and this has to be your only coded I probably just didn't copy a character so let's see copy all of this actually let's test the whole string okay I did copy and paste poorly refresh let's just copy the whole string it's easy to make mistakes when doing some things man that was way off so we no longer have invalid page so we can add hips x equals who am i and now we get invalid page see oh it's and I don't know why was doing question marks and hip SEC equals Who am I there we go ww data so finally have code execution on the box so let's get a shell so pen test monkey reverse shell cheat sheet and I'm just going to do this net cat one because this almost always works so we'll as long as net cats on the box which for some reason a lot of things include it by default I don't know why let's see let's do port 8000 won actually 9,000 won because it's over 9000 and do 10 10 14 30 we got to URL encode this and that should be good so let's see n CL v NP 9001 click go did I get a immediate return which is good for us and we get a shell so Python - C input PT y PT y dot spawn band bash that doesn't exist so Python 3 and then we can background it do sty raw - echo hit FG enter and now we have a real shell so there is a file in the web directory that just gives credit to where this X boy came from my first stored in the 2016 plaid CTF or played CTF I'm not exactly sure how you pronounce that on web pixel shop so if you want to see another similar vulnerability find this and do that so the very first thing I guess we can do is if we grab the user flag if we go to home LS dash away and you see Dom go into Dom's directory and you have the user dot text that we can read so WCC use it at X 3 3 characters md5sum 32 then you got the new line which is 33 so could read that and we also have dot Thunderbird and that's interesting because if you remember all the way back at the very beginning of this we have white rose dot text and he's giving an email address so thunderbird is an email client what i'm going to do is go into thunderbird and we're going to copy this profile and i'm gonna do that by taradash see jvf and then we can put the file name so let's do verb dub dub HTML and then my broke just take focus that was weird probably Firefox auto update I hate that thing upload so it uploads yeah then 10 10 14 30 and we'll do this Firefox dot tar.gz to and then after that is the directory you want to zip up so now if we just go back to Firefox and go into uploads 10 10 14 30 we get and download the file and also I forgot to mention that if you had read the source and notice that was doing it I know a lot of people just brute force to other people's IP addresses and went into the directories and found files that way unintentional forgot to add like it I don't want to do dot index because I wanted people to see this or I guess in hindsight I could agree like a dot htaccess fall probably to restrict the directory by IP address or something weird like that but one small thing I forgot one creating this machine so if I knew I could just do dub dub dub buzz and fuzz the last octet and get other people's directories so let's go back to a machine and we can copy out of that Downloads directory we called it Firefox and then unzip it z x VF no z JX VF and move this into the Thunderbird so I have thought a good install you can just do apt-get install Thunderbird and then we can call Thunderbird with - I think profile manager default rename I thought it would have another one so after we copy that let's copy the name go into profiles I and I and change the profile and then we go into Thunderbird and we can read the emails so we see the person is Dom at Crimestoppers htb and there's a email RCE vulnerability this is Waitrose trying to contact saying I left note on leave a tip page but no response major vulnerability exists in your site this gives code execution continue to investigate we will sell exploit perhaps buyers not be so kind for more details place 1 million coins in your wallet payment instructions will be sent once we see you move money so this was a little bit of a pseudo hint I guess you could say because before white roses English was not horrible you guys should really learn to code want to get pram is vulnerable and now they kind of changed their tactic and additionally place 1 mil any coins in your wallet and then they will take it so it kind of hints potentially unless they're it's like Bitcoin and there's a ledger and they can publicly see it but they've access to the wallet that they're moving it to so once they see the transferred whatever USD to 1 million coins then they'll send payment instructions if you go to the sent mail you can see immediately Dom went to Elliot saying they got a suspicious email from the dark army claiming this remote code execution she doesn't trust them she ran a program called hurricane hunter which is route can Hana it reported that the Apache mod me back door was installed and according to the research if the rootkit was on the server she should be able to run netcat localhost 80 and type get root to get a root shell however the server just airs out without providing any shell at all would you mind checking this is a false positive so sending it to a security vendor to check on a malware alert that rootkit hunter said she also Ford's this to Santiago saying she's gonna try to trick white rose and pretend to set up a bug bounty page to pay it out this was actually a tactic I think someone did with uber when I was writing this machine there's something around that but this was the main email to look at and additionally you got her email account so there is a program called like Firefox decrypt there's also lasagna there's a bunch of things to decrypt Mozilla passwords if you just googled Firefox decrypt password you'd get to this github page and we can see the instructions say Firefox secret folder containing profiles not any so let's do Python then root Thunderbird master password you would think this is encrypted with the users password or something you have to crack it but by default no no master password just hit enter and we can see that there's a user Dom at Crimestoppers out htb with the password Gummer 59 Grace Gummer is the actress that played dumb so that's what the password came from 5-9 of course is a big thing in mr. robot so ssh dom at 10:10 1430 and oh no port 22 isn't open of course it isn't so what we can do is go back here do netstat al NP grep 22 and we see it is listening so there's something weird here can we go to Etsy and then find rap IP table CD IP tables cat rules v4 can we read this file we cannot we can see the rules v4 file is 413 bytes and the rules v6 file is only 191 so chances are the VIP v6 stuff has less information or less rules than the version 4 so do i piay ddr we can grab the ipv6 address of dead beef go back to abash and then ssh with those credentials and the password gamma five nine and we can SSH in so the next thing I'll do is start looking into that backdoor that Dom said so going into the sent mail we can Google Apache mod root me back door we copy this cuz obviously there's information since she's saying she should be able just to type get root to get a root shell which sounds weird so go to Apache mod me back door and we can clear out some of these old tabs very first result is mod root me and this is a public Apache rootkit that's when UNC localhost I'd get root and then it puts you as root so it installs to use the Lib Apache two modules so let's go there and see if the file exists so CD user share Apache modules LS dash LA and we can see yes it does exist here and was uploaded on December 22nd so let's copy this and SCP it so we could ask you it to ourselves but let's SCP to an ipv6 address because it's a little bit different so if we do SCP Dom at the ipv6 address too and we need - six I think you'll notice the issue when we type slash user web Apache two modules mod me SM I think you notice a weird issue ipv6 uses colons SCP uses Cohens to separate IP and file so ipv6 addresses generally can be also done in brackets and that also helps with the port because what's in brackets you can do port 80 so if you ever come across that scenario put it in brackets and we can do password and copy that file so very first thing to do is let's open this up in radar you could use Ida or something like really anything but I like using freighter and then the first thing is a a to analyze all functions if you don't know it may look confusing because you hit tab you got oh my god so much junk just two question mark let's wake Cisco switches and things like that of how to learn it and a is analysis command so you do a question mark and it tells you what all the things do so a a analyze all then a a a auto named functions after that so how you do it P is print stuff then you can do where's P D P D is print disassembled they can do P DC student assembler and see like syntax PDF just disassembled to print an ASM so it's really intuitive once you start using it a little bit so that's why I would recommend just using it especially for things like this AFL so a question mark AF is analyze functions then AFL analyze function list and we can list all the functions you can also do like vvv and go into visualization mode which is if you aren't too used to it there's also a program called cutter which turns which is a GUI for ADA but I generally don't like chaining open-source projects because they depend on two people instead of just one and looking at the functions you see a really odd one sim dark army so we can copy this and do PD F then at sim dark army and see what this is so and you can also I think ax are Sam dot dark army and what is it ax is it G to show X references where the codes used I think that's it anyways let's just go back to the assembly and analyze this so we'll do that and I meant oh it's a XT that's what it was is that what I did first now I did our a XT so sim dark army is called in route me post read request but we'll get to that in a minute we have the beginning of this function calling malloc and then le a load effective address we got a memory address here so it's loading just looks like a byte array into our di load effective address RSI and the string hack the box which is at memory address 0 x1 BFD and it's act the box so it loads two strings into memory registers it's going to clear out edx and then we'll go into a loop as indicated by this and also if you like visualization you could also do like capital DV sam dark army and analyze it like this if this is how you prefer it you can do like tab to change views or P as well so this is what we're looking at we're moving let's see the bite are di + r DX + o DX is let's see 0 so it's part of edx so it's really weird registers between like the various generations i guess you could say registers will jump it i think this will get me to the page I want yes call security oh it had such a pretty picture so early acts do we have a picture what does use this RDX is EDX just bigger so like how EDX is D H and DL and then DX o DX is e X EDX and then 32 bytes more over here well explanation look into how that works but already X is 64 bits so it's 2 of edx's essentially so we XOR this out it's probably going to be completely empty here so this is probably 0 right now already I this is the memory address here and it's moving that bite into ECX and then we have let's see 30 X again okay so already I the very first character of this whatever string is at this location it's getting put in ECX and that's going to RSI and then taking the very first character because our DX or DX is currently 0 taking the very first character of this and x1 against CL and this looks a little bit confusing but if you look at this ECX Co is the rightmost 8 bit so CL is part of ECX and this bro just to save space some compiler optimization or something weird like that but it's compiling the very first byte of already I just say compiling XOR in the very first byte of RTI and the very first byte of our si then it's going to add 1 to RDX it's going to check if our DX is equal to 0 X a which is 10 which is the number of characters in half the box then it's going to jump back up here and do it all over again this time our DX is now one higher so it's going to grab the second byte and this memory address of our di so instead of going to one bf2 it's going to one bf3 grab that bite put in ECX and instead of going to one B D F D it's going to one B D F E and putting that bite into your X going straight away and then adding one doing it all over again so all we have to do is grab the string at this address grab these won't we know the string at this address and XOR them so if we do pede question mark and look for hex so let's see peach x is a hex dump of bytes and we can do at that and we have the hex dump at one b f2 and if we do PDF one b f2 is where the string begins so we'll copy 10 bytes will copy up to the knob white because as we said before nor bite is a string terminator so this is 10 bytes long so create a new window we can do python b1 is equal to byte array this thing i'm doing the code right and back slash X okay I've got there that you do that just in case that air is out then we do B to byte array hack the box and then we can do for I in range zero think is it be one zeros at the very first character yeah so for I in range zero nine print will in Python - oh yeah Python to be 1i ex-ored with b1 or b2 I and then mistake there we don't need to put this in quotes and we get a bunch of hex so let's do that again at this time convert it to characters and we get fun society with fun society so I did something wrong for I and 0 to 10 there we go fun society so we ex-ored there's two strings together and got this so if we quit out we can do get NC ten tenten a tenten 1430 port 80 nope 10 10 10 80 port 80 and then get fun society do ID we are root we can go into slash root and get the file so WC - see root text and we're done one small thing if we wanted to look at that X references there's something that may have thrown people off if we do strings on mod root me you'll see it's looking at this White Rose file and that is weird why is it looking at that and that could have put people down a weird hole that's really nothing to do with that at all all that there is to prevent people from taking this script and using it elsewhere they have to modify it themselves they don't want get root so if we do a X T naught X T how do we view strings you know because we gotta get the memory location of this string so PS no question mark I there we go hi Z so you do dump strings and data section we could also search in the whole binary and that's more with the strings program showed let's just do the data section and we can see this string is stored at one c one e so if we do a XT and ax is cross-references t is right here address to this address so ax t find out where this memory location is referenced in the binary we see it's in Sam root me post read request so we can PDF that and we see it's right here and you can also if you like it I just copy too much VV go into visualization mode and it's loading the string into ODI clearing out ESI doing a access s call and if the file exists go down here and do stuff if the file doesn't exist exit right away so if that file whiterose txt doesn't exist the route gets gonna do nothing I think there was one more thing I wanted to do I can't remember what that is oh I remember it's back to the PDF at sim dark our main or we can do the read request so I did PDF it's pretty hard to read if you don't know assembly you could do PDC and it's kinda temp to decompile it and we can see Q word so it's kind of more syntax or C syntax like output and we can see access and then it's unlikely at this I don't really use it that often I generally like this output much more than the PDC but it does exist if you do the same dark army this may make more sense to you than the PDF is there any other outputs it does let's see sudo C like syntax and just Google not Google like offset formatted assembly PDS JSON nope I was worried if it - like Python or something but doesn't look like it so that is the reverse engineering piece of this there is a unintended root method if we pretend we are incident responders so if we're not mr. robot and go hack stuff and we're for Elliot who is a essent responder we can just kind of guess when the incident occurred so if we do CD for job HTML upload Waitrose tax this is when he left the message for us and that was on December 23 looking at the email let's see when did he email us December 16th which is a little bit odd so pretty much all of December we can assume this server was compromised because December 16th is when he emailed us and the file was last modified December 23 and let's see we can use fine to list all the files that were modified in December so find / - type F to only search files then newer MT 2017 we'll do December 15th actually we'll do December 10th the exclamation point - newer M T and this is the end date 2017 1231 and then we also do - LS so it shows us all the permissions and we don't want to see what's in dev null so here's all the files that have been modified and this is definitely good to do for instant response because you can see generally what the actor did and also it's good and CTFs because this is when I was on the box is when I was developing it so chances are the files I put on here or relevant so we can see the IP table rules let's see shadow file so a password was changed probably or added what a net see there's a bunch of stuff there user share you don't care about that Python so this is grabbing a bunch of stuff from install so I'm going to change the start date to be a little bit less noisy and do I think 16 or will do looks like everything was generally only 16 so we'll do the 17th and we get a lot less so let's see let's see not much changed we have logs from around the time I was on the box and Apache logs root cut home root get hundred logs and I forgot I'd leave these Mabel yes because gum is a member of a DM so she can read log files so we do four log you could have looked at the root get hundred logging yourself because this requires - see you need me root to run it and I didn't give her student missions because I didn't feel like people exploiting rootkit hunter itself if that had an exploit yeah so if we can't ok hundred got log dot one permission denied so we don't have to mission for that one no but we do have mission for the Apache I saw the access log yeah it's in Apache too so we have access to these logs and we can see it goes December 24 25 26 27 then May because of how hack the box works with reverting and things like that so we can do Z cap to go into the actual logs that are guns it Z cat just unzips and then does cat so access log we're not gonna care about error that's probably interesting but we can do two three four dot star and we can view everything at the very end we have a bunch of weird stuff and we have get root root hack the box dark army White Rose hacked the box let's see bunch of odd ones on December 23 so let's just say what do we want to do let's grip - V and we don't want options head first get and we see more on Christmas we see fun society quite a few times and we also may just want that 400 so grab 400 there we go so right now I'm just trying to filter out standard HTTP requests because you would see the get posed Ted options for this we're not and we can see just fun society constantly right around Christmas time actually on Christmas at one o'clock so just before I went out for Christmas dinner I was testing this box and creating this Apache module and actually what happened was if you go to the mod route me page you can't just run this anymore if you go to the issues we see Jeff McJunkin because this was used in net words he just didn't modify it but you need the HTTP protocol options unsafe and Apache to kampf so all this stuff was created because I didn't have that flag again and it wasn't giving me the shell so there's route me on December 23rd so that's when the module got installed and me testing wait why does it that work so I think that may be it I hope you guys enjoyed the box and enjoyed the video as well take care and I'll see you next week