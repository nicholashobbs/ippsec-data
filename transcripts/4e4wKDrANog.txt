 what's going on youtube this is ipsec been doing paper from hack the box which starts off with just finding a default apache page for centers but if you examine the server headers it leaks a hostname of office.paper when you navigate there you find a wordpress blog that's set up like a blog from the office which is a tv show and if you examine wordpress it's running version 5.2.3 which is vulnerable for a way for unauthenticated users to view draft first or saved post so when you look at this url you discover that there's a rocket chat server because there's a registration link in one of the drafts and you join the rocketchat server you find that dwight set up a bot that allows command execution or not command execution reading files and you read the environment file to get a password you can ssh and as him and then the privasc is a uh policy kit one that you can find via linps so with all that being said let's jump in as always we start off with an nmap so dash sc for default scripts as v enumerate versions o a output all formats bring the nmap directory and call it paper and then the ip address of 1010 11.143 this can take some time to run so i've already ran it looking at the results we have just three ports open the first one being ssh on port 22 and its banner tells us no information most of the time we're used to being able to see like a distro in here like ubuntu debian things like that but we get absolutely nothing the next port we have is http on port 80. its banner tells us it's running apache and a center server so i don't know if it's centos is default configuration to just not put its os information in ssh but that is how this one's configured i'm assuming it is default we could probably google one of these packages most likely this mod fcg id and get exactly what like um flavor of santos this is i think flavor's the right word um identify if it's like center six seven uh whatever they're at now so we see center seven and oh uh two three nine so it looks like we can't do that with this because two three nine is existing in centers eight along with um center seven so we have a dash six and a dash 17 then dot el8 is there any more information in this no there is not so we can't identify exactly what version of centos this is because the version isn't going um specific enough we just know it centers the other thing we have is https on port 443 it's also centers and i'm looking at like the title i don't see like an http title here so maybe this is a different page we do have the hostname just localhost.localdomain so it's a self-signed certificate and here's the http title page and it looks like both of these are the same exact thing so um i'm not sure exactly what https is doing on the server maybe it's just default to put in both so let's just go take a look at it so 1010 11.143 and we get an http server test page so the first thing i'm going to do is just run a ferro buster on this we just specify dash u and put this in to see exactly what other things exist and we're getting a lot of errors um not exactly sure why that is if we go all the way up let's see we have images misc style manual so i'm not sure exactly why fair buster is getting those errors if we go to go buster we may be able to see the error code there see how it handles it dash u word list opt sec list uh discovery web wrapped small words dot text and let's just see what errors we get if any so 301 403 it looks like this is behaving as expected i'm not sure exactly what was going on there so when your application gives you a bunch of errors try switching application and see what happens um we could just examine the headers in burp suite so if we turned intercept on go to proxy intercept we have to enable burp suite here refresh this page we can look at it in the repeater tab and see what headers look like we do have an x backend server at office.paper so we could try testing this one out so i'm going to do sudo vi etsy host and add 101011 143 and put office.paper and the interesting thing is um i would think nmap would tell me this but if i look for nmap of office it doesn't so it's only putting specific um headers in this so that's something to just keep in mind that you're not going to get every header you want out of this um i want to say the banner plus may do that let's see do i have it i do have this installed so i'm just going to run sudo and map script banner plus 10 10 11 143 and radio port 80 dash n to not do dns so this runs a bit faster and the banner plus is going to put all this information into your map report which you may not want because pages have a lot but um it does show the backend server being office.paper so you may want that script you may not um generally i do like running the script and you can always just like grab that information out if you don't want it so all that does is makes a request and outputs everything that it responds with so normally when asked to save the data or not i opt to save the data and i don't know if that's a default script so you may have to just google like banner plus nse and download it we probably should turn brip suite off uh banner plus mse you can download it from this thing but let's add office.paper did we do that sudo vi etsy host uh we did so we should be able to go to office.paper and see what this is about it looks like we're getting to a wordpress site so we have some post by prison mike and the from june 2021 uh blunder tifflin so it looks like it's a mock of the office um paper company definitely so the very first thing i do with wordpress as that's what this looks like we can probably verify by doing wp-admin or looking at the page source if we do control u we see um wordpress ooh it's telling us the version five two three we can make that bigger for you wordpress let's see 5.2.3 so we have the version there but it was up here right here at the generator so i like running wp scan wherever i get it so wp scan url and we should put http office.paper and then after this one runs i generally do enumerate all plugins and set plugin discovery method to be aggressive but that takes a while to run so i like just doing the quick scan first looking at what it tells me because this took like 10 seconds right so um much quicker just looking through we do have 523 it's identified insecure released in 2019 so that's probably gonna be where i start off but um [Music] let us do the other thing so i'm gonna do dash e for enumerate and if we look for dash e that's exclude e we could enumerate vulnerable plugins all plugins vulnerable themes can enumerate a lot of things um i like doing all plugins i don't really care about the um themes and whatnot so i'm just going to do dash e ap and then let's see i don't think it's plugin detection search hold on let's see yeah this one plug-ins detection we want to change this to aggressive um the version doesn't really help you you want plug-ins dash detection and put this as aggressive and sometimes this finds plugins when um the default does not so while that runs we have go buster maybe all these 403s is what pharaoh was saying is error but gearbox doesn't find anything we want to look at wordpress 523 exploits and see what there is we do have unauthenticated viewing of post or drafts so if we do wordpress.local question mark static equals one we should be able to see potential draft post so question mark static equals one we get a 404 if i take off the order and just do static equals 1 we see something so i'm not exactly sure why i had to do that [Music] but apparently i did let's see do we have the cve we have a blog post here do they have that order equals ascending so this is talking about why it's vulnerable static equals one so in this post it's just saying static equals one so we do see what looks like to be blog post if i change static does this change the blog post it does not look like it i'm guessing it's just dumping every blog post so we see test michael please remove secret from drafts dude.orders it's the inside fbai agent so that's something different secret registration for url for new employee chat system we have chat.office.paper and we have a note here saying the person thought it was secure because it's a draft but of course this wordpress is out of date which let us view the drafts so we're going to have to add this to our host file so let's do sudo vi etsy host add the chat.office.paper and if we go there we have rocket chat so i'm going to go to this secret registration link because i don't see any register here so i'm guessing it's like discord and other things where you're supposed to give people a registration link and then they can register so if i do just a fake user put the password of password and we log in so let's just use our username of ipsec and it looks like we're on the rocketchat server and i'm going to guess there's a lot of vulnerabilities here just because rocketchat in general i think has a lot um let's see if we search rocket um exploit db's been going slow for me with that lately i'm going to do search point rocket chat rocket chat with this and we have some sql injections on authenticated so at the end of the video i'm going to try playing with these because from memory i want to say this is a recent one let's see does it give us a cbe 2021 so i'm not exactly sure if it's vulnerable but we'll check out at the end of the video because this one is going pretty quick if we have something in general we look at it this room is read only it's employee chatter but if we scroll up we can see someone put a bot here um recyclops designed by dwight and you can ask questions um where's the contents of the file in x in your sales directory you can do jokes um but it says message recyclops file with the file name and we can get it so let's try this i'm going to go to the dm say recyclops file.txt test.text and it's running cat so the very first thing i want to try is like command injection right so i'm just gonna do semicolon who am i it says stop injecting commands let's try a different one like dollar this uh nothing we do this still nothing maybe backticks so it looks like there's some pretty good command injection prevention here however um we can probably do directory traversal all right so if i just do etsy pass wd uh it says oh we have to do dot slash there we go and we get the contents of the passwd file uh my favorite directory is proc self whenever first doing a lfi on linux i generally go for like cmd line um oddly enough we're getting the cmd line of our self so i'm guessing it spawned something i like getting environment so environ to get the environment and we have some good information here let's see we got the user recyclops is there cycleops a user here it is not so it's only a discord user uh the pwd is home dwight so i'm guessing dwight is running this rocketchat is running on port two oh i'm guessing not using ssl we have a rocket chat password and it's queen of blades 23 so it looks like he is a starcraft fan um let's just do ssh dwight at 10 10 11 dot let's see what is it 143 i think put in that password and we get logged in first thing i want to check is just pseudo-l to see if there's anything there no dwight can't run pseudo on paper but i want to take a look more at this lfi real quick because there was one interesting thing normally when i get cmd line it gives me a bit more information than just this cat so um i'm guessing the os dot system commands being ran and that's why this is the cmd line i wonder if i can do stat and get the parent process so this is rpid um i want to say this is the parent process and this is a group so let's try cutting this so proc this cmd line and we can so this is definitely going to be the parent process we have node running who bought um coffee i don't know what this known module is script coffee who bought node modules and rocket chat so that's it running rocket chat um you'd be surprised the information get out of this proc directory by just um playing with it what if we can get the environment from this one we could and we also see queen of blades here another way we could probably get this is if we do proc self cwd um i wonder if we can list files file list let's see video file dot env is generally how a bunch of web apps put environment variables and we can see if we do that we have all the environment variables it's exporting and we get the password there as well so um some handy things when you do lfis always check for env files and extract source code what not but now that we're dwight we already tested for sudo we can't run it we have this bot restart but before i even start looking at the bot restart i just want to see the like call tree of this right and we can see right off the bat this bot restart is running by dwight so it's not that much interest to me because if i get command injection in here it's not going to execute as another user because it's turning off by dwight the parent process is kron d that's root but um root is running this as dwight so there's nothing really interesting here other than potential passwords which we already have um let's see this would be interesting we maybe will get on the rocket chat user if we go to opt rocket.chat we can see what is there so ls up rocket.chat looks like we can go in there we lsla um it's not writable by everyone so if we do find uh i think dash writable see if there's anything here nope so we can't write anything so we can't um execute code as rocket chat we could try to find the password but i'm guessing it's going to be like queen ablaze or something like that i wonder what star.json is uh let's see pass nothing there so the other place we could have went and got a password is the dub dub dub directory because it had wordpress so i'm going to try going d mifflin blog and we can't because only apache can go in there um if we do a lsla on html we can't write files there so we can't like drop a php shell and get it as the apache user and do things so at this point i'm kind of like running out of things to manually check so um i'm going to go over to lin p's so if i just i was going to say google nps but we just do lin p's github go down to the google like that and we can always i always like going to the github page so i can download the latest uh because you'd be surprised like how often things change like 22 hours ago this has been updated so um always like running the latest let's make dirt dub dub dub w get python3 dash m http server and then we can curl 10 10 14 8 port 8000 linps.sh pipe it over to bash and we have it running so i'm going to pause the video let this run and we'll take a look at the results when it's done now that linps is done i'm just going to search for thank you to get to the top of it i think it's a lowercase u there we go and we can take a look at everything here so it's giving us the kernel version i'm looking for the build date so we have wednesday december 22nd 2021 so the kernel is um i guess six months old at this point which is probably new for when the box was released looking down we see it is highlighting it is vulnerable to cve 2021-3560 so i'm going to go over to google and see exactly what this is by doing poc github because github's where all the cool exploits are i guess we see um secnigma and it's a policy kit privilege escalation so let's go and just try this out if we copy it raw we should be able just to paste it in so let's go to dev shm v polykit.sh i guess i'll call it set my mode to paste paste this exploit in and then just go quickly glance over it to make sure it's not doing anything dangerous we have optional arguments so enter custom username and password um let's see user pass time there's quite a bit to check um i saw ubuntu when i was going through is there centers it looks like there is and it's checking if it's vulnerable by doing an rpm dash qa that is a query all gripping for poly kit and then looking for the version so 0.11 and looking for three to nine so it's looking for like one one three one one five one one six things like that um [Music] yeah i'm not exactly sure what everything does but the beauty of hack the box if this breaks the system it's not my system i can just revert it right so if we run this we can see the username is set as secnigma and it is trying insertion of username failed we have some type of access denied so it appears to be vulnerable um inserting username let's see usually multiple attempts are required to get timing right so it's saying to run it multiple times so we can it's trying and this time it looks like it did insert the user secnigma and it looks like password insertion is successful so su dash when entering i know your password i wonder if password is going to be seconigma sec enigma does not look like it um cat etsy pass wd did this write the password here so we have it definitely adding the user but we don't know the password um is it smart enough actually to use that queen of blades password there's no way it's that smart right let's see um we wanted to get the environment is that back here so did just copy it from like shadow and put it as her password no let's see does it tell us what the password is username is set paul kit username uid set setting password hash okay so uh let's see let's look at pulkit password when prompted for password enter your password what is the default password to this secnigma for the win so oh wait cat etsy passwd so the user got deleted so i'm guessing it gets reverted periodically so let's run this again and we could have also just specified the password right but um that's not fun so if we do this then type ftw after it does it log in let's see secnigma for the win that should have been the password s u dash oh wait sec enigma put this password in there we have it and then the exploit i think gives us the permission to do pseudo with everything so we can do sudo su and now we are root so um that is the box but there are some things i wanted to go over so let's see the one cool thing is we do have this searching for passwords let's see does it find it here i don't think so but lin pease surprised me when i was doing this for the first time it actually has a special thing to analyze rocket chat files so we can see it found the rocket chat service gets this credential so here's the password for rocket chat so another password we could have tried um so if we do like s u dash is it rocket rocket chat put this password in can we log in as him does not look like we can authentication failure so let's see let's do sudo su oh it reverted again let's just go opt rocket chat what version is this we look at readme does it have the version that is not for rocket chat server programs i don't know what version this is uh config.json is this going to tell us no um let's just go back to that exploit db and i want to try this nosql injection see if this works so this looks like it's just a python script changing password to factor see are both these like the same i wonder which one is going to be better oh it's from enoch so he is a hack-the-box player i recognize that handle but let's just try this um i'm going to call it rocket.pie set paste that's the wrong paste there we go python3 rocket.pi pip3 install oauth tool does it now run okay so let's see dash u low priv user email root ipsec dot rocks dash t http chat.office.paper let's see if this works uh the following requirement is required administrator email it says it's optional um admin at office.paper let's see if this worked um maybe it doesn't because this doesn't even have mail see i wonder if the other one requires the same exact thing so i think we grabbed the two one low priv admin says requiring admin email is this one doing so they both acquire admin email i'm guessing this is not going to work or i don't know how to use this exploit i thought it was gonna be easier when i saw it on exploit db but does not look like it is so that's gonna be the video hope you guys enjoyed that take care and i will see you all next time